!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CesiumPro={})}(this,(function(e){"use strict";var t=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*t,kilometers:6371.0088,kilometres:6371.0088,meters:t,metres:t,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:t/1852,radians:1,yards:6967335.223679999};function r(e,t,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function n(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!u(e[0])||!u(e[1]))throw new Error("coordinates must contain numbers");return r({type:"Point",coordinates:e},t,i)}function o(e,t,i){void 0===i&&(i={});for(var n=0,o=e;n<o.length;n++){var s=o[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:e},t,i)}function s(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:e},t,i)}function a(e,t){void 0===t&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function l(e){return 180*(e%(2*Math.PI))/Math.PI}function c(e){return e%360*Math.PI/180}function u(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function h(e){return!!e&&e.constructor===Object}function d(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function p(e){return"Feature"===e.type?e.geometry:e}function m(e,t,r){void 0===r&&(r={});var n=d(e),o=d(t),s=c(o[1]-n[1]),a=c(o[0]-n[0]),l=c(n[1]),u=c(o[1]),h=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(l)*Math.cos(u);return function(e,t){void 0===t&&(t="kilometers");var r=i[t];if(!r)throw new Error(t+" units is invalid");return e*r}(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),r.units)}function f(e,t,i){if(null!==e)for(var r,n,o,s,a,l,c,u,h=0,d=0,p=e.type,m="FeatureCollection"===p,g="Feature"===p,_=m?e.features.length:1,v=0;v<_;v++){a=(u=!!(c=m?e.features[v].geometry:g?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var y=0;y<a;y++){var C=0,x=0;if(null!==(s=u?c.geometries[y]:c)){l=s.coordinates;var w=s.type;switch(h=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,d,v,C,x))return!1;d++,C++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],d,v,C,x))return!1;d++,"MultiPoint"===w&&C++}"LineString"===w&&C++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(n=0;n<l[r].length-h;n++){if(!1===t(l[r][n],d,v,C,x))return!1;d++}"MultiLineString"===w&&C++,"Polygon"===w&&x++}"Polygon"===w&&C++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,n=0;n<l[r].length;n++){for(o=0;o<l[r][n].length-h;o++){if(!1===t(l[r][n][o],d,v,C,x))return!1;d++}x++}C++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===f(s.geometries[r],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function g(e,t){var i,r,n,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===e.type,m="Feature"===e.type,f=p?e.features.length:1;for(i=0;i<f;i++){for(a=p?e.features[i].geometry:m?e.geometry:e,c=p?e.features[i].properties:m?e.properties:{},u=p?e.features[i].bbox:m?e.bbox:void 0,h=p?e.features[i].id:m?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<s;n++)if(null!==(o=l?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}function _(e,t){g(e,(function(e,i,n,o,s){var a,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(r(e,n,{bbox:o,id:s}),i,0)&&void 0}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<e.coordinates.length;c++){var u=e.coordinates[c];if(!1===t(r({type:a,coordinates:u},n),i,c))return!1}}))}function v(e,t,i){var r=i,n=!1;return function(e,t){_(e,(function(e,i,r){var n=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,l=0,c=0,u=0;return!1!==f(e,(function(o,h,d,p,m){if(void 0===a||i>l||p>c||m>u)return a=o,l=i,c=p,u=m,void(n=0);var f=s([a,o],e.properties);if(!1===t(f,i,r,m,n))return!1;n++,a=o}))&&void 0}}}))}(e,(function(e,o,s,a,l){r=!1===n&&void 0===i?e:t(r,e,o,s,a,l),n=!0})),r}function y(e,t,i){if(void 0===i&&(i={}),!0===i.final)return function(e,t){var i=y(t,e);return i=(i+180)%360}(e,t);var r=d(e),n=d(t),o=c(r[0]),s=c(n[0]),a=c(r[1]),u=c(n[1]),h=Math.sin(s-o)*Math.cos(u),p=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(s-o);return l(Math.atan2(h,p))}function C(e,t,r,o){void 0===o&&(o={});var s=d(e),a=c(s[0]),u=c(s[1]),h=c(r),p=function(e,t){void 0===t&&(t="kilometers");var r=i[t];if(!r)throw new Error(t+" units is invalid");return e/r}(t,o.units),m=Math.asin(Math.sin(u)*Math.cos(p)+Math.cos(u)*Math.sin(p)*Math.cos(h));return n([l(a+Math.atan2(Math.sin(h)*Math.sin(p)*Math.cos(u),Math.cos(p)-Math.sin(u)*Math.sin(m))),l(m)],o.properties)}function x(e,t,i,r){if(!h(r=r||{}))throw new Error("options is invalid");var n,o=[];if("Feature"===e.type)n=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");n=e.coordinates}for(var a,l,c,u=n.length,d=0,p=0;p<n.length&&!(t>=d&&p===n.length-1);p++){if(d>t&&0===o.length){if(!(a=t-d))return o.push(n[p]),s(o);l=y(n[p],n[p-1])-180,c=C(n[p],a,l,r),o.push(c.geometry.coordinates)}if(d>=i)return(a=i-d)?(l=y(n[p],n[p-1])-180,c=C(n[p],a,l,r),o.push(c.geometry.coordinates),s(o)):(o.push(n[p]),s(o));if(d>=t&&o.push(n[p]),p===n.length-1)return s(o);d+=m(n[p],n[p+1],r)}if(d<t&&n.length===u)throw new Error("Start position is beyond line");var f=n[n.length-1];return s([f,f])}function w(e,t,i){if(!h(i=i||{}))throw new Error("options is invalid");var r=i.units,n=i.reverse;if(!e)throw new Error("geojson is required");if(t<=0)throw new Error("segmentLength must be greater than 0");var o=[];return _(e,(function(e){n&&(e.geometry.coordinates=e.geometry.coordinates.reverse()),function(e,t,i,r){var n=function(e,t){return void 0===t&&(t={}),v(e,(function(e,i){var r=i.geometry.coordinates;return e+m(r[0],r[1],t)}),0)}(e,{units:i});if(n<=t)return r(e);var o=n/t;Number.isInteger(o)||(o=Math.floor(o)+1);for(var s=0;s<o;s++){r(x(e,t*s,t*(s+1),{units:i}),s)}}(e,t,r,(function(e){o.push(e)}))})),a(o)}function b(e){var t=[1/0,1/0,-1/0,-1/0];return f(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}function S(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function T(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){if(this instanceof e){var i=[null];i.push.apply(i,arguments);var r=Function.bind.apply(t,i);return new r}return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),i}function E(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=d(e),n=p(t),o=n.type,s=t.bbox,a=n.coordinates;if(s&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,s))return!1;"Polygon"===o&&(a=[a]);for(var l=!1,c=0;c<a.length&&!l;c++)if(P(r,a[c][0],i.ignoreBoundary)){for(var u=!1,h=1;h<a[c].length&&!u;)P(r,a[c][h],!i.ignoreBoundary)&&(u=!0),h++;u||(l=!0)}return l}function P(e,t,i){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var n=0,o=t.length-1;n<t.length;o=n++){var s=t[n][0],a=t[n][1],l=t[o][0],c=t[o][1];if(e[1]*(s-l)+a*(l-e[0])+c*(e[0]-s)==0&&(s-e[0])*(l-e[0])<=0&&(a-e[1])*(c-e[1])<=0)return!i;a>e[1]!=c>e[1]&&e[0]<(l-s)*(e[1]-a)/(c-a)+s&&(r=!r)}return r}b.default=b;var A=6378137;function M(e){return function(e,t,i){var r=i;return g(e,(function(e,n,o,s,a){r=0===n&&void 0===i?e:t(r,e,n,o,s,a)})),r}(e,(function(e,t){return e+function(e){var t,i=0;switch(e.type){case"Polygon":return D(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)i+=D(e.coordinates[t]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(t)}),0)}function D(e){var t=0;if(e&&e.length>0){t+=Math.abs(L(e[0]));for(var i=1;i<e.length;i++)t-=Math.abs(L(e[i]))}return t}function L(e){var t,i,r,n,o,s,a=0,l=e.length;if(l>2){for(s=0;s<l;s++)s===l-2?(r=l-2,n=l-1,o=0):s===l-1?(r=l-1,n=0,o=1):(r=s,n=s+1,o=s+2),t=e[r],i=e[n],a+=(R(e[o][0])-R(t[0]))*Math.sin(R(i[1]));a=a*A*A/2}return a}function R(e){return e*Math.PI/180}function O(e,t,i){void 0===i&&(i={});for(var r=d(e),n=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(t),o=0;o<n.length-1;o++){var s=!1;if(i.ignoreEndVertices&&(0===o&&(s="start"),o===n.length-2&&(s="end"),0===o&&o+1===n.length-1&&(s="both")),I(n[o],n[o+1],r,s,void 0===i.epsilon?null:i.epsilon))return!0}return!1}function I(e,t,i,r,n){var o=i[0],s=i[1],a=e[0],l=e[1],c=t[0],u=t[1],h=c-a,d=u-l,p=(i[0]-a)*d-(i[1]-l)*h;if(null!==n){if(Math.abs(p)>n)return!1}else if(0!==p)return!1;return r?"start"===r?Math.abs(h)>=Math.abs(d)?h>0?a<o&&o<=c:c<=o&&o<a:d>0?l<s&&s<=u:u<=s&&s<l:"end"===r?Math.abs(h)>=Math.abs(d)?h>0?a<=o&&o<c:c<o&&o<=a:d>0?l<=s&&s<u:u<s&&s<=l:"both"===r&&(Math.abs(h)>=Math.abs(d)?h>0?a<o&&o<c:c<o&&o<a:d>0?l<s&&s<u:u<s&&s<l):Math.abs(h)>=Math.abs(d)?h>0?a<=o&&o<=c:c<=o&&o<=a:d>0?l<=s&&s<=u:u<=s&&s<=l}function N(e,t){var i=p(e),r=p(t),n=i.type,o=r.type;switch(n){case"Point":switch(o){case"MultiPoint":return function(e,t){var i,r=!1;for(i=0;i<t.coordinates.length;i++)if(F(t.coordinates[i],e.coordinates)){r=!0;break}return r}(i,r);case"LineString":return O(i,r,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return E(i,r,{ignoreBoundary:!0});default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"MultiPoint":return function(e,t){for(var i=0;i<e.coordinates.length;i++){for(var r=!1,n=0;n<t.coordinates.length;n++)F(e.coordinates[i],t.coordinates[n])&&(r=!0);if(!r)return!1}return!0}(i,r);case"LineString":return function(e,t){for(var i=!1,r=0;r<e.coordinates.length;r++){if(!O(e.coordinates[r],t))return!1;i||(i=O(e.coordinates[r],t,{ignoreEndVertices:!0}))}return i}(i,r);case"Polygon":case"MultiPolygon":return function(e,t){for(var i=!0,r=!1,n=0;n<e.coordinates.length;n++){if(!(r=E(e.coordinates[1],t))){i=!1;break}r=E(e.coordinates[1],t,{ignoreBoundary:!0})}return i&&r}(i,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"LineString":return function(e,t){for(var i=0;i<e.coordinates.length;i++)if(!O(e.coordinates[i],t))return!1;return!0}(i,r);case"Polygon":case"MultiPolygon":return function(e,t){var i=b(t),r=b(e);if(!k(i,r))return!1;for(var n=!1,o=0;o<e.coordinates.length-1;o++){if(!E(e.coordinates[o],t))return!1;if(n||(n=E(e.coordinates[o],t,{ignoreBoundary:!0})),!n)n=E(z(e.coordinates[o],e.coordinates[o+1]),t,{ignoreBoundary:!0})}return n}(i,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Polygon":case"MultiPolygon":return function(e,t){var i=b(e);if(!k(b(t),i))return!1;for(var r=0;r<e.coordinates[0].length;r++)if(!E(e.coordinates[0][r],t))return!1;return!0}(i,r);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function k(e,t){return!(e[0]>t[0])&&(!(e[2]<t[2])&&(!(e[1]>t[1])&&!(e[3]<t[3])))}function F(e,t){return e[0]===t[0]&&e[1]===t[1]}function z(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}
/**
     * splaytree v3.1.2
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
function B(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var G=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function W(e,t){return e>t?1:e<t?-1:0}function U(e,t,i){for(var r=new G(null,null),n=r,o=r;;){var s=i(e,t.key);if(s<0){if(null===t.left)break;if(i(e,t.left.key)<0){var a=t.left;if(t.left=a.right,a.right=t,null===(t=a).left)break}o.left=t,o=t,t=t.left}else{if(!(s>0))break;if(null===t.right)break;if(i(e,t.right.key)>0){a=t.right;if(t.right=a.left,a.left=t,null===(t=a).right)break}n.right=t,n=t,t=t.right}}return n.right=t.left,o.left=t.right,t.left=r.right,t.right=r.left,t}function H(e,t,i,r){var n=new G(e,t);if(null===i)return n.left=n.right=null,n;var o=r(e,(i=U(e,i,r)).key);return o<0?(n.left=i.left,n.right=i,i.left=null):o>=0&&(n.right=i.right,n.left=i,i.right=null),n}function V(e,t,i){var r=null,n=null;if(t){var o=i((t=U(e,t,i)).key,e);0===o?(r=t.left,n=t.right):o<0?(n=t.right,t.right=null,r=t):(r=t.left,t.left=null,n=t)}return{left:r,right:n}}function j(e,t,i,r,n){if(e){r(t+(i?"└── ":"├── ")+n(e)+"\n");var o=t+(i?"    ":"│   ");e.left&&j(e.left,o,!1,r,n),e.right&&j(e.right,o,!0,r,n)}}var q=function(){function e(e){void 0===e&&(e=W),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=H(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var i=new G(e,t);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var r=this._comparator,n=U(e,this._root,r),o=r(e,n.key);return 0===o?this._root=n:(o<0?(i.left=n.left,i.right=n,n.left=null):o>0&&(i.right=n.right,i.left=n,n.right=null),this._size++,this._root=i),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,i){var r;return null===t?null:0===i(e,(t=U(e,t,i)).key)?(null===t.left?r=t.right:(r=U(e,t.left,i)).right=t.right,this._size--,r):t},e.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=U(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){for(var t=this._root,i=this._comparator;t;){var r=i(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=U(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){for(var t=this._root,i=this._comparator;t;){var r=i(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){for(var i=this._root,r=[],n=!1;!n;)null!==i?(r.push(i),i=i.left):0!==r.length?(i=r.pop(),e.call(t,i),i=i.right):n=!0;return this},e.prototype.range=function(e,t,i,r){for(var n=[],o=this._comparator,s=this._root;0!==n.length||s;)if(s)n.push(s),s=s.left;else{if(o((s=n.pop()).key,t)>0)break;if(o(s.key,e)>=0&&i.call(r,s))return this;s=s.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var i=t.key;return e.push(i)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var i=t.data;return e.push(i)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},e.prototype.at=function(e){for(var t=this._root,i=!1,r=0,n=[];!i;)if(t)n.push(t),t=t.left;else if(n.length>0){if(t=n.pop(),r===e)return t;r++,t=t.right}else i=!0;return null},e.prototype.next=function(e){var t=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var r=this._comparator;t;){var n=r(e.key,t.key);if(0===n)break;n<0?(i=t,t=t.left):t=t.right}return i},e.prototype.prev=function(e){var t=this._root,i=null;if(null!==e.left){for(i=e.left;i.right;)i=i.right;return i}for(var r=this._comparator;t;){var n=r(e.key,t.key);if(0===n)break;n<0?t=t.left:(i=t,t=t.right)}return i},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return function(e){var t=e,i=[],r=!1,n=new G(null,null),o=n;for(;!r;)t?(i.push(t),t=t.left):i.length>0?t=(t=o=o.next=i.pop()).right:r=!0;return o.next=null,n.next}(this._root)},e.prototype.load=function(e,t,i){void 0===t&&(t=[]),void 0===i&&(i=!1);var r=e.length,n=this._comparator;if(i&&X(e,t,0,r-1,n),null===this._root)this._root=$(e,t,0,r),this._size=r;else{var o=function(e,t,i){var r=new G(null,null),n=r,o=e,s=t;for(;null!==o&&null!==s;)i(o.key,s.key)<0?(n.next=o,o=o.next):(n.next=s,s=s.next),n=n.next;null!==o?n.next=o:null!==s&&(n.next=s);return r.next}(this.toList(),function(e,t){for(var i=new G(null,null),r=i,n=0;n<e.length;n++)r=r.next=new G(e[n],t[n]);return r.next=null,i.next}(e,t),n);r=this._size+r,this._root=Y({head:o},0,r)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return j(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,i){var r=this._comparator,n=V(e,this._root,r),o=n.left,s=n.right;r(e,t)<0?s=H(t,i,s,r):o=H(t,i,o,r),this._root=function(e,t,i){return null===t?e:(null===e||((t=U(e.key,t,i)).left=e),t)}(o,s,r)},e.prototype.split=function(e){return V(e,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var e,t,i;return B(this,(function(r){switch(r.label){case 0:e=this._root,t=[],i=!1,r.label=1;case 1:return i?[3,6]:null===e?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return 0===t.length?[3,4]:[4,e=t.pop()];case 3:return r.sent(),e=e.right,[3,5];case 4:i=!0,r.label=5;case 5:return[3,1];case 6:return[2]}}))},e}();function $(e,t,i,r){var n=r-i;if(n>0){var o=i+Math.floor(n/2),s=e[o],a=t[o],l=new G(s,a);return l.left=$(e,t,i,o),l.right=$(e,t,o+1,r),l}return null}function Y(e,t,i){var r=i-t;if(r>0){var n=t+Math.floor(r/2),o=Y(e,t,n),s=e.head;return s.left=o,e.head=e.head.next,s.right=Y(e,n+1,i),s}return null}function X(e,t,i,r,n){if(!(i>=r)){for(var o=e[i+r>>1],s=i-1,a=r+1;;){do{s++}while(n(e[s],o)<0);do{a--}while(n(e[a],o)>0);if(s>=a)break;var l=e[s];e[s]=e[a],e[a]=l,l=t[s],t[s]=t[a],t[a]=l}X(e,t,i,a,n),X(e,t,a+1,r,n)}}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t,i){return t&&Z(e.prototype,t),i&&Z(e,i),e}var K=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},ee=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var i=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:i,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},te=Number.EPSILON;void 0===te&&(te=Math.pow(2,-52));var ie=te*te,re=function(e,t){if(-te<e&&e<te&&-te<t&&t<te)return 0;var i=e-t;return i*i<ie*e*t?0:e<t?-1:1},ne=function(){function e(){J(this,e),this.reset()}return Q(e,[{key:"reset",value:function(){this.xRounder=new oe,this.yRounder=new oe}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),e}(),oe=function(){function e(){J(this,e),this.tree=new q,this.round(0)}return Q(e,[{key:"round",value:function(e){var t=this.tree.add(e),i=this.tree.prev(t);if(null!==i&&0===re(t.key,i.key))return this.tree.remove(e),i.key;var r=this.tree.next(t);return null!==r&&0===re(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),e}(),se=new ne,ae=function(e,t){return e.x*t.y-e.y*t.x},le=function(e,t){return e.x*t.x+e.y*t.y},ce=function(e,t,i){var r={x:t.x-e.x,y:t.y-e.y},n={x:i.x-e.x,y:i.y-e.y},o=ae(r,n);return re(o,0)},ue=function(e){return Math.sqrt(le(e,e))},he=function(e,t,i){var r={x:t.x-e.x,y:t.y-e.y},n={x:i.x-e.x,y:i.y-e.y};return le(n,r)/ue(n)/ue(r)},de=function(e,t,i){return 0===t.y?null:{x:e.x+t.x/t.y*(i-e.y),y:i}},pe=function(e,t,i){return 0===t.x?null:{x:i,y:e.y+t.y/t.x*(i-e.x)}},me=function(){function e(t,i){J(this,e),void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=i}return Q(e,null,[{key:"compare",value:function(t,i){var r=e.comparePoints(t.point,i.point);return 0!==r?r:(t.point!==i.point&&t.link(i),t.isLeft!==i.isLeft?t.isLeft?1:-1:ge.compare(t.segment,i.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),Q(e,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,i=0,r=t.length;i<r;i++){var n=t[i];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var i=this.point.events[t];if(void 0===i.segment.consumedBy)for(var r=t+1;r<e;r++){var n=this.point.events[r];void 0===n.consumedBy&&(i.otherSE.point.events===n.otherSE.point.events&&i.segment.consume(n.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,i=this.point.events.length;t<i;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,i=new Map,r=function(r){var n,o,s,a,l,c=r.otherSE;i.set(r,{sine:(n=t.point,o=e.point,s=c.point,a={x:o.x-n.x,y:o.y-n.y},l={x:s.x-n.x,y:s.y-n.y},ae(l,a)/ue(l)/ue(a)),cosine:he(t.point,e.point,c.point)})};return function(e,t){i.has(e)||r(e),i.has(t)||r(t);var n=i.get(e),o=n.sine,s=n.cosine,a=i.get(t),l=a.sine,c=a.cosine;return o>=0&&l>=0?s<c?1:s>c?-1:0:o<0&&l<0?s<c?-1:s>c?1:0:l<o?-1:l>o?1:0}}}]),e}(),fe=0,ge=function(){function e(t,i,r,n){J(this,e),this.id=++fe,this.leftSE=t,t.segment=this,t.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=t,this.rings=r,this.windings=n}return Q(e,null,[{key:"compare",value:function(e,t){var i=e.leftSE.point.x,r=t.leftSE.point.x,n=e.rightSE.point.x,o=t.rightSE.point.x;if(o<i)return 1;if(n<r)return-1;var s=e.leftSE.point.y,a=t.leftSE.point.y,l=e.rightSE.point.y,c=t.rightSE.point.y;if(i<r){if(a<s&&a<l)return 1;if(a>s&&a>l)return-1;var u=e.comparePoint(t.leftSE.point);if(u<0)return 1;if(u>0)return-1;var h=t.comparePoint(e.rightSE.point);return 0!==h?h:-1}if(i>r){if(s<a&&s<c)return-1;if(s>a&&s>c)return 1;var d=t.comparePoint(e.leftSE.point);if(0!==d)return d;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(n<o){var m=t.comparePoint(e.rightSE.point);if(0!==m)return m}if(n>o){var f=e.comparePoint(t.rightSE.point);if(f<0)return 1;if(f>0)return-1}if(n!==o){var g=l-s,_=n-i,v=c-a,y=o-r;if(g>_&&v<y)return 1;if(g<_&&v>y)return-1}return n>o?1:n<o||l<c?-1:l>c?1:e.id<t.id?-1:e.id>t.id?1:0}}]),Q(e,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,i=this.rightSE.point,r=this.vector();if(t.x===i.x)return e.x===t.x?0:e.x<t.x?1:-1;var n=(e.y-t.y)/r.y,o=t.x+n*r.x;if(e.x===o)return 0;var s=(e.x-t.x)/r.x,a=t.y+s*r.y;return e.y===a?0:e.y<a?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),i=e.bbox(),r=ee(t,i);if(null===r)return null;var n=this.leftSE.point,o=this.rightSE.point,s=e.leftSE.point,a=e.rightSE.point,l=K(t,s)&&0===this.comparePoint(s),c=K(i,n)&&0===e.comparePoint(n),u=K(t,a)&&0===this.comparePoint(a),h=K(i,o)&&0===e.comparePoint(o);if(c&&l)return h&&!u?o:!h&&u?a:null;if(c)return u&&n.x===a.x&&n.y===a.y?null:n;if(l)return h&&o.x===s.x&&o.y===s.y?null:s;if(h&&u)return null;if(h)return o;if(u)return a;var d=function(e,t,i,r){if(0===t.x)return pe(i,r,e.x);if(0===r.x)return pe(e,t,i.x);if(0===t.y)return de(i,r,e.y);if(0===r.y)return de(e,t,i.y);var n=ae(t,r);if(0==n)return null;var o={x:i.x-e.x,y:i.y-e.y},s=ae(o,t)/n,a=ae(o,r)/n;return{x:(e.x+a*t.x+(i.x+s*r.x))/2,y:(e.y+a*t.y+(i.y+s*r.y))/2}}(n,this.vector(),s,e.vector());return null===d?null:K(r,d)?se.round(d.x,d.y):null}},{key:"split",value:function(t){var i=[],r=void 0!==t.events,n=new me(t,!0),o=new me(t,!1),s=this.rightSE;this.replaceRightSE(o),i.push(o),i.push(n);var a=new e(n,s,this.rings.slice(),this.windings.slice());return me.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),me.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),o.checkForConsuming()),i}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}},{key:"consume",value:function(t){for(var i=this,r=t;i.consumedBy;)i=i.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var n=e.compare(i,r);if(0!==n){if(n>0){var o=i;i=r,r=o}if(i.prev===r){var s=i;i=r,r=s}for(var a=0,l=r.rings.length;a<l;a++){var c=r.rings[a],u=r.windings[a],h=i.rings.indexOf(c);-1===h?(i.rings.push(c),i.windings.push(u)):i.windings[h]+=u}r.rings=null,r.windings=null,r.consumedBy=i,r.leftSE.consumedBy=i.leftSE,r.rightSE.consumedBy=i.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys,n=0,o=this.rings.length;n<o;n++){var s=this.rings[n],a=this.windings[n],l=t.indexOf(s);-1===l?(t.push(s),i.push(a)):i[l]+=a}for(var c=[],u=[],h=0,d=t.length;h<d;h++)if(0!==i[h]){var p=t[h],m=p.poly;if(-1===u.indexOf(m))if(p.isExterior)c.push(m);else{-1===u.indexOf(m)&&u.push(m);var f=c.indexOf(p.poly);-1!==f&&c.splice(f,1)}}for(var g=0,_=c.length;g<_;g++){var v=c[g].multiPoly;-1===r.indexOf(v)&&r.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Pe.type){case"union":var i=0===e.length,r=0===t.length;this._isInResult=i!==r;break;case"intersection":var n,o;e.length<t.length?(n=e.length,o=t.length):(n=t.length,o=e.length),this._isInResult=o===Pe.numMultiPolys&&n<o;break;case"xor":var s=Math.abs(e.length-t.length);this._isInResult=s%2==1;break;case"difference":var a=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=a(e)!==a(t);break;default:throw new Error("Unrecognized operation type found ".concat(Pe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,i,r){var n,o,s,a=me.comparePoints(t,i);if(a<0)n=t,o=i,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));n=i,o=t,s=-1}return new e(new me(n,!0),new me(o,!1),[r],[s])}}]),e}(),_e=function(){function e(t,i,r){if(J(this,e),!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=r,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var n=se.round(t[0][0],t[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};for(var o=n,s=1,a=t.length;s<a;s++){if("number"!=typeof t[s][0]||"number"!=typeof t[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=se.round(t[s][0],t[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(ge.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}n.x===o.x&&n.y===o.y||this.segments.push(ge.fromRing(o,n,this))}return Q(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,i=this.segments.length;t<i;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),e}(),ve=function(){function e(t,i){if(J(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new _e(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,n=t.length;r<n;r++){var o=new _e(t[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=i}return Q(e,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,i=this.interiorRings.length;t<i;t++)for(var r=this.interiorRings[t].getSweepEvents(),n=0,o=r.length;n<o;n++)e.push(r[n]);return e}}]),e}(),ye=function(){function e(t,i){if(J(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,n=t.length;r<n;r++){var o=new ve(t[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=i}return Q(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,i=this.polys.length;t<i;t++)for(var r=this.polys[t].getSweepEvents(),n=0,o=r.length;n<o;n++)e.push(r[n]);return e}}]),e}(),Ce=function(){function e(t){J(this,e),this.events=t;for(var i=0,r=t.length;i<r;i++)t[i].segment.ringOut=this;this.poly=null}return Q(e,null,[{key:"factory",value:function(t){for(var i=[],r=0,n=t.length;r<n;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){for(var s=null,a=o.leftSE,l=o.rightSE,c=[a],u=a.point,h=[];s=a,a=l,c.push(a),a.point!==u;)for(;;){var d=a.getAvailableLinkedEvents();if(0===d.length){var p=c[0].point,m=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(m.x,", ").concat(m.y,"]."))}if(1===d.length){l=d[0].otherSE;break}for(var f=null,g=0,_=h.length;g<_;g++)if(h[g].point===a.point){f=g;break}if(null===f){h.push({index:c.length,point:a.point});var v=a.getLeftmostComparator(s);l=d.sort(v)[0].otherSE;break}var y=h.splice(f)[0],C=c.splice(y.index);C.unshift(C[0].otherSE),i.push(new e(C.reverse()))}i.push(new e(c))}}return i}}]),Q(e,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],i=1,r=this.events.length-1;i<r;i++){var n=this.events[i].point,o=this.events[i+1].point;0!==ce(n,e,o)&&(t.push(n),e=n)}if(1===t.length)return null;var s=t[0],a=t[1];0===ce(s,e,a)&&t.shift(),t.push(t[0]);for(var l=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,u=this.isExteriorRing()?t.length:-1,h=[],d=c;d!=u;d+=l)h.push([t[d].x,t[d].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,i=this.events.length;t<i;t++){var r=this.events[t];me.compare(e,r)>0&&(e=r)}for(var n=e.segment.prevInResult(),o=n?n.prevInResult():null;;){if(!n)return null;if(!o)return n.ringOut;if(o.ringOut!==n.ringOut)return o.ringOut.enclosingRing()!==n.ringOut?n.ringOut:n.ringOut.enclosingRing();n=o.prevInResult(),o=n?n.prevInResult():null}}}]),e}(),xe=function(){function e(t){J(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Q(e,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,i=this.interiorRings.length;t<i;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),e}(),we=function(){function e(t){J(this,e),this.rings=t,this.polys=this._composePolys(t)}return Q(e,[{key:"getGeom",value:function(){for(var e=[],t=0,i=this.polys.length;t<i;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];if(!n.poly)if(n.isExteriorRing())t.push(new xe(n));else{var o=n.enclosingRing();o.poly||t.push(new xe(o)),o.poly.addInterior(n)}}return t}}]),e}(),be=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ge.compare;J(this,e),this.queue=t,this.tree=new q(i),this.segments=[]}return Q(e,[{key:"process",value:function(e){var t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),i;var r=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var n=r,o=r,s=void 0,a=void 0;void 0===s;)null===(n=this.tree.prev(n))?s=null:void 0===n.key.consumedBy&&(s=n.key);for(;void 0===a;)null===(o=this.tree.next(o))?a=null:void 0===o.key.consumedBy&&(a=o.key);if(e.isLeft){var l=null;if(s){var c=s.getIntersection(t);if(null!==c&&(t.isAnEndpoint(c)||(l=c),!s.isAnEndpoint(c)))for(var u=this._splitSafely(s,c),h=0,d=u.length;h<d;h++)i.push(u[h])}var p=null;if(a){var m=a.getIntersection(t);if(null!==m&&(t.isAnEndpoint(m)||(p=m),!a.isAnEndpoint(m)))for(var f=this._splitSafely(a,m),g=0,_=f.length;g<_;g++)i.push(f[g])}if(null!==l||null!==p){var v=null;if(null===l)v=p;else if(null===p)v=l;else{v=me.comparePoints(l,p)<=0?l:p}this.queue.remove(t.rightSE),i.push(t.rightSE);for(var y=t.split(v),C=0,x=y.length;C<x;C++)i.push(y[C])}i.length>0?(this.tree.remove(t),i.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&a){var w=s.getIntersection(a);if(null!==w){if(!s.isAnEndpoint(w))for(var b=this._splitSafely(s,w),S=0,T=b.length;S<T;S++)i.push(b[S]);if(!a.isAnEndpoint(w))for(var E=this._splitSafely(a,w),P=0,A=E.length;P<A;P++)i.push(E[P])}}this.tree.remove(t)}return i}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var i=e.rightSE;this.queue.remove(i);var r=e.split(t);return r.push(i),void 0===e.consumedBy&&this.tree.insert(e),r}}]),e}(),Se="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Te="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ee=function(){function e(){J(this,e)}return Q(e,[{key:"run",value:function(e,t,i){Pe.type=e,se.reset();for(var r=[new ye(t,!0)],n=0,o=i.length;n<o;n++)r.push(new ye(i[n],!1));if(Pe.numMultiPolys=r.length,"difference"===Pe.type)for(var s=r[0],a=1;a<r.length;)null!==ee(r[a].bbox,s.bbox)?a++:r.splice(a,1);if("intersection"===Pe.type)for(var l=0,c=r.length;l<c;l++)for(var u=r[l],h=l+1,d=r.length;h<d;h++)if(null===ee(u.bbox,r[h].bbox))return[];for(var p=new q(me.compare),m=0,f=r.length;m<f;m++)for(var g=r[m].getSweepEvents(),_=0,v=g.length;_<v;_++)if(p.insert(g[_]),p.size>Se)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var y=new be(p),C=p.size,x=p.pop();x;){var w=x.key;if(p.size===C){var b=w.segment;throw new Error("Unable to pop() ".concat(w.isLeft?"left":"right"," SweepEvent ")+"[".concat(w.point.x,", ").concat(w.point.y,"] from segment #").concat(b.id," ")+"[".concat(b.leftSE.point.x,", ").concat(b.leftSE.point.y,"] -> ")+"[".concat(b.rightSE.point.x,", ").concat(b.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(p.size>Se)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(y.segments.length>Te)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var S=y.process(w),T=0,E=S.length;T<E;T++){var P=S[T];void 0===P.consumedBy&&p.insert(P)}C=p.size,x=p.pop()}se.reset();var A=Ce.factory(y.segments);return new we(A).getGeom()}}]),e}(),Pe=new Ee,Ae={union:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return Pe.run("union",e,i)},intersection:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return Pe.run("intersection",e,i)},xor:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return Pe.run("xor",e,i)},difference:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return Pe.run("difference",e,i)}},Me=Ae;function De(e,t,i){void 0===i&&(i={});var n=p(e),s=p(t),a=Me.intersection(n.coordinates,s.coordinates);return 0===a.length?null:1===a.length?o(a[0],i.properties):function(e,t,i){return void 0===i&&(i={}),r({type:"MultiPolygon",coordinates:e},t,i)}(a,i.properties)}let Le=class extends Error{constructor(e){super(e),this.name="CesiumProError"}};function Re(e,t){return null!=e?e:t}function Oe(e){return null!=e}Le.throwInstantiationError=function(){throw new DeveloperError("This function defines an interface and should not be called directly.")},Le.throwNoInstance=function(){throw new Le("它的定义了一个接口，不能被以直接调用.")};class Ie{constructor(e,t,i){if(!Oe(e))throw new Le("longitude is required.");if(!Oe(t))throw new Le("latitude is required.");this.lon=e,this.lat=t,this.alt=Re(i,0)}get height(){return this.alt}toPixel(e){return Ie.toPixel(this,e)}toCartesian(){return Ie.toCartesian(this)}toCartographic(){return Ie.toCartographic(this)}getRadias(){return{lon:Cesium.Math.toRadians(this.lon),lat:Cesium.Math.toRadians(this.lat),alt:alt}}isVisible(e){return Ie.isVisible(this,e)}toString(){return`{lon: ${this.lon}, lat: ${this.lat}, alt: ${this.alt}}`}toJson(){return{lon:this.lon,lat:this.lat,alt:this.alt}}toArray(){return[this.lon,this.lat,this.alt]}static isVisible(e,t){if(t instanceof Cesium.Viewer==!1)throw new Le("viewer不是一个有效的Cesium.Viewer对象");if(!Oe(e))return!1;const i=Ie.toCartesian(e);if(!i)return!1;if(t.scene.mode===Cesium.SceneMode.SCENE3D){if(!new Cesium.EllipsoidalOccluder(Cesium.Ellipsoid.WGS84,t.camera.position).isPointVisible(i))return!1;const r=Ie.toPixel(e,t.scene);if(!Oe(r))return!1;const n=t.canvas.width||t.canvas.clientWidth,o=t.canvas.height||t.canvas.clientHeight;return r.x>0&&r.x<n&&r.y>0&&r.y<o}if(t.scene.mode===Cesium.SceneMode.SCENE2D){const e=t.scene.camera.frustum,{positionWC:r,directionWC:n,upWC:o}=t.scene.camera,s=e.computeCullingVolume(r,n,o),a=Cesium.BoundingSphere.projectTo2D(new BoundingSphere(i,1)),l=s.computeVisibility(a);return l===Cesium.Intersect.INSIDE||l===Cesium.Intersect.INERSECTING}}static toPixel(e,t){if(!Oe(t))throw new Le("scene未定义。");if(!Oe(e))return;const i=Ie.toCartesian(e);return Oe(i)?Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,i):void 0}static toCartographic(e,t){if(!Oe(e))throw new Le("point is not defined.");if(e instanceof Ie)return Cesium.Cartographic.fromDegrees(e.lon,e.lat,e.alt);if(e instanceof Cesium.Cartesian3)return Cesium.Cartographic.fromCartesian(e);if(e instanceof Cesium.Cartographic)return e;if(e instanceof Cesium.Cartesian2){const i=Ie.toCartesian(e,t);return Ie.toCartographic(i)}}static toCartesian(e,t){if(Oe(e)){if(e instanceof Cesium.Cartesian3)return e;if(e instanceof Cesium.Cartographic)return Cesium.Cartographic.toCartesian(e);if(e instanceof Ie)return Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt);if(e instanceof Cesium.Cartesian2){if(!t)return;const i=t.scene.camera.getPickRay(e);return t.scene.globe.pick(i,t.scene)}}}static fromCartesian(e){if(!Oe(e))return;const t=Cesium.Cartographic.fromCartesian(e);return Oe(t)?Ie.fromCartographic(t):void 0}static fromCartographic(e){if(!Oe(e))throw new Le("cartographic is not defined.");return new Ie(Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height)}static fromPixel(e,t){if(!t.scene.globe)return;if(!Oe(e))throw new Le("pixel is not defined.");if(t instanceof Cesium.Viewer==!1)throw new Le("viewer不是一个有效的Cesium.Viewer对象");const i=t.scene.camera.getPickRay(e),r=t.scene.globe.pick(i,t.scene);return Oe(r)?Ie.fromCartesian(r):void 0}static fromDegrees(e,t,i){return new Ie(e,t,i)}static fromDegreesArray(e){const t=[];for(let i=0,r=e.length;i<r;i+=2)t.push(new Ie(e[i],e[i+1]));return t}static fromDegreesArrayHeights(e){const t=[];for(let i=0,r=e.length;i<r;i+=3)t.push(new Ie(e[i],e[i+1],e[i+2]));return t}static fromRadians(e,t,i){return new Ie(Cesium.Math.toDegrees(e),Cesium.Math.toDegrees(t),i)}static inChina(...e){if(1!==e.length){const t=+e[0],i=+e[1];return t>73.66&&t<135.05&&i>3.86&&i<53.55}{const t=e[0];if(e[0]instanceof Ie)return Ie.inChina(t.lon,t.lat)}}static fromArray(e){return new Ie(...e)}static fromJson(e){return new Ie(e.lon,e.lat,e.alt)}static isValid(e){return e instanceof Ie?!!Oe(e.lon)&&(!!Oe(e.lat)&&!!Oe(e.alt)):e instanceof Cesium.Cartesian3&&(!!Oe(e.x)&&(!!Oe(e.y)&&!!Oe(e.z)))}}const{Cartographic:Ne,Cartesian3:ke}=Cesium,Fe={};function ze(e){if(!(e&&e instanceof Cesium.Viewer)){throw new Le(`Expected viewer to be typeof Viewer, actual typeof was ${typeof e}`)}}function Be(e,t){return t-e}Fe.lineChunk=function(e,t,i={}){try{return w(s(e.map((e=>[e.lon,e.lat]))),t,i)}catch(e){throw new Le("计算错误",e)}},Fe.polygonToGrid=function(e,t,i={}){const r=o([e.map((e=>[e.lon,e.lat]))]),s=b(r);return i.mask=r,function(e,t,i){void 0===i&&(i={}),i.mask&&!i.units&&(i.units="kilometers");for(var r=[],o=e[0],s=e[1],l=e[2],c=e[3],u=t/m([o,s],[l,s],i)*(l-o),h=t/m([o,s],[o,c],i)*(c-s),d=l-o,p=c-s,f=Math.floor(d/u),g=(p-Math.floor(p/h)*h)/2,_=o+(d-f*u)/2;_<=l;){for(var v=s+g;v<=c;){var y=n([_,v],i.properties);i.mask?N(y,i.mask)&&r.push(y):r.push(y),v+=h}_+=u}return a(r)}(s,t,i)},Fe.triangleGrid=function(e,t,i={}){const r=o([e.map((e=>[e.lon,e.lat]))]),n=b(r);return i.mask=r,function(e,t,i){void 0===i&&(i={});for(var r=[],n=t/m([e[0],e[1]],[e[2],e[1]],i)*(e[2]-e[0]),s=t/m([e[0],e[1]],[e[0],e[3]],i)*(e[3]-e[1]),l=0,c=e[0];c<=e[2];){for(var u=0,h=e[1];h<=e[3];){var d=null,p=null;l%2==0&&u%2==0?(d=o([[[c,h],[c,h+s],[c+n,h],[c,h]]],i.properties),p=o([[[c,h+s],[c+n,h+s],[c+n,h],[c,h+s]]],i.properties)):l%2==0&&u%2==1?(d=o([[[c,h],[c+n,h+s],[c+n,h],[c,h]]],i.properties),p=o([[[c,h],[c,h+s],[c+n,h+s],[c,h]]],i.properties)):u%2==0&&l%2==1?(d=o([[[c,h],[c,h+s],[c+n,h+s],[c,h]]],i.properties),p=o([[[c,h],[c+n,h+s],[c+n,h],[c,h]]],i.properties)):u%2==1&&l%2==1&&(d=o([[[c,h],[c,h+s],[c+n,h],[c,h]]],i.properties),p=o([[[c,h+s],[c+n,h+s],[c+n,h],[c,h+s]]],i.properties)),i.mask?(De(i.mask,d)&&r.push(d),De(i.mask,p)&&r.push(p)):(r.push(d),r.push(p)),h+=s,u++}l++,c+=n}return a(r)}(n,t,i)},Fe.getCartesians=function(e){if(!e)return;const t=e[0];return t instanceof Ie?e.map((e=>e.toCartesian())):t instanceof ke?e:t instanceof Ne?e.map((e=>Ne.toCartesian(e))):"number"==typeof t?ke.fromDegreesArray(e):e},Fe.getLonLats=function(e){const t=e[0];return t instanceof Ie?e:t instanceof ke?e.map((e=>Ie.fromCartesian(e))):t instanceof Ne?e.map((e=>Ie.fromCartographic(e))):"number"==typeof t?Ie.fromDegreesArray(e):e},Fe.getArea=function(e){return M(o([e]))};let Ge=class{constructor(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}get numberOfListeners(){return this._listeners.length-this._toRemove.length}addEventListener(e,t){if("function"!=typeof e)throw new Le("侦听器应该是一个函数");this._listeners.push(e),this._scopes.push(t);const i=this;return function(){i.removeEventListener(e,t)}}removeEventListener(e,t){if("function"!=typeof e)throw new Le("侦听器应该是一个函数");const i=this._listeners,r=this._scopes;let n=-1;for(let o=0;o<i.length;o++)if(i[o]===e&&r[o]===t){n=o;break}return-1!==n&&(this._insideRaiseEvent?(this._toRemove.push(n),i[n]=void 0,r[n]=void 0):(i.splice(n,1),r.splice(n,1)),!0)}raise(){let e;this._insideRaiseEvent=!0;const t=this._listeners,i=this._scopes;let{length:r}=t;for(e=0;e<r;e++){const r=t[e];Cesium.defined(r)&&t[e].apply(i[e],arguments)}const n=this._toRemove;if(r=n.length,r>0){for(n.sort(Be),e=0;e<r;e++){const r=n[e];t.splice(r,1),i.splice(r,1)}n.length=0}this._insideRaiseEvent=!1}raiseEvent(){this.raise(...arguments)}};function We(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)}))}class Ue{constructor(e,t={}){ze(e),this._id=Re(t.id,We()),this.options=t,this._viewer=e,this._doing=!1,this.preAnalysis=new Ge,this.preDo=this.preAnalysis,this.postAnalysis=new Ge,this.postDo=this.postAnalysis}get type(){return this._type}do(e){if(this._doing)throw new Le("当前有正在分析的任务，请稍候再试")}isDestroyed(){return!1}_check(){if(this._doing)throw new Le("上一次分析正在进行，请稍候...");this._doing=!0}}const He={};function Ve(){return!0}function je(e,t){function i(){}const r=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertyNames(Object.getPrototypeOf(e))];for(var n of r)"function"==typeof e[n]&&(e[n]=i);e.isDestroyed=Ve}He.surfaceDistance=function(e){let t=0;for(let i=0;i<e.length-1;i+=1){const r=Cesium.Cartographic.fromCartesian(e[i]),n=Cesium.Cartographic.fromCartesian(e[i+1]),o=new Cesium.EllipsoidGeodesic;o.setEndPoints(r,n);t+=o.surfaceDistance}return t},He.spaceDistance=function(e){let t=0;for(let i=1;i<e.length;i++){const r=e[i-1],n=e[i];t+=Cesium.Cartesian3.distance(r,n)}return t},He.angle=function(e,t,i){let r=0;try{const n=Cesium.Transforms.eastNorthUpToFixedFrame(e),o=Cesium.Matrix4.inverseTransformation(n,new Cesium.Matrix4),s=Cesium.Matrix4.multiplyByPoint(o,t,new Cesium.Cartesian3),a=Cesium.Matrix4.multiplyByPoint(o,i,new Cesium.Cartesian3),l=Cesium.Cartesian3.normalize(s,new Cesium.Cartesian3),c=Cesium.Cartesian3.normalize(a,new Cesium.Cartesian3),u=Cesium.Cartesian3.dot(l,c);r=Cesium.Math.acosClamped(u)}catch(e){console.log(e),r=0}return Cesium.Math.toDegrees(r)},He.angleBetweenNorth=function(e,t){const i=Cesium.Transforms.eastNorthUpToFixedFrame(e),r=Cesium.Matrix4.inverseTransformation(i,new Cesium.Matrix4),n=Cesium.Matrix4.multiplyByPoint(r,t,new Cesium.Cartesian3),o=Cesium.Cartesian3.normalize(n,new Cesium.Cartesian3),s=new Cesium.Cartesian3(0,1,0),a=Cesium.Cartesian3.dot(o,s);let l=Cesium.Math.acosClamped(a);l=Cesium.Math.toDegrees(l);const c=new Cesium.Cartesian3(1,0,0);return Cesium.Cartesian3.dot(c,o)<0&&(l=360-l),l},He.surfaceArea=function(e){let t=0;for(let i=0;i<e.length-2;i+=1){const r=(i+1)%e.length,n=(i+2)%e.length,o=He.angle(e[i],e[r],e[n]);t+=He.spaceDistance([e[i],e[r]])*He.spaceDistance([e[r],e[n]])*Math.abs(Math.sin(Cesium.Math.toRadians(o)))}return t},He.spaceArea=function(e){const t=[];for(let i of e){const e=Ie.fromCartesian(i);t.push([e.lon,e.lat])}t.push(t[0]);return M(o([t]))},He.heightFromCartesianArray=function(e){if(e.length<2)return 0;const t=[];for(let i=1;i<e.length;i++){const r=Cesium.Cartographic.fromCartesian(e[i-1]),n=Cesium.Cartographic.fromCartesian(e[i]);r&&n?t.push(n.height-r.height):t.push("NaN")}return t};const{Color:qe,Cartesian3:$e,Cartographic:Ye,PrimitiveCollection:Xe,PolygonGeometry:Je,PolygonHierarchy:Ze,GeometryInstance:Qe,Primitive:Ke,GroundPrimitive:et,PerInstanceColorAppearance:tt}=Cesium;function it(e,t,i=[]){const r=[];let n=0;const o=Fe.getArea(t);for(let o=0;o<3;o++){const s=t[o],a=Ye.fromDegrees(...s),l=e.scene.sampleHeight(a,i);n+=l;const c=$e.fromDegrees(s[0],s[1],l);r.push(c)}return{positions:r,height:n/3,area:o}}class rt extends Ue{constructor(e,t={}){super(e,t);const i=Fe.getCartesians(t.mask);i&&(this._mask=[...i,i[0]]),this._mask instanceof $e&&(this._mask=this._mask.map((e=>Ie.fromCartesian(e)))),this.excavatedColor=Re(t.excavatedColor,qe.RED.withAlpha(.5)),this.fillColor=Re(t.fillColor,qe.GREEN.withAlpha(.5)),this._type="excavation-analysis",this._height=Re(t.height,0),this._samplerSize=t.samplerSize,this._excludeObject=Re(t.excludeObject,[]),this._renderToViewer=Re(t.renderToViewer,!0)}setMask(e){if(!Array.isArray(e))throw new Le("mask must be an array");const t=Fe.getCartesians(options.mask);this._mask=[...t,t[0]],this._mask instanceof $e&&(this._mask=this._mask.map((e=>Ie.fromCartesian(e))))}static suggestGridCount=300;do(){if(super.do(),!this._mask&&!Array.isArray(mask))throw new Le("请通过setMask方法指定分析范围");if(this._check(),this.clear(),this.preDo.raise({samplerSize:this._samplerSize,id:this._id}),!this._mask)return;const e=He.surfaceArea(this._mask),t=this._samplerSize||Math.sqrt(e/1e6/rt.suggestGridCount),i=Fe.getLonLats(this._mask),r=Fe.triangleGrid(i,t),n=new Xe;this._root=n,n.name=this.type,this._renderToViewer&&this._viewer.scene.primitives.add(n);const o=r.features.map((e=>e.geometry.coordinates[0])),s=[];let a=0,l=0;for(let e of o){const{height:t,positions:i,area:r}=it(this._viewer,e,this._excludeObject),n=r*(t-this._height);n>0?l+=n:a+=Math.abs(n),s.push({height:t,positions:i,volume:n}),this._render(i,t)}const c={samplerSize:t,id:this._id,grid:r,result:s,fillVolume:a,excavaVolume:l,graphicCollection:this._root};return this.postAnalysis.raise(c),this._doing=!1,c}_render(e,t){const i=t<this._height?this.excavatedColor:this.fillColor,r=t>this._height,n=function(e,t,i,r){const n=new Je({polygonHierarchy:new Ze(e),perPositionHeight:!0,extrudedHeight:i}),o=new Qe({geometry:n,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(t)}});return new(r?et:Ke)({geometryInstances:[o],appearance:new tt})}(e,i,this._height,r);this._root.add(n)}clear(){this._root&&this._viewer.scene.primitives.remove(this._root)}destroy(){this._viewer.scene.primitives.remove(this._root),je(this)}}const{Cartographic:nt}=Cesium;class ot extends Ue{constructor(e,t={}){super(e),this._samplerSize=t.samplerSzie;const i=Fe.getCartesians(t.mask);this._mask=[...i,i[0]],this._type="height-analysis"}static suggestGridCount=300;do(e=[]){this._check(),this.preDo.raise({id:this._id,mask:this._mask});const t=He.surfaceArea(this._mask),i=Math.sqrt(t/1e6/ot.suggestGridCount),r=Fe.getLonLats(this._mask);this.samplerSize=this._samplerSize||i;const n=Fe.polygonToGrid(r,this.samplerSize).features.map((e=>nt.fromDegrees(...e.geometry.coordinates))),{max:o,min:s,avg:a}=function(e,t,i=[]){let r=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,o=0;return e.map((e=>{const s=t.scene.sampleHeight(e,i);isNaN(s)||(s>r&&(r=s),s<n&&(n=s),o+=s)})),{max:r,min:n,avg:o/e.length}}(n,this._viewer,e);return this.postAnalysis.raise({id:this._id,mask:this._mask,samplerSize:this.samplerSize}),{max:o,min:s,avg:a,samplerSize:this.samplerSize}}}class st{constructor(e){if(!Oe(e))throw new Le("parameter shadowMap is required.");this._shadowMap=e}get show(){return this._show}set show(e){this._show=e}update(e){e.shadowMaps.push(this._shadowMap)}destroy(){this._shadowMap&&!this._shadowMap.isDestroyed()&&this._shadowMap.destroy(),je(this)}}const at=Cesium.BoundingRectangle,lt=Cesium.BoundingSphere,ct=Cesium.BoxOutlineGeometry,ut=Cesium.Cartesian2,ht=Cesium.Cartesian3,dt=Cesium.Cartesian4,pt=Cesium.Cartographic,mt=Cesium.Color,ft=Cesium.ColorGeometryInstanceAttribute,gt=Cesium.combine,_t=Cesium.CullingVolume,vt=Cesium.defaultValue,yt=Cesium.defined,Ct=Object.defineProperties,xt=Cesium.destroyObject;Cesium.DeveloperError;const wt=Cesium.FeatureDetection,bt=Cesium.GeometryInstance,St=Cesium.Intersect,Tt=Cesium.Math,Et=Cesium.Matrix4,Pt=Cesium.OrthographicOffCenterFrustum,At=Cesium.PerspectiveFrustum,Mt=Cesium.PixelFormat,Dt=Cesium.Quaternion,Lt=Cesium.SphereOutlineGeometry,Rt=Cesium.WebGLConstants,Ot=Cesium.ClearCommand,It=Cesium.ContextLimits,Nt=Cesium.CubeMap,kt=Cesium.DrawCommand,Ft=Cesium.Framebuffer,zt=Cesium.Pass,Bt=Cesium.PassState,Gt=Cesium.PixelDatatype,Wt=Cesium.Renderbuffer,Ut=Cesium.RenderbufferFormat,Ht=Cesium.RenderState,Vt=Cesium.Sampler,jt=Cesium.Texture,qt=Cesium.TextureMagnificationFilter,$t=Cesium.TextureMinificationFilter,Yt=Cesium.TextureWrap,Xt=Cesium.Camera,Jt=Cesium.CullFace,Zt=Cesium.DebugCameraPrimitive,Qt=Cesium.PerInstanceColorAppearance,Kt=Cesium.Primitive,ei=Cesium.ShadowMapShader,ti=Cesium.ShaderSource;function ii(e){var t=(e=vt(e,vt.EMPTY_OBJECT)).context;this._enabled=vt(e.enabled,!0),this._softShadows=vt(e.softShadows,!1),this._normalOffset=vt(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=vt(e.fromLightSource,!0),this.darkness=0,this._darkness=this.darkness,this.maximumDistance=vt(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;var i,r=!0;(wt.isInternetExplorer()||wt.isEdge()||(wt.isChrome()||wt.isFirefox())&&wt.isWindows()&&!t.depthTexture)&&(r=!1),this._polygonOffsetSupported=r,this._terrainBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new Et,this._shadowMapTexture=void 0,this._lightDirectionEC=new ht,this._lightPositionEC=new dt,this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new Ci,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=vt(e.boundingSphere,new lt),this._isPointLight=vt(e.isPointLight,!1),this._pointLightRadius=vt(e.pointLightRadius,100),this._cascadesEnabled=!1,this._numberOfCascades=this._cascadesEnabled?vt(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new ut,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new Pt:yt(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new dt,new dt],this._cascadeMatrices=[new Et,new Et,new Et,new Et],this._cascadeDistances=new dt,i=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(i);for(var n=0;n<i;++n)this._passes[n]=new ri(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,oi(this),this._clearCommand=new Ot({depth:1,color:new mt}),this._clearPassState=new Bt(t),this._size=vt(e.size,2048),this.size=this._size}function ri(e){this.camera=new Ci,this.passState=new Bt(e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function ni(e,t){return Ht.fromCache({cull:{enabled:!0,face:Jt.BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function oi(e){var t=!e._usesDepthTexture;e._primitiveRenderState=ni(t,e._primitiveBias),e._terrainRenderState=ni(t,e._terrainBias),e._pointRenderState=ni(t,e._pointBias)}function si(e){for(var t=e._passes.length,i=0;i<t;++i){var r=e._passes[i],n=r.framebuffer;yt(n)&&!n.isDestroyed()&&n.destroy(),r.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function ai(){return new Vt({wrapS:Yt.CLAMP_TO_EDGE,wrapT:Yt.CLAMP_TO_EDGE,minificationFilter:$t.NEAREST,magnificationFilter:qt.NEAREST})}function li(e,t){e._isPointLight?function(e,t){for(var i=new Wt({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Ut.DEPTH_COMPONENT16}),r=new Nt({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:Mt.RGBA,pixelDatatype:Gt.UNSIGNED_BYTE,sampler:ai()}),n=[r.negativeX,r.negativeY,r.negativeZ,r.positiveX,r.positiveY,r.positiveZ],o=0;o<6;++o){var s=new Ft({context:t,depthRenderbuffer:i,colorTextures:[n[o]],destroyAttachments:!1}),a=e._passes[o];a.framebuffer=s,a.passState.framebuffer=s}e._shadowMapTexture=r,e._depthAttachment=i,e._colorAttachment=r}(e,t):e._usesDepthTexture?function(e,t){for(var i=new jt({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:Mt.DEPTH_STENCIL,pixelDatatype:Gt.UNSIGNED_INT_24_8,sampler:ai()}),r=new Ft({context:t,depthStencilTexture:i,destroyAttachments:!1}),n=e._passes.length,o=0;o<n;++o){var s=e._passes[o];s.framebuffer=r,s.passState.framebuffer=r}e._shadowMapTexture=i,e._depthAttachment=i}(e,t):function(e,t){for(var i=new Wt({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Ut.DEPTH_COMPONENT16}),r=new jt({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:Mt.RGBA,pixelDatatype:Gt.UNSIGNED_BYTE,sampler:ai()}),n=new Ft({context:t,depthRenderbuffer:i,colorTextures:[r],destroyAttachments:!1}),o=e._passes.length,s=0;s<o;++s){var a=e._passes[s];a.framebuffer=n,a.passState.framebuffer=n}e._shadowMapTexture=r,e._depthAttachment=i,e._colorAttachment=r}(e,t)}function ci(e,t){yt(e._passes[0].framebuffer)&&e._shadowMapTexture.width===e._textureSize.x||(si(e),li(e,t),function(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==Rt.FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,oi(e),si(e),li(e,t))}(e,t),ui(e,t))}function ui(e,t,i){i=vt(i,0),(e._isPointLight||0===i)&&(e._clearCommand.framebuffer=e._passes[i].framebuffer,e._clearCommand.execute(t,e._clearPassState))}ii.MAXIMUM_DISTANCE=2e4,ii.prototype.debugCreateRenderStates=function(){oi(this)},Ct(ii.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},isViewShed:{get:function(){return!0}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){!function(e,t){e._size=t;var i=e._passes,r=i.length,n=e._textureSize;if(e._isPointLight){t=It.maximumCubeMapSize>=t?t:It.maximumCubeMapSize,n.x=t,n.y=t;var o=new at(0,0,t,t);i[0].passState.viewport=o,i[1].passState.viewport=o,i[2].passState.viewport=o,i[3].passState.viewport=o,i[4].passState.viewport=o,i[5].passState.viewport=o}else 1===r?(t=It.maximumTextureSize>=t?t:It.maximumTextureSize,n.x=t,n.y=t,i[0].passState.viewport=new at(0,0,t,t)):4===r&&(t=It.maximumTextureSize>=2*t?t:It.maximumTextureSize/2,n.x=2*t,n.y=2*t,i[0].passState.viewport=new at(0,0,t,t),i[1].passState.viewport=new at(t,0,t,t),i[2].passState.viewport=new at(0,t,t,t),i[3].passState.viewport=new at(t,t,t,t));e._clearPassState.viewport=new at(0,0,n.x,n.y);for(var s=0;s<r;++s){var a=i[s],l=a.passState.viewport,c=l.x/n.x,u=l.y/n.y,h=l.width/n.x,d=l.height/n.y;a.textureOffsets=new Et(h,0,0,c,0,d,0,u,0,0,1,0,0,0,0,1)}}(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});var hi=new at;function di(e,t){var i=t.context,r=t.context.drawingBufferWidth,n=t.context.drawingBufferHeight,o=.3*Math.min(r,n),s=hi;s.x=r-o,s.y=0,s.width=o,s.height=o;var a=e._debugShadowViewCommand;yt(a)||(a=function(e,t){var i;i=e._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(e._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n";var r=t.createViewportQuadCommand(i,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return r.pass=zt.OVERLAY,r}(e,i),e._debugShadowViewCommand=a),yt(a.renderState)&&at.equals(a.renderState.viewport,s)||(a.renderState=Ht.fromCache({viewport:at.clone(s)})),t.commandList.push(e._debugShadowViewCommand)}var pi=new Array(8);pi[0]=new dt(-1,-1,-1,1),pi[1]=new dt(1,-1,-1,1),pi[2]=new dt(1,1,-1,1),pi[3]=new dt(-1,1,-1,1),pi[4]=new dt(-1,-1,1,1),pi[5]=new dt(1,-1,1,1),pi[6]=new dt(1,1,1,1),pi[7]=new dt(-1,1,1,1);for(var mi=new Et,fi=new Array(8),gi=0;gi<8;++gi)fi[gi]=new dt;var _i=[mt.RED,mt.GREEN,mt.BLUE,mt.MAGENTA],vi=new ht;function yi(e,t){di(e,t);var i=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(i&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new Zt({camera:e._sceneCamera,color:mt.CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){i&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new Zt({camera:e._shadowMapCamera,color:mt.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(var r=0;r<e._numberOfCascades;++r)i&&(e._debugCascadeFrustums[r]=e._debugCascadeFrustums[r]&&e._debugCascadeFrustums[r].destroy(),e._debugCascadeFrustums[r]=new Zt({camera:e._passes[r].camera,color:_i[r],updateOnChange:!1})),e._debugCascadeFrustums[r].update(t)}}else if(e._isPointLight){if(!yt(e._debugLightFrustum)||e._needsUpdate){var n=e._shadowMapCamera.positionWC,o=Dt.IDENTITY,s=2*e._pointLightRadius,a=ht.fromElements(s,s,s,vi),l=Et.fromTranslationQuaternionRotationScale(n,o,a,mi);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=function(e,t){var i=new bt({geometry:new ct({minimum:new ht(-.5,-.5,-.5),maximum:new ht(.5,.5,.5)}),attributes:{color:ft.fromColor(t)}}),r=new bt({geometry:new Lt({radius:.5}),attributes:{color:ft.fromColor(t)}});return new Kt({geometryInstances:[i,r],appearance:new Qt({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}(l,mt.YELLOW)}e._debugLightFrustum.update(t)}else yt(e._debugLightFrustum)&&!e._needsUpdate||(e._debugLightFrustum=new Zt({camera:e._shadowMapCamera,color:mt.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function Ci(){this.viewMatrix=new Et,this.inverseViewMatrix=new Et,this.frustum=void 0,this.positionCartographic=new pt,this.positionWC=new ht,this.directionWC=ht.clone(ht.UNIT_Z),this.upWC=ht.clone(ht.UNIT_Y),this.rightWC=ht.clone(ht.UNIT_X),this.viewProjectionMatrix=new Et}Ci.prototype.clone=function(e){Et.clone(e.viewMatrix,this.viewMatrix),Et.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),pt.clone(e.positionCartographic,this.positionCartographic),ht.clone(e.positionWC,this.positionWC),ht.clone(e.directionWC,this.directionWC),ht.clone(e.upWC,this.upWC),ht.clone(e.rightWC,this.rightWC)};var xi=new Et(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);Ci.prototype.getViewProjection=function(){var e=this.viewMatrix,t=this.frustum.projectionMatrix;return Et.multiply(t,e,this.viewProjectionMatrix),Et.multiply(xi,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var wi=new Array(5),bi=new At,Si=new Array(4),Ti=new ht,Ei=new ht;var Pi=new Et,Ai=new ht,Mi=new ht,Di=new ht;var Li=[new ht(-1,0,0),new ht(0,-1,0),new ht(0,0,-1),new ht(1,0,0),new ht(0,1,0),new ht(0,0,1)],Ri=[new ht(0,-1,0),new ht(0,0,-1),new ht(0,-1,0),new ht(0,-1,0),new ht(0,0,1),new ht(0,-1,0)],Oi=[new ht(0,0,1),new ht(1,0,0),new ht(-1,0,0),new ht(0,0,-1),new ht(1,0,0),new ht(1,0,0)];var Ii=new ht,Ni=new ht,ki=new lt,Fi=ki.center;function zi(e,t){var i=t.camera,r=e._lightCamera,n=e._sceneCamera,o=e._shadowMapCamera;e._cascadesEnabled?ht.clone(r.directionWC,o.directionWC):e._isPointLight?ht.clone(r.positionWC,o.positionWC):o.clone(r);var s,a,l=e._lightDirectionEC;Et.multiplyByPointAsVector(i.viewMatrix,o.directionWC,l),ht.normalize(l,l),ht.negate(l,l),Et.multiplyByPoint(i.viewMatrix,o.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius,e.isViewShed?(s=r.frustum.near,a=r.frustum.far):e._fitNearFar?(s=Math.min(t.shadowState.nearPlane,e.maximumDistance),a=Math.min(t.shadowState.farPlane,e.maximumDistance+1)):(s=i.frustum.near,a=e.maximumDistance),e._sceneCamera=Xt.clone(i,n),i.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=s,e._sceneCamera.frustum.far=a,e._distance=a-s,function(e,t){var i=e._sceneCamera,r=e._shadowMapCamera,n=ki;if(e._cascadesEnabled){if(i.frustum.near>=e.maximumDistance)return e._outOfView=!0,void(e._needsUpdate=!1);var o=t.mapProjection.ellipsoid.geodeticSurfaceNormal(i.positionWC,Ii),s=ht.negate(r.directionWC,Ni),a=ht.dot(o,s),l=Tt.clamp(a/.1,0,1);if(e._darkness=Tt.lerp(1,e.darkness,l),a<0)return e._outOfView=!0,void(e._needsUpdate=!1);e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)n.center=r.positionWC,n.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(n)===St.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),lt.clone(n,e._boundingSphere);else{var c=r.frustum.far/2,u=ht.add(r.positionWC,ht.multiplyByScalar(r.directionWC,c,Fi),Fi);n.center=u,n.radius=c,e._outOfView=t.cullingVolume.computeVisibility(n)===St.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),lt.clone(n,e._boundingSphere)}}(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}ii.prototype.update=function(e){if(zi(this,e),this._needsUpdate)if(ci(this,e.context),this._isPointLight&&function(e,t){var i=new At;i.fov=Tt.PI_OVER_TWO,i.near=1,i.far=e._pointLightRadius,i.aspectRatio=1;for(var r=0;r<6;++r){var n=e._passes[r].camera;n.positionWC=e._shadowMapCamera.positionWC,n.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(n.positionWC,n.positionCartographic),n.directionWC=Li[r],n.upWC=Ri[r],n.rightWC=Oi[r],Et.computeView(n.positionWC,n.directionWC,n.upWC,n.rightWC,n.viewMatrix),Et.inverse(n.viewMatrix,n.inverseViewMatrix),n.frustum=i}}(this,e),this._cascadesEnabled&&(function(e,t){var i=e._shadowMapCamera,r=e._sceneCamera,n=Et.multiply(r.frustum.projectionMatrix,r.viewMatrix,mi),o=Et.inverse(n,mi),s=i.directionWC,a=r.directionWC,l=ht.cross(s,a,Ai);a=ht.cross(l,s,Mi),ht.normalize(a,a),ht.normalize(l,l);for(var c=ht.fromElements(0,0,0,Di),u=Et.computeView(c,s,a,l,Pi),h=Et.multiply(u,o,mi),d=ht.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Ti),p=ht.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Ei),m=0;m<8;++m){var f=dt.clone(pi[m],fi[m]);Et.multiplyByVector(h,f,f),ht.divideByScalar(f,f.w,f),ht.minimumByComponent(f,d,d),ht.maximumByComponent(f,p,p)}p.z+=1e3,d.z-=10;var g=Di;g.x=-.5*(d.x+p.x),g.y=-.5*(d.y+p.y),g.z=-p.z;var _=Et.fromTranslation(g,mi);u=Et.multiply(_,u,u);var v=.5*(p.x-d.x),y=.5*(p.y-d.y),C=p.z-d.z,x=i.frustum;x.left=-v,x.right=v,x.bottom=-y,x.top=y,x.near=.01,x.far=C,Et.clone(u,i.viewMatrix),Et.inverse(u,i.inverseViewMatrix),Et.getTranslation(i.inverseViewMatrix,i.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(i.positionWC,i.positionCartographic),ht.clone(s,i.directionWC),ht.clone(a,i.upWC),ht.clone(l,i.rightWC)}(this,e),this._numberOfCascades>1&&function(e,t){var i,r=e._shadowMapCamera,n=e._sceneCamera,o=n.frustum.near,s=n.frustum.far,a=e._numberOfCascades,l=s-o,c=s/o,u=.9,h=!1;t.shadowState.closestObjectSize<200&&(h=!0,u=.9);var d=Si,p=wi;for(p[0]=o,p[a]=s,i=0;i<a;++i){var m=(i+1)/a,f=o*Math.pow(c,m),g=o+l*m,_=Tt.lerp(g,f,u);p[i+1]=_,d[i]=_-p[i]}if(h){for(i=0;i<a;++i)d[i]=Math.min(d[i],e._maximumCascadeDistances[i]);var v=p[0];for(i=0;i<a-1;++i)v+=d[i],p[i+1]=v}dt.unpack(p,0,e._cascadeSplits[0]),dt.unpack(p,1,e._cascadeSplits[1]),dt.unpack(d,0,e._cascadeDistances);var y=r.frustum,C=y.left,x=y.right,w=y.bottom,b=y.top,S=y.near,T=y.far,E=r.positionWC,P=r.directionWC,A=r.upWC,M=n.frustum.clone(bi),D=r.getViewProjection();for(i=0;i<a;++i){M.near=p[i],M.far=p[i+1];for(var L=Et.multiply(M.projectionMatrix,n.viewMatrix,mi),R=Et.inverse(L,mi),O=Et.multiply(D,R,mi),I=ht.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Ti),N=ht.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Ei),k=0;k<8;++k){var F=dt.clone(pi[k],fi[k]);Et.multiplyByVector(O,F,F),ht.divideByScalar(F,F.w,F),ht.minimumByComponent(F,I,I),ht.maximumByComponent(F,N,N)}I.x=Math.max(I.x,0),I.y=Math.max(I.y,0),I.z=0,N.x=Math.min(N.x,1),N.y=Math.min(N.y,1),N.z=Math.min(N.z,1);var z=e._passes[i],B=z.camera;B.clone(r);var G=B.frustum;G.left=C+I.x*(x-C),G.right=C+N.x*(x-C),G.bottom=w+I.y*(b-w),G.top=w+N.y*(b-w),G.near=S+I.z*(T-S),G.far=S+N.z*(T-S),z.cullingVolume=B.frustum.computeCullingVolume(E,P,A);var W=e._cascadeMatrices[i];Et.multiply(B.getViewProjection(),n.inverseViewMatrix,W),Et.multiply(z.textureOffsets,W,W)}}(this,e)),this._isPointLight)this._shadowMapCullingVolume=_t.fromBoundingSphere(this._boundingSphere);else{var t=this._shadowMapCamera,i=t.positionWC,r=t.directionWC,n=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(i,r,n),1===this._passes.length&&this._passes[0].camera.clone(t)}if(1===this._passes.length){var o=this._sceneCamera.inverseViewMatrix;Et.multiply(this._shadowMapCamera.getViewProjection(),o,this._shadowMapMatrix)}this.debugShow&&yi(this,e)},ii.prototype.updatePass=function(e,t){ui(this,e,t)};var Bi=new ut;Cesium.ShadowMap.createReceiveDerivedCommand=function(e,t,i,r,n){yt(n)||(n={});var o=e.length>0,s=t.shaderProgram,a=s.vertexShaderSource,l=s.fragmentShaderSource,c=t.pass===zt.GLOBE,u=!1;if(c&&(u=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&o){var h,d;yt(n.receiveCommand)&&(h=n.receiveCommand.shaderProgram,d=n.receiveCommand.uniformMap),n.receiveCommand=kt.shallowClone(t,n.receiveCommand),n.castShadows=!1,n.receiveShadows=!0;var p=n.receiveShaderCastShadows!==t.castShadows,m=n.receiveShaderProgramId!==t.shaderProgram.id;if(!yt(h)||m||i||p){var f;if(f=e[0].isViewShed?function(e,t,i,r){return"view receiveShadow "+e._usesDepthTexture+e._polygonOffsetSupported+e._isPointLight+e._isSpotLight+(e._numberOfCascades>1)+e.debugCascadeColors+e.softShadows+t+i+r}(e[0],t.castShadows,c,u):ei.getShadowReceiveShaderKeyword(e[0],t.castShadows,c,u),h=r.shaderCache.getDerivedShaderProgram(s,f),!yt(h)){var g,_=ei.createShadowReceiveVertexShader(a,c,u);g=e[0].isViewShed?function(e,t,i,r,n){for(var o=ti.findNormalVarying(e),s=!r&&yt(o)||r&&n,a=ti.findPositionVarying(e),l=yt(a),c=t._usesDepthTexture,u=t._polygonOffsetSupported,h=t._isPointLight,d=t._isSpotLight,p=t._numberOfCascades>1,m=t.debugCascadeColors,f=t.softShadows,g=h?t._pointBias:r?t._terrainBias:t._primitiveBias,_=e.defines.slice(0),v=e.sources.slice(0),y=v.length,C=0;C<y;++C)v[C]=ti.replaceMain(v[C],"czm_shadow_receive_main");h?_.push("USE_CUBE_MAP_SHADOW"):c&&_.push("USE_SHADOW_DEPTH_TEXTURE"),f&&!h&&_.push("USE_SOFT_SHADOWS"),p&&i&&r&&(s?_.push("ENABLE_VERTEX_LIGHTING"):_.push("ENABLE_DAYNIGHT_SHADING")),i&&g.normalShading&&s&&(_.push("USE_NORMAL_SHADING"),g.normalShadingSmooth>0&&_.push("USE_NORMAL_SHADING_SMOOTH"));var x="";return x+=h?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",x+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+(l?"    return vec4("+a+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n")+"} \nvec3 getNormalEC() \n{ \n"+(s?"    return normalize("+o+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(g.normalOffset&&s?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":"")+"} \n",x+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",x+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",r?x+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":u||(x+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),x+=h?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":d?"    vec3 directionEC1 = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC1); \n    if (distance > shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.y) \n    { \n        return; \n    } \n    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":p?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(m?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",x+="   if(visibility==0.0) \n   {\n        gl_FragColor.rgb *= vec3(0.8,0.0,0.0);\n   }else{\n        gl_FragColor.rgb *= vec3(0.0,0.8,0.0) * visibility;\n   } \n } \n ",v.push(x),new ti({defines:_,sources:v})}(l,e[0],t.castShadows,c,u):ei.createShadowReceiveFragmentShader(l,e[0],t.castShadows,c,u),h=r.shaderCache.createDerivedShaderProgram(s,f,{vertexShaderSource:_,fragmentShaderSource:g,attributeLocations:s._attributeLocations})}d=function(e,t,i){var r=e._isPointLight?e._pointBias:i?e._terrainBias:e._primitiveBias,n={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var t=Bi;return t.x=1/e._textureSize.x,t.y=1/e._textureSize.y,dt.fromElements(t.x,t.y,r.depthBias,r.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return dt.fromElements(r.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new dt,combinedUniforms2:new dt};return gt(t,n,!1)}(e[0],t.uniformMap,c)}n.receiveCommand.shaderProgram=h,n.receiveCommand.uniformMap=d,n.receiveShaderProgramId=t.shaderProgram.id,n.receiveShaderCastShadows=t.castShadows}return n},ii.prototype.isDestroyed=function(){return!1},ii.prototype.destroy=function(){si(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return xt(this)};var Gi='#ifdef GL_OES_standard_derivatives\n  #extension GL_OES_standard_derivatives : enable\n#endif\n\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\n\nuniform float u_radius;\nuniform float u_xHalfAngle;\nuniform float u_yHalfAngle;\nuniform float u_normalDirection;\nuniform vec4 u_color;\n\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\n  czm_materialInput materialInput;\n\n  vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\n  materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\n  materialInput.str = pointMC / sensorRadius;\n\n  vec3 positionToEyeEC = -v_positionEC;\n  materialInput.positionToEyeEC = positionToEyeEC;\n\n  vec3 normalEC = normalize(v_normalEC);\n  materialInput.normalEC = u_normalDirection * normalEC;\n\n  czm_material material = czm_getMaterial(materialInput);\n\n  material.diffuse = u_color.rgb;\n  material.alpha = u_color.a;\n\n  return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\n\n}\n\nbool isOnBoundary(float value, float epsilon)\n{\n  float width = getIntersectionWidth();\n  float tolerance = width * epsilon;\n\n#ifdef GL_OES_standard_derivatives\n  float delta = max(abs(dFdx(value)), abs(dFdy(value)));\n  float pixels = width * delta;\n  float temp = abs(value);\n  // There are a couple things going on here.\n  // First we test the value at the current fragment to see if it is within the tolerance.\n  // We also want to check if the value of an adjacent pixel is within the tolerance,\n  // but we don\'t want to admit points that are obviously not on the surface.\n  // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\n  // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\n  // the points is close to zero.\n  return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\n#else\n  return abs(value) < tolerance;\n#endif\n}\n\nvec4 shade(bool isOnBoundary)\n{\n  if (u_showIntersection && isOnBoundary)\n  {\n      return getIntersectionColor();\n  }\n  return getColor(u_radius, v_positionEC);\n}\n\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\n{\n  vec3 scaled = ellipsoid.inverseRadii * point;\n  return dot(scaled, scaled) - 1.0;\n}\n\nvoid main()\n{\n  vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\n  vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\n\n  //vec3 pixDir = normalize(v_position);\n  float positionX = v_position.x;\n  float positionY = v_position.y;\n  float positionZ = v_position.z;\n\n  vec3 zDir = vec3(0.0, 0.0, 1.0);\n  vec3 lineX = vec3(positionX, 0 ,positionZ);\n  vec3 lineY = vec3(0, positionY, positionZ);\n  float resX = dot(normalize(lineX), zDir);\n  if(resX < cos(u_xHalfAngle) - 0.0001){\n      discard;\n  }\n  float resY = dot(normalize(lineY), zDir);\n  if(resY < cos(u_yHalfAngle)- 0.0001){\n      discard;\n  }\n\n\n  czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n  float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\n\n  // Occluded by the ellipsoid?\nif (!u_showThroughEllipsoid)\n{\n    // Discard if in the ellipsoid\n    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\n    if (ellipsoidValue < 0.0)\n    {\n          discard;\n    }\n\n    // Discard if in the sensor\'s shadow\n    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\n    {\n        discard;\n    }\n  }\n\n  // Notes: Each surface functions should have an associated tolerance based on the floating point error.\n  bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\n  gl_FragColor = shade(isOnEllipsoid);\n\n}',Wi="\nuniform vec4 u_intersectionColor;\nuniform float u_intersectionWidth;\nuniform vec4 u_lineColor;\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointWC)\n{\n  // Diagonal matrix from the unscaled ellipsoid space to the scaled space.\n  vec3 D = ellipsoidEC.inverseRadii;\n\n  // Sensor vertex in the scaled ellipsoid space\n  vec3 q = D * coneVertexWC;\n  float qMagnitudeSquared = dot(q, q);\n  float test = qMagnitudeSquared - 1.0;\n\n  // Sensor vertex to fragment vector in the ellipsoid's scaled space\n  vec3 temp = D * pointWC - q;\n  float d = dot(temp, q);\n\n  // Behind silhouette plane and inside silhouette cone\n  return (d < -test) && (d / length(temp) < -sqrt(test));\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\nvec4 getLineColor()\n{\n  return u_lineColor;\n}\n\nvec4 getIntersectionColor()\n{\n  return u_intersectionColor;\n}\n\nfloat getIntersectionWidth()\n{\n  return u_intersectionWidth;\n}\n\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\n  // (s, t) both in the range [0, 1]\n  float t = pointMC.z / sensorRadius;\n  float s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\n  s = s - floor(s);\n\n  return vec2(s, t);\n}",Ui='\n#ifdef GL_OES_standard_derivatives\n  #extension GL_OES_standard_derivatives : enable\n#endif\n\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\n\nuniform float u_radius;\nuniform float u_xHalfAngle;\nuniform float u_yHalfAngle;\nuniform float u_normalDirection;\nuniform float u_type;\n\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\n  czm_materialInput materialInput;\n\n  vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\n  materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\n  materialInput.str = pointMC / sensorRadius;\n\n  vec3 positionToEyeEC = -v_positionEC;\n  materialInput.positionToEyeEC = positionToEyeEC;\n\n  vec3 normalEC = normalize(v_normalEC);\n  materialInput.normalEC = u_normalDirection * normalEC;\n\n  czm_material material = czm_getMaterial(materialInput);\n\n  return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\n\n}\n\nbool isOnBoundary(float value, float epsilon)\n{\n  float width = getIntersectionWidth();\n  float tolerance = width * epsilon;\n\n#ifdef GL_OES_standard_derivatives\n  float delta = max(abs(dFdx(value)), abs(dFdy(value)));\n  float pixels = width * delta;\n  float temp = abs(value);\n  // There are a couple things going on here.\n  // First we test the value at the current fragment to see if it is within the tolerance.\n  // We also want to check if the value of an adjacent pixel is within the tolerance,\n  // but we don\'t want to admit points that are obviously not on the surface.\n  // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\n  // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\n  // the points is close to zero.\n  return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\n#else\n  return abs(value) < tolerance;\n#endif\n}\n\nvec4 shade(bool isOnBoundary)\n{\n  if (u_showIntersection && isOnBoundary)\n  {\n      return getIntersectionColor();\n  }\n  if(u_type == 1.0){\n      return getLineColor();\n  }\n  return getColor(u_radius, v_positionEC);\n}\n\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\n{\n  vec3 scaled = ellipsoid.inverseRadii * point;\n  return dot(scaled, scaled) - 1.0;\n}\n\nvoid main()\n{\n  vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\n  vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\n\n  //vec3 pixDir = normalize(v_position);\n  float positionX = v_position.x;\n  float positionY = v_position.y;\n  float positionZ = v_position.z;\n\n  vec3 zDir = vec3(0.0, 0.0, 1.0);\n  vec3 lineX = vec3(positionX, 0 ,positionZ);\n  vec3 lineY = vec3(0, positionY, positionZ);\n  float resX = dot(normalize(lineX), zDir);\n  if(resX < cos(u_xHalfAngle)-0.00001){\n      discard;\n  }\n  float resY = dot(normalize(lineY), zDir);\n  if(resY < cos(u_yHalfAngle)-0.00001){\n      discard;\n  }\n\n\n  czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n  float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\n\n  // Occluded by the ellipsoid?\nif (!u_showThroughEllipsoid)\n{\n    // Discard if in the ellipsoid\n    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\n    if (ellipsoidValue < 0.0)\n    {\n          discard;\n    }\n\n    // Discard if in the sensor\'s shadow\n    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\n    {\n        discard;\n    }\n  }\n\n  // Notes: Each surface functions should have an associated tolerance based on the floating point error.\n  bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\n  //isOnEllipsoid = false;\n  //if((resX >= 0.8 && resX <= 0.81)||(resY >= 0.8 && resY <= 0.81)){\n  /*if(false){\n      gl_FragColor = vec4(1.0,0.0,0.0,1.0);\n  }else{\n      gl_FragColor = shade(isOnEllipsoid);\n  }\n*/\n  gl_FragColor = shade(isOnEllipsoid);\n\n}',Hi="attribute vec4 position;\nattribute vec3 normal;\n\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n  gl_Position = czm_modelViewProjection * position;\n  v_position = vec3(position);\n  v_positionWC = (czm_model * position).xyz;\n  v_positionEC = (czm_modelView * position).xyz;\n  v_normalEC = czm_normal * normal;\n}";const{Matrix4:Vi,Material:ji,Color:qi,JulianDate:$i,BoundingSphere:Yi,DrawCommand:Xi,PrimitiveType:Ji,SceneMode:Zi,Matrix3:Qi,Buffer:Ki,BufferUsage:er,VertexArray:tr,VertexFormat:ir,ComponentDatatype:rr,RenderState:nr,BlendingState:or,Pass:sr,combine:ar,CullFace:lr,Cartesian3:cr,EllipsoidGeometry:ur,EllipsoidOutlineGeometry:hr,ShaderSource:dr,ShaderProgram:pr}=Cesium,{cos:mr,sin:fr,tan:gr,atan:_r}=Math,vr=Cesium.Math,yr={position:0,normal:1};class Cr{constructor(e){e=Re(e,Re.EMPTY_OBJECT);const t=this;if(this._createVS=!0,this._createRS=!0,this._createSP=!0,this.show=Re(e.show,!0),this.slice=Re(e.slice,32),e.modelMatrix)this._modelMatrix=Vi.clone(e.modelMatrix,new Vi);else{if(!e.position)throw new Le("parameter position or modelMatrix must be provided.");this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(Ie.toCartesian(e.position))}this._computedModelMatrix=new Vi,this._computedScanPlaneModelMatrix=new Vi,this._radius=Re(e.radius,Number.POSITIVE_INFINITY),this._xHalfAngle=vr.toRadians(Re(e.xHalfAngle,0)),this._yHalfAngle=vr.toRadians(Re(e.yHalfAngle,0)),this._color=Re(e._color,qi.AQUA.withAlpha(.4)),this.lineColor=Re(e.lineColor,qi.WHITE),this.showSectorLines=Re(e.showSectorLines,!0),this.showSectorSegmentLines=Re(e.showSectorSegmentLines,!0),this.showLateralSurfaces=Re(e.showLateralSurfaces,!0),this._material=Oe(e.material)?e.material:ji.fromType(ji.ColorType),this._material.uniforms.color=this._color,this._translucent=void 0,this.lateralSurfaceMaterial=Oe(e.lateralSurfaceMaterial)?e.lateralSurfaceMaterial:ji.fromType(ji.ColorType),this._lateralSurfaceMaterial=void 0,this._lateralSurfaceTranslucent=void 0,this.showDomeSurfaces=Re(e.showDomeSurfaces,!0),this.domeSurfaceMaterial=Oe(e.domeSurfaceMaterial)?e.domeSurfaceMaterial:ji.fromType(ji.ColorType),this.showDomeLines=Re(e.showDomeLines,!0),this.showIntersection=Re(e.showIntersection,!1),this.intersectionColor=Re(e.intersectionColor,qi.WHITE),this.intersectionWidth=Re(e.intersectionWidth,5),this._showThroughEllipsoid=Re(e.showThroughEllipsoid,!1),this.showScanPlane=Re(e.showScanPlane,!0),this.scanPlaneColor=Re(e.scanPlaneColor,qi.AQUA),this.scanPlaneMode=Re(e.scanPlaneMode,"H"),this.speed=Re(e.speed,10),this._scanePlaneXHalfAngle=0,this._scanePlaneYHalfAngle=0,this._time=$i.now(),this._boundingSphere=new Yi,this._boundingSphereWC=new Yi,this._boundingSphere=new Yi(cr.ZERO,this._radius),Vi.multiplyByUniformScale(this._modelMatrix,this._radius,this._computedModelMatrix),Yi.transform(this._boundingSphere,this._modelMatrix,this._boundingSphereWC),this._sectorFrontCommand=new Xi({owner:this,primitiveType:Ji.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorBackCommand=new Xi({owner:this,primitiveType:Ji.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorVA=void 0,this._sectorLineCommand=new Xi({owner:this,primitiveType:Ji.LINES,boundingVolume:this._boundingSphereWC}),this._sectorLineVA=void 0,this._sectorSegmentLineCommand=new Xi({owner:this,primitiveType:Ji.LINES,boundingVolume:this._boundingSphereWC}),this._sectorSegmentLineVA=void 0,this._domeFrontCommand=new Xi({owner:this,primitiveType:Ji.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeBackCommand=new Xi({owner:this,primitiveType:Ji.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeVA=void 0,this._domeLineCommand=new Xi({owner:this,primitiveType:Ji.LINES,boundingVolume:this._boundingSphereWC}),this._domeLineVA=void 0,this._scanPlaneFrontCommand=new Xi({owner:this,primitiveType:Ji.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanPlaneBackCommand=new Xi({owner:this,primitiveType:Ji.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanRadialCommand=void 0,this._colorCommands=[],this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._uniforms={u_type:function(){return 0},u_xHalfAngle:function(){return t._xHalfAngle},u_yHalfAngle:function(){return t._yHalfAngle},u_radius:function(){return t.radius},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}},this._scanUniforms={u_xHalfAngle:function(){return t._scanePlaneXHalfAngle},u_yHalfAngle:function(){return t._scanePlaneYHalfAngle},u_radius:function(){return t.radius},u_color:function(){return t.scanPlaneColor},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}}}get color(){return this._color}set color(e){this._color=e,this._material.uniforms.color=e}get boundingSphere(){return this._boundingSphere}get xHalfAngle(){return vr.toDegrees(this._xHalfAngle)}set xHalfAngle(e){this._xHalfAngle!==e&&(this._xHalfAngle=vr.toRadians(e),this._createVS=!0)}get yHalfAngle(){return vr.toDegrees(this._yHalfAngle)}set yHalfAngle(e){this._yHalfAngle!==e&&(this._yHalfAngle=vr.toRadians(e),this._createVS=!0)}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._boundingSphere=new Yi(cr.ZERO,e),Vi.multiplyByUniformScale(this._modelMatrix,this._radius,this._computedModelMatrix),Yi.transform(this._boundingSphere,this._modelMatrix,this._boundingSphereWC))}get modelMatrix(){return this._modelMatrix}set modelMatrix(e){!Vi.equals(e,this._modelMatrix)&&(Vi.clone(e,this._modelMatrix),Vi.multiplyByUniformScale(this._modelMatrix,this._radius,this._computedModelMatrix),Yi.transform(this._boundingSphere,this._modelMatrix,this._boundingSphereWC))}get showThroughEllipsoid(){return this._showThroughEllipsoid}set showThroughEllipsoid(e){this._showThroughEllipsoid!==e&&(this._showThroughEllipsoid=e,this._createRS=!0)}get material(){return this._material}set material(e){this._material=e,this._createRS=!0,this._createSP=!0}update(e){const t=e.mode;if(!this.show||t!==Zi.SCENE3D)return;const i=this._xHalfAngle,r=this._yHalfAngle;if(i<0||r<0)throw new Le("halfAngle must be greater than or equal to zero.");if(0==i||0==r)return;if(this.radius<0)throw new Le("this.radius must be greater than or equal to zero.");const n=this.showThroughEllipsoid,o=this.material,s=o.isTranslucent();if(this._translucent!==s&&(this._translucent=s,this._createRS=!0),this.showScanPlane){const t=e.time;let n,o,s=$i.secondsDifference(t,this._time);if(s<0&&(this._time=$i.clone(t,this._time)),this.speed<=0)n=0;else{const e=10/this.speed;n=Math.max(s%e/e,0)}const a=new Qi;if("H"==this.scanPlaneMode){o=2*r*n-r;const e=mr(o),t=gr(i),s=_r(e*t);this._scanePlaneXHalfAngle=s,this._scanePlaneYHalfAngle=o,Qi.fromRotationX(this._scanePlaneYHalfAngle,a)}else{o=2*i*n-i;const e=gr(r),t=mr(o),s=_r(t*e);this._scanePlaneXHalfAngle=o,this._scanePlaneYHalfAngle=s,Qi.fromRotationY(this._scanePlaneXHalfAngle,a)}Vi.multiplyByMatrix3(this.modelMatrix,a,this._computedScanPlaneModelMatrix),Vi.multiplyByUniformScale(this._computedScanPlaneModelMatrix,this.radius,this._computedScanPlaneModelMatrix)}this._createVS&&function(e,t){const i=t.context,r=wr(e,e._xHalfAngle,e._yHalfAngle),n=function(e,t){const i=e._xHalfAngle,r=e._yHalfAngle,n=t.zoy,o=t.zox,s=[],a=new Qi;let l=Qi.fromRotationY(i,a);return s.push(n.map((function(e){return Qi.multiplyByVector(l,e,new cr)}))),l=Qi.fromRotationX(-r,a),s.push(o.map((function(e){return Qi.multiplyByVector(l,e,new cr)})).reverse()),l=Qi.fromRotationY(-i,a),s.push(n.map((function(e){return Qi.multiplyByVector(l,e,new cr)})).reverse()),l=Qi.fromRotationX(r,a),s.push(o.map((function(e){return Qi.multiplyByVector(l,e,new cr)}))),s}(e,r);e.showLateralSurfaces&&(e._sectorVA=function(e,t){const i=Array.prototype.concat.apply([],t).length-t.length,r=new Float32Array(18*i);let n=0;for(let e=0,i=t.length;e<i;e++){const i=t[e],o=new cr,s=cr.normalize(cr.cross(i[0],i[i.length-1],o),o);for(let e=0,t=i.length-1;e<t;e++)r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=-s.x,r[n++]=-s.y,r[n++]=-s.z,r[n++]=i[e].x,r[n++]=i[e].y,r[n++]=i[e].z,r[n++]=-s.x,r[n++]=-s.y,r[n++]=-s.z,r[n++]=i[e+1].x,r[n++]=i[e+1].y,r[n++]=i[e+1].z,r[n++]=-s.x,r[n++]=-s.y,r[n++]=-s.z}const o=Ki.createVertexBuffer({context:e,typedArray:r,usage:er.STATIC_DRAW}),s=6*Float32Array.BYTES_PER_ELEMENT,a=[{index:yr.position,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:rr.FLOAT,offsetInBytes:0,strideInBytes:s},{index:yr.normal,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:rr.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:s}];return new tr({context:e,attributes:a})}(i,n));e.showSectorLines&&(e._sectorLineVA=function(e,t){const i=t.length,r=new Float32Array(9*i);let n=0;for(let e=0,i=t.length;e<i;e++){const i=t[e];r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=i[0].x,r[n++]=i[0].y,r[n++]=i[0].z}const o=Ki.createVertexBuffer({context:e,typedArray:r,usage:er.STATIC_DRAW}),s=3*Float32Array.BYTES_PER_ELEMENT,a=[{index:yr.position,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:rr.FLOAT,offsetInBytes:0,strideInBytes:s}];return new tr({context:e,attributes:a})}(i,n));e.showSectorSegmentLines&&(e._sectorSegmentLineVA=function(e,t){const i=Array.prototype.concat.apply([],t).length-t.length,r=new Float32Array(9*i);let n=0;for(let e=0,i=t.length;e<i;e++){const i=t[e];for(let e=0,t=i.length-1;e<t;e++)r[n++]=i[e].x,r[n++]=i[e].y,r[n++]=i[e].z,r[n++]=i[e+1].x,r[n++]=i[e+1].y,r[n++]=i[e+1].z}const o=Ki.createVertexBuffer({context:e,typedArray:r,usage:er.STATIC_DRAW}),s=3*Float32Array.BYTES_PER_ELEMENT,a=[{index:yr.position,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:rr.FLOAT,offsetInBytes:0,strideInBytes:s}];return new tr({context:e,attributes:a})}(i,n));e.showDomeSurfaces&&(e._domeVA=function(e){const t=ur.createGeometry(new ur({vertexFormat:ir.POSITION_ONLY,stackPartitions:32,slicePartitions:32}));return tr.fromGeometry({context:e,geometry:t,attributeLocations:yr,bufferUsage:er.STATIC_DRAW,interleave:!1})}(i));e.showDomeLines&&(e._domeLineVA=function(e){const t=hr.createGeometry(new hr({vertexFormat:ir.POSITION_ONLY,stackPartitions:32,slicePartitions:32}));return tr.fromGeometry({context:e,geometry:t,attributeLocations:yr,bufferUsage:er.STATIC_DRAW,interleave:!1})}(i));if(e.showScanPlane)if("H"==e.scanPlaneMode){const t=wr(e,vr.PI_OVER_TWO,0);e._scanPlaneVA=br(i,t.zox)}else{const t=wr(e,0,vr.PI_OVER_TWO);e._scanPlaneVA=br(i,t.zoy)}}(this,e),this._createRS&&function(e,t,i){i?(e._frontFaceRS=nr.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:or.ALPHA_BLEND,cull:{enabled:!0,face:lr.BACK}}),e._backFaceRS=nr.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:or.ALPHA_BLEND,cull:{enabled:!0,face:lr.FRONT}}),e._pickRS=nr.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:or.ALPHA_BLEND})):(e._frontFaceRS=nr.fromCache({depthTest:{enabled:!t},depthMask:!0}),e._pickRS=nr.fromCache({depthTest:{enabled:!0},depthMask:!0}))}(this,n,s),this._createSP&&function(e,t,i){(function(e,t,i){const r=t.context,n=Hi,o=new dr({sources:[Wi,i.shaderSource,Ui]});e._sp=pr.replaceCache({context:r,shaderProgram:e._sp,vertexShaderSource:n,fragmentShaderSource:o,attributeLocations:yr});const s=new dr({sources:[Wi,i.shaderSource,Ui],pickColorQualifier:"uniform"});e._pickSP=pr.replaceCache({context:r,shaderProgram:e._pickSP,vertexShaderSource:n,fragmentShaderSource:s,attributeLocations:yr})})(e,t,i),e.showScanPlane&&function(e,t,i){const r=t.context,n=Hi,o=new dr({sources:[Wi,i.shaderSource,Gi]});e._scanePlaneSP=pr.replaceCache({context:r,shaderProgram:e._scanePlaneSP,vertexShaderSource:n,fragmentShaderSource:o,attributeLocations:yr})}(e,t,i)}(this,e,o),(this._createRS||this._createSP)&&function(e,t){e._colorCommands.length=0;const i=t?sr.TRANSLUCENT:sr.OPAQUE;e.showLateralSurfaces&&xr(e,e._sectorFrontCommand,e._sectorBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorVA,e._uniforms,e._computedModelMatrix,t,i);e.showSectorLines&&xr(e,e._sectorLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showSectorSegmentLines&&xr(e,e._sectorSegmentLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorSegmentLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showDomeSurfaces&&xr(e,e._domeFrontCommand,e._domeBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._domeVA,e._uniforms,e._computedModelMatrix,t,i);e.showDomeLines&&xr(e,e._domeLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._domeLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showScanPlane&&xr(e,e._scanPlaneFrontCommand,e._scanPlaneBackCommand,e._frontFaceRS,e._backFaceRS,e._scanePlaneSP,e._scanPlaneVA,e._scanUniforms,e._computedScanPlaneModelMatrix,t,i)}(this,s);const a=e.commandList,l=e.passes,c=this._colorCommands;if(l.render)for(let e=0,t=c.length;e<t;e++){const t=c[e];a.push(t)}}destroy(){this._pickSP.destroy(),this._sp=this._sp.destroy(),this._scanePlaneSP&&(this._scanePlaneSP=this._scanePlaneSP.destroy()),je(this)}}function xr(e,t,i,r,n,o,s,a,l,c,u,h){c&&i&&(i.vertexArray=s,i.renderState=n,i.shaderProgram=o,i.uniformMap=ar(a,e._material._uniforms),i.uniformMap.u_normalDirection=function(){return-1},i.pass=u,i.modelMatrix=l,e._colorCommands.push(i)),t.vertexArray=s,t.renderState=r,t.shaderProgram=o,t.uniformMap=ar(a,e._material._uniforms),h&&(t.uniformMap.u_type=function(){return 1}),t.pass=u,t.modelMatrix=l,e._colorCommands.push(t)}function wr(e,t,i){const r=e.slice,n=mr(i),o=gr(i),s=mr(t),a=gr(t),l=_r(s*o),c=_r(n*a),u=[];for(let e=0;e<r;e++){const t=2*l*e/(r-1)-l;u.push(new cr(0,fr(t),mr(t)))}const h=[];for(let e=0;e<r;e++){const t=2*c*e/(r-1)-c;h.push(new cr(fr(t),0,mr(t)))}return{zoy:u,zox:h}}function br(e,t){const i=t.length-1,r=new Float32Array(9*i);let n=0;for(let e=0;e<i;e++)r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=t[e].x,r[n++]=t[e].y,r[n++]=t[e].z,r[n++]=t[e+1].x,r[n++]=t[e+1].y,r[n++]=t[e+1].z;const o=Ki.createVertexBuffer({context:e,typedArray:r,usage:er.STATIC_DRAW}),s=3*Float32Array.BYTES_PER_ELEMENT,a=[{index:yr.position,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:rr.FLOAT,offsetInBytes:0,strideInBytes:s}];return new tr({context:e,attributes:a})}const Sr=Cesium.Math;function Tr(){throw new Le("抽象方法无法被调用。")}const{Cartesian3:Er,Primitive:Pr,Material:Ar,Geometry:Mr,MaterialAppearance:Dr,GeometryAttribute:Lr,ComponentDatatype:Rr,PrimitiveType:Or,BoundingSphere:Ir,VertexFormat:Nr,defaultValue:kr,GeometryAttributes:Fr,Check:zr}=Cesium,Br=new Nr,Gr=new Er;class Wr{constructor(e={}){this._normal=e.normal,this._radius=e.radius,this._center=e.center;const t=kr(e.vertexFormat,Nr.DEFAULT);this._vertexFormat=t}static packedLength=Nr.packedLength+Er.packedLength+1;static pack(e,t,i){return i=kr(i,0),Nr.pack(e._vertexFormat,t,i),i+=Nr.packedLength,Er.pack(e._normal,t,i),i+=Er.packedLength,t[i++]=e._radius,t}static unpack(e,t,i){t=kr(t,0);const r=Nr.unpack(e,t,Br);t+=Nr.packedLength;const n=Er.unpack(e,t,Gr),o=e[t+=Er.packedLength];return defined(i)?(i._vertexFormat=Nr.clone(r,i._vertexFormat),i._normal=Er.clone(n,i._normal),i._radius=o,i):new PlaneGeometry({vertexFormat:r,normal:n,radius:o})}static createGeometry(e){const t=Math.max(1,.02*e._radius),i=Math.max(.2*e._radius,2*t);let r=[],n=[];const{x:o,y:s,z:a}=e._center;let l;Er.equals(e._normal,Er.UNIT_X)?(r=[o,-t+s,t+a,o,-i+s,t+a,o,-i+s,i+a,o,-t+s,i+a],l=new Er(o,-(t+i)/2+s,(t+i)/2+a),n=[1,0,0,1,0,0,1,0,0,1,0,0]):Er.equals(e._normal,Er.UNIT_Y)?(r=[t+o,s,t+a,i+o,s,t+a,i+o,s,i+a,t+o,s,i+a],l=new Er((t+i)/2+o,s,(t+i)/2+a),n=[0,1,0,0,1,0,0,1,0,0,1,0]):Er.equals(e._normal,Er.UNIT_Z)&&(r=[t+o,-t+s,a,i+o,-t+s,a,i+o,-i+s,a,t+o,-i+s,a],l=new Er((t+i)/2+o,-(t+i)/2+s,a),n=[0,0,1,0,0,1,0,0,1,0,0,1]),r=new Float32Array([...r]);const c=new Float32Array([0,0,1,0,1,1,0,1]),u=new Uint16Array([0,1,2,2,3,0]);return new Mr({attributes:new Fr({position:new Lr({componentDatatype:Rr.DOUBLE,componentsPerAttribute:3,values:r}),normal:new Lr({componentDatatype:Rr.FLOAT,componentsPerAttribute:3,values:n}),st:new Lr({componentDatatype:Rr.FLOAT,componentsPerAttribute:2,values:c})}),indices:u,primitiveType:Or.TRIANGLES,boundingSphere:new Ir(l,(t+i)/2)})}}class Ur{constructor(e={}){this._center=e.center,this._modelMatrix=e.modelMatrix,this._color=e.color;const t=e.radius;this._normal=e.normal;const i=new Wr({normal:this._normal,radius:t,vertexFormat:Nr.DEFAULT,center:this._center}),r=new Cesium.GeometryInstance({geometry:Wr.createGeometry(i)}),n=new Pr({asynchronous:!1,geometryInstances:r,modelMatrix:this._modelMatrix,appearance:new Dr({material:Ar.fromType("Color",{color:this._color})})});return n.isAxisPlane=!0,n.normal=this._normal,n.axis=e.axis,n.color=this._color,n}}const Hr={SURFACE_DISTANCE:1,SPACE_DISTANCE:2,SPACE_AREA:3,SURFACE_AREA:4,HEIGHT:5,ANGLE:6,validate:function(e){return e===Hr.SURFACE_AREA||e===Hr.SURFACE_DISTANCE||e===Hr.SPACE_AREA||e===Hr.SPACE_DISTANCE||e===Hr.HEIGHT||e===Hr.ANGLE},getKey:function(e){let t;switch(e){case 1:t="SURFACE_DISTANCE";break;case 2:t="SPACE_DISTANCE";break;case 3:t="SPACE_AREA";break;case 4:t="SURFACE_AREA";break;case 5:t="HEIGHT";break;case 6:t="ANGLE";break;default:t=void 0}return t},getValue:function(e){let t;switch(e){case 1:t="贴地距离";break;case 2:t="空间距离";break;case 3:t="空间面积";break;case 4:t="贴地面积";break;case 5:t="高度";break;case 6:t="方位角";break;default:t=void 0}return t}};var Vr=Object.freeze(Hr);const{RequestState:jr,AttributeCompression:qr,BoundingSphere:$r,Cartesian3:Yr,Credit:Xr,defaultValue:Jr,defined:Zr,DeveloperError:Qr,GeographicTilingScheme:Kr,WebMercatorTilingScheme:en,getJsonFromTypedArray:tn,HeightmapTerrainData:rn,IndexDatatype:nn,OrientedBoundingBox:on,QuantizedMeshTerrainData:sn,Request:an,RequestType:ln,Resource:cn,RuntimeError:un,TerrainProvider:hn,TileAvailability:dn,TileProviderError:pn}=Cesium;function mn(e){this.resource=e.resource,this.version=e.version,this.isHeightmap=e.isHeightmap,this.tileUrlTemplates=e.tileUrlTemplates,this.availability=e.availability,this.hasVertexNormals=e.hasVertexNormals,this.hasWaterMask=e.hasWaterMask,this.hasMetadata=e.hasMetadata,this.availabilityLevels=e.availabilityLevels,this.availabilityTilesLoaded=e.availabilityTilesLoaded,this.littleEndianExtensionSize=e.littleEndianExtensionSize,this.availabilityPromiseCache={}}function fn(e){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=e.ellipsoid,this._requestVertexNormals=Jr(e.requestVertexNormals,!1),this._requestWaterMask=Jr(e.requestWaterMask,!1),this._requestMetadata=Jr(e.requestMetadata,!0),this._errorEvent=new Ge;let t=e.credit;"string"==typeof t&&(t=new Xr(t)),this._credit=t,this._availability=void 0,this._ready=!1,this._tileCredits=void 0;const i=this;let r,n,o;const s=this._layers=[];let a="";const l=[];let c=0;function u(e){let t;if(!e.format)return t="The tile format is not specified in the layer.json file.",o=pn.reportError(o,i,i._errorEvent,t),o.retry?m():Promise.reject(new un(t));if(!e.tiles||0===e.tiles.length)return t="The layer.json file does not specify any tile URL templates.",o=pn.reportError(o,i,i._errorEvent,t),o.retry?m():Promise.reject(new un(t));let d=!1,p=!1,f=!1,g=!0,_=!1;if("heightmap-1.0"===e.format)_=!0,Zr(i._heightmapStructure)||(i._heightmapStructure={heightScale:.2,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),p=!0,i._requestWaterMask=!0;else if(0!==e.format.indexOf("quantized-mesh-1."))return t=`The tile format "${e.format}" is invalid or not supported.`,o=pn.reportError(o,i,i._errorEvent,t),o.retry?m():Promise.reject(new un(t));const v=e.tiles,y=e.maxzoom;if(c=Math.max(c,y),e.projection&&"EPSG:4326"!==e.projection){if("EPSG:3857"!==e.projection)return t=`The projection "${e.projection}" is invalid or not supported.`,o=pn.reportError(o,i,i._errorEvent,t),o.retry?m():Promise.reject(new un(t));i._tilingScheme=new en({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:i._ellipsoid})}else i._tilingScheme=new Kr({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:i._ellipsoid});if(i._levelZeroMaximumGeometricError=hn.getEstimatedLevelZeroGeometricErrorForAHeightmap(i._tilingScheme.ellipsoid,i._heightmapWidth,i._tilingScheme.getNumberOfXTilesAtLevel(0)),e.scheme&&"tms"!==e.scheme&&"slippyMap"!==e.scheme)return t=`The scheme "${e.scheme}" is invalid or not supported.`,o=pn.reportError(o,i,i._errorEvent,t),o.retry?m():Promise.reject(new un(t));let C;i._scheme=e.scheme,Zr(e.extensions)&&-1!==e.extensions.indexOf("octvertexnormals")?d=!0:Zr(e.extensions)&&-1!==e.extensions.indexOf("vertexnormals")&&(d=!0,g=!1),Zr(e.extensions)&&-1!==e.extensions.indexOf("watermask")&&(p=!0),Zr(e.extensions)&&-1!==e.extensions.indexOf("metadata")&&(f=!0);const x=e.metadataAvailability,w=e.available;let b;if(Zr(w)&&!Zr(x)){b=new dn(i._tilingScheme,w.length);for(let e=0;e<w.length;++e){const t=w[e],r=i._tilingScheme.getNumberOfYTilesAtLevel(e);Zr(l[e])||(l[e]=[]);for(let i=0;i<t.length;++i){const n=t[i],o=r-n.endY-1,s=r-n.startY-1;l[e].push([n.startX,o,n.endX,s]),b.addAvailableTileRange(e,n.startX,o,n.endX,s)}}}else Zr(x)&&(C=new dn(i._tilingScheme,y),b=new dn(i._tilingScheme,y),l[0]=[[0,0,1,0]],b.addAvailableTileRange(0,0,0,1,0));i._hasWaterMask=i._hasWaterMask||p,i._hasVertexNormals=i._hasVertexNormals||d,i._hasMetadata=i._hasMetadata||f,Zr(e.attribution)&&(a.length>0&&(a+=" "),a+=e.attribution),s.push(new mn({resource:r,version:e.version,isHeightmap:_,tileUrlTemplates:v,availability:b,hasVertexNormals:d,hasWaterMask:p,hasMetadata:f,availabilityLevels:x,availabilityTilesLoaded:C,littleEndianExtensionSize:g}));const S=e.parentUrl;if(Zr(S)){if(!Zr(b))return console.log("A layer.json can't have a parentUrl if it does't have an available array."),Promise.resolve(!0);r=r.getDerivedResource({url:S}),r.appendForwardSlash(),n=r.getDerivedResource({url:"layer.json"});const e=n.fetchJson();return Promise.resolve(e).then(u).catch(h)}return Promise.resolve(!0)}function h(e){const t=`An error occurred while accessing ${n.url}.`;return o=pn.reportError(o,i,i._errorEvent,t),o.retry?m():Promise.reject(new un(t))}function d(e){return u(e).then((function(){if(Zr(o))return;const e=l.length;if(e>0){const t=i._availability=new dn(i._tilingScheme,c);for(let i=0;i<e;++i){const e=l[i];for(let r=0;r<e.length;++r){const n=e[r];t.addAvailableTileRange(i,n[0],n[1],n[2],n[3])}}}if(a.length>0){const e=new Xr(a);Zr(i._tileCredits)?i._tileCredits.push(e):i._tileCredits=[e]}return i._ready=!0,Promise.resolve(!0)}))}function p(e){return Zr(e)&&404===e.statusCode?d({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]}):h()}function m(){return Promise.resolve(n.fetchJson()).then(d).catch(p)}this._readyPromise=Promise.resolve(e.url).then((function(e){const t=cn.createIfNeeded(e);return t.appendForwardSlash(),r=t,n=r.getDerivedResource({url:"layer.json"}),i._tileCredits=t.credits,m()}))}const gn=1,_n=2,vn=4;function yn(e){if(!Zr(e)||0===e.length)return{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"};return{Accept:`application/vnd.quantized-mesh;extensions=${e.join("-")},application/octet-stream;q=0.9,*/*;q=0.01`}}function Cn(e,t,i,r,n,o){if(!Zr(n))return Promise.reject(new un("Terrain tile doesn't exist"));const s=n.tileUrlTemplates;if(0===s.length)return;let a;if(e._scheme&&"tms"!==e._scheme)a=i;else{a=e._tilingScheme.getNumberOfYTilesAtLevel(r)-i-1}const l=[];let c,u;e._requestVertexNormals&&n.hasVertexNormals&&l.push(n.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),e._requestWaterMask&&n.hasWaterMask&&l.push("watermask"),e._requestMetadata&&n.hasMetadata&&l.push("metadata");const h=s[(t+a+r)%s.length],d=n.resource;Zr(d._ionEndpoint)&&!Zr(d._ionEndpoint.externalType)?(0!==l.length&&(u={extensions:l.join("-")}),c=yn(void 0)):c=yn(l);const p=d.getDerivedResource({url:h,templateValues:{version:n.version,z:r,x:t,y:a},queryParameters:u,headers:c,request:o}).fetchArrayBuffer();return d.request.state!==jr.ISSUED&&d.request.state!==jr.ACTIVE&&Zr(p)?p.then((function(o){return Zr(o)?Zr(e._heightmapStructure)?function(e,t,i,r,n){const o=new Uint16Array(t,0,e._heightmapWidth*e._heightmapWidth);return new rn({buffer:o,childTileMask:new Uint8Array(t,o.byteLength,1)[0],waterMask:new Uint8Array(t,o.byteLength+1,t.byteLength-o.byteLength-1),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure,credits:e._tileCredits})}(e,o):function(e,t,i,r,n,o){const s=o.littleEndianExtensionSize;let a=0;const l=3*Float64Array.BYTES_PER_ELEMENT,c=4*Float64Array.BYTES_PER_ELEMENT,u=3*Uint16Array.BYTES_PER_ELEMENT;let h=Uint16Array.BYTES_PER_ELEMENT,d=3*h;const p=new DataView(t),m=new Yr(p.getFloat64(a,!0),p.getFloat64(a+8,!0),p.getFloat64(a+16,!0));a+=l;const f=p.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;const g=p.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;const _=new $r(new Yr(p.getFloat64(a,!0),p.getFloat64(a+8,!0),p.getFloat64(a+16,!0)),p.getFloat64(a+l,!0));a+=c;const v=new Yr(p.getFloat64(a,!0),p.getFloat64(a+8,!0),p.getFloat64(a+16,!0));a+=l;const y=p.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const C=new Uint16Array(t,a,3*y);a+=y*u,y>65536&&(h=Uint32Array.BYTES_PER_ELEMENT,d=3*h);const x=C.subarray(0,y),w=C.subarray(y,2*y),b=C.subarray(2*y,3*y);qr.zigZagDeltaDecode(x,w,b),a%h!=0&&(a+=h-a%h);const S=p.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const T=nn.createTypedArrayFromArrayBuffer(y,t,a,3*S);a+=S*d;let E=0;const P=T.length;for(let e=0;e<P;++e){const t=T[e];T[e]=E-t,0===t&&++E}const A=p.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const M=nn.createTypedArrayFromArrayBuffer(y,t,a,A);a+=A*h;const D=p.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const L=nn.createTypedArrayFromArrayBuffer(y,t,a,D);a+=D*h;const R=p.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const O=nn.createTypedArrayFromArrayBuffer(y,t,a,R);a+=R*h;const I=p.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const N=nn.createTypedArrayFromArrayBuffer(y,t,a,I);let k,F;for(a+=I*h;a<p.byteLength;){const l=p.getUint8(a,!0);a+=Uint8Array.BYTES_PER_ELEMENT;const c=p.getUint32(a,s);if(a+=Uint32Array.BYTES_PER_ELEMENT,l===gn&&e._requestVertexNormals)k=new Uint8Array(t,a,2*y);else if(l===_n&&e._requestWaterMask)F=new Uint8Array(t,a,c);else if(l===vn&&e._requestMetadata){const s=p.getUint32(a,!0);if(s>0){const r=tn(new Uint8Array(t),a+Uint32Array.BYTES_PER_ELEMENT,s).available;if(Zr(r))for(let t=0;t<r.length;++t){const n=i+t+1,s=r[t],a=e._tilingScheme.getNumberOfYTilesAtLevel(n);for(let t=0;t<s.length;++t){const i=s[t],r=a-i.endY-1,l=a-i.startY-1;e.availability.addAvailableTileRange(n,i.startX,r,i.endX,l),o.availability.addAvailableTileRange(n,i.startX,r,i.endX,l)}}}o.availabilityTilesLoaded.addAvailableTileRange(i,r,n,r,n)}a+=c}const z=5*e.getLevelMaximumGeometricError(i),B=e._tilingScheme.tileXYToRectangle(r,n,i),G=on.fromRectangle(B,f,g,e._tilingScheme.ellipsoid);return new sn({center:m,minimumHeight:f,maximumHeight:g,boundingSphere:_,orientedBoundingBox:G,horizonOcclusionPoint:v,quantizedVertices:C,encodedNormals:k,indices:T,westIndices:M,southIndices:L,eastIndices:O,northIndices:N,westSkirtHeight:z,southSkirtHeight:z,eastSkirtHeight:z,northSkirtHeight:z,childTileMask:e.availability.computeChildMaskForTile(i,r,n),waterMask:F,credits:e._tileCredits})}(e,o,r,t,i,n):Promise.reject(new un("Mesh buffer doesn't exist."))})):void 0}function xn(e,t,i,r){if(0===r)return;const n=e.availabilityLevels,o=r%n==0?r-n:(r/n|0)*n,s=1<<r-o;return{level:o,x:t/s|0,y:i/s|0}}function wn(e,t,i,r,n,o){if(!Zr(n.availabilityLevels))return{result:!1};let s;const a=function(){delete n.availabilityPromiseCache[s]},l=n.availabilityTilesLoaded,c=n.availability;let u=xn(n,t,i,r);for(;Zr(u);){if(c.isTileAvailable(u.level,u.x,u.y)&&!l.isTileAvailable(u.level,u.x,u.y)){let t;if(!o&&(s=`${u.level}-${u.x}-${u.y}`,t=n.availabilityPromiseCache[s],!Zr(t))){const i=new an({throttle:!1,throttleByServer:!0,type:ln.TERRAIN});t=Cn(e,u.x,u.y,u.level,n,i),Zr(t)&&(n.availabilityPromiseCache[s]=t,t.then(a))}return{result:!0,promise:t}}u=xn(n,u.x,u.y,u.level)}return{result:!1}}function bn(e,t){if(null===e||"object"!=typeof e)return e;t=Re(t,!1);const i=new e.constructor;for(const r in e)if(e.hasOwnProperty(r)){let n=e[r];t&&(n=bn(n,t)),i[r]=n}return i}fn.prototype.requestTileGeometry=function(e,t,i,r){const n=this._layers;let o;const s=n.length;if(1===s)o=n[0];else for(let r=0;r<s;++r){const s=n[r];if(!Zr(s.availability)||s.availability.isTileAvailable(i,e,t)){o=s;break}}return Cn(this,e,t,i,o,r)},Object.defineProperties(fn.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){return this._availability}}}),fn.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},fn.prototype.getTileDataAvailable=function(e,t,i){if(!Zr(this._availability))return;if(i>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(i,e,t))return!0;if(!this._hasMetadata)return!1;const r=this._layers,n=r.length;for(let o=0;o<n;++o){if(wn(this,e,t,i,r[o],0===o).result)return}return!1},fn.prototype.loadTileDataAvailability=function(e,t,i){if(!Zr(this._availability)||i>this._availability._maximumLevel||this._availability.isTileAvailable(i,e,t)||!this._hasMetadata)return;const r=this._layers,n=r.length;for(let o=0;o<n;++o){const n=wn(this,e,t,i,r[o],0===o);if(Zr(n.promise))return n.promise}},fn._getAvailabilityTile=xn;const Sn=/((?:.*\/)|^)CesiumPro\.js(?:\?|#|$)/;let Tn,En,Pn;function An(e){return"undefined"==typeof document?e:(Oe(Tn)||(Tn=document.createElement("a")),Tn.href=e,Tn.href=Tn.href,Tn.href)}function Mn(e){return An(`../${e}`)}function Dn(){if(Oe(En))return En;let e;if(e="undefined"!=typeof CESIUMPRO_BASE_URL?CESIUMPRO_BASE_URL:"object"==typeof window.define&&Oe(window.define.amd)&&!window.define.amd.toUrlUndefined?Cesium.getAbsoluteUri("..","core/Url.js"):function(){const e=document.getElementsByTagName("script");for(let t=0,i=e.length;t<i;++t){const i=e[t].getAttribute("src"),r=Sn.exec(i);if(null!==r)return r[1]}}(),!Oe(e))throw new Le("Unable to determine CesiumPro base URL automatically, try defining a global variable called CESIUMPRO_BASE_URL.");return Oe(e)||(e=""),En=new Cesium.Resource({url:An(e)}),En.appendForwardSlash(),En}function Ln(e){return Dn().getDerivedResource({url:e}).url}function Rn(e){Oe(Pn)||(Pn="object"==typeof window.define&&Oe(window.define.amd)&&!window.define.amd.toUrlUndefined?Mn:Ln);return Pn(e)}const On={join:function(...e){const t=[];for(let i of e)i.startsWith("/")&&(i=i.substring(1)),i.endsWith("/")&&(i=i.substring(0,i.length-1)),t.push(i);return t.join("/")},buildModuleUrl:function(e){return Rn(e)}};On.getCesiumProBaseUrl=Dn;const{FeatureDetection:In,isCrossOriginUrl:Nn}=Cesium;let kn;function Fn(){return Oe(kn)||(kn=function(e){let t=Cesium.buildModuleUrl(e);if(Nn(t)){const e='importScripts("'+t+'");';let i;try{i=new Blob([e],{type:"application/javascript"})}catch(t){let r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);r.append(e),i=r.getBlob("application/javascript")}t=(window.URL||window.webkitURL).createObjectURL(i)}return t}("Workers/cesiumWorkerBootstrapper.js")),kn}function zn(e){const t=new Worker(Fn());t.postMessage=Re(t.webkitPostMessage,t.postMessage);const i={loaderConfig:{paths:{Workers:Rn("workers")},baseUrl:Dn().url},workerModule:e._workerPath};return t.postMessage(i),t.onmessage=function(t){!function(e,t){console.log(e,t,"------complete-----")}(e,t.data)},t.postMessage(e._options),t}const{kdbush:Bn,Cartesian3:Gn,Cartographic:Wn,PointPrimitive:Un,BoundingRectangle:Hn,SceneMode:Vn,EllipsoidalOccluder:jn}=Cesium;function qn(e){return e.__pixel.x}function $n(e){return e.__pixel.y}function Yn(e,t){const i=new Hn;return Un.getScreenSpaceBoundingBox(e,t,i),function(e,t){e.x-=t,e.y-=t,e.width+=2*t,e.height+=2*t}(i,this.pixelRange),i}let Xn;function Jn(e){if(!e.scene.globe)return;const t=Cesium.getTimestamp(),i=e.scene;if(Oe(Xn)&&t-Xn<250)return;Xn=t;const r=i.canvas.clientWidth,n=i.canvas.clientHeight,o=i.camera.getPickRay(new Cesium.Cartesian2(r/2,n/2)),s=i.camera.getPickRay(new Cesium.Cartesian2(r/2+1,n/2)),a=i.globe.pick(o,i),l=i.globe.pick(s,i);if(!Oe(a)||!Oe(l))return;return new Cesium.EllipsoidGeodesic(i.globe.ellipsoid.cartesianToCartographic(a),i.globe.ellipsoid.cartesianToCartographic(l)).surfaceDistance}function Zn(e){const t=e.canvas.getBoundingClientRect(),i=new Cesium.Cartesian2(t.width/2,t.height/2);return Ie.fromPixel(i,e)}function Qn(e){if(!e.scene.globe)return{};if(e.scene.mode===Cesium.SceneMode.SCENE3D){const t=e.camera.computeViewRectangle();if(!Oe(t))return;return{west:Cesium.Math.toDegrees(t.west),south:Cesium.Math.toDegrees(t.south),east:Cesium.Math.toDegrees(t.east),north:Cesium.Math.toDegrees(t.north)}}const t=e.canvas.getBoundingClientRect(),i=Ie.fromPixel(new Cesium.Cartesian2(0,t.height/2),e)||{lon:-180},r=Ie.fromPixel(new Cesium.Cartesian2(t.width,t.height/2),e)||{lon:180},n=Ie.fromPixel(new Cesium.Cartesian2(t.width/2,0),e)||{lat:90},o=Ie.fromPixel(new Cesium.Cartesian2(t.width/2,t.height),e)||{lat:-90};return{west:i.lon,south:o.lat,east:r.lon,north:n.lat}}class Kn{constructor(e,t){ze(e),this._viewer=e,t=Re(t,{});const i=Re(t.items,[]);this._items=new Cesium.AssociativeArray,this._position=t.position,this._container=Re(t.container,e.container),this._root=this.createMenu(),this.createItems(i),this._show=!0,this._activeSubMenu=void 0,this.parent=t.parent}get show(){return this._show}set show(e){this._show=e,this._root.style.display=e?"block":"none",this._menu.style.display=e?"block":"none"}get position(){return this._position}set position(e){if(this._position=e,this._root){const e=Ie.toPixel(this._position,this._viewer.scene);this._root.style.left=e.x+"px",this._root.style.top=e.y+"px"}}get(e){return this._items.values[e]}getById(e){return this._items.get(e)}add(e){if(this._items.contains(e.id))return;const t=this.createItem(e);this._items.set(t.id,t),this._menu.appendChild(t.el)}remove(e){const t=e.el;try{return this._root.removeChild(t),this._items.remove(e.id),!0}catch(e){return!1}}removeAll(){for(let e of this._items.values)this.remove(e)}createMenu(){const e=document.createElement("div");e.className="context-root";const t=document.createElement("ul");if(t.className="context-menu context-ul",e.appendChild(t),this._container.appendChild(e),this._position){const t=Ie.toPixel(this._position,this._viewer.scene);e.style.left=t.x+"px",e.style.top=t.y+"px"}return this._menu=t,e.oncontextmenu=function(){return!1},e}updateItemText(e,t){const i=document.getElementById(e.id+"-text");i&&(i.innerHTML=t)}updateItemDistabled(e,t){e&&e.a&&(e.disabled=t,e.a.className=t?"context-item-disabled":"context-item")}createItems(e){for(let t of e)this.add(t)}createItem(e={}){const t=document.createElement("li");t.className="context-menu";const i=document.createElement("a");i.className=e.disabled?"context-item-disabled":"context-item";const r=document.createElement("i");if(r.className=e.class,i.appendChild(r),i.innerHTML+=`<span id="${e.id}-text">${e.text}</span>`,t.appendChild(i),t.id=e.id,e.el=t,e.a=i,e.children){const r=document.createElement("i");r.className="fa fa-caret-right",i.appendChild(r);const n=new Kn(this._viewer,{items:e.children,position:this._position,parent:this});t.appendChild(n._menu),n._menu.className+=" context-submenu",e.subMenu=n,n.container=e}return e.el.onmouseover=t=>{t.stopPropagation(),e.disabled||(this._activeSubMenu&&(this._activeSubMenu.show=!1),e.subMenu&&(e.subMenu.show=!0),this._activeSubMenu=e.subMenu)},e.el.onclick=t=>{t.stopPropagation(),e.disabled||(e.callback&&e.callback(e),this.show=!1,this.parent&&(this.parent.show=!1))},e}ContextMenuItem(e){}destroy(){}}function eo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}const to=[],{document:io}=window,ro=Object.getPrototypeOf,{slice:no}=to,{concat:oo}=to,{push:so}=to,{indexOf:ao}=to,lo={},{toString:co}=lo,uo=lo.hasOwnProperty,ho=uo.toString,po=ho.call(Object),mo={},fo=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},go=function(e){return null!=e&&e===e.window},_o={type:!0,src:!0,nonce:!0,noModule:!0};function vo(e,t,i){let r,n;const o=(i=i||io).createElement("script");if(o.text=e,t)for(r in _o)n=t[r]||t.getAttribute&&t.getAttribute(r),n&&o.setAttribute(r,n);i.head.appendChild(o).parentNode.removeChild(o)}function yo(e){return null==e?`${e}`:"object"==typeof e||"function"==typeof e?lo[co.call(e)]||"object":typeof e}const Co="3.4.1";var xo=function(e,t){return new xo.fn.init(e,t)};const wo=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function bo(e){const t=!!e&&"length"in e&&e.length,i=yo(e);return!fo(e)&&!go(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}xo.fn=xo.prototype={jquery:Co,constructor:xo,length:0,toArray(){return no.call(this)},get(e){return null==e?no.call(this):e<0?this[e+this.length]:this[e]},pushStack(e){const t=xo.merge(this.constructor(),e);return t.prevObject=this,t},each(e){return xo.each(this,e)},map(e){return this.pushStack(xo.map(this,((t,i)=>e.call(t,i,t))))},slice(){return this.pushStack(no.apply(this,arguments))},first(){return this.eq(0)},last(){return this.eq(-1)},eq(e){const t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end(){return this.prevObject||this.constructor()},push:so,sort:to.sort,splice:to.splice},xo.extend=xo.fn.extend=function(){let e,t,i,r,n,o,s=arguments[0]||{},a=1;const{length:l}=arguments;let c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||fo(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)r=e[t],"__proto__"!==t&&s!==r&&(c&&r&&(xo.isPlainObject(r)||(n=Array.isArray(r)))?(i=s[t],o=n&&!Array.isArray(i)?[]:n||xo.isPlainObject(i)?i:{},n=!1,s[t]=xo.extend(c,o,r)):void 0!==r&&(s[t]=r));return s},xo.extend({expando:`jQuery${(Co+Math.random()).replace(/\D/g,"")}`,isReady:!0,error(e){throw new Error(e)},noop(){},isPlainObject(e){let t,i;return!(!e||"[object Object]"!==co.call(e))&&(t=ro(e),!t||(i=uo.call(t,"constructor")&&t.constructor,"function"==typeof i&&ho.call(i)===po))},isEmptyObject(e){let t;for(t in e)return!1;return!0},globalEval(e,t){vo(e,{nonce:t&&t.nonce})},each(e,t){let i,r=0;if(bo(e))for(i=e.length;r<i&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:e=>null==e?"":`${e}`.replace(wo,""),makeArray(e,t){const i=t||[];return null!=e&&(bo(Object(e))?xo.merge(i,"string"==typeof e?[e]:e):so.call(i,e)),i},inArray:(e,t,i)=>null==t?-1:ao.call(t,e,i),merge(e,t){const i=+t.length;let r=0,n=e.length;for(;r<i;r++)e[n++]=t[r];return e.length=n,e},grep(e,t,i){let r;const n=[];let o=0;const{length:s}=e,a=!i;for(;o<s;o++)r=!t(e[o],o),r!==a&&n.push(e[o]);return n},map(e,t,i){let r,n,o=0;const s=[];if(bo(e))for(r=e.length;o<r;o++)n=t(e[o],o,i),null!=n&&s.push(n);else for(o in e)n=t(e[o],o,i),null!=n&&s.push(n);return oo.apply([],s)},guid:1,support:mo}),"function"==typeof Symbol&&(xo.fn[Symbol.iterator]=to[Symbol.iterator]),xo.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),((e,t)=>{lo[`[object ${t}]`]=t.toLowerCase()}));const So=
/*!
     * Sizzle CSS Selector Engine v2.3.4
     * https://sizzlejs.com/
     *
     * Copyright JS Foundation and other contributors
     * Released under the MIT license
     * https://js.foundation/
     *
     * Date: 2019-04-08
     */
function(e){let t,i,r,n,o,s,a,l,c,u,h,d,p,m,f,g,_,v,y;const C="sizzle"+1*new Date,x=e.document;let w=0,b=0;const S=le(),T=le(),E=le(),P=le();let A=function(e,t){return e===t&&(h=!0),0};const M={}.hasOwnProperty;let D=[];const{pop:L}=D,R=D.push;let{push:O}=D;const{slice:I}=D,N=function(e,t){let i=0;const r=e.length;for(;i<r;i++)if(e[i]===t)return i;return-1},k="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",z="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",B=`\\[${F}*(${z})(?:${F}*([*^$|!~]?=)${F}*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(${z}))|)${F}*\\]`,G=`:(${z})(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|${B})*)|.*)\\)|)`,W=new RegExp(`${F}+`,"g"),U=new RegExp(`^${F}+|((?:^|[^\\\\])(?:\\\\.)*)${F}+$`,"g"),H=new RegExp(`^${F}*,${F}*`),V=new RegExp(`^${F}*([>+~]|${F})${F}*`),j=new RegExp(`${F}|>`),q=new RegExp(G),$=new RegExp(`^${z}$`),Y={ID:new RegExp(`^#(${z})`),CLASS:new RegExp(`^\\.(${z})`),TAG:new RegExp(`^(${z}|[*])`),ATTR:new RegExp(`^${B}`),PSEUDO:new RegExp(`^${G}`),CHILD:new RegExp(`^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(${F}*(even|odd|(([+-]|)(\\d*)n|)${F}*(?:([+-]|)${F}*(\\d+)|))${F}*\\)|)`,"i"),bool:new RegExp(`^(?:${k})$`,"i"),needsContext:new RegExp(`^${F}*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(${F}*((?:-\\d)?\\d*)${F}*\\)|)(?=[^-]|$)`,"i")},X=/HTML$/i,J=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp(`\\\\([\\da-f]{1,6}${F}?|(${F})|.)`,"ig"),ie=function(e,t,i){const r=`0x${t}`-65536;return r!=r||i?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"�":`${e.slice(0,-1)}\\${e.charCodeAt(e.length-1).toString(16)} `:`\\${e}`},oe=function(){d()},se=Ce((e=>!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()),{dir:"parentNode",next:"legend"});try{O.apply(D=I.call(x.childNodes),x.childNodes),D[x.childNodes.length].nodeType}catch(e){O={apply:D.length?function(e,t){R.apply(e,I.call(t))}:function(e,t){let i=e.length,r=0;for(;e[i++]=t[r++];);e.length=i-1}}}function ae(e,t,r,n){let o,a,c,u,h,m,_,v=t&&t.ownerDocument;const w=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==w&&9!==w&&11!==w)return r;if(!n&&((t?t.ownerDocument||t:x)!==p&&d(t),t=t||p,f)){if(11!==w&&(h=K.exec(e)))if(o=h[1]){if(9===w){if(!(c=t.getElementById(o)))return r;if(c.id===o)return r.push(c),r}else if(v&&(c=v.getElementById(o))&&y(t,c)&&c.id===o)return r.push(c),r}else{if(h[2])return O.apply(r,t.getElementsByTagName(e)),r;if((o=h[3])&&i.getElementsByClassName&&t.getElementsByClassName)return O.apply(r,t.getElementsByClassName(o)),r}if(i.qsa&&!P[`${e} `]&&(!g||!g.test(e))&&(1!==w||"object"!==t.nodeName.toLowerCase())){if(_=e,v=t,1===w&&j.test(e)){for((u=t.getAttribute("id"))?u=u.replace(re,ne):t.setAttribute("id",u=C),m=s(e),a=m.length;a--;)m[a]=`#${u} ${ye(m[a])}`;_=m.join(","),v=ee.test(e)&&_e(t.parentNode)||t}try{return O.apply(r,v.querySelectorAll(_)),r}catch(t){P(e,!0)}finally{u===C&&t.removeAttribute("id")}}}return l(e.replace(U,"$1"),t,r,n)}function le(){const e=[];return function t(i,n){return e.push(`${i} `)>r.cacheLength&&delete t[e.shift()],t[`${i} `]=n}}function ce(e){return e[C]=!0,e}function ue(e){let t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){const i=e.split("|");let n=i.length;for(;n--;)r.attrHandle[i[n]]=t}function de(e,t){let i=t&&e;const r=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function pe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function me(e){return function(t){const i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function fe(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&se(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ge(e){return ce((t=>(t=+t,ce(((i,r)=>{let n;const o=e([],i.length,t);let s=o.length;for(;s--;)i[n=o[s]]&&(i[n]=!(r[n]=i[n]))})))))}function _e(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in i=ae.support={},o=ae.isXML=function(e){const t=e.namespaceURI,i=(e.ownerDocument||e).documentElement;return!X.test(t||i&&i.nodeName||"HTML")},d=ae.setDocument=function(e){let t,n;const s=e?e.ownerDocument||e:x;return s!==p&&9===s.nodeType&&s.documentElement?(p=s,m=p.documentElement,f=!o(p),x!==p&&(n=p.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),i.attributes=ue((e=>(e.className="i",!e.getAttribute("className")))),i.getElementsByTagName=ue((e=>(e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length))),i.getElementsByClassName=Q.test(p.getElementsByClassName),i.getById=ue((e=>(m.appendChild(e).id=C,!p.getElementsByName||!p.getElementsByName(C).length))),i.getById?(r.filter.ID=function(e){const t=e.replace(te,ie);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&f){const i=t.getElementById(e);return i?[i]:[]}}):(r.filter.ID=function(e){const t=e.replace(te,ie);return function(e){const i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&f){let i,r,n,o=t.getElementById(e);if(o){if(i=o.getAttributeNode("id"),i&&i.value===e)return[o];for(n=t.getElementsByName(e),r=0;o=n[r++];)if(i=o.getAttributeNode("id"),i&&i.value===e)return[o]}return[]}}),r.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){let i;const r=[];let n=0;const o=t.getElementsByTagName(e);if("*"===e){for(;i=o[n++];)1===i.nodeType&&r.push(i);return r}return o},r.find.CLASS=i.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&f)return t.getElementsByClassName(e)},_=[],g=[],(i.qsa=Q.test(p.querySelectorAll))&&(ue((e=>{m.appendChild(e).innerHTML=`<a id='${C}'></a><select id='${C}-\r\\' msallowcapture=''><option selected=''></option></select>`,e.querySelectorAll("[msallowcapture^='']").length&&g.push(`[*^$]=${F}*(?:''|"")`),e.querySelectorAll("[selected]").length||g.push(`\\[${F}*(?:value|${k})`),e.querySelectorAll(`[id~=${C}-]`).length||g.push("~="),e.querySelectorAll(":checked").length||g.push(":checked"),e.querySelectorAll(`a#${C}+*`).length||g.push(".#.+[+~]")})),ue((e=>{e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";const t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&g.push(`name${F}*[*^$|!~]?=`),2!==e.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),m.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")}))),(i.matchesSelector=Q.test(v=m.matches||m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&ue((e=>{i.disconnectedMatch=v.call(e,"*"),v.call(e,"[s!='']:x"),_.push("!=",G)})),g=g.length&&new RegExp(g.join("|")),_=_.length&&new RegExp(_.join("|")),t=Q.test(m.compareDocumentPosition),y=t||Q.test(m.contains)?function(e,t){const i=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},A=t?function(e,t){if(e===t)return h=!0,0;let r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!i.sortDetached&&t.compareDocumentPosition(e)===r?e===p||e.ownerDocument===x&&y(x,e)?-1:t===p||t.ownerDocument===x&&y(x,t)?1:u?N(u,e)-N(u,t):0:4&r?-1:1)}:function(e,t){if(e===t)return h=!0,0;let i,r=0;const n=e.parentNode,o=t.parentNode,s=[e],a=[t];if(!n||!o)return e===p?-1:t===p?1:n?-1:o?1:u?N(u,e)-N(u,t):0;if(n===o)return de(e,t);for(i=e;i=i.parentNode;)s.unshift(i);for(i=t;i=i.parentNode;)a.unshift(i);for(;s[r]===a[r];)r++;return r?de(s[r],a[r]):s[r]===x?-1:a[r]===x?1:0},p):p},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&d(e),i.matchesSelector&&f&&!P[`${t} `]&&(!_||!_.test(t))&&(!g||!g.test(t)))try{const r=v.call(e,t);if(r||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){P(t,!0)}return ae(t,p,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!==p&&d(e),y(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!==p&&d(e);const n=r.attrHandle[t.toLowerCase()];let o=n&&M.call(r.attrHandle,t.toLowerCase())?n(e,t,!f):void 0;return void 0!==o?o:i.attributes||!f?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},ae.escape=function(e){return`${e}`.replace(re,ne)},ae.error=function(e){throw new Error(`Syntax error, unrecognized expression: ${e}`)},ae.uniqueSort=function(e){let t;const r=[];let n=0,o=0;if(h=!i.detectDuplicates,u=!i.sortStable&&e.slice(0),e.sort(A),h){for(;t=e[o++];)t===e[o]&&(n=r.push(o));for(;n--;)e.splice(r[n],1)}return u=null,e},n=ae.getText=function(e){let t,i="",r=0;const{nodeType:o}=e;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=n(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)i+=n(t);return i},r=ae.selectors={cacheLength:50,createPseudo:ce,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:e=>(e[1]=e[1].replace(te,ie),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ie),"~="===e[2]&&(e[3]=` ${e[3]} `),e.slice(0,4)),CHILD:e=>(e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e),PSEUDO(e){let t;const i=!e[6]&&e[2];return Y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&q.test(i)&&(t=s(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG(e){const t=e.replace(te,ie).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS(e){let t=S[`${e} `];return t||(t=new RegExp(`(^|${F})${e}(${F}|$)`))&&S(e,(e=>t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")))},ATTR:(e,t,i)=>function(r){let n=ae.attr(r,e);return null==n?"!="===t:!t||(n+="","="===t?n===i:"!="===t?n!==i:"^="===t?i&&0===n.indexOf(i):"*="===t?i&&n.indexOf(i)>-1:"$="===t?i&&n.slice(-i.length)===i:"~="===t?` ${n.replace(W," ")} `.indexOf(i)>-1:"|="===t&&(n===i||n.slice(0,i.length+1)===`${i}-`))},CHILD(e,t,i,r,n){const o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,i,l){let c,u,h,d,p,m,f=o!==s?"nextSibling":"previousSibling";const g=t.parentNode,_=a&&t.nodeName.toLowerCase(),v=!l&&!a;let y=!1;if(g){if(o){for(;f;){for(d=t;d=d[f];)if(a?d.nodeName.toLowerCase()===_:1===d.nodeType)return!1;m=f="only"===e&&!m&&"nextSibling"}return!0}if(m=[s?g.firstChild:g.lastChild],s&&v){for(d=g,h=d[C]||(d[C]={}),u=h[d.uniqueID]||(h[d.uniqueID]={}),c=u[e]||[],p=c[0]===w&&c[1],y=p&&c[2],d=p&&g.childNodes[p];d=++p&&d&&d[f]||(y=p=0)||m.pop();)if(1===d.nodeType&&++y&&d===t){u[e]=[w,p,y];break}}else if(v&&(d=t,h=d[C]||(d[C]={}),u=h[d.uniqueID]||(h[d.uniqueID]={}),c=u[e]||[],p=c[0]===w&&c[1],y=p),!1===y)for(;(d=++p&&d&&d[f]||(y=p=0)||m.pop())&&((a?d.nodeName.toLowerCase()!==_:1!==d.nodeType)||!++y||(v&&(h=d[C]||(d[C]={}),u=h[d.uniqueID]||(h[d.uniqueID]={}),u[e]=[w,y]),d!==t)););return y-=n,y===r||y%r==0&&y/r>=0}}},PSEUDO(e,t){let i;const n=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ae.error(`unsupported pseudo: ${e}`);return n[C]?n(t):n.length>1?(i=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ce(((e,i)=>{let r;const o=n(e,t);let s=o.length;for(;s--;)r=N(e,o[s]),e[r]=!(i[r]=o[s])})):function(e){return n(e,0,i)}):n}},pseudos:{not:ce((e=>{const t=[],i=[],r=a(e.replace(U,"$1"));return r[C]?ce(((e,t,i,n)=>{let o;const s=r(e,null,n,[]);let a=e.length;for(;a--;)(o=s[a])&&(e[a]=!(t[a]=o))})):function(e,n,o){return t[0]=e,r(t,null,o,i),t[0]=null,!i.pop()}})),has:ce((e=>function(t){return ae(e,t).length>0})),contains:ce((e=>(e=e.replace(te,ie),function(t){return(t.textContent||n(t)).indexOf(e)>-1}))),lang:ce((e=>($.test(e||"")||ae.error(`unsupported lang: ${e}`),e=e.replace(te,ie).toLowerCase(),function(t){let i;do{if(i=f?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(`${e}-`)}while((t=t.parentNode)&&1===t.nodeType);return!1}))),target(t){const i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:e=>e===m,focus:e=>e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex),enabled:fe(!1),disabled:fe(!0),checked(e){const t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:e=>(e.parentNode&&e.parentNode.selectedIndex,!0===e.selected),empty(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:e=>!r.pseudos.empty(e),header:e=>Z.test(e.nodeName),input:e=>J.test(e.nodeName),button(e){const t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text(e){let t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ge((()=>[0])),last:ge(((e,t)=>[t-1])),eq:ge(((e,t,i)=>[i<0?i+t:i])),even:ge(((e,t)=>{let i=0;for(;i<t;i+=2)e.push(i);return e})),odd:ge(((e,t)=>{let i=1;for(;i<t;i+=2)e.push(i);return e})),lt:ge(((e,t,i)=>{let r=i<0?i+t:i>t?t:i;for(;--r>=0;)e.push(r);return e})),gt:ge(((e,t,i)=>{let r=i<0?i+t:i;for(;++r<t;)e.push(r);return e}))}},r.pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=pe(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=me(t);function ve(){}function ye(e){let t=0;const i=e.length;let r="";for(;t<i;t++)r+=e[t].value;return r}function Ce(e,t,i){const{dir:r}=t,n=t.next,o=n||r,s=i&&"parentNode"===o,a=b++;return t.first?function(t,i,n){for(;t=t[r];)if(1===t.nodeType||s)return e(t,i,n);return!1}:function(t,i,l){let c,u,h;const d=[w,a];if(l){for(;t=t[r];)if((1===t.nodeType||s)&&e(t,i,l))return!0}else for(;t=t[r];)if(1===t.nodeType||s)if(h=t[C]||(t[C]={}),u=h[t.uniqueID]||(h[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[r]||t;else{if((c=u[o])&&c[0]===w&&c[1]===a)return d[2]=c[2];if(u[o]=d,d[2]=e(t,i,l))return!0}return!1}}function xe(e){return e.length>1?function(t,i,r){let n=e.length;for(;n--;)if(!e[n](t,i,r))return!1;return!0}:e[0]}function we(e,t,i,r,n){let o;const s=[];let a=0;const l=e.length,c=null!=t;for(;a<l;a++)(o=e[a])&&(i&&!i(o,r,n)||(s.push(o),c&&t.push(a)));return s}function be(e,t,i,r,n,o){return r&&!r[C]&&(r=be(r)),n&&!n[C]&&(n=be(n,o)),ce(((o,s,a,l)=>{let c,u,h;const d=[],p=[],m=s.length,f=o||function(e,t,i){let r=0;const n=t.length;for(;r<n;r++)ae(e,t[r],i);return i}(t||"*",a.nodeType?[a]:a,[]),g=!e||!o&&t?f:we(f,d,e,a,l);let _=i?n||(o?e:m||r)?[]:s:g;if(i&&i(g,_,a,l),r)for(c=we(_,p),r(c,[],a,l),u=c.length;u--;)(h=c[u])&&(_[p[u]]=!(g[p[u]]=h));if(o){if(n||e){if(n){for(c=[],u=_.length;u--;)(h=_[u])&&c.push(g[u]=h);n(null,_=[],c,l)}for(u=_.length;u--;)(h=_[u])&&(c=n?N(o,h):d[u])>-1&&(o[c]=!(s[c]=h))}}else _=we(_===s?_.splice(m,_.length):_),n?n(null,s,_,l):O.apply(s,_)}))}function Se(e){let t,i,n;const o=e.length,s=r.relative[e[0].type],a=s||r.relative[" "];let l=s?1:0;const u=Ce((e=>e===t),a,!0),h=Ce((e=>N(t,e)>-1),a,!0);let d=[function(e,i,r){const n=!s&&(r||i!==c)||((t=i).nodeType?u(e,i,r):h(e,i,r));return t=null,n}];for(;l<o;l++)if(i=r.relative[e[l].type])d=[Ce(xe(d),i)];else{if(i=r.filter[e[l].type].apply(null,e[l].matches),i[C]){for(n=++l;n<o&&!r.relative[e[n].type];n++);return be(l>1&&xe(d),l>1&&ye(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(U,"$1"),i,l<n&&Se(e.slice(l,n)),n<o&&Se(e=e.slice(n)),n<o&&ye(e))}d.push(i)}return xe(d)}return ve.prototype=r.filters=r.pseudos,r.setFilters=new ve,s=ae.tokenize=function(e,t){let i,n,o,s,a,l,c;const u=T[`${e} `];if(u)return t?0:u.slice(0);for(a=e,l=[],c=r.preFilter;a;){for(s in i&&!(n=H.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(o=[])),i=!1,(n=V.exec(a))&&(i=n.shift(),o.push({value:i,type:n[0].replace(U," ")}),a=a.slice(i.length)),r.filter)!(n=Y[s].exec(a))||c[s]&&!(n=c[s](n))||(i=n.shift(),o.push({value:i,type:s,matches:n}),a=a.slice(i.length));if(!i)break}return t?a.length:a?ae.error(e):T(e,l).slice(0)},a=ae.compile=function(e,t){let i;const n=[],o=[];let a=E[`${e} `];if(!a){for(t||(t=s(e)),i=t.length;i--;)a=Se(t[i]),a[C]?n.push(a):o.push(a);a=E(e,function(e,t){const i=t.length>0,n=e.length>0,o=function(o,s,a,l,u){let h,m,g,_=0,v="0";const y=o&&[];let C=[];const x=c,b=o||n&&r.find.TAG("*",u),S=w+=null==x?1:Math.random()||.1,T=b.length;for(u&&(c=s===p||s||u);v!==T&&null!=(h=b[v]);v++){if(n&&h){for(m=0,s||h.ownerDocument===p||(d(h),a=!f);g=e[m++];)if(g(h,s||p,a)){l.push(h);break}u&&(w=S)}i&&((h=!g&&h)&&_--,o&&y.push(h))}if(_+=v,i&&v!==_){for(m=0;g=t[m++];)g(y,C,s,a);if(o){if(_>0)for(;v--;)y[v]||C[v]||(C[v]=L.call(l));C=we(C)}O.apply(l,C),u&&!o&&C.length>0&&_+t.length>1&&ae.uniqueSort(l)}return u&&(w=S,c=x),y};return i?ce(o):o}(o,n)),a.selector=e}return a},l=ae.select=function(e,t,i,n){let o,l,c,u,h;const d="function"==typeof e&&e,p=!n&&s(e=d.selector||e);if(i=i||[],1===p.length){if(l=p[0]=p[0].slice(0),l.length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&f&&r.relative[l[1].type]){if(!(t=(r.find.ID(c.matches[0].replace(te,ie),t)||[])[0]))return i;d&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(o=Y.needsContext.test(e)?0:l.length;o--&&(c=l[o],!r.relative[u=c.type]);)if((h=r.find[u])&&(n=h(c.matches[0].replace(te,ie),ee.test(l[0].type)&&_e(t.parentNode)||t))){if(l.splice(o,1),!(e=n.length&&ye(l)))return O.apply(i,n),i;break}}return(d||a(e,p))(n,t,!f,i,!t||ee.test(e)&&_e(t.parentNode)||t),i},i.sortStable=C.split("").sort(A).join("")===C,i.detectDuplicates=!!h,d(),i.sortDetached=ue((e=>1&e.compareDocumentPosition(p.createElement("fieldset")))),ue((e=>(e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href"))))||he("type|href|height|width",((e,t,i)=>{if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),i.attributes&&ue((e=>(e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value"))))||he("value",((e,t,i)=>{if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ue((e=>null==e.getAttribute("disabled")))||he(k,((e,t,i)=>{let r;if(!i)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null})),ae}(window);xo.find=So,xo.expr=So.selectors,xo.expr[":"]=xo.expr.pseudos,xo.uniqueSort=xo.unique=So.uniqueSort,xo.text=So.getText,xo.isXMLDoc=So.isXML,xo.contains=So.contains,xo.escapeSelector=So.escape;const To=function(e,t,i){const r=[],n=void 0!==i;for(;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&xo(e).is(i))break;r.push(e)}return r},Eo=function(e,t){const i=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},Po=xo.expr.match.needsContext;function Ao(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}const Mo=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Do(e,t,i){return fo(t)?xo.grep(e,((e,r)=>!!t.call(e,r,e)!==i)):t.nodeType?xo.grep(e,(e=>e===t!==i)):"string"!=typeof t?xo.grep(e,(e=>ao.call(t,e)>-1!==i)):xo.filter(t,e,i)}let Lo;xo.filter=function(e,t,i){const r=t[0];return i&&(e=`:not(${e})`),1===t.length&&1===r.nodeType?xo.find.matchesSelector(r,e)?[r]:[]:xo.find.matches(e,xo.grep(t,(e=>1===e.nodeType)))},xo.fn.extend({find(e){let t,i;const r=this.length,n=this;if("string"!=typeof e)return this.pushStack(xo(e).filter((function(){for(t=0;t<r;t++)if(xo.contains(n[t],this))return!0})));for(i=this.pushStack([]),t=0;t<r;t++)xo.find(e,n[t],i);return r>1?xo.uniqueSort(i):i},filter(e){return this.pushStack(Do(this,e||[],!1))},not(e){return this.pushStack(Do(this,e||[],!0))},is(e){return!!Do(this,"string"==typeof e&&Po.test(e)?xo(e):e||[],!1).length}});const Ro=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(xo.fn.init=function(e,t,i){let r,n;if(!e)return this;if(i=i||Lo,"string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:Ro.exec(e),r&&(r[1]||!t)){if(r[1]){if(t=t instanceof xo?t[0]:t,xo.merge(this,xo.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:io,!0)),Mo.test(r[1])&&xo.isPlainObject(t))for(r in t)fo(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return n=io.getElementById(r[2]),n&&(this[0]=n,this.length=1),this}return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e)}return e.nodeType?(this[0]=e,this.length=1,this):fo(e)?void 0!==i.ready?i.ready(e):e(xo):xo.makeArray(e,this)}).prototype=xo.fn,Lo=xo(io);const Oo=/^(?:parents|prev(?:Until|All))/,Io={children:!0,contents:!0,next:!0,prev:!0};function No(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}xo.fn.extend({has(e){const t=xo(e,this),i=t.length;return this.filter((function(){let e=0;for(;e<i;e++)if(xo.contains(this,t[e]))return!0}))},closest(e,t){let i,r=0;const n=this.length,o=[],s="string"!=typeof e&&xo(e);if(!Po.test(e))for(;r<n;r++)for(i=this[r];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&xo.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?xo.uniqueSort(o):o)},index(e){return e?"string"==typeof e?ao.call(xo(e),this[0]):ao.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add(e,t){return this.pushStack(xo.uniqueSort(xo.merge(this.get(),xo(e,t))))},addBack(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),xo.each({parent(e){const t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:e=>To(e,"parentNode"),parentsUntil:(e,t,i)=>To(e,"parentNode",i),next:e=>No(e,"nextSibling"),prev:e=>No(e,"previousSibling"),nextAll:e=>To(e,"nextSibling"),prevAll:e=>To(e,"previousSibling"),nextUntil:(e,t,i)=>To(e,"nextSibling",i),prevUntil:(e,t,i)=>To(e,"previousSibling",i),siblings:e=>Eo((e.parentNode||{}).firstChild,e),children:e=>Eo(e.firstChild),contents:e=>void 0!==e.contentDocument?e.contentDocument:(Ao(e,"template")&&(e=e.content||e),xo.merge([],e.childNodes))},((e,t)=>{xo.fn[e]=function(i,r){let n=xo.map(this,t,i);return"Until"!==e.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=xo.filter(r,n)),this.length>1&&(Io[e]||xo.uniqueSort(n),Oo.test(e)&&n.reverse()),this.pushStack(n)}}));const ko=/[^\x20\t\r\n\f]+/g;function Fo(e){return e}function zo(e){throw e}function Bo(e,t,i,r){let n;try{e&&fo(n=e.promise)?n.call(e).done(t).fail(i):e&&fo(n=e.then)?n.call(e,t,i):t.apply(void 0,[e].slice(r))}catch(e){i.apply(void 0,[e])}}xo.Callbacks=function(e){let t,i,r,n;e="string"==typeof e?function(e){const t={};return xo.each(e.match(ko)||[],((e,i)=>{t[i]=!0})),t}(e):xo.extend({},e);let o=[],s=[],a=-1;const l=function(){for(n=n||e.once,r=t=!0;s.length;a=-1)for(i=s.shift();++a<o.length;)!1===o[a].apply(i[0],i[1])&&e.stopOnFalse&&(a=o.length,i=!1);e.memory||(i=!1),t=!1,n&&(o=i?[]:"")};var c={add(){return o&&(i&&!t&&(a=o.length-1,s.push(i)),function t(i){xo.each(i,((i,r)=>{fo(r)?e.unique&&c.has(r)||o.push(r):r&&r.length&&"string"!==yo(r)&&t(r)}))}(arguments),i&&!t&&l()),this},remove(){return xo.each(arguments,((e,t)=>{let i;for(;(i=xo.inArray(t,o,i))>-1;)o.splice(i,1),i<=a&&a--})),this},has:e=>e?xo.inArray(e,o)>-1:o.length>0,empty(){return o&&(o=[]),this},disable(){return n=s=[],o=i="",this},disabled:()=>!o,lock(){return n=s=[],i||t||(o=i=""),this},locked:()=>!!n,fireWith(e,i){return n||(i=[e,(i=i||[]).slice?i.slice():i],s.push(i),t||l()),this},fire(){return c.fireWith(this,arguments),this},fired:()=>!!r};return c},xo.extend({Deferred(e){const t=[["notify","progress",xo.Callbacks("memory"),xo.Callbacks("memory"),2],["resolve","done",xo.Callbacks("once memory"),xo.Callbacks("once memory"),0,"resolved"],["reject","fail",xo.Callbacks("once memory"),xo.Callbacks("once memory"),1,"rejected"]];let i="pending";var r={state:()=>i,always(){return n.done(arguments).fail(arguments),this},catch:e=>r.then(null,e),pipe(){let e=arguments;return xo.Deferred((i=>{xo.each(t,((t,r)=>{const o=fo(e[r[4]])&&e[r[4]];n[r[1]]((function(){const e=o&&o.apply(this,arguments);e&&fo(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[`${r[0]}With`](this,o?[e]:arguments)}))})),e=null})).promise()},then(e,i,r){let n=0;function o(e,t,i,r){return function(){let s=this,a=arguments;const l=function(){let l,c;if(!(e<n)){if(l=i.apply(s,a),l===t.promise())throw new TypeError("Thenable self-resolution");c=l&&("object"==typeof l||"function"==typeof l)&&l.then,fo(c)?r?c.call(l,o(n,t,Fo,r),o(n,t,zo,r)):(n++,c.call(l,o(n,t,Fo,r),o(n,t,zo,r),o(n,t,Fo,t.notifyWith))):(i!==Fo&&(s=void 0,a=[l]),(r||t.resolveWith)(s,a))}};var c=r?l:function(){try{l()}catch(r){xo.Deferred.exceptionHook&&xo.Deferred.exceptionHook(r,c.stackTrace),e+1>=n&&(i!==zo&&(s=void 0,a=[r]),t.rejectWith(s,a))}};e?c():(xo.Deferred.getStackHook&&(c.stackTrace=xo.Deferred.getStackHook()),window.setTimeout(c))}}return xo.Deferred((n=>{t[0][3].add(o(0,n,fo(r)?r:Fo,n.notifyWith)),t[1][3].add(o(0,n,fo(e)?e:Fo)),t[2][3].add(o(0,n,fo(i)?i:zo))})).promise()},promise:e=>null!=e?xo.extend(e,r):r},n={};return xo.each(t,((e,o)=>{const s=o[2],a=o[5];r[o[1]]=s.add,a&&s.add((()=>{i=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),s.add(o[3].fire),n[o[0]]=function(){return n[`${o[0]}With`](this===n?void 0:this,arguments),this},n[`${o[0]}With`]=s.fireWith})),r.promise(n),e&&e.call(n,n),n},when(e){let t=arguments.length,i=t;const r=Array(i),n=no.call(arguments),o=xo.Deferred(),s=function(e){return function(i){r[e]=this,n[e]=arguments.length>1?no.call(arguments):i,--t||o.resolveWith(r,n)}};if(t<=1&&(Bo(e,o.done(s(i)).resolve,o.reject,!t),"pending"===o.state()||fo(n[i]&&n[i].then)))return o.then();for(;i--;)Bo(n[i],s(i),o.reject);return o.promise()}});const Go=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;xo.Deferred.exceptionHook=function(e,t){window.console&&window.console.warn&&e&&Go.test(e.name)&&window.console.warn(`jQuery.Deferred exception: ${e.message}`,e.stack,t)},xo.readyException=function(e){window.setTimeout((()=>{throw e}))};const Wo=xo.Deferred();function Uo(){io.removeEventListener("DOMContentLoaded",Uo),window.removeEventListener("load",Uo),xo.ready()}xo.fn.ready=function(e){return Wo.then(e).catch((e=>{xo.readyException(e)})),this},xo.extend({isReady:!1,readyWait:1,ready(e){(!0===e?--xo.readyWait:xo.isReady)||(xo.isReady=!0,!0!==e&&--xo.readyWait>0||Wo.resolveWith(io,[xo]))}}),xo.ready.then=Wo.then,"complete"===io.readyState||"loading"!==io.readyState&&!io.documentElement.doScroll?window.setTimeout(xo.ready):(io.addEventListener("DOMContentLoaded",Uo),window.addEventListener("load",Uo));var Ho=function(e,t,i,r,n,o,s){let a=0;const l=e.length;let c=null==i;if("object"===yo(i))for(a in n=!0,i)Ho(e,t,a,i[a],!0,o,s);else if(void 0!==r&&(n=!0,fo(r)||(s=!0),c&&(s?(t.call(e,r),t=null):(c=t,t=function(e,t,i){return c.call(xo(e),i)})),t))for(;a<l;a++)t(e[a],i,s?r:r.call(e[a],a,t(e[a],i)));return n?e:c?t.call(e):l?t(e[0],i):o};const Vo=/^-ms-/,jo=/-([a-z])/g;function qo(e,t){return t.toUpperCase()}function $o(e){return e.replace(Vo,"ms-").replace(jo,qo)}const Yo=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Xo(){this.expando=xo.expando+Xo.uid++}Xo.uid=1,Xo.prototype={cache(e){let t=e[this.expando];return t||(t={},Yo(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set(e,t,i){let r;const n=this.cache(e);if("string"==typeof t)n[$o(t)]=i;else for(r in t)n[$o(r)]=t[r];return n},get(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][$o(t)]},access(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove(e,t){let i;const r=e[this.expando];if(void 0!==r){if(void 0!==t){i=(t=Array.isArray(t)?t.map($o):(t=$o(t))in r?[t]:t.match(ko)||[]).length;for(;i--;)delete r[t[i]]}(void 0===t||xo.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData(e){const t=e[this.expando];return void 0!==t&&!xo.isEmptyObject(t)}};const Jo=new Xo,Zo=new Xo,Qo=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ko=/[A-Z]/g;function es(e,t,i){let r;if(void 0===i&&1===e.nodeType)if(r=`data-${t.replace(Ko,"-$&").toLowerCase()}`,"string"==typeof(i=e.getAttribute(r))){try{i=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===""+ +e?+e:Qo.test(e)?JSON.parse(e):e)}(i)}catch(e){}Zo.set(e,t,i)}else i=void 0;return i}xo.extend({hasData:e=>Zo.hasData(e)||Jo.hasData(e),data:(e,t,i)=>Zo.access(e,t,i),removeData(e,t){Zo.remove(e,t)},_data:(e,t,i)=>Jo.access(e,t,i),_removeData(e,t){Jo.remove(e,t)}}),xo.fn.extend({data(e,t){let i,r,n;const o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(n=Zo.get(o),1===o.nodeType&&!Jo.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(r=s[i].name,0===r.indexOf("data-")&&(r=$o(r.slice(5)),es(o,r,n[r])));Jo.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each((function(){Zo.set(this,e)})):Ho(this,(function(t){let i;if(o&&void 0===t)return i=Zo.get(o,e),void 0!==i?i:(i=es(o,e),void 0!==i?i:void 0);this.each((function(){Zo.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData(e){return this.each((function(){Zo.remove(this,e)}))}}),xo.extend({queue(e,t,i){let r;if(e)return t=`${t||"fx"}queue`,r=Jo.get(e,t),i&&(!r||Array.isArray(i)?r=Jo.access(e,t,xo.makeArray(i)):r.push(i)),r||[]},dequeue(e,t){t=t||"fx";const i=xo.queue(e,t);let r=i.length,n=i.shift();const o=xo._queueHooks(e,t),s=function(){xo.dequeue(e,t)};"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===t&&i.unshift("inprogress"),delete o.stop,n.call(e,s,o)),!r&&o&&o.empty.fire()},_queueHooks(e,t){const i=`${t}queueHooks`;return Jo.get(e,i)||Jo.access(e,i,{empty:xo.Callbacks("once memory").add((()=>{Jo.remove(e,[`${t}queue`,i])}))})}}),xo.fn.extend({queue(e,t){let i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?xo.queue(this[0],e):void 0===t?this:this.each((function(){const i=xo.queue(this,e,t);xo._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&xo.dequeue(this,e)}))},dequeue(e){return this.each((function(){xo.dequeue(this,e)}))},clearQueue(e){return this.queue(e||"fx",[])},promise(e,t){let i,r=1;const n=xo.Deferred(),o=this;let s=this.length;const a=function(){--r||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)i=Jo.get(o[s],`${e}queueHooks`),i&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(t)}});const ts=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,is=new RegExp(`^(?:([+-])=|)(${ts})([a-z%]*)$`,"i"),rs=["Top","Right","Bottom","Left"],{documentElement:ns}=io;let os=function(e){return xo.contains(e.ownerDocument,e)};const ss={composed:!0};ns.getRootNode&&(os=function(e){return xo.contains(e.ownerDocument,e)||e.getRootNode(ss)===e.ownerDocument});const as=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&os(e)&&"none"===xo.css(e,"display")},ls=function(e,t,i,r){let n,o;const s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];for(o in n=i.apply(e,r||[]),t)e.style[o]=s[o];return n};function cs(e,t,i,r){let n,o,s=20;const a=r?function(){return r.cur()}:function(){return xo.css(e,t,"")};let l=a(),c=i&&i[3]||(xo.cssNumber[t]?"":"px"),u=e.nodeType&&(xo.cssNumber[t]||"px"!==c&&+l)&&is.exec(xo.css(e,t));if(u&&u[3]!==c){for(l/=2,c=c||u[3],u=+l||1;s--;)xo.style(e,t,u+c),(1-o)*(1-(o=a()/l||.5))<=0&&(s=0),u/=o;u*=2,xo.style(e,t,u+c),i=i||[]}return i&&(u=+u||+l||0,n=i[1]?u+(i[1]+1)*i[2]:+i[2],r&&(r.unit=c,r.start=u,r.end=n)),n}const us={};function hs(e){let t;const i=e.ownerDocument,{nodeName:r}=e;let n=us[r];return n||(t=i.body.appendChild(i.createElement(r)),n=xo.css(t,"display"),t.parentNode.removeChild(t),"none"===n&&(n="block"),us[r]=n,n)}function ds(e,t){let i,r;const n=[];let o=0;const{length:s}=e;for(;o<s;o++)r=e[o],r.style&&(i=r.style.display,t?("none"===i&&(n[o]=Jo.get(r,"display")||null,n[o]||(r.style.display="")),""===r.style.display&&as(r)&&(n[o]=hs(r))):"none"!==i&&(n[o]="none",Jo.set(r,"display",i)));for(o=0;o<s;o++)null!=n[o]&&(e[o].style.display=n[o]);return e}xo.fn.extend({show(){return ds(this,!0)},hide(){return ds(this)},toggle(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){as(this)?xo(this).show():xo(this).hide()}))}});const ps=/^(?:checkbox|radio)$/i,ms=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,fs=/^$|^module$|\/(?:java|ecma)script/i,gs={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function _s(e,t){let i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&Ao(e,t)?xo.merge([e],i):i}function vs(e,t){let i=0;const r=e.length;for(;i<r;i++)Jo.set(e[i],"globalEval",!t||Jo.get(t[i],"globalEval"))}gs.optgroup=gs.option,gs.tbody=gs.tfoot=gs.colgroup=gs.caption=gs.thead,gs.th=gs.td;const ys=/<|&#?\w+;/;function Cs(e,t,i,r,n){let o,s,a,l,c,u;const h=t.createDocumentFragment(),d=[];let p=0;const m=e.length;for(;p<m;p++)if(o=e[p],o||0===o)if("object"===yo(o))xo.merge(d,o.nodeType?[o]:o);else if(ys.test(o)){for(s=s||h.appendChild(t.createElement("div")),a=(ms.exec(o)||["",""])[1].toLowerCase(),l=gs[a]||gs._default,s.innerHTML=l[1]+xo.htmlPrefilter(o)+l[2],u=l[0];u--;)s=s.lastChild;xo.merge(d,s.childNodes),s=h.firstChild,s.textContent=""}else d.push(t.createTextNode(o));for(h.textContent="",p=0;o=d[p++];)if(r&&xo.inArray(o,r)>-1)n&&n.push(o);else if(c=os(o),s=_s(h.appendChild(o),"script"),c&&vs(s),i)for(u=0;o=s[u++];)fs.test(o.type||"")&&i.push(o);return h}!function(){const e=io.createDocumentFragment().appendChild(io.createElement("div")),t=io.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),mo.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",mo.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();const xs=/^key/,ws=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,bs=/^([^.]*)(?:\.(.+)|)/;function Ss(){return!0}function Ts(){return!1}function Es(e,t){return e===function(){try{return io.activeElement}catch(e){}}()==("focus"===t)}function Ps(e,t,i,r,n,o){let s,a;if("object"==typeof t){for(a in"string"!=typeof i&&(r=r||i,i=void 0),t)Ps(e,a,i,r,t[a],o);return e}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),!1===n)n=Ts;else if(!n)return e;return 1===o&&(s=n,n=function(e){return xo().off(e),s.apply(this,arguments)},n.guid=s.guid||(s.guid=xo.guid++)),e.each((function(){xo.event.add(this,t,n,r,i)}))}function As(e,t,i){i?(Jo.set(e,t,!1),xo.event.add(e,t,{namespace:!1,handler(e){let r,n,o=Jo.get(this,t);if(1&e.isTrigger&&this[t]){if(o.length)(xo.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=no.call(arguments),Jo.set(this,t,o),r=i(this,t),this[t](),n=Jo.get(this,t),o!==n||r?Jo.set(this,t,!1):n={},o!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else o.length&&(Jo.set(this,t,{value:xo.event.trigger(xo.extend(o[0],xo.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Jo.get(e,t)&&xo.event.add(e,t,Ss)}xo.event={global:{},add(e,t,i,r,n){let o,s,a,l,c,u,h,d,p,m,f;const g=Jo.get(e);if(g)for(i.handler&&(o=i,i=o.handler,n=o.selector),n&&xo.find.matchesSelector(ns,n),i.guid||(i.guid=xo.guid++),(l=g.events)||(l=g.events={}),(s=g.handle)||(s=g.handle=function(t){return void 0!==xo&&xo.event.triggered!==t.type?xo.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(ko)||[""]).length;c--;)a=bs.exec(t[c])||[],p=f=a[1],m=(a[2]||"").split(".").sort(),p&&(h=xo.event.special[p]||{},p=(n?h.delegateType:h.bindType)||p,h=xo.event.special[p]||{},u=xo.extend({type:p,origType:f,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&xo.expr.match.needsContext.test(n),namespace:m.join(".")},o),(d=l[p])||(d=l[p]=[],d.delegateCount=0,h.setup&&!1!==h.setup.call(e,r,m,s)||e.addEventListener&&e.addEventListener(p,s)),h.add&&(h.add.call(e,u),u.handler.guid||(u.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,u):d.push(u),xo.event.global[p]=!0)},remove(e,t,i,r,n){let o,s,a,l,c,u,h,d,p,m,f;const g=Jo.hasData(e)&&Jo.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(ko)||[""]).length;c--;)if(a=bs.exec(t[c])||[],p=f=a[1],m=(a[2]||"").split(".").sort(),p){for(h=xo.event.special[p]||{},p=(r?h.delegateType:h.bindType)||p,d=l[p]||[],a=a[2]&&new RegExp(`(^|\\.)${m.join("\\.(?:.*\\.|)")}(\\.|$)`),s=o=d.length;o--;)u=d[o],!n&&f!==u.origType||i&&i.guid!==u.guid||a&&!a.test(u.namespace)||r&&r!==u.selector&&("**"!==r||!u.selector)||(d.splice(o,1),u.selector&&d.delegateCount--,h.remove&&h.remove.call(e,u));s&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,m,g.handle)||xo.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)xo.event.remove(e,p+t[c],i,r,!0);xo.isEmptyObject(l)&&Jo.remove(e,"handle events")}},dispatch(e){const t=xo.event.fix(e);let i,r,n,o,s,a;const l=new Array(arguments.length),c=(Jo.get(this,"events")||{})[t.type]||[],u=xo.event.special[t.type]||{};for(l[0]=t,i=1;i<arguments.length;i++)l[i]=arguments[i];if(t.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,t)){for(a=xo.event.handlers.call(this,t,c),i=0;(o=a[i++])&&!t.isPropagationStopped();)for(t.currentTarget=o.elem,r=0;(s=o.handlers[r++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!1!==s.namespace&&!t.rnamespace.test(s.namespace)||(t.handleObj=s,t.data=s.data,n=((xo.event.special[s.origType]||{}).handle||s.handler).apply(o.elem,l),void 0!==n&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,t),t.result}},handlers(e,t){let i,r,n,o,s;const a=[],{delegateCount:l}=t;let c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(o=[],s={},i=0;i<l;i++)r=t[i],n=`${r.selector} `,void 0===s[n]&&(s[n]=r.needsContext?xo(n,this).index(c)>-1:xo.find(n,this,null,[c]).length),s[n]&&o.push(r);o.length&&a.push({elem:c,handlers:o})}return c=this,l<t.length&&a.push({elem:c,handlers:t.slice(l)}),a},addProp(e,t){Object.defineProperty(xo.Event.prototype,e,{enumerable:!0,configurable:!0,get:fo(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:e=>e[xo.expando]?e:new xo.Event(e),special:{load:{noBubble:!0},click:{setup(e){const t=this||e;return ps.test(t.type)&&t.click&&Ao(t,"input")&&As(t,"click",Ss),!1},trigger(e){const t=this||e;return ps.test(t.type)&&t.click&&Ao(t,"input")&&As(t,"click"),!0},_default(e){const{target:t}=e;return ps.test(t.type)&&t.click&&Ao(t,"input")&&Jo.get(t,"click")||Ao(t,"a")}},beforeunload:{postDispatch(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},xo.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},xo.Event=function(e,t){if(!(this instanceof xo.Event))return new xo.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ss:Ts,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&xo.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[xo.expando]=!0},xo.Event.prototype={constructor:xo.Event,isDefaultPrevented:Ts,isPropagationStopped:Ts,isImmediatePropagationStopped:Ts,isSimulated:!1,preventDefault(){const e=this.originalEvent;this.isDefaultPrevented=Ss,e&&!this.isSimulated&&e.preventDefault()},stopPropagation(){const e=this.originalEvent;this.isPropagationStopped=Ss,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation(){const e=this.originalEvent;this.isImmediatePropagationStopped=Ss,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},xo.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which(e){const{button:t}=e;return null==e.which&&xs.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&ws.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},xo.event.addProp),xo.each({focus:"focusin",blur:"focusout"},((e,t)=>{xo.event.special[e]={setup(){return As(this,e,Es),!1},trigger(){return As(this,e),!0},delegateType:t}})),xo.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},((e,t)=>{xo.event.special[e]={delegateType:t,bindType:t,handle(e){let i;const r=e.relatedTarget,{handleObj:n}=e;return r&&(r===this||xo.contains(this,r))||(e.type=n.origType,i=n.handler.apply(this,arguments),e.type=t),i}}})),xo.fn.extend({on(e,t,i,r){return Ps(this,e,t,i,r)},one(e,t,i,r){return Ps(this,e,t,i,r,1)},off(e,t,i){let r,n;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,xo(e.delegateTarget).off(r.namespace?`${r.origType}.${r.namespace}`:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=Ts),this.each((function(){xo.event.remove(this,e,i,t)}))}});const Ms=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ds=/<script|<style|<link/i,Ls=/checked\s*(?:[^=]|=\s*.checked.)/i,Rs=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Os(e,t){return Ao(e,"table")&&Ao(11!==t.nodeType?t:t.firstChild,"tr")&&xo(e).children("tbody")[0]||e}function Is(e){return e.type=`${null!==e.getAttribute("type")}/${e.type}`,e}function Ns(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function ks(e,t){let i,r,n,o,s,a,l,c;if(1===t.nodeType){if(Jo.hasData(e)&&(o=Jo.access(e),s=Jo.set(t,o),c=o.events,c))for(n in delete s.handle,s.events={},c)for(i=0,r=c[n].length;i<r;i++)xo.event.add(t,n,c[n][i]);Zo.hasData(e)&&(a=Zo.access(e),l=xo.extend({},a),Zo.set(t,l))}}function Fs(e,t){const i=t.nodeName.toLowerCase();"input"===i&&ps.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function zs(e,t,i,r){let n,o,s,a,l,c;t=oo.apply([],t);let u=0;const h=e.length,d=h-1,p=t[0],m=fo(p);if(m||h>1&&"string"==typeof p&&!mo.checkClone&&Ls.test(p))return e.each((function(n){const o=e.eq(n);m&&(t[0]=p.call(this,n,o.html())),zs(o,t,i,r)}));if(h&&(n=Cs(t,e[0].ownerDocument,!1,e,r),o=n.firstChild,1===n.childNodes.length&&(n=o),o||r)){for(s=xo.map(_s(n,"script"),Is),a=s.length;u<h;u++)l=n,u!==d&&(l=xo.clone(l,!0,!0),a&&xo.merge(s,_s(l,"script"))),i.call(e[u],l,u);if(a)for(c=s[s.length-1].ownerDocument,xo.map(s,Ns),u=0;u<a;u++)l=s[u],fs.test(l.type||"")&&!Jo.access(l,"globalEval")&&xo.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?xo._evalUrl&&!l.noModule&&xo._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")}):vo(l.textContent.replace(Rs,""),l,c))}return e}function Bs(e,t,i){let r;const n=t?xo.filter(t,e):e;let o=0;for(;null!=(r=n[o]);o++)i||1!==r.nodeType||xo.cleanData(_s(r)),r.parentNode&&(i&&os(r)&&vs(_s(r,"script")),r.parentNode.removeChild(r));return e}xo.extend({htmlPrefilter:e=>e.replace(Ms,"<$1></$2>"),clone(e,t,i){let r,n,o,s;const a=e.cloneNode(!0),l=os(e);if(!(mo.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||xo.isXMLDoc(e)))for(s=_s(a),o=_s(e),r=0,n=o.length;r<n;r++)Fs(o[r],s[r]);if(t)if(i)for(o=o||_s(e),s=s||_s(a),r=0,n=o.length;r<n;r++)ks(o[r],s[r]);else ks(e,a);return s=_s(a,"script"),s.length>0&&vs(s,!l&&_s(e,"script")),a},cleanData(e){let t,i,r;const{special:n}=xo.event;let o=0;for(;void 0!==(i=e[o]);o++)if(Yo(i)){if(t=i[Jo.expando]){if(t.events)for(r in t.events)n[r]?xo.event.remove(i,r):xo.removeEvent(i,r,t.handle);i[Jo.expando]=void 0}i[Zo.expando]&&(i[Zo.expando]=void 0)}}}),xo.fn.extend({detach(e){return Bs(this,e,!0)},remove(e){return Bs(this,e)},text(e){return Ho(this,(function(e){return void 0===e?xo.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append(){return zs(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){Os(this,e).appendChild(e)}}))},prepend(){return zs(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){const t=Os(this,e);t.insertBefore(e,t.firstChild)}}))},before(){return zs(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after(){return zs(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty(){let e,t=0;for(;null!=(e=this[t]);t++)1===e.nodeType&&(xo.cleanData(_s(e,!1)),e.textContent="");return this},clone(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return xo.clone(this,e,t)}))},html(e){return Ho(this,(function(e){let t=this[0]||{},i=0;const r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ds.test(e)&&!gs[(ms.exec(e)||["",""])[1].toLowerCase()]){e=xo.htmlPrefilter(e);try{for(;i<r;i++)t=this[i]||{},1===t.nodeType&&(xo.cleanData(_s(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith(){const e=[];return zs(this,arguments,(function(t){const i=this.parentNode;xo.inArray(this,e)<0&&(xo.cleanData(_s(this)),i&&i.replaceChild(t,this))}),e)}}),xo.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},((e,t)=>{xo.fn[e]=function(e){let i;const r=[],n=xo(e),o=n.length-1;let s=0;for(;s<=o;s++)i=s===o?this:this.clone(!0),xo(n[s])[t](i),so.apply(r,i.get());return this.pushStack(r)}}));const Gs=new RegExp(`^(${ts})(?!px)[a-z%]+$`,"i"),Ws=function(e){let t=e.ownerDocument.defaultView;return t&&t.opener||(t=window),t.getComputedStyle(e)},Us=new RegExp(rs.join("|"),"i");function Hs(e,t,i){let r,n,o,s;const{style:a}=e;return(i=i||Ws(e))&&(s=i.getPropertyValue(t)||i[t],""!==s||os(e)||(s=xo.style(e,t)),!mo.pixelBoxStyles()&&Gs.test(s)&&Us.test(t)&&(r=a.width,n=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=r,a.minWidth=n,a.maxWidth=o)),void 0!==s?`${s}`:s}function Vs(e,t){return{get(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(!l)return;a.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ns.appendChild(a).appendChild(l);const e=window.getComputedStyle(l);i="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",n=12===t(l.offsetWidth/3),ns.removeChild(a),l=null}function t(e){return Math.round(parseFloat(e))}let i,r,n,o,s;var a=io.createElement("div"),l=io.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",mo.clearCloneStyle="content-box"===l.style.backgroundClip,xo.extend(mo,{boxSizingReliable:()=>(e(),r),pixelBoxStyles:()=>(e(),o),pixelPosition:()=>(e(),i),reliableMarginLeft:()=>(e(),s),scrollboxSize:()=>(e(),n)}))}();const js=["Webkit","Moz","ms"],qs=io.createElement("div").style,$s={};function Ys(e){const t=xo.cssProps[e]||$s[e];return t||(e in qs?e:$s[e]=function(e){const t=e[0].toUpperCase()+e.slice(1);let i=js.length;for(;i--;)if((e=js[i]+t)in qs)return e}(e)||e)}const Xs=/^(none|table(?!-c[ea]).+)/,Js=/^--/,Zs={position:"absolute",visibility:"hidden",display:"block"},Qs={letterSpacing:"0",fontWeight:"400"};function Ks(e,t,i){const r=is.exec(t);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):t}function ea(e,t,i,r,n,o){let s="width"===t?1:0,a=0,l=0;if(i===(r?"border":"content"))return 0;for(;s<4;s+=2)"margin"===i&&(l+=xo.css(e,i+rs[s],!0,n)),r?("content"===i&&(l-=xo.css(e,`padding${rs[s]}`,!0,n)),"margin"!==i&&(l-=xo.css(e,`border${rs[s]}Width`,!0,n))):(l+=xo.css(e,`padding${rs[s]}`,!0,n),"padding"!==i?l+=xo.css(e,`border${rs[s]}Width`,!0,n):a+=xo.css(e,`border${rs[s]}Width`,!0,n));return!r&&o>=0&&(l+=Math.max(0,Math.ceil(e[`offset${t[0].toUpperCase()}${t.slice(1)}`]-o-l-a-.5))||0),l}function ta(e,t,i){const r=Ws(e);let n=(!mo.boxSizingReliable()||i)&&"border-box"===xo.css(e,"boxSizing",!1,r),o=n,s=Hs(e,t,r);const a=`offset${t[0].toUpperCase()}${t.slice(1)}`;if(Gs.test(s)){if(!i)return s;s="auto"}return(!mo.boxSizingReliable()&&n||"auto"===s||!parseFloat(s)&&"inline"===xo.css(e,"display",!1,r))&&e.getClientRects().length&&(n="border-box"===xo.css(e,"boxSizing",!1,r),o=a in e,o&&(s=e[a])),s=parseFloat(s)||0,`${s+ea(e,t,i||(n?"border":"content"),o,r,s)}px`}function ia(e,t,i,r,n){return new ia.prototype.init(e,t,i,r,n)}let ra,na;xo.extend({cssHooks:{opacity:{get(e,t){if(t){const t=Hs(e,"opacity");return""===t?"1":t}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style(e,t,i,r){if(!e||3===e.nodeType||8===e.nodeType||!e.style)return;let n,o,s;const a=$o(t),l=Js.test(t),{style:c}=e;if(l||(t=Ys(a)),s=xo.cssHooks[t]||xo.cssHooks[a],void 0===i)return s&&"get"in s&&void 0!==(n=s.get(e,!1,r))?n:c[t];o=typeof i,"string"===o&&(n=is.exec(i))&&n[1]&&(i=cs(e,t,n),o="number"),null!=i&&i==i&&("number"!==o||l||(i+=n&&n[3]||(xo.cssNumber[a]?"":"px")),mo.clearCloneStyle||""!==i||0!==t.indexOf("background")||(c[t]="inherit"),s&&"set"in s&&void 0===(i=s.set(e,i,r))||(l?c.setProperty(t,i):c[t]=i))},css(e,t,i,r){let n,o,s;const a=$o(t);return Js.test(t)||(t=Ys(a)),s=xo.cssHooks[t]||xo.cssHooks[a],s&&"get"in s&&(n=s.get(e,!0,i)),void 0===n&&(n=Hs(e,t,r)),"normal"===n&&t in Qs&&(n=Qs[t]),""===i||i?(o=parseFloat(n),!0===i||isFinite(o)?o||0:n):n}}),xo.each(["height","width"],((e,t)=>{xo.cssHooks[t]={get(e,i,r){if(i)return!Xs.test(xo.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ta(e,t,r):ls(e,Zs,(()=>ta(e,t,r)))},set(e,i,r){let n;const o=Ws(e),s=!mo.scrollboxSize()&&"absolute"===o.position,a=(s||r)&&"border-box"===xo.css(e,"boxSizing",!1,o);let l=r?ea(e,t,r,a,o):0;return a&&s&&(l-=Math.ceil(e[`offset${t[0].toUpperCase()}${t.slice(1)}`]-parseFloat(o[t])-ea(e,t,"border",!1,o)-.5)),l&&(n=is.exec(i))&&"px"!==(n[3]||"px")&&(e.style[t]=i,i=xo.css(e,t)),Ks(0,i,l)}}})),xo.cssHooks.marginLeft=Vs(mo.reliableMarginLeft,((e,t)=>{if(t)return`${parseFloat(Hs(e,"marginLeft"))||e.getBoundingClientRect().left-ls(e,{marginLeft:0},(()=>e.getBoundingClientRect().left))}px`})),xo.each({margin:"",padding:"",border:"Width"},((e,t)=>{xo.cssHooks[e+t]={expand(i){let r=0;const n={},o="string"==typeof i?i.split(" "):[i];for(;r<4;r++)n[e+rs[r]+t]=o[r]||o[r-2]||o[0];return n}},"margin"!==e&&(xo.cssHooks[e+t].set=Ks)})),xo.fn.extend({css(e,t){return Ho(this,((e,t,i)=>{let r,n;const o={};let s=0;if(Array.isArray(t)){for(r=Ws(e),n=t.length;s<n;s++)o[t[s]]=xo.css(e,t[s],!1,r);return o}return void 0!==i?xo.style(e,t,i):xo.css(e,t)}),e,t,arguments.length>1)}}),xo.Tween=ia,ia.prototype={constructor:ia,init(e,t,i,r,n,o){this.elem=e,this.prop=i,this.easing=n||xo.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(xo.cssNumber[i]?"":"px")},cur(){const e=ia.propHooks[this.prop];return e&&e.get?e.get(this):ia.propHooks._default.get(this)},run(e){let t;const i=ia.propHooks[this.prop];return this.options.duration?this.pos=t=xo.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):ia.propHooks._default.set(this),this}},ia.prototype.init.prototype=ia.prototype,ia.propHooks={_default:{get(e){let t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=xo.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set(e){xo.fx.step[e.prop]?xo.fx.step[e.prop](e):1!==e.elem.nodeType||!xo.cssHooks[e.prop]&&null==e.elem.style[Ys(e.prop)]?e.elem[e.prop]=e.now:xo.style(e.elem,e.prop,e.now+e.unit)}}},ia.propHooks.scrollTop=ia.propHooks.scrollLeft={set(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},xo.easing={linear:e=>e,swing:e=>.5-Math.cos(e*Math.PI)/2,_default:"swing"},xo.fx=ia.prototype.init,xo.fx.step={};const oa=/^(?:toggle|show|hide)$/,sa=/queueHooks$/;function aa(){na&&(!1===io.hidden&&window.requestAnimationFrame?window.requestAnimationFrame(aa):window.setTimeout(aa,xo.fx.interval),xo.fx.tick())}function la(){return window.setTimeout((()=>{ra=void 0})),ra=Date.now()}function ca(e,t){let i,r=0;const n={height:e};for(t=t?1:0;r<4;r+=2-t)i=rs[r],n[`margin${i}`]=n[`padding${i}`]=e;return t&&(n.opacity=n.width=e),n}function ua(e,t,i){let r;const n=(ha.tweeners[t]||[]).concat(ha.tweeners["*"]);let o=0;const{length:s}=n;for(;o<s;o++)if(r=n[o].call(i,t,e))return r}function ha(e,t,i){let r,n,o=0;const{length:s}=ha.prefilters,a=xo.Deferred().always((()=>{delete l.elem}));var l=function(){if(n)return!1;const t=ra||la(),i=Math.max(0,c.startTime+c.duration-t),r=1-(i/c.duration||0);let o=0;const{length:s}=c.tweens;for(;o<s;o++)c.tweens[o].run(r);return a.notifyWith(e,[c,r,i]),r<1&&s?i:(s||a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:xo.extend({},t),opts:xo.extend(!0,{specialEasing:{},easing:xo.easing._default},i),originalProperties:t,originalOptions:i,startTime:ra||la(),duration:i.duration,tweens:[],createTween(t,i){const r=xo.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop(t){let i=0;const r=t?c.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)c.tweens[i].run(1);return t?(a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c,t])):a.rejectWith(e,[c,t]),this}});const{props:u}=c;for(!function(e,t){let i,r,n,o,s;for(i in e)if(r=$o(i),n=t[r],o=e[i],Array.isArray(o)&&(n=o[1],o=e[i]=o[0]),i!==r&&(e[r]=o,delete e[i]),s=xo.cssHooks[r],s&&"expand"in s)for(i in o=s.expand(o),delete e[r],o)i in e||(e[i]=o[i],t[i]=n);else t[r]=n}(u,c.opts.specialEasing);o<s;o++)if(r=ha.prefilters[o].call(c,e,u,c.opts),r)return fo(r.stop)&&(xo._queueHooks(c.elem,c.opts.queue).stop=r.stop.bind(r)),r;return xo.map(u,ua,c),fo(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),xo.fx.timer(xo.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}let da;xo.Animation=xo.extend(ha,{tweeners:{"*":[function(e,t){const i=this.createTween(e,t);return cs(i.elem,e,is.exec(t),i),i}]},tweener(e,t){let i;fo(e)?(t=e,e=["*"]):e=e.match(ko);let r=0;const{length:n}=e;for(;r<n;r++)i=e[r],ha.tweeners[i]=ha.tweeners[i]||[],ha.tweeners[i].unshift(t)},prefilters:[function(e,t,i){let r,n,o,s,a,l,c,u;const h="width"in t||"height"in t,d=this,p={},{style:m}=e;let f=e.nodeType&&as(e),g=Jo.get(e,"fxshow");for(r in i.queue||(s=xo._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,d.always((()=>{d.always((()=>{s.unqueued--,xo.queue(e,"fx").length||s.empty.fire()}))}))),t)if(n=t[r],oa.test(n)){if(delete t[r],o=o||"toggle"===n,n===(f?"hide":"show")){if("show"!==n||!g||void 0===g[r])continue;f=!0}p[r]=g&&g[r]||xo.style(e,r)}if(l=!xo.isEmptyObject(t),l||!xo.isEmptyObject(p))for(r in h&&1===e.nodeType&&(i.overflow=[m.overflow,m.overflowX,m.overflowY],c=g&&g.display,null==c&&(c=Jo.get(e,"display")),u=xo.css(e,"display"),"none"===u&&(c?u=c:(ds([e],!0),c=e.style.display||c,u=xo.css(e,"display"),ds([e]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===xo.css(e,"float")&&(l||(d.done((()=>{m.display=c})),null==c&&(u=m.display,c="none"===u?"":u)),m.display="inline-block")),i.overflow&&(m.overflow="hidden",d.always((()=>{m.overflow=i.overflow[0],m.overflowX=i.overflow[1],m.overflowY=i.overflow[2]}))),l=!1,p)l||(g?"hidden"in g&&(f=g.hidden):g=Jo.access(e,"fxshow",{display:c}),o&&(g.hidden=!f),f&&ds([e],!0),d.done((()=>{for(r in f||ds([e]),Jo.remove(e,"fxshow"),p)xo.style(e,r,p[r])}))),l=ua(f?g[r]:0,r,d),r in g||(g[r]=l.start,f&&(l.end=l.start,l.start=0))}],prefilter(e,t){t?ha.prefilters.unshift(e):ha.prefilters.push(e)}}),xo.speed=function(e,t,i){const r=e&&"object"==typeof e?xo.extend({},e):{complete:i||!i&&t||fo(e)&&e,duration:e,easing:i&&t||t&&!fo(t)&&t};return xo.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in xo.fx.speeds?r.duration=xo.fx.speeds[r.duration]:r.duration=xo.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){fo(r.old)&&r.old.call(this),r.queue&&xo.dequeue(this,r.queue)},r},xo.fn.extend({fadeTo(e,t,i,r){return this.filter(as).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate(e,t,i,r){const n=xo.isEmptyObject(e),o=xo.speed(t,i,r),s=function(){const t=ha(this,xo.extend({},e),o);(n||Jo.get(this,"finish"))&&t.stop(!0)};return s.finish=s,n||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop(e,t,i){const r=function(e){const{stop:t}=e;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each((function(){let t=!0,n=null!=e&&`${e}queueHooks`;const{timers:o}=xo,s=Jo.get(this);if(n)s[n]&&s[n].stop&&r(s[n]);else for(n in s)s[n]&&s[n].stop&&sa.test(n)&&r(s[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(i),t=!1,o.splice(n,1));!t&&i||xo.dequeue(this,e)}))},finish(e){return!1!==e&&(e=e||"fx"),this.each((function(){let t;const i=Jo.get(this),r=i[`${e}queue`],n=i[`${e}queueHooks`],{timers:o}=xo,s=r?r.length:0;for(i.finish=!0,xo.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<s;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete i.finish}))}}),xo.each(["toggle","show","hide"],((e,t)=>{const i=xo.fn[t];xo.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(ca(t,!0),e,r,n)}})),xo.each({slideDown:ca("show"),slideUp:ca("hide"),slideToggle:ca("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},((e,t)=>{xo.fn[e]=function(e,i,r){return this.animate(t,e,i,r)}})),xo.timers=[],xo.fx.tick=function(){let e,t=0;const{timers:i}=xo;for(ra=Date.now();t<i.length;t++)e=i[t],e()||i[t]!==e||i.splice(t--,1);i.length||xo.fx.stop(),ra=void 0},xo.fx.timer=function(e){xo.timers.push(e),xo.fx.start()},xo.fx.interval=13,xo.fx.start=function(){na||(na=!0,aa())},xo.fx.stop=function(){na=null},xo.fx.speeds={slow:600,fast:200,_default:400},xo.fn.delay=function(e,t){return e=xo.fx&&xo.fx.speeds[e]||e,t=t||"fx",this.queue(t,((t,i)=>{const r=window.setTimeout(t,e);i.stop=function(){window.clearTimeout(r)}}))},function(){let e=io.createElement("input");const t=io.createElement("select").appendChild(io.createElement("option"));e.type="checkbox",mo.checkOn=""!==e.value,mo.optSelected=t.selected,e=io.createElement("input"),e.value="t",e.type="radio",mo.radioValue="t"===e.value}();const{attrHandle:pa}=xo.expr;xo.fn.extend({attr(e,t){return Ho(this,xo.attr,e,t,arguments.length>1)},removeAttr(e){return this.each((function(){xo.removeAttr(this,e)}))}}),xo.extend({attr(e,t,i){let r,n;const o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?xo.prop(e,t,i):(1===o&&xo.isXMLDoc(e)||(n=xo.attrHooks[t.toLowerCase()]||(xo.expr.match.bool.test(t)?da:void 0)),void 0!==i?null===i?void xo.removeAttr(e,t):n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,`${i}`),i):n&&"get"in n&&null!==(r=n.get(e,t))?r:(r=xo.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set(e,t){if(!mo.radioValue&&"radio"===t&&Ao(e,"input")){const i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr(e,t){let i,r=0;const n=t&&t.match(ko);if(n&&1===e.nodeType)for(;i=n[r++];)e.removeAttribute(i)}}),da={set:(e,t,i)=>(!1===t?xo.removeAttr(e,i):e.setAttribute(i,i),i)},xo.each(xo.expr.match.bool.source.match(/\w+/g),((e,t)=>{const i=pa[t]||xo.find.attr;pa[t]=function(e,t,r){let n,o;const s=t.toLowerCase();return r||(o=pa[s],pa[s]=n,n=null!=i(e,t,r)?s:null,pa[s]=o),n}}));const ma=/^(?:input|select|textarea|button)$/i,fa=/^(?:a|area)$/i;function ga(e){return(e.match(ko)||[]).join(" ")}function _a(e){return e.getAttribute&&e.getAttribute("class")||""}function va(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(ko)||[]}xo.fn.extend({prop(e,t){return Ho(this,xo.prop,e,t,arguments.length>1)},removeProp(e){return this.each((function(){delete this[xo.propFix[e]||e]}))}}),xo.extend({prop(e,t,i){let r,n;const o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&xo.isXMLDoc(e)||(t=xo.propFix[t]||t,n=xo.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get(e){const t=xo.find.attr(e,"tabindex");return t?parseInt(t,10):ma.test(e.nodeName)||fa.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),mo.optSelected||(xo.propHooks.selected={get(e){const t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set(e){const t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),xo.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){xo.propFix[this.toLowerCase()]=this})),xo.fn.extend({addClass(e){let t,i,r,n,o,s,a,l=0;if(fo(e))return this.each((function(t){xo(this).addClass(e.call(this,t,_a(this)))}));if(t=va(e),t.length)for(;i=this[l++];)if(n=_a(i),r=1===i.nodeType&&` ${ga(n)} `,r){for(s=0;o=t[s++];)r.indexOf(` ${o} `)<0&&(r+=`${o} `);a=ga(r),n!==a&&i.setAttribute("class",a)}return this},removeClass(e){let t,i,r,n,o,s,a,l=0;if(fo(e))return this.each((function(t){xo(this).removeClass(e.call(this,t,_a(this)))}));if(!arguments.length)return this.attr("class","");if(t=va(e),t.length)for(;i=this[l++];)if(n=_a(i),r=1===i.nodeType&&` ${ga(n)} `,r){for(s=0;o=t[s++];)for(;r.indexOf(` ${o} `)>-1;)r=r.replace(` ${o} `," ");a=ga(r),n!==a&&i.setAttribute("class",a)}return this},toggleClass(e,t){const i=typeof e,r="string"===i||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):fo(e)?this.each((function(i){xo(this).toggleClass(e.call(this,i,_a(this),t),t)})):this.each((function(){let t,n,o,s;if(r)for(n=0,o=xo(this),s=va(e);t=s[n++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==i||(t=_a(this),t&&Jo.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Jo.get(this,"__className__")||""))}))},hasClass(e){let t,i,r=0;for(t=` ${e} `;i=this[r++];)if(1===i.nodeType&&` ${ga(_a(i))} `.indexOf(t)>-1)return!0;return!1}});const ya=/\r/g;xo.fn.extend({val(e){let t,i,r;const n=this[0];return arguments.length?(r=fo(e),this.each((function(i){let n;1===this.nodeType&&(n=r?e.call(this,i,xo(this).val()):e,null==n?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=xo.map(n,(e=>null==e?"":`${e}`))),t=xo.valHooks[this.type]||xo.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))}))):n?(t=xo.valHooks[n.type]||xo.valHooks[n.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(ya,""):null==i?"":i)):void 0}}),xo.extend({valHooks:{option:{get(e){const t=xo.find.attr(e,"value");return null!=t?t:ga(xo.text(e))}},select:{get(e){let t,i,r;const{options:n}=e,o=e.selectedIndex,s="select-one"===e.type,a=s?null:[],l=s?o+1:n.length;for(r=o<0?l:s?o:0;r<l;r++)if(i=n[r],(i.selected||r===o)&&!i.disabled&&(!i.parentNode.disabled||!Ao(i.parentNode,"optgroup"))){if(t=xo(i).val(),s)return t;a.push(t)}return a},set(e,t){let i,r;const{options:n}=e,o=xo.makeArray(t);let s=n.length;for(;s--;)r=n[s],(r.selected=xo.inArray(xo.valHooks.option.get(r),o)>-1)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),xo.each(["radio","checkbox"],(function(){xo.valHooks[this]={set(e,t){if(Array.isArray(t))return e.checked=xo.inArray(xo(e).val(),t)>-1}},mo.checkOn||(xo.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),mo.focusin="onfocusin"in window;const Ca=/^(?:focusinfocus|focusoutblur)$/,xa=function(e){e.stopPropagation()};xo.extend(xo.event,{trigger(e,t,i,r){let n,o,s,a,l,c,u,h;const d=[i||io];let p=uo.call(e,"type")?e.type:e,m=uo.call(e,"namespace")?e.namespace.split("."):[];if(o=h=s=i=i||io,3!==i.nodeType&&8!==i.nodeType&&!Ca.test(p+xo.event.triggered)&&(p.indexOf(".")>-1&&(m=p.split("."),p=m.shift(),m.sort()),l=p.indexOf(":")<0&&`on${p}`,(e=e[xo.expando]?e:new xo.Event(p,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp(`(^|\\.)${m.join("\\.(?:.*\\.|)")}(\\.|$)`):null,e.result=void 0,e.target||(e.target=i),t=null==t?[e]:xo.makeArray(t,[e]),u=xo.event.special[p]||{},r||!u.trigger||!1!==u.trigger.apply(i,t))){if(!r&&!u.noBubble&&!go(i)){for(a=u.delegateType||p,Ca.test(a+p)||(o=o.parentNode);o;o=o.parentNode)d.push(o),s=o;s===(i.ownerDocument||io)&&d.push(s.defaultView||s.parentWindow||window)}for(n=0;(o=d[n++])&&!e.isPropagationStopped();)h=o,e.type=n>1?a:u.bindType||p,c=(Jo.get(o,"events")||{})[e.type]&&Jo.get(o,"handle"),c&&c.apply(o,t),c=l&&o[l],c&&c.apply&&Yo(o)&&(e.result=c.apply(o,t),!1===e.result&&e.preventDefault());return e.type=p,r||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(d.pop(),t)||!Yo(i)||l&&fo(i[p])&&!go(i)&&(s=i[l],s&&(i[l]=null),xo.event.triggered=p,e.isPropagationStopped()&&h.addEventListener(p,xa),i[p](),e.isPropagationStopped()&&h.removeEventListener(p,xa),xo.event.triggered=void 0,s&&(i[l]=s)),e.result}},simulate(e,t,i){const r=xo.extend(new xo.Event,i,{type:e,isSimulated:!0});xo.event.trigger(r,null,t)}}),xo.fn.extend({trigger(e,t){return this.each((function(){xo.event.trigger(e,t,this)}))},triggerHandler(e,t){const i=this[0];if(i)return xo.event.trigger(e,t,i,!0)}}),mo.focusin||xo.each({focus:"focusin",blur:"focusout"},((e,t)=>{const i=function(e){xo.event.simulate(t,e.target,xo.event.fix(e))};xo.event.special[t]={setup(){const r=this.ownerDocument||this,n=Jo.access(r,t);n||r.addEventListener(e,i,!0),Jo.access(r,t,(n||0)+1)},teardown(){const r=this.ownerDocument||this,n=Jo.access(r,t)-1;n?Jo.access(r,t,n):(r.removeEventListener(e,i,!0),Jo.remove(r,t))}}}));const{location:wa}=window;let ba=Date.now();const Sa=/\?/;xo.parseXML=function(e){let t;if(!e||"string"!=typeof e)return null;try{t=(new window.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||xo.error(`Invalid XML: ${e}`),t};const Ta=/\[\]$/,Ea=/\r?\n/g,Pa=/^(?:submit|button|image|reset|file)$/i,Aa=/^(?:input|select|textarea|keygen)/i;function Ma(e,t,i,r){let n;if(Array.isArray(t))xo.each(t,((t,n)=>{i||Ta.test(e)?r(e,n):Ma(`${e}[${"object"==typeof n&&null!=n?t:""}]`,n,i,r)}));else if(i||"object"!==yo(t))r(e,t);else for(n in t)Ma(`${e}[${n}]`,t[n],i,r)}xo.param=function(e,t){let i;const r=[],n=function(e,t){const i=fo(t)?t():t;r[r.length]=`${encodeURIComponent(e)}=${encodeURIComponent(null==i?"":i)}`};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!xo.isPlainObject(e))xo.each(e,(function(){n(this.name,this.value)}));else for(i in e)Ma(i,e[i],t,n);return r.join("&")},xo.fn.extend({serialize(){return xo.param(this.serializeArray())},serializeArray(){return this.map((function(){const e=xo.prop(this,"elements");return e?xo.makeArray(e):this})).filter((function(){const{type:e}=this;return this.name&&!xo(this).is(":disabled")&&Aa.test(this.nodeName)&&!Pa.test(e)&&(this.checked||!ps.test(e))})).map((function(e,t){const i=xo(this).val();return null==i?null:Array.isArray(i)?xo.map(i,(e=>({name:t.name,value:e.replace(Ea,"\r\n")}))):{name:t.name,value:i.replace(Ea,"\r\n")}})).get()}});const Da=/%20/g,La=/#.*$/,Ra=/([?&])_=[^&]*/,Oa=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ia=/^(?:GET|HEAD)$/,Na=/^\/\//,ka={},Fa={},za="*/".concat("*"),Ba=io.createElement("a");function Ga(e){return function(t,i){let r;"string"!=typeof t&&(i=t,t="*");let n=0;const o=t.toLowerCase().match(ko)||[];if(fo(i))for(;r=o[n++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(i)):(e[r]=e[r]||[]).push(i)}}function Wa(e,t,i,r){const n={},o=e===Fa;function s(a){let l;return n[a]=!0,xo.each(e[a]||[],((e,a)=>{const c=a(t,i,r);return"string"!=typeof c||o||n[c]?o?!(l=c):void 0:(t.dataTypes.unshift(c),s(c),!1)})),l}return s(t.dataTypes[0])||!n["*"]&&s("*")}function Ua(e,t){let i,r;const n=xo.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:r||(r={}))[i]=t[i]);return r&&xo.extend(!0,e,r),e}Ba.href=wa.href,xo.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wa.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wa.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":za,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":xo.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:(e,t)=>t?Ua(Ua(e,xo.ajaxSettings),t):Ua(xo.ajaxSettings,e),ajaxPrefilter:Ga(ka),ajaxTransport:Ga(Fa),ajax(e,t){let i,r,n,o,s,a,l,c,u,h;"object"==typeof e&&(t=e,e=void 0),t=t||{};const d=xo.ajaxSetup({},t),p=d.context||d,m=d.context&&(p.nodeType||p.jquery)?xo(p):xo.event,f=xo.Deferred(),g=xo.Callbacks("once memory");let _=d.statusCode||{};const v={},y={};let C="canceled";var x={readyState:0,getResponseHeader(e){let t;if(l){if(!o)for(o={};t=Oa.exec(n);)o[`${t[1].toLowerCase()} `]=(o[`${t[1].toLowerCase()} `]||[]).concat(t[2]);t=o[`${e.toLowerCase()} `]}return null==t?null:t.join(", ")},getAllResponseHeaders:()=>l?n:null,setRequestHeader(e,t){return null==l&&(e=y[e.toLowerCase()]=y[e.toLowerCase()]||e,v[e]=t),this},overrideMimeType(e){return null==l&&(d.mimeType=e),this},statusCode(e){let t;if(e)if(l)x.always(e[x.status]);else for(t in e)_[t]=[_[t],e[t]];return this},abort(e){const t=e||C;return i&&i.abort(t),w(0,t),this}};if(f.promise(x),d.url=`${e||d.url||wa.href}`.replace(Na,`${wa.protocol}//`),d.type=t.method||t.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(ko)||[""],null==d.crossDomain){a=io.createElement("a");try{a.href=d.url,a.href=a.href,d.crossDomain=`${Ba.protocol}//${Ba.host}`!=`${a.protocol}//${a.host}`}catch(e){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=xo.param(d.data,d.traditional)),Wa(ka,d,t,x),l)return x;for(u in c=xo.event&&d.global,c&&0==xo.active++&&xo.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Ia.test(d.type),r=d.url.replace(La,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Da,"+")):(h=d.url.slice(r.length),d.data&&(d.processData||"string"==typeof d.data)&&(r+=(Sa.test(r)?"&":"?")+d.data,delete d.data),!1===d.cache&&(r=r.replace(Ra,"$1"),h=`${Sa.test(r)?"&":"?"}_=${ba++}${h}`),d.url=r+h),d.ifModified&&(xo.lastModified[r]&&x.setRequestHeader("If-Modified-Since",xo.lastModified[r]),xo.etag[r]&&x.setRequestHeader("If-None-Match",xo.etag[r])),(d.data&&d.hasContent&&!1!==d.contentType||t.contentType)&&x.setRequestHeader("Content-Type",d.contentType),x.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?`, ${za}; q=0.01`:""):d.accepts["*"]),d.headers)x.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(!1===d.beforeSend.call(p,x,d)||l))return x.abort();if(C="abort",g.add(d.complete),x.done(d.success),x.fail(d.error),i=Wa(Fa,d,t,x),i){if(x.readyState=1,c&&m.trigger("ajaxSend",[x,d]),l)return x;d.async&&d.timeout>0&&(s=window.setTimeout((()=>{x.abort("timeout")}),d.timeout));try{l=!1,i.send(v,w)}catch(e){if(l)throw e;w(-1,e)}}else w(-1,"No Transport");function w(e,t,o,a){let u,h,v,y,C,w=t;l||(l=!0,s&&window.clearTimeout(s),i=void 0,n=a||"",x.readyState=e>0?4:0,u=e>=200&&e<300||304===e,o&&(y=function(e,t,i){let r,n,o,s;const{contents:a}=e,{dataTypes:l}=e;for(;"*"===l[0];)l.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||e.converters[`${n} ${l[0]}`]){o=n;break}s||(s=n)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}(d,x,o)),y=function(e,t,i,r){let n,o,s,a,l;const c={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(o=u.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=u.shift(),o)if("*"===o)o=l;else if("*"!==l&&l!==o){if(s=c[`${l} ${o}`]||c[`* ${o}`],!s)for(n in c)if(a=n.split(" "),a[1]===o&&(s=c[`${l} ${a[0]}`]||c[`* ${a[0]}`],s)){!0===s?s=c[n]:!0!==c[n]&&(o=a[0],u.unshift(a[1]));break}if(!0!==s)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:`No conversion from ${l} to ${o}`}}}return{state:"success",data:t}}(d,y,x,u),u?(d.ifModified&&(C=x.getResponseHeader("Last-Modified"),C&&(xo.lastModified[r]=C),C=x.getResponseHeader("etag"),C&&(xo.etag[r]=C)),204===e||"HEAD"===d.type?w="nocontent":304===e?w="notmodified":(w=y.state,h=y.data,v=y.error,u=!v)):(v=w,!e&&w||(w="error",e<0&&(e=0))),x.status=e,x.statusText=`${t||w}`,u?f.resolveWith(p,[h,w,x]):f.rejectWith(p,[x,w,v]),x.statusCode(_),_=void 0,c&&m.trigger(u?"ajaxSuccess":"ajaxError",[x,d,u?h:v]),g.fireWith(p,[x,w]),c&&(m.trigger("ajaxComplete",[x,d]),--xo.active||xo.event.trigger("ajaxStop")))}return x},getJSON:(e,t,i)=>xo.get(e,t,i,"json"),getScript:(e,t)=>xo.get(e,void 0,t,"script")}),xo.each(["get","post"],((e,t)=>{xo[t]=function(e,i,r,n){return fo(i)&&(n=n||r,r=i,i=void 0),xo.ajax(xo.extend({url:e,type:t,dataType:n,data:i,success:r},xo.isPlainObject(e)&&e))}})),xo._evalUrl=function(e,t){return xo.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter(e){xo.globalEval(e,t)}})},xo.fn.extend({wrapAll(e){let t;return this[0]&&(fo(e)&&(e=e.call(this[0])),t=xo(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){let e=this;for(;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner(e){return fo(e)?this.each((function(t){xo(this).wrapInner(e.call(this,t))})):this.each((function(){const t=xo(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)}))},wrap(e){const t=fo(e);return this.each((function(i){xo(this).wrapAll(t?e.call(this,i):e)}))},unwrap(e){return this.parent(e).not("body").each((function(){xo(this).replaceWith(this.childNodes)})),this}}),xo.expr.pseudos.hidden=function(e){return!xo.expr.pseudos.visible(e)},xo.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},xo.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};const Ha={0:200,1223:204};let Va=xo.ajaxSettings.xhr();mo.cors=!!Va&&"withCredentials"in Va,mo.ajax=Va=!!Va,xo.ajaxTransport((e=>{let t,i;if(mo.cors||Va&&!e.crossDomain)return{send(r,n){let o;const s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)s[o]=e.xhrFields[o];for(o in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)s.setRequestHeader(o,r[o]);t=function(e){return function(){t&&(t=i=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?n(0,"error"):n(s.status,s.statusText):n(Ha[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),i=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=i:s.onreadystatechange=function(){4===s.readyState&&window.setTimeout((()=>{t&&i()}))},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort(){t&&t()}}})),xo.ajaxPrefilter((e=>{e.crossDomain&&(e.contents.script=!1)})),xo.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return xo.globalEval(e),e}}}),xo.ajaxPrefilter("script",(e=>{void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),xo.ajaxTransport("script",(e=>{if(e.crossDomain||e.scriptAttrs){let t,i;return{send(r,n){t=xo("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&n("error"===e.type?404:200,e.type)}),io.head.appendChild(t[0])},abort(){i&&i()}}}}));const ja=[],qa=/(=)\?(?=&|$)|\?\?/;xo.ajaxSetup({jsonp:"callback",jsonpCallback(){const e=ja.pop()||`${xo.expando}_${ba++}`;return this[e]=!0,e}}),xo.ajaxPrefilter("json jsonp",((e,t,i)=>{let r,n,o;const s=!1!==e.jsonp&&(qa.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&qa.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=fo(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(qa,`$1${r}`):!1!==e.jsonp&&(e.url+=`${(Sa.test(e.url)?"&":"?")+e.jsonp}=${r}`),e.converters["script json"]=function(){return o||xo.error(`${r} was not called`),o[0]},e.dataTypes[0]="json",n=window[r],window[r]=function(){o=arguments},i.always((()=>{void 0===n?xo(window).removeProp(r):window[r]=n,e[r]&&(e.jsonpCallback=t.jsonpCallback,ja.push(r)),o&&fo(n)&&n(o[0]),o=n=void 0})),"script"})),mo.createHTMLDocument=function(){const{body:e}=io.implementation.createHTMLDocument("");return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),xo.parseHTML=function(e,t,i){if("string"!=typeof e)return[];let r,n,o;return"boolean"==typeof t&&(i=t,t=!1),t||(mo.createHTMLDocument?(r=(t=io.implementation.createHTMLDocument("")).createElement("base"),r.href=io.location.href,t.head.appendChild(r)):t=io),n=Mo.exec(e),o=!i&&[],n?[t.createElement(n[1])]:(n=Cs([e],t,o),o&&o.length&&xo(o).remove(),xo.merge([],n.childNodes))},xo.fn.load=function(e,t,i){let r,n,o;const s=this,a=e.indexOf(" ");return a>-1&&(r=ga(e.slice(a)),e=e.slice(0,a)),fo(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),s.length>0&&xo.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done((function(e){o=arguments,s.html(r?xo("<div>").append(xo.parseHTML(e)).find(r):e)})).always(i&&((e,t)=>{s.each((function(){i.apply(this,o||[e.responseText,t,e])}))})),this},xo.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],((e,t)=>{xo.fn[t]=function(e){return this.on(t,e)}})),xo.expr.pseudos.animated=function(e){return xo.grep(xo.timers,(t=>e===t.elem)).length},xo.offset={setOffset(e,t,i){let r,n,o,s,a,l,c;const u=xo.css(e,"position"),h=xo(e),d={};"static"===u&&(e.style.position="relative"),a=h.offset(),o=xo.css(e,"top"),l=xo.css(e,"left"),c=("absolute"===u||"fixed"===u)&&(o+l).indexOf("auto")>-1,c?(r=h.position(),s=r.top,n=r.left):(s=parseFloat(o)||0,n=parseFloat(l)||0),fo(t)&&(t=t.call(e,i,xo.extend({},a))),null!=t.top&&(d.top=t.top-a.top+s),null!=t.left&&(d.left=t.left-a.left+n),"using"in t?t.using.call(e,d):h.css(d)}},xo.fn.extend({offset(e){if(arguments.length)return void 0===e?this:this.each((function(t){xo.offset.setOffset(this,e,t)}));let t,i;const r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),i=r.ownerDocument.defaultView,{top:t.top+i.pageYOffset,left:t.left+i.pageXOffset}):{top:0,left:0}:void 0},position(){if(!this[0])return;let e,t,i;const r=this[0];let n={top:0,left:0};if("fixed"===xo.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),i=r.ownerDocument,e=r.offsetParent||i.documentElement;e&&(e===i.body||e===i.documentElement)&&"static"===xo.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&(n=xo(e).offset(),n.top+=xo.css(e,"borderTopWidth",!0),n.left+=xo.css(e,"borderLeftWidth",!0))}return{top:t.top-n.top-xo.css(r,"marginTop",!0),left:t.left-n.left-xo.css(r,"marginLeft",!0)}},offsetParent(){return this.map((function(){let{offsetParent:e}=this;for(;e&&"static"===xo.css(e,"position");)e=e.offsetParent;return e||ns}))}}),xo.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},((e,t)=>{const i="pageYOffset"===t;xo.fn[e]=function(r){return Ho(this,((e,r,n)=>{let o;if(go(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===n)return o?o[t]:e[r];o?o.scrollTo(i?o.pageXOffset:n,i?n:o.pageYOffset):e[r]=n}),e,r,arguments.length)}})),xo.each(["top","left"],((e,t)=>{xo.cssHooks[t]=Vs(mo.pixelPosition,((e,i)=>{if(i)return i=Hs(e,t),Gs.test(i)?`${xo(e).position()[t]}px`:i}))})),xo.each({Height:"height",Width:"width"},((e,t)=>{xo.each({padding:`inner${e}`,content:t,"":`outer${e}`},((i,r)=>{xo.fn[r]=function(n,o){const s=arguments.length&&(i||"boolean"!=typeof n),a=i||(!0===n||!0===o?"margin":"border");return Ho(this,((t,i,n)=>{let o;return go(t)?0===r.indexOf("outer")?t[`inner${e}`]:t.document.documentElement[`client${e}`]:9===t.nodeType?(o=t.documentElement,Math.max(t.body[`scroll${e}`],o[`scroll${e}`],t.body[`offset${e}`],o[`offset${e}`],o[`client${e}`])):void 0===n?xo.css(t,i,a):xo.style(t,i,n,a)}),t,s?n:void 0,s)}}))})),xo.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),((e,t)=>{xo.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}})),xo.fn.extend({hover(e,t){return this.mouseenter(e).mouseleave(t||e)}}),xo.fn.extend({bind(e,t,i){return this.on(e,null,t,i)},unbind(e,t){return this.off(e,null,t)},delegate(e,t,i,r){return this.on(t,e,i,r)},undelegate(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}}),xo.proxy=function(e,t){let i,r,n;if("string"==typeof t&&(i=e[t],t=e,e=i),fo(e))return r=no.call(arguments,2),n=function(){return e.apply(t||this,r.concat(no.call(arguments)))},n.guid=e.guid=e.guid||xo.guid++,n},xo.holdReady=function(e){e?xo.readyWait++:xo.ready(!0)},xo.isArray=Array.isArray,xo.parseJSON=JSON.parse,xo.nodeName=Ao,xo.isFunction=fo,xo.isWindow=go,xo.camelCase=$o,xo.type=yo,xo.now=Date.now,xo.isNumeric=function(e){const t=xo.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))};class $a{constructor(e={}){const{text:t,id:i,viewer:r}=e;i&&document.getElementById(i)&&!e.reduplicate&&xo(`#${i}`).remove();const n=document.createElement("div");n.id=Re(i,We()),n.className="cursor-tip-class",n.innerHTML=t;const o=r?r.container:document.body;o.appendChild(n),this.ele=n,this._show=Re(e.show,!0),this._isDestryoed=!1,this._target=o,this._id=n.id,this._text=t,this._position=void 0;const s=this;this.show=this._show,r instanceof Cesium.Viewer&&(this._handler=new Cesium.ScreenSpaceEventHandler(r.canvas),this._handler.setInputAction((e=>{s.updatePosition(e.endPosition)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE))}updatePosition(e){this.ele.style.left=`${e.x+10}px`,this.ele.style.top=`${e.y+10}px`}updateText(e){this.ele.innerHTML=e}destroy(){this._isDestryoed||(this._target.removeChild(this.ele),this._handler.isDestroyed()&&this._handler.destroy(),this._isDestryoed=!0)}get show(){return this._show}set show(e){this._show=e,this.ele.style.display=e?"block":"none"}get id(){return this._id}get text(){return this._text}set text(e){this._text=e,this.updateText(e)}get position(){return this._position}set position(e){e.x&&e.y?(this._position=e,this.updatePosition(e)):console.warn("CursorTip:设置了一个无效的位置，将被忽略.")}}function Ya(e,t){let i;const r={"y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()},n=Object.keys(r);for(const t of n)i=new RegExp(`(${t})`).exec(e),i&&(e=e.replace(i[1],1===i[1].length?r[t]:r[t].padStart(i[1].length,"0")));return e}window.Date.prototype.format=function(e){Ya(e,this)};const{Ellipsoid:Xa}=Cesium;Xa.CGCS2000=Object.freeze(new Xa(6378137,6378137,6356752.314140356));const{GeographicTilingScheme:Ja,GeographicProjection:Za,Rectangle:Qa,Math:Ka}=Cesium;class el extends Ja{constructor(e={}){super(e),this._tileInfo=e.tileInfo,this._ellipsoid=Re(e.ellipsoid,Xa.CGCS2000),this._rectangle=Re(e.rectangle,Qa.fromDegrees(-180,-90,180,90)),this._numberOfLevelZeroTilesX=Re(e.numberOfLevelZeroTilesX,4),this._numberOfLevelZeroTilesY=Re(e.numberOfLevelZeroTilesY,2),this._projection=new Za(this._ellipsoid)}getNumberOfXTilesAtLevel(e){if(Oe(this._tileInfo)){var t=this._tileInfo.lods.filter((function(t){return t.level===e}))[0].resolution;return Math.round(Ka.toDegrees(2*Ka.TWO_PI)/(this._tileInfo.rows*t))}return super.getNumberOfXTilesAtLevel(e)}getNumberOfYTilesAtLevel(e){if(Oe(this._tileInfo)){var t=this._tileInfo.lods.filter((function(t){return t.level===e}))[0].resolution;return Math.round(Ka.toDegrees(2*Ka.TWO_PI)/(this._tileInfo.cols*t))}return super.getNumberOfYTilesAtLevel(e)}}class tl{constructor(e){this._options=Re(e,{}),this._id=Re(e.id,eo()),this._primitive=null,this._oldPrimitive=null,this._definedChanged=new Ge,this._loadEvent=new Ge,this._clampToGround=Re(!!e.clampToGround,!1),this._show=Re(e.show,!0),this._removed=!1,this._allowPicking=Re(e.allowPicking,!0),this._property=e.property}get id(){return this._id}get property(){return this._property}get allowPicking(){return this._allowPicking}set allowPicking(e){!!e!==this._allowPicking&&(this.definedChanged.raise("allowPicking",e,this._allowPicking),this._allowPicking=e,this.updatePrimitive&&this.updatePrimitive())}get clampToGround(){return this._clampToGround}set clampToGround(e){e!==this._clampToGround&&(this.definedChanged.raise("clampToGround",e,this._clampToGround),this._clampToGround=e,this.updatePrimitive())}get show(){return this._show}set show(e){e!==this._show&&(this.definedChanged.raise("show",e,this._show),this._show=e,this.primitive&&(this.primitive.show=e))}get primitive(){return this._primitive}get definedChanged(){return this._definedChanged}get readyPromise(){return this.primitive?this.primitive.readyPromise:new Primise}get material(){if(this.primitive)return this.primitive.appearance.material}toJson(){if(Oe(this.primitive))return JSON.parse(JSON.stringify(this._options))}update(){}updateAttribute(e,t){if(this.isDestroyed())return;if(!this.primitive)return;const i=this.primitive.appearance.material;if(!i)return;const r=i.uniforms;r&&(r[e]=t)}addTo(e){Oe(this.primitive)&&e.graphicGroup.add(this)}zoomTo(){}remove(){if(Oe(this.primitive))return this.group?(this.group.remove(this),this):void 0}isDestroyed(){return!1}destroy(){this.remove(),this.primitive&&!this.primitive.isDestroyed()&&(this.primitive.destroy(),this.primitive=void 0),Cesium.destroyObject(this)}}const{AssociativeArray:il,PrimitiveCollection:rl}=Cesium;class nl{constructor(e){this.values=new il,this.id=eo(),this.viewer=e,this.root=new rl,this.root.name="graphicGroup",e.scene.primitives.add(this.root)}add(e){e instanceof nl&&(this.values.set(e.id,e),this.root.add(e.root)),e instanceof tl&&(this.values.set(e.id,e),e.primitive&&this.root.add(e.primitive),e._viewer=this.viewer,e.group=this,e._loadEvent.raise())}get(e){return this.values.get(e)}getById(e){return this.get(e)}remove(e){this.values.remove(e.id),e instanceof nl&&(e.clear(),this.root.remove(e.root)),e.primitive&&this.root.remove(e.primitive)}removeById(e){const t=this.values.get(e);this.remove(t)}has(e){return this.values.contains(e)}update(e){const t=this.values._array;for(let i of t)i.update(e)}clear(){const e=[...this.values._array];for(let t of e)t.destroy();this.root.removeAll(),this.values.removeAll()}}const ol="uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  ",sl="attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",{defaultValue:al,destroyObject:ll,Matrix4:cl,DrawCommand:ul,BoxGeometry:hl,Cartesian3:dl,defined:pl,GeometryPipeline:ml,Transforms:fl,VertexFormat:gl,BufferUsage:_l,CubeMap:vl,loadCubeMap:yl,RenderState:Cl,VertexArray:xl,BlendingState:wl,SceneMode:bl,ShaderProgram:Sl,ShaderSource:Tl,Matrix3:El}=Cesium;Cesium;class Pl extends tl{constructor(e){if(e.el instanceof HTMLElement==!1)throw new Le("options.el parameter is invalid.");super(e),this._clampToGround=void 0,this._asynchronous=void 0,this._distanceDisplayCondition=e.distanceDisplayCondition,this.createGraphic()}get clampToGround(){}set clampToGround(e){throw new Le("HtmlPointGraphic is not support clampToGround.")}get asynchronous(){}set asynchronous(e){throw new Le("HtmlPointGraphic is not support asynchronous.")}get color(){}set color(e){throw new Le("HtmlPointGraphic is not support color.")}set show(e){this.el&&(this.display=e?"block":"none"),this._show=e}get distanceDisplayCondition(){return this._distanceDisplayCondition}set distanceDisplayCondition(e){this._distanceDisplayCondition=e}get position(){return this._position}set position(e){this._definedChanged.raise("position",e,this._position),this._position=e}createGraphic(){this.el=this._options.el,this.el.id=this._id,this.el.style.position="absolute",this._position=this._options.position,this.updatePrimitive()}updatePrimitive(){this._allowPicking?this.el.style.pointerEvents="auto":this.el.style.pointerEvents="none"}addTo(e){defined(this.primitive)&&e.htmlGraphicGroup.add(this)}remove(){if(this.group)return this.group.remove(this),this}zoomTo(){if(this._viewer)return this._viewer.flyTo(this.position)}updateStyle(e,t){this.el.style[e]=t}addClass(e){this.el.classList.add(e)}}const{Cartesian2:Al,Rectangle:Ml,GeographicProjection:Dl,Ellipsoid:Ll}=Cesium,Rl=Cesium.Math;function Ol(e){e=Re(e,Re.EMPTY_OBJECT),this._ellipsoid=Re(e.ellipsoid,Ll.WGS84),this._rectangle=Re(e.rectangle,Ml.MAX_VALUE),this._projection=new Dl(this._ellipsoid),this._numberOfLevelZeroTilesX=36,this._numberOfLevelZeroTilesY=18,this._intervalOfZeorLevel=Re(e.intervalOfZeorLevel,16)}Object.defineProperties(Ol.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),Ol.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},Ol.prototype.modifyLevel=function(e){return e<3?0:e<6?1:void 0},Ol.prototype.getDelatXY=function(e){const t=this._intervalOfZeorLevel;return{dx:t/2**e,dy:t/2**e}},Ol.prototype.getLonLatValue=function(e,t,i){const r=this.getDelatXY(e);return{lon:r.dx*t-180,lat:90-r.dy*i}},Ol.prototype.getPosition=function(e,t,i){const r=this._rectangle,n=this.getNumberOfXTilesAtLevel(e),o=this.getNumberOfYTilesAtLevel(e),s=r.width/n,a=t*s+r.west;r.west;const l=r.height/o,c=r.north-i*l;return r.north,{lon:+Rl.toDegrees(a).toFixed(5),lat:+Rl.toDegrees(c).toFixed(5)}},Ol.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},Ol.prototype.rectangleToNativeRectangle=function(e,t){const i=Rl.toDegrees(e.west),r=Rl.toDegrees(e.south),n=Rl.toDegrees(e.east),o=Rl.toDegrees(e.north);return Oe(t)?(t.west=i,t.south=r,t.east=n,t.north=o,t):new Ml(i,r,n,o)},Ol.prototype.tileXYToNativeRectangle=function(e,t,i,r){const n=this.tileXYToRectangle(e,t,i,r);return n.west=Rl.toDegrees(n.west),n.south=Rl.toDegrees(n.south),n.east=Rl.toDegrees(n.east),n.north=Rl.toDegrees(n.north),n},Ol.prototype.tileXYToRectangle=function(e,t,i,r){var n=this._rectangle,o=this.getNumberOfXTilesAtLevel(i),s=this.getNumberOfYTilesAtLevel(i),a=n.width/o,l=e*a+n.west,c=(e+1)*a+n.west,u=n.height/s,h=n.north-t*u,d=n.north-(t+1)*u;return Oe(r)||(r=new Ml(l,d,c,h)),r.west=l,r.south=d,r.east=c,r.north=h,r},Ol.prototype.positionToTileXY=function(e,t,i){var r=this._rectangle;if(Ml.contains(r,e)){var n=this.getNumberOfXTilesAtLevel(t),o=this.getNumberOfYTilesAtLevel(t),s=r.width/n,a=r.height/o,l=e.longitude;r.east<r.west&&(l+=Rl.TWO_PI);var c=(l-r.west)/s|0;c>=n&&(c=n-1);var u=(r.north-e.latitude)/a|0;return u>=o&&(u=o-1),Oe(i)?(i.x=c,i.y=u,i):new Al(c,u)}};const{CesiumTerrainProvider:Il,TerrainProvider:Nl,Resource:kl,CustomDataSource:Fl,Cartesian3:zl,Entity:Bl,Color:Gl,Rectangle:Wl}=Cesium;function Ul(e){let t=[];const i=[e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north];return"EPSG:4326"===e.projection.toUpperCase()&&(t=[i[0],i[1],i[0],i[3],i[2],i[3],i[2],i[1],i[0],i[1]]),new Bl({polyline:{positions:zl.fromRadiansArray(t),material:Gl.fromRandom({alpha:1}),width:3,clampToGround:!0}})}function Hl(e,t){const i=kl.createIfNeeded(t);i.appendForwardSlash();return i.getDerivedResource({url:"layer.json"}).fetchJson().then((t=>{e.projection=t.projection,e.bounds=Wl.fromDegrees(...t.valid_bounds)}))}function Vl(e,t,i=!0){let r;t.scene.globe.ellipsoid;const n=t.camera.getPickRay(e);r=t.scene.globe.pick(n,t.scene);return t.scene.pick(e)&&t.scene.globe.depthTestAgainstTerrain&&(t.scene.pickPositionSupported?r=t.scene.pickPosition(e)||r:console.warn("This browser does not support pickPosition.")),r}const jl=52.35987755982988,ql=3.141592653589793,$l=6378245,Yl=.006693421622965943;function Xl(e,t){let i=function(e,t){let i=300+(e=+e)+2*(t=+t)+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*ql)+20*Math.sin(2*e*ql))/3,i+=2*(20*Math.sin(e*ql)+40*Math.sin(e/3*ql))/3,i+=2*(150*Math.sin(e/12*ql)+300*Math.sin(e/30*ql))/3,i}(e-105,t-35),r=function(e,t){let i=2*(e=+e)-100+3*(t=+t)+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*ql)+20*Math.sin(2*e*ql))/3,i+=2*(20*Math.sin(t*ql)+40*Math.sin(t/3*ql))/3,i+=2*(160*Math.sin(t/12*ql)+320*Math.sin(t*ql/30))/3,i}(e-105,t-35);const n=t/180*ql;let o=Math.sin(n);o=1-Yl*o*o;const s=Math.sqrt(o);return i=180*i/($l/s*Math.cos(n)*ql),r=180*r/($l*(1-Yl)/(o*s)*ql),[i,r]}const Jl={};function Zl(e,t=!1){const i=`_${e}`;return{configurable:t,get(){return this[i]},set(t){const r=this[i];t!==r&&(this[i]=t,this._definitionChanged.raise(e,t,r))}}}Jl.get=function(e="EPSG:3857",t){const i=e.toUpperCase();if("EPSG:3857"===i)return new Cesium.WebMercatorTilingScheme(t);if("EPSG:4326"===i)return new Cesium.GeographicTilingScheme(t);throw new Le("未知的坐标系.")},Jl.BD09ToGCJ02=function(e,t){const i=+e-.0065,r=+t-.006,n=Math.sqrt(i*i+r*r)-2e-5*Math.sin(r*jl),o=Math.atan2(r,i)-3e-6*Math.cos(i*jl);return[n*Math.cos(o),n*Math.sin(o)]},Jl.GCJ02ToBD09=function(e,t){t=+t,e=+e;const i=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*jl),r=Math.atan2(t,e)+3e-6*Math.cos(e*jl);return[i*Math.cos(r)+.0065,i*Math.sin(r)+.006]},Jl.WGS84ToGCJ02=function(e,t){if(t=+t,e=+e,Ie.inChina(e,t)){const i=Xl(e,t);return[e+i[0],t+i[1]]}return[e,t]},Jl.GCJ02ToWGS84=function(e,t){if(t=+t,e=+e,Ie.inChina(e,t)){const i=Xl(e,t);return[2*e-(e+i[0]),2*t-(t+i[1])]}return[e,t]};class Ql{constructor(e={}){this._definitionChange=new Ge,this._propertyNames=[];for(const t in e)e.hasOwnProperty(t)&&(this[`_${t}`]=e[t],this._propertyNames.push(t),Object.defineProperty(this,t,Zl(t)))}get propertyNames(){return this._propertyNames}addProperty(e,t){if(!Oe(e))throw new Le("key is reqiured.");if(this.propertyNames.includes(e))throw new Le(`${e}has be a registered property.`);this[`_${e}`]=t,this._propertyNames.push(e),Object.defineProperty(this,e,Zl(e))}removeProperty(e){if(!Oe(e))throw new Le("key is reqiured.");if(this.propertyNames.includes(e)){delete this[e],delete this[`_${e}`];const t=this.propertyNames.indexOf(e);this.propertyNames.slice(t,1),this.definitionChanged.raise(e)}}toString(){const e=this.toJson();return JSON.stringify(e)}toJson(){const e={};for(const t of this.propertyNames)e[t]=this[t];return e}hasProperty(e){if(!Oe(e))throw new Le("key is reqiured.");return this.propertyNames.includes(e)}get definitionChanged(){return this._definitionChanged}destroy(){this._definitionChanged=void 0,this._propertyNames=void 0}}function Kl(e,t=!0){ze(e),e.scene.screenSpaceCameraController.enableRotate=t}const{Color:ec}=Cesium;class tc{constructor(){}static pointColor=ec.AQUA;static fillColor=ec.AQUA;static strokeColor=ec.AQUA}const ic=Object.freeze({LEFT:-1,RIGHT:1,NONE:0,TOP:-10,BOTTOM:10}),rc="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform vec4 gapColor;\nuniform float dashLength;\nuniform float dashPattern;\nvarying float v_polylineAngle;\n\nconst float maskLength = 16.0;\n\nmat2 rotate(float rad) {\n    float c = cos(rad);\n    float s = sin(rad);\n    return mat2(\n        c, s,\n        -s, c\n    );\n}\n\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\n    float slope = (p0.y - p1.y) / (p0.x - p1.x);\n    return slope * (x - p0.x) + p0.y;\n}\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n\n#ifdef GL_OES_standard_derivatives\n    float base = 1.0 - abs(fwidth(st.s)) * 10.0 * czm_pixelRatio;\n#else\n    float base = 0.975; // 2.5% of the line will be the arrow head\n#endif\n    // 没有箭头\n    base = 1.0;\n\n    vec2 center = vec2(1.0, 0.5);\n    float ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\n    float ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\n\n    float halfWidth = 0.15;\n    float s = step(0.5 - halfWidth, st.t);\n    s *= 1.0 - step(0.5 + halfWidth, st.t);\n    s *= 1.0 - step(base, st.s);\n\n    float t = step(base, materialInput.st.s);\n    t *= 1.0 - step(ptOnUpperLine, st.t);\n    t *= step(ptOnLowerLine, st.t);\n\n    // Find the distance from the closest separator (region between two colors)\n    float dist;\n    if (st.s < base)\n    {\n        float d1 = abs(st.t - (0.5 - halfWidth));\n        float d2 = abs(st.t - (0.5 + halfWidth));\n        dist = min(d1, d2);\n    }\n    else\n    {\n        float d1 = czm_infinity;\n        if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\n        {\n            d1 = abs(st.s - base);\n        }\n        float d2 = abs(st.t - ptOnUpperLine);\n        float d3 = abs(st.t - ptOnLowerLine);\n        dist = min(min(d1, d2), d3);\n    }\n\n    vec4 outsideColor = vec4(0.0);\n    vec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\n    vec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);\n    // dash\n    vec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\n    // Get the relative position within the dash from 0 to 1\n    float dashPosition = fract(pos.x / (dashLength * czm_pixelRatio));\n    // Figure out the mask index.\n    float maskIndex = floor(dashPosition * maskLength);\n    // Test the bit mask.\n    float maskTest = floor(dashPattern / pow(2.0, maskIndex));\n    vec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;\n    if (fragColor.a < 0.005) {   // matches 0/255 and 1/255\n        discard;\n    }\n    outColor *= fragColor;\n    outColor = czm_gammaCorrect(outColor);\n    material.diffuse = outColor.rgb;\n    material.alpha = outColor.a;\n    return material;\n}\n",{Transforms:nc,Cartesian3:oc}=Cesium;let sc=class{constructor(e={}){if(!Oe(e.modelMatrix)&&Oe(e.position)){let t;e.position instanceof oc?t=e.position:e.position instanceof Ie&&(t=e.position.toCartesian()),t&&(e.modelMatrix=nc.eastNorthUpToFixedFrame(t))}if(Oe(e.gltf))this.delegate=new Cesium.Model(e);else{if(!Oe(e.url))throw new Le("one of parameters url or gltf must be provided.");this.delegate=Cesium.Model.fromGltf(e)}this._readyPromise=this.delegate._readyPromise,this._ready=this.delegate._ready}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get activeAnimations(){return this.delegate.activeAnimations}set activeAnimations(e){this.delegate.activeAnimations=e}get allowPicking(){return this.delegate.allowPicking}get asynchronous(){return this.delegate.asynchronous}get backFaceCulling(){return this.delegate.backFaceCulling}get basePath(){return this.delegate.basePath}get boundingSphere(){return this.delegate.boundingSphere}get clippingPlanes(){return this.delegate.clippingPlanes}set clippingPlanes(e){this.delegate.clippingPlanes=e}get color(){return this.delegate.color}set color(e){this.delegate.color=e}get colorBlendMode(){return this.delegate.colorBlendMode}set colorBlendMode(e){this.delegate.colorBlendMode=e}get colorBlendAmount(){return this.delegate.colorBlendAmount}set colorBlendAmount(e){this.delegate.colorBlendAmount=e}get credit(){return this.delegate.credit}set credit(e){this.delegate.credit=e}get debugShowBoundingVolume(){return this.delegate.debugShowBoundingVolume}set debugShowBoundingVolume(e){this.delegate.debugShowBoundingVolume=e}get debugWireframe(){return this.delegate.debugWireframe}set debugWireframe(e){this.delegate.debugWireframe=e}get distanceDisplayCondition(){return this.delegate.distanceDisplayCondition}set distanceDisplayCondition(e){this.delegate.distanceDisplayCondition=e}get gltf(){return this.delegate.gltf}get id(){return this.delegate.id}set id(e){this.delegate.id=e}get maximumScale(){return this.delegate.maximumScale}set maximumScale(e){this.delegate.maximumScale=e}get minimumPixelSize(){return this.delegate.minimumPixelSize}set minimumPixelSize(e){this.delegate.minimumPixelSize=e}get modelMatrix(){return this.delegate.modelMatrix}set modelMatrix(e){this.delegate.modelMatrix=e}get scale(){return this.delegate.scale}set scale(e){this.delegate.scale=e}get shadows(){return this.delegate.shadows}set shadows(e){this.delegate.shadows=e}get show(){return this.delegate.show}set show(e){this.delegate.show=e}get showOutline(){return this.delegate.showOutline}get silhouetteColor(){return this.delegate.silhouetteColor}set silhouetteColor(e){this.delegate.silhouetteColor=e}get silhouetteSize(){return this.delegate.silhouetteSize}set silhouetteSize(e){this.delegate.silhouetteSize=e}static silhouetteSupported(e){return Cesium.Model.silhouetteSupported(e.scene)}destroy(){this.delegate.destroy()}isDestroyed(){this.delegate.isDestroyed()}getMaterial(e){return this.delegate.getMaterial(e)}getMesh(e){return this.delegate.getMesh(e)}getNode(e){return this.delegate.getNode(e)}get sceneGraph(){return this.delegate.sceneGraph}get rootNodes(){if(this.delegate._runtime)return this.delegate._runtime.rootNodes;return this.sceneGraph._rootNodes.map((e=>this.nodes[e]))}get nodes(){return this.nodesByName}get materials(){return this.delegate._runtime?this.delegate._runtime.materialsByName:[]}get meshs(){return this.delegate._runtime?this.delegate._runtime.meshesByName:[]}get nodesByName(){return this.delegate._nodesByName||this.delegate_runtime}};const{PrimitiveCollection:ac,PolylineCollection:lc,Material:cc,Color:uc,defaultValue:hc,Cartesian3:dc,Cartesian2:pc,Matrix4:mc,Matrix3:fc,Quaternion:gc,PointPrimitiveCollection:_c,ScreenSpaceEventHandler:vc,ScreenSpaceEventType:yc,Polyline:Cc,Primitive:xc,Math:wc,Plane:bc,Model:Sc,IntersectionTests:Tc,Transforms:Ec}=Cesium,Pc=new dc,Ac=new gc,Mc=new fc,Dc=new dc;new dc;const Lc=new mc,Rc=new mc;function Oc(e,t){e instanceof Cc?e.material.uniforms.color=t:e instanceof xc&&(e.appearance.material.uniforms.color=t)}function Ic(e,t){const i=new dc,r=viewer.camera.getPickRay(e),n=new bc(dc.UNIT_X,0);return bc.fromPointNormal(t.center,t.activePrimitive.normal,n),bc.transform(n,t._modelMatrix,n),Tc.rayPlane(r,n,i),mc.multiplyByPoint(t._inverseModelMatrix,i,i),i}const Nc=new pc,kc=new pc;function Fc(e,t,i,r){const n=e.activePrimitive.relativeAxis||[e.activePrimitive];if(!Array.isArray(n))return;const o=e._viewer.camera.positionCartographic.height/1047;for(let l of n){const n=l.positions.map((t=>mc.multiplyByPoint(e._modelMatrix,t,new dc))).map((t=>Ie.toPixel(t,e._viewer.scene))),c=(s=pc.subtract(...n,Nc),a=pc.subtract(i,t,kc),pc.normalize(s,s),pc.dot(s,a));r[l.axis.toLowerCase()]=c*o}var s,a;return r}const zc="None",Bc="T",Gc="R",Wc="S";class Uc extends Cesium.UrlTemplateImageryProvider{constructor(e){"string"==typeof e&&(e={url:e}),e.getFeatureInfoFormats=Re(e.getFeatureInfoFormats,Uc.defaultFeatureInfoFormats),super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get rectangle(){return super.rectangle}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}function Hc(){return new Uc({url:On.buildModuleUrl("assets/tiles/{z}/{x}/{y}.png"),maximumLevel:4})}Uc.defaultFeatureInfoFormats=Object.freeze([Object.freeze(new Cesium.GetFeatureInfoFormat("json","application/json")),Object.freeze(new Cesium.GetFeatureInfoFormat("xml","text/xml")),Object.freeze(new Cesium.GetFeatureInfoFormat("text","text/html"))]);const{defined:Vc,defaultValue:jc,ColorMaterialProperty:qc,ConstantPositionProperty:$c,ConstantProperty:Yc,DataSource:Xc,PolygonGraphics:Jc,PolylineGraphics:Zc,EntityCluster:Qc,PinBuilder:Kc,createGuid:eu,Cartesian3:tu,PointGraphics:iu,ArcType:ru,PolygonHierarchy:nu,Color:ou,EntityCollection:su,HeightReference:au,Resource:lu,describe:cu,Event:uu}=Cesium,hu={small:24,medium:48,large:64},du={},pu={},mu={"urn:ogc:def:crs:OGC:1.3:CRS84":Iu,"EPSG:4326":Iu,"urn:ogc:def:crs:EPSG::4326":Iu},fu=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"],gu={Feature:Cu,FeatureCollection:function(e,t,i,r,n){for(var o=t.features,s=0,a=o.length;s<a;s++)Cu(e,o[s],void 0,r,n)},GeometryCollection:xu,LineString:Pu,MultiLineString:Au,MultiPoint:Su,MultiPolygon:Lu,Point:bu,Polygon:Du,Topology:Ru},_u={GeometryCollection:xu,LineString:Pu,MultiLineString:Au,MultiPoint:Su,MultiPolygon:Lu,Point:bu,Polygon:Du,Topology:Ru};function vu(e,t){for(var i=new Array(e.length),r=0;r<e.length;r++)i[r]=t(e[r]);return i}function yu(e,t,i){var r=e.id;if(Vc(r)&&"Feature"===e.type){for(var n=2,o=r;Vc(t.getById(o));)o=r+"_"+n,n++;r=o}else r=eu();var s=t.getOrCreateEntity(r),a=e.properties;if(Vc(a)){var l;s.properties=a;var c=a.title;if(Vc(c))s.name=c,l="title";else{var u=Number.MAX_VALUE;for(var h in a)if(a.hasOwnProperty(h)&&a[h]){var d=h.toLowerCase();if(u>1&&"title"===d){u=1,l=h;break}u>2&&"name"===d?(u=2,l=h):u>3&&/title/i.test(h)?(u=3,l=h):u>4&&/name/i.test(h)&&(u=4,l=h)}Vc(l)&&(s.name=a[l])}var p=a.description;null!==p&&(s.description=Vc(p)?new Yc(p):i(a,l))}return s}function Cu(e,t,i,r,n){if(null!==t.geometry){if(!Vc(t.geometry))throw new Le("feature.geometry is required.");var o=t.geometry.type,s=_u[o];if(!Vc(s))throw new Le("Unknown geometry type: "+o);s(e,t,t.geometry,r,n)}else yu(t,e._entityCollection,n.describe)}function xu(e,t,i,r,n){for(var o=i.geometries,s=0,a=o.length;s<a;s++){var l=o[s],c=l.type,u=_u[c];if(!Vc(u))throw new Le("Unknown geometry type: "+c);u(e,t,l,r,n)}}function wu(e,t,i,r,n){let o=n.pointSize,s=n.pointColor;const a=t.properties;if(Vc(a)){const e=a["point-color"];Vc(e)&&(s=ou.fromCssColorString(e)),o=jc(hu[a["point-size"]],o)}const l=new iu;2===r.length&&n.clampToGround&&(l.heightReference=au.CLAMP_TO_GROUND);const c=yu(t,e._entityCollection,n.describe);c.point=l,c.point.color=s,c.point.pixelSize=o,c.position=new $c(i(r))}function bu(e,t,i,r,n){wu(e,t,r,i.coordinates,n)}function Su(e,t,i,r,n){for(var o=i.coordinates,s=0;s<o.length;s++)wu(e,t,r,o[s],n)}function Tu(e,t,i,r,n){const o=n.lineColor,s=n.lineWidth,a=t.properties;if(Vc(a)){const e=a["stroke-width"];let t;Vc(e)&&(s=new Yc(e));let i=a.stroke;Vc(i)&&(t=ou.fromCssColorString(i));let r=a["stroke-opacity"];Vc(r)&&1!==r&&(Vc(t)||(t=o.color.clone()),t.alpha=r),Vc(t)&&(o=new qc(t))}const l=yu(t,e._entityCollection,n.describe),c=new Zc;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=s,c.positions=new Yc(vu(r,i)),c.arcType=ru.RHUMB}function Eu(e,t){var i="";for(var r in e)if(e.hasOwnProperty(r)){if(r===t||-1!==fu.indexOf(r))continue;var n=e[r];Vc(n)&&(i+="object"==typeof n?"<tr><th>"+r+"</th><td>"+Eu(n)+"</td></tr>":"<tr><th>"+r+"</th><td>"+n+"</td></tr>")}return i.length>0&&(i='<table class="cesium-infoBox-defaultTable"><tbody>'+i+"</tbody></table>"),i}function Pu(e,t,i,r,n){Tu(e,t,r,i.coordinates,n)}function Au(e,t,i,r,n){for(var o=i.coordinates,s=0;s<o.length;s++)Tu(e,t,r,o[s],n)}function Mu(e,t,i,r,n){if(n.outline){const o=Cesium.clone(n);return o.width=n.outlineWidth,o.lineColor=n.outlineColor,Tu(e,t,i,r[0],o)}if(!1===n.fill.getValue().color)return;if(0===r.length||0===r[0].length)return;let o=n.outlineColor.color,s=n.fill,a=n.outlineWidth;const l=t.properties;if(Vc(l)){const e=l["stroke-width"];let t;Vc(e)&&(a=new Yc(e));const i=l.stroke;Vc(i)&&(t=ou.fromCssColorString(i));let r,c=l["stroke-opacity"];Vc(c)&&1!==c&&(Vc(t)||(t=n.outlineColor.color.clone()),t.alpha=c),Vc(t)&&(o=new Yc(t));const u=l.fill;Vc(u)&&(r=ou.fromCssColorString(u),r.alpha=s.color.alpha),c=l["fill-opacity"],Vc(c)&&c!==s.color.alpha&&(Vc(r)||(r=s.color.clone()),r.alpha=c),Vc(r)&&(s=new qc(r))}const c=new Jc;c.outline=!1,c.outlineColor=o,c.outlineWidth=a,c.material=s,c.arcType=ru.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let i of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(i);Vc(e)&&Vc(e[1])&&(t=t.replace(i,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const h=[];for(var d=1,p=r.length;d<p;d++)h.push(new nu(vu(r[d],i)));const m=r[0];c.hierarchy=new Yc(new nu(vu(m,i),h)),m[0].length>2?c.perPositionHeight=new Yc(!0):n.clampToGround||(c.height=0);yu(t,e._entityCollection,n.describe).polygon=c}function Du(e,t,i,r,n){Mu(e,t,r,i.coordinates,n)}function Lu(e,t,i,r,n){for(var o=i.coordinates,s=0;s<o.length;s++)Mu(e,t,r,o[s],n)}function Ru(e,t,i,r,n){for(var o in i.objects)if(i.objects.hasOwnProperty(o)){var s=topojson.feature(i,i.objects[o]);(0,gu[s.type])(e,s,s,r,n)}}function Ou(e,t){return new Cesium.CallbackProperty(function(e,t,i){var r;return function(n,o){return Vc(r)||(r=e(t,i)),r}}(Eu,e,t),!0)}function Iu(e){return tu.fromDegrees(e[0],e[1],e[2])}class Nu{constructor(e){this._name=e,this._changed=new uu,this._error=new uu,this._isLoading=!1,this._loading=new uu,this._entityCollection=new su(this),this._promises=[],this._pinBuilder=new Kc,this._entityCluster=new Qc,this._credit=void 0,this._resourceCredits=[]}static pointSize=5;static pointColor=ou.ROYALBLUE;static lineColor=ou.YELLOW;static fill=ou.fromBytes(255,255,0,100);static outline=!0;static outlineColor=ou.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return mu}static crsLinkHrefs(){return du}static crsLinkTypes(){return pu}get entities(){return this._entityCollection}get name(){return this._name}set name(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}get clock(){}get isLoading(){return this._isLoading}get changedEvent(){return this._changed}get errorEvent(){return this._error}get loadingEvent(){return this._loading}get show(){return this._entityCollection.show}set show(e){this._entityCollection.show=e}get clustering(){return this._entityCluster}set clustering(e){this._entityCluster=e}get credit(){return this._credit}load(e,t){Xc.setLoading(this,!0);let i=(t=jc(t,{})).credit;"string"==typeof i&&(i=new Credit(i)),this._credit=i;let r=e,n=t.sourceUri;if("string"==typeof e||e instanceof lu){r=(e=lu.createIfNeeded(e)).fetchJson(),n=jc(n,e.getUrlComponent());const t=this._resourceCredits,i=e.credits;if(Vc(i)){const e=i.length;for(const r=0;r<e;r++)t.push(i[r])}}t={describe:jc(t.describe,Ou),pointSize:jc(t.pointSize,Nu.pointSize),pointColor:jc(t.pointColor,Nu.pointColor),lineWidth:new Yc(jc(t.lineWidth,Nu.lineWidth)),outlineColor:new qc(jc(t.outlineColor,Nu.outlineColor)),lineColor:new qc(jc(t.lineColor,Nu.lineColor)),outlineWidth:jc(t.outlineWidth,Nu.outlineWidth),fill:new qc(jc(t.fill,Nu.fill)),outline:jc(t.outline,Nu.outline),clampToGround:jc(t.clampToGround,Nu.clampToGround),extrudedHeight:t.extrudedHeight};const o=this;return Promise.resolve(r).then((function(e){return function(e,t,i,r){let n;Vc(r)&&(n=Cesium.getFilenameFromUri(r)),Vc(n)&&e._name!==n&&(e._name=n,e._changed.raiseEvent(e));const o=gu[t.type];if(!Vc(o))throw new Le("Unsupported GeoJSON object type: "+t.type);const s=t.crs;let a=null!==s?Iu:null;if(Vc(s)){if(!Vc(s.properties))throw new Le("crs.properties is undefined.");const e=s.properties;if("name"===s.type){if(a=mu[e.name],!Vc(a))throw new Le("Unknown crs name: "+e.name)}else if("link"===s.type){var l=du[e.href];if(Vc(l)||(l=pu[e.type]),!Vc(l))throw new Le("Unable to resolve crs link: "+JSON.stringify(e));a=l(e)}else{if("EPSG"!==s.type)throw new Le("Unknown crs type: "+s.type);if(a=mu["EPSG:"+e.code],!Vc(a))throw new Le("Unknown crs EPSG code: "+e.code)}}return Promise.resolve(a).then((function(r){return e._entityCollection.removeAll(),null!==r&&o(e,t,t,r,i),Promise.all(e._promises).then((function(){return e._promises.length=0,Xc.setLoading(e,!1),e}))}))}(o,e,t,n)})).catch((function(e){throw Xc.setLoading(o,!1),o._error.raiseEvent(o,e),e}))}update(){return!0}}function ku(e){return new Fu(e instanceof Uint8Array?e:new Uint8Array(e))}function Fu(e){this._array=e}function zu(e){return fetch(e).then((function(e){return e.body&&e.body.getReader?e.body.getReader():e.arrayBuffer().then(ku)}))}function Bu(e){return new Promise((function(t,i){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onload=function(){t(ku(r.response))},r.onerror=i,r.ontimeout=i,r.open("GET",e,!0),r.send()}))}function Gu(e){return("function"==typeof fetch?zu:Bu)(e)}function Wu(e){return"function"==typeof e.read?e:e.getReader()}Nu.load=function(e,t){return(new Nu).load(e,t)},Fu.prototype.read=function(){var e=this._array;return this._array=null,Promise.resolve(e?{done:!1,value:e}:{done:!0,value:void 0})},Fu.prototype.cancel=function(){return this._array=null,Promise.resolve()};var Uu=new Uint8Array(0);function Hu(e,t){if(!e.length)return t;if(!t.length)return e;var i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function Vu(e){return"function"==typeof e.slice?e:new ju("function"==typeof e.read?e:e.getReader())}function ju(e){this._source=e,this._array=Uu,this._index=0}function qu(e){return!(e=e.trim())||isNaN(e=+e)?null:e}ju.prototype.read=function(){var e=this,t=e._array.subarray(e._index);return e._source.read().then((function(i){return e._array=Uu,e._index=0,i.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:Hu(t,i.value)}}))},ju.prototype.slice=function(e){if((e|=0)<0)throw new Error("invalid length");var t=this,i=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var r=new Uint8Array(e);return r.set(this._array.subarray(this._index)),function n(){return t._source.read().then((function(o){return o.done?(t._array=Uu,t._index=0,i>0?r.subarray(0,i):null):i+o.value.length>=e?(t._array=o.value,t._index=e-i,r.set(o.value.subarray(0,e-i),i),r):(r.set(o.value,i),i+=o.value.length,n())}))}()},ju.prototype.cancel=function(){return this._source.cancel()};var $u={B:qu,C:function(e){return e.trim()||null},D:function(e){return new Date(+e.substring(0,4),e.substring(4,6)-1,+e.substring(6,8))},F:qu,L:function(e){return!/^[nf]$/i.test(e)&&(!!/^[yt]$/i.test(e)||null)},M:qu,N:qu};function Yu(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Xu(e,t){return(e=Vu(e)).slice(32).then((function(i){var r=Yu(i);return e.slice(r.getUint16(8,!0)-32).then((function(i){return new Ju(e,t,r,Yu(i))}))}))}function Ju(e,t,i,r){this._source=e,this._decode=t.decode.bind(t),this._recordLength=i.getUint16(10,!0),this._fields=[];for(var n=0;13!==r.getUint8(n);n+=32){for(var o=0;o<11&&0!==r.getUint8(n+o);++o);this._fields.push({name:this._decode(new Uint8Array(r.buffer,r.byteOffset+n,o)),type:String.fromCharCode(r.getUint8(n+11)),length:r.getUint8(n+16)})}}var Zu=Ju.prototype;function Qu(e){var t,i=40,r=e.getInt32(36,!0),n=new Array(r);for(t=0;t<r;++t,i+=16)n[t]=[e.getFloat64(i,!0),e.getFloat64(i+8,!0)];return{type:"MultiPoint",coordinates:n}}function Ku(e){return{type:"Point",coordinates:[e.getFloat64(4,!0),e.getFloat64(12,!0)]}}function eh(e){var t,i=44,r=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(r),s=new Array(n),a=[],l=[];for(t=0;t<r;++t,i+=4)o[t]=e.getInt32(i,!0);for(t=0;t<n;++t,i+=16)s[t]=[e.getFloat64(i,!0),e.getFloat64(i+8,!0)];return o.forEach((function(e,t){var i=s.slice(e,o[t+1]);!function(e){if((t=e.length)<4)return!1;var t,i=0,r=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];for(;++i<t;)r+=e[i-1][1]*e[i][0]-e[i-1][0]*e[i][1];return r>=0}(i)?l.push(i):a.push([i])})),l.forEach((function(e){a.some((function(t){if(function(e,t){var i,r=-1,n=t.length;for(;++r<n;)if(i=th(e,t[r]))return i>0;return!1}(t[0],e))return t.push(e),!0}))||a.push([e])})),1===a.length?{type:"Polygon",coordinates:a[0]}:{type:"MultiPolygon",coordinates:a}}function th(e,t){for(var i=t[0],r=t[1],n=-1,o=0,s=e.length,a=s-1;o<s;a=o++){var l=e[o],c=l[0],u=l[1],h=e[a],d=h[0],p=h[1];if(ih(l,h,t))return 0;u>r!=p>r&&i<(d-c)*(r-u)/(p-u)+c&&(n=-n)}return n}function ih(e,t,i){var r=i[0]-e[0],n=i[1]-e[1];if(0===r&&0===n)return!0;var o=t[0]-e[0],s=t[1]-e[1];if(0===o&&0===s)return!1;var a=(r*o+n*s)/(o*o+s*s);return!(a<0||a>1)&&(0===a||1===a||a*o===r&&a*s===n)}function rh(e){var t,i=44,r=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(r),s=new Array(n);for(t=0;t<r;++t,i+=4)o[t]=e.getInt32(i,!0);for(t=0;t<n;++t,i+=16)s[t]=[e.getFloat64(i,!0),e.getFloat64(i+8,!0)];return 1===r?{type:"LineString",coordinates:s}:{type:"MultiLineString",coordinates:o.map((function(e,t){return s.slice(e,o[t+1])}))}}function nh(e,t){var i=new Uint8Array(e.length+t.length);return i.set(e,0),i.set(t,e.length),i}Zu.read=function(){var e=this,t=1;return e._source.slice(e._recordLength).then((function(i){return i&&26!==i[0]?{done:!1,value:e._fields.reduce((function(r,n){return r[n.name]=$u[n.type](e._decode(i.subarray(t,t+=n.length))),r}),{})}:{done:!0,value:void 0}}))},Zu.cancel=function(){return this._source.cancel()};var oh={0:function(){return null},1:Ku,3:rh,5:eh,8:Qu,11:Ku,13:rh,15:eh,18:Qu,21:Ku,23:rh,25:eh,28:Qu};function sh(e,t){var i=t.getInt32(32,!0);if(!(i in oh))throw new Error("unsupported shape type: "+i);this._source=e,this._type=i,this._index=0,this._parse=oh[i],this.bbox=[t.getFloat64(36,!0),t.getFloat64(44,!0),t.getFloat64(52,!0),t.getFloat64(60,!0)]}var ah=sh.prototype;function lh(){}function ch(e,t,i){return Promise.all([(r=e,(r=Vu(r)).slice(100).then((function(e){return new sh(r,Yu(e))}))),t&&Xu(t,i)]).then((function(e){return new uh(e[0],e[1])}));var r}function uh(e,t){this._shp=e,this._dbf=t,this.bbox=e.bbox}ah.read=function(){var e=this;return++e._index,e._source.slice(12).then((function(t){if(null==t)return{done:!0,value:void 0};var i=Yu(t);function r(){return e._source.slice(4).then((function(o){return null==o?{done:!0,value:void 0}:(i=Yu(t=nh(t.slice(4),o))).getInt32(0,!1)!==e._index?r():n()}))}function n(){var n=2*i.getInt32(4,!1)-4,o=i.getInt32(8,!0);return n<0||o&&o!==e._type?r():e._source.slice(n).then((function(i){return{done:!1,value:o?e._parse(Yu(nh(t.slice(8),i))):null}}))}return n()}))},ah.cancel=function(){return this._source.cancel()};var hh=uh.prototype;function dh(e,t,i){return"string"==typeof t?(/\.dbf$/.test(t)||(t+=".dbf"),t=Gu(t)):t instanceof ArrayBuffer||t instanceof Uint8Array?t=ku(t):null!=t&&(t=Wu(t)),"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),void 0===t&&(t=Gu(e.substring(0,e.length-4)+".dbf").catch((function(){}))),e=Gu(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?ku(e):Wu(e),Promise.all([e,t]).then((function(e){var t=e[0],r=e[1],n="windows-1252";return i&&null!=i.encoding&&(n=i.encoding),ch(t,r,r&&new TextDecoder(n))}))}hh.read=function(){var e=this;return Promise.all([e._dbf?e._dbf.read():{value:{}},e._shp.read()]).then((function(e){var t=e[0],i=e[1];return i.done?i:{done:!1,value:{type:"Feature",properties:t.value,geometry:i.value}}}))},hh.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(lh)};const{defined:ph,defaultValue:mh,ColorMaterialProperty:fh,ConstantPositionProperty:gh,ConstantProperty:_h,DataSource:vh,PolygonGraphics:yh,PolylineGraphics:Ch,createGuid:xh,Cartesian3:wh,PointGraphics:bh,ArcType:Sh,PolygonHierarchy:Th,Color:Eh,HeightReference:Ph,Resource:Ah}=Cesium,Mh={small:24,medium:48,large:64},Dh={},Lh={},Rh={"urn:ogc:def:crs:OGC:1.3:CRS84":Qh,"EPSG:4326":Qh,"urn:ogc:def:crs:EPSG::4326":Qh},Oh={Feature:Fh,FeatureCollection:function(e,t,i,r,n){for(var o=t.features,s=0,a=o.length;s<a;s++)Fh(e,o[s],void 0,r,n)},GeometryCollection:zh,LineString:Hh,MultiLineString:Vh,MultiPoint:Wh,MultiPolygon:$h,Point:Gh,Polygon:qh,Topology:Yh},Ih={GeometryCollection:zh,LineString:Hh,MultiLineString:Vh,MultiPoint:Wh,MultiPolygon:$h,Point:Gh,Polygon:qh,Topology:Yh};function Nh(e,t){for(var i=new Array(e.length),r=0;r<e.length;r++)i[r]=t(e[r]);return i}function kh(e,t,i){var r=e.id;if(ph(r)&&"Feature"===e.type){for(var n=2,o=r;ph(t.getById(o));)o=r+"_"+n,n++;r=o}else r=xh();var s=t.getOrCreateEntity(r),a=e.properties;if(ph(a)){var l;s.properties=a;var c=a.title;if(ph(c))s.name=c,l="title";else{var u=Number.MAX_VALUE;for(var h in a)if(a.hasOwnProperty(h)&&a[h]){var d=h.toLowerCase();if(u>1&&"title"===d){u=1,l=h;break}u>2&&"name"===d?(u=2,l=h):u>3&&/title/i.test(h)?(u=3,l=h):u>4&&/name/i.test(h)&&(u=4,l=h)}ph(l)&&(s.name=a[l])}var p=a.description;null!==p&&(s.description=ph(p)?new _h(p):i(a,l))}return s}function Fh(e,t,i,r,n){if(null!==t.geometry){if(!ph(t.geometry))throw new Le("feature.geometry is required.");var o=t.geometry.type,s=Ih[o];if(!ph(s))throw new Le("Unknown geometry type: "+o);s(e,t,t.geometry,r,n)}else kh(t,e._entityCollection,n.describe)}function zh(e,t,i,r,n){for(var o=i.geometries,s=0,a=o.length;s<a;s++){var l=o[s],c=l.type,u=Ih[c];if(!ph(u))throw new Le("Unknown geometry type: "+c);u(e,t,l,r,n)}}function Bh(e,t,i,r,n){let o=n.pointSize,s=n.pointColor;const a=t.properties;if(ph(a)){const e=a["point-color"];ph(e)&&(s=Eh.fromCssColorString(e)),o=mh(Mh[a["point-size"]],o)}const l=new bh;2===r.length&&n.clampToGround&&(l.heightReference=Ph.CLAMP_TO_GROUND);const c=kh(t,e._entityCollection,n.describe);c.point=l,c.point.color=s,c.point.pixelSize=o,c.position=new gh(i(r))}function Gh(e,t,i,r,n){Bh(e,t,r,i.coordinates,n)}function Wh(e,t,i,r,n){for(var o=i.coordinates,s=0;s<o.length;s++)Bh(e,t,r,o[s],n)}function Uh(e,t,i,r,n){const o=n.lineColor,s=n.lineWidth,a=t.properties;if(ph(a)){const e=a["stroke-width"];let t;ph(e)&&(s=new _h(e));let i=a.stroke;ph(i)&&(t=Eh.fromCssColorString(i));let r=a["stroke-opacity"];ph(r)&&1!==r&&(ph(t)||(t=o.color.clone()),t.alpha=r),ph(t)&&(o=new fh(t))}const l=kh(t,e._entityCollection,n.describe),c=new Ch;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=s,c.positions=new _h(Nh(r,i)),c.arcType=Sh.RHUMB}function Hh(e,t,i,r,n){Uh(e,t,r,i.coordinates,n)}function Vh(e,t,i,r,n){for(var o=i.coordinates,s=0;s<o.length;s++)Uh(e,t,r,o[s],n)}function jh(e,t,i,r,n){if(n.outline){const o=Cesium.clone(n);o.width=n.outlineWidth,o.lineColor=n.outlineColor;for(let n of r)Uh(e,t,i,n,o)}if(!1===n.fill.getValue().color)return;if(0===r.length||0===r[0].length)return;let o=n.outlineColor.color,s=n.fill,a=n.outlineWidth;const l=t.properties;if(ph(l)){const e=l["stroke-width"];let t;ph(e)&&(a=new _h(e));const i=l.stroke;ph(i)&&(t=Eh.fromCssColorString(i));let r,c=l["stroke-opacity"];ph(c)&&1!==c&&(ph(t)||(t=n.outlineColor.color.clone()),t.alpha=c),ph(t)&&(o=new _h(t));const u=l.fill;ph(u)&&(r=Eh.fromCssColorString(u),r.alpha=s.color.alpha),c=l["fill-opacity"],ph(c)&&c!==s.color.alpha&&(ph(r)||(r=s.color.clone()),r.alpha=c),ph(r)&&(s=new fh(r))}const c=new yh;c.outline=!1,c.outlineColor=o,c.outlineWidth=a,c.material=s,c.arcType=Sh.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let i of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(i);ph(e)&&ph(e[1])&&(t=t.replace(i,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const h=[];for(var d=1,p=r.length;d<p;d++)h.push(new Th(Nh(r[d],i)));const m=r[0];c.hierarchy=new _h(new Th(Nh(m,i),h)),m[0].length>2?c.perPositionHeight=new _h(!0):n.clampToGround||(c.height=0);kh(t,e._entityCollection,n.describe).polygon=c}function qh(e,t,i,r,n){jh(e,t,r,i.coordinates,n)}function $h(e,t,i,r,n){for(var o=i.coordinates,s=0;s<o.length;s++)jh(e,t,r,o[s],n)}function Yh(e,t,i,r,n){for(var o in i.objects)if(i.objects.hasOwnProperty(o)){var s=topojson.feature(i,i.objects[o]);(0,Oh[s.type])(e,s,s,r,n)}}function Xh(e,t){var i="";for(var r in e)if(e.hasOwnProperty(r)){if(r===t||-1!==Jh.indexOf(r))continue;var n=e[r];ph(n)&&(i+="object"==typeof n?"<tr><th>"+r+"</th><td>"+Xh(n)+"</td></tr>":"<tr><th>"+r+"</th><td>"+n+"</td></tr>")}return i.length>0&&(i='<table class="cesium-infoBox-defaultTable"><tbody>'+i+"</tbody></table>"),i}const Jh=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"];function Zh(e,t){return new Cesium.CallbackProperty(function(e,t,i){var r;return function(n,o){return ph(r)||(r=e(t,i)),r}}(Xh,e,t),!0)}function Qh(e){return wh.fromDegrees(e[0],e[1],e[2])}function Kh(e,t,i,r){let n;ph(r)&&(n=Cesium.getFilenameFromUri(r)),ph(n)&&e._name!==n&&(e._name=n,e._changed.raiseEvent(e));const o=Oh[t.type];if(!ph(o))throw new Le("Unsupported GeoJSON object type: "+t.type);const s=t.crs;let a=null!==s?Qh:null;if(ph(s)){if(!ph(s.properties))throw new Le("crs.properties is undefined.");const e=s.properties;if("name"===s.type){if(a=Rh[e.name],!ph(a))throw new Le("Unknown crs name: "+e.name)}else if("link"===s.type){var l=Dh[e.href];if(ph(l)||(l=Lh[e.type]),!ph(l))throw new Le("Unable to resolve crs link: "+JSON.stringify(e));a=l(e)}else{if("EPSG"!==s.type)throw new Le("Unknown crs type: "+s.type);if(a=Rh["EPSG:"+e.code],!ph(a))throw new Le("Unknown crs EPSG code: "+e.code)}}return Promise.resolve(a).then((function(r){return e._entityCollection.removeAll(),null!==r&&o(e,t,t,r,i),Promise.all(e._promises).then((function(){return e._promises.length=0,vh.setLoading(e,!1),e}))}))}class ed extends Nu{constructor(e){super(e),this._geoJson=void 0}get geoJson(){return this._geoJson}set geoJson(e){this._geoJson?this._geoJson.features.push(e):this._geoJson={type:"FeatureCollection",features:[e]}}static pointSize=5;static pointColor=Eh.ROYALBLUE;static lineColor=Eh.YELLOW;static fill=Eh.fromBytes(255,255,0,100);static outline=!0;static outlineColor=Eh.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return Rh}static crsLinkHrefs(){return Dh}static crsLinkTypes(){return Lh}load(e,t,i={encoding:"utf-8"}){let r=e;if(!ph(r))throw new Le("shpfile is required.");Cesium.DataSource.setLoading(this,!0);const n=i.credit;"string"==typeof n&&(n=new Cesium.Credit(n)),this._credit=n;const o=this;let s=r,a=i.sourceUri;if("string"==typeof r||r instanceof Ah){s=new Promise(((e,n)=>{dh(r,t,{encoding:i.encoding}).then((t=>t.read().then((function i(r){if(!r.done)return o.geoJson=r.value,t.read().then(i);e(o.geoJson)})))).catch((e=>n(e.stack)))})),a=mh(a,"");var l=this._resourceCredits,c=r.credits;if(ph(c))for(var u=c.length,h=0;h<u;h++)l.push(c[h])}return i={describe:mh(i.describe,Zh),pointSize:mh(i.pointSize,ed.pointSize),pointColor:mh(i.pointColor,ed.pointColor),lineWidth:new _h(mh(i.lineWidth,ed.lineWidth)),outlineColor:new fh(mh(i.outlineColor,ed.outlineColor)),lineColor:new fh(mh(i.lineColor,ed.lineColor)),outlineWidth:mh(i.outlineWidth,ed.outlineWidth),fill:new fh(mh(i.fill,ed.fill)),outline:mh(i.outline,ed.outline),clampToGround:mh(i.clampToGround,ed.clampToGround),extrudedHeight:i.extrudedHeight},Promise.resolve(s).then((function(e){return Kh(o,e,i,a)})).catch((function(e){throw vh.setLoading(o,!1),o._error.raiseEvent(o,e),e}))}loadArrayBuffer(e,t,i={encoding:"utf-8"}){let r=e;if(!ph(r))throw new Le("shpfile is required.");Cesium.DataSource.setLoading(this,!0);const n=i.credit;"string"==typeof n&&(n=new Cesium.Credit(n)),this._credit=n;const o=this;let s=r,a=i.sourceUri;if(r instanceof ArrayBuffer){s=new Promise(((e,n)=>{dh(r,t,{encoding:i.encoding}).then((t=>t.read().then((function i(r){if(!r.done)return o.geoJson=r.value,t.read().then(i);e(o.geoJson)})))).catch((e=>n(e.stack)))})),a=mh(a,"");var l=this._resourceCredits,c=r.credits;if(ph(c))for(var u=c.length,h=0;h<u;h++)l.push(c[h])}return i={describe:mh(i.describe,Zh),pointSize:mh(i.pointSize,ed.pointSize),pointColor:mh(i.pointColor,ed.pointColor),lineWidth:new _h(mh(i.lineWidth,ed.lineWidth)),outlineColor:new fh(mh(i.outlineColor,ed.outlineColor)),lineColor:new fh(mh(i.lineColor,ed.lineColor)),outlineWidth:mh(i.outlineWidth,ed.outlineWidth),fill:new fh(mh(i.fill,ed.fill)),outline:mh(i.outline,ed.outline),clampToGround:mh(i.clampToGround,ed.clampToGround),extrudedHeight:i.extrudedHeight},Promise.resolve(s).then((function(e){return Kh(o,e,i,a)})).catch((function(e){throw vh.setLoading(o,!1),o._error.raiseEvent(o,e),e}))}}ed.load=function(e,t,i){return(new ed).load(e,t,i)},ed.loadArrayBuffer=function(e,t,i){return(new ed).loadArrayBuffer(e,t,i)};const{buildModuleUrl:td,Color:id,defined:rd,destroyObject:nd,knockout:od,getElement:sd,subscribeAndEvaluate:ad,InfoBoxViewModel:ld}=Cesium;class cd{constructor(e){e=sd(e);var t=document.createElement("div");t.className="cesium-infoBox",t.setAttribute("data-bind",'      css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }'),e.appendChild(t);var i=document.createElement("div");i.className="cesium-infoBox-title",i.setAttribute("data-bind","text: titleText"),t.appendChild(i);var r=document.createElement("button");r.type="button",r.className="cesium-infoBox-close",r.setAttribute("data-bind","      click: function () { closeClicked.raiseEvent(this); }"),r.innerHTML="&times;",t.appendChild(r);var n=document.createElement("iframe");n.className="cesium-infoBox-iframe",n.setAttribute("sandbox","allow-same-origin allow-popups allow-forms"),n.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }"),n.setAttribute("allowfullscreen",!0),t.appendChild(n);var o=new ld;od.applyBindings(o,t),this._container=e,this._element=t,this._frame=n,this._viewModel=o,this._descriptionSubscription=void 0;var s=this;n.addEventListener("load",(function(){var e=n.contentDocument,i=e.createElement("link");i.href=td("Widgets/InfoBox/InfoBoxDescription.css"),i.rel="stylesheet",i.type="text/css";var r=e.createElement("div");r.className="cesium-infoBox-description",e.head.appendChild(i),e.body.appendChild(r),s._descriptionSubscription=ad(o,"description",(function(e){n.style.height="5px",r.innerHTML=e;var i=null,o=r.firstElementChild;if(null!==o&&1===r.childNodes.length){var s=window.getComputedStyle(o);if(null!==s){var a=s["background-color"],l=id.fromCssColorString(a);rd(l)&&0!==l.alpha&&(i=s["background-color"])}}t.style["background-color"]=i;var c=r.getBoundingClientRect().height;n.style.height=c+"px"}))})),n.setAttribute("src","about:blank")}get container(){return this._container}get viewModel(){return this._viewModel}get frame(){return this._frame}isDestroyed(){return!1}destroy(){var e=this._container;return od.cleanNode(this._element),e.removeChild(this._element),rd(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),nd(this)}}function ud(e,t){const{center:i}=e.boundingSphere,r=Ie.fromCartesian(i),n=Cesium.Cartesian3.fromDegrees(r.lon,r.lat,0),o=Cesium.Cartesian3.fromDegrees(r.lon,r.lat,t),s=Cesium.Cartesian3.subtract(o,n,new Cesium.Cartesian3);e.modelMatrix=Cesium.Matrix4.multiply(e.modelMatrix,Cesium.Matrix4.fromTranslation(s),e.modelMatrix)}class hd{constructor(e={},t={}){this._params={height:0,position:new Cesium.Cartesian3(0,0,0),rotation:0};let{transform:i,position:r,height:n,rotationZ:o,debug:s}=e;const a=new Cesium.Cesium3DTileset(e);a.readyPromise.then((e=>{if(viewer.scene.primitives.add(e),Cesium.defined(r)&&function(e,t,i,r){if(t)e.root.transform=t;else{const t=Cesium.Transforms.eastNorthUpToFixedFrame(i),n=Cesium.Matrix3.fromRotationZ(r);Cesium.Matrix4.multiplyByMatrix3(t,n,t),Cesium.Matrix4.multiply(e.root.transform,t,e.root.transform)}}(e,i,r,o),Cesium.defined(n)&&ud(e,n),s){let t=0,i=new Cesium.Cartesian3,r=0;parent.onkeypress=function(n){n.keyCode==="Q".charCodeAt()||n.keyCode==="q".charCodeAt()?t=1:n.keyCode==="E".charCodeAt()||n.keyCode==="e".charCodeAt()?t=-1:n.keyCode==="A".charCodeAt()||n.keyCode==="a".charCodeAt()?i=new Cesium.Cartesian3(-2,0,0):n.keyCode==="D".charCodeAt()||n.keyCode==="d".charCodeAt()?i=new Cesium.Cartesian3(2,0,0):n.keyCode==="W".charCodeAt()||n.keyCode==="w".charCodeAt()?i=new Cesium.Cartesian3(0,-2,0):n.keyCode==="S".charCodeAt()||n.keyCode==="s".charCodeAt()?i=new Cesium.Cartesian3(0,2,0):n.keyCode==="Z".charCodeAt()||n.keyCode==="z".charCodeAt()?r=-1:n.keyCode!=="X".charCodeAt()&&n.keyCode!=="x".charCodeAt()||(r=1),function(e,t){const i=new Cesium.Matrix4;Cesium.Matrix4.fromTranslation(t,i),Cesium.Matrix4.multiply(e.modelMatrix,i,e.modelMatrix)}(e,i),function(e,t){const i=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(t));Cesium.Matrix4.multiplyByMatrix3(e.root.transform,i,e.root.transform)}(e,r),ud(e,t),r=0,i=new Cesium.Cartesian3,t=0}}})),this.delegate=a}get allTilesLoaded(){return this.delegate.allTilesLoaded}get readyPromise(){return this.delegate.readyPromise}get boundingSphere(){return this.delegate.boundingSphere}get colorBlendAmount(){return this.delegate.colorBlendAmount}set colorBlendAmount(e){this.delegate.colorBlendAmount=e}get colorBlendMode(){return this.delegate.colorBlendMode}set colorBlendMode(e){this.delegate.colorBlendMode=e}get style(){return this.delegate.style}set style(e){this.delegate.style=e}get customShader(){return this.delegate.customShader}set customShader(e){this.delegate.customShader=e}get debugColorizeTiles(){return this.delegate.debugColorizeTiles}set debugColorizeTiles(e){this.delegate.debugColorizeTiles=e}get debugFreezeFrame(){return this.delegate.debugFreezeFrame}set debugFreezeFrame(e){this.delegate.debugFreezeFrame=e}get debugShowBoundingVolume(){return this.delegate.debugShowBoundingVolume}set debugShowBoundingVolume(e){this.delegate.debugShowBoundingVolume=e}get debugShowContentBoundingVolume(){return this.delegate.debugShowContentBoundingVolume}set debugShowContentBoundingVolume(e){this.delegate.debugShowContentBoundingVolume=e}get debugShowGeometricError(){return this.delegate.debugShowGeometricError}set debugShowGeometricError(e){this.delegate.debugShowGeometricError=e}get debugShowMemoryUsage(){return this.delegate.debugShowMemoryUsage}set debugShowMemoryUsage(e){this.delegate.debugShowMemoryUsage=e}get debugShowRenderingStatistics(){return this.delegate.debugShowRenderingStatistics}set debugShowRenderingStatistics(e){this.delegate.debugShowRenderingStatistics=e}get debugShowUrl(){return this.delegate.debugShowUrl}set debugShowUrl(e){this.delegate.debugShowUrl=e}get debugWireframe(){return this.delegate.debugWireframe}set debugWireframe(e){this.delegate.debugWireframe=e}get dynamicScreenSpaceError(){return this.delegate.dynamicScreenSpaceError}set dynamicScreenSpaceError(e){this.delegate.dynamicScreenSpaceError=e}get dynamicScreenSpaceErrorFactor(){return this.delegate.dynamicScreenSpaceErrorFactor}set dynamicScreenSpaceErrorFactor(e){this.delegate.dynamicScreenSpaceErrorFactor=e}get extensions(){return this.delegate.extensions}get extras(){return this.delegate.extras}get dynamicScreenSpaceErrorDensity(){return this.delegate.dynamicScreenSpaceErrorDensity}set dynamicScreenSpaceErrorDensity(e){this.delegate.dynamicScreenSpaceErrorDensity=e}get foveatedScreenSpaceError(){return this.delegate.foveatedScreenSpaceError}set foveatedScreenSpaceError(e){this.delegate.foveatedScreenSpaceError=e}get foveatedConeSize(){return this.delegate.foveatedConeSize}set foveatedConeSize(e){this.delegate.foveatedConeSize=e}get foveatedInterpolationCallback(){return this.delegate.foveatedInterpolationCallback}set foveatedInterpolationCallback(e){this.delegate.foveatedInterpolationCallback=e}get foveatedMinimumScreenSpaceErrorRelaxation(){return this.delegate.foveatedMinimumScreenSpaceErrorRelaxation}set foveatedMinimumScreenSpaceErrorRelaxation(e){this.delegate.foveatedMinimumScreenSpaceErrorRelaxation=e}get foveatedTimeDelay(){return this.delegate.foveatedTimeDelay}set foveatedTimeDelay(e){this.delegate.foveatedTimeDelay=e}get imageBasedLightingFactor(){return this.delegate.imageBasedLightingFactor}set imageBasedLightingFactor(e){this.delegate.imageBasedLightingFactor=e}get immediateLoadDesiredLevelOfDetail(){return this.delegate.immediateLoadDesiredLevelOfDetail}set immediateLoadDesiredLevelOfDetail(e){this.delegate.immediateLoadDesiredLevelOfDetail=e}get initialTilesLoaded(){return this.delegate.initialTilesLoaded}get lightColor(){return this.delegate.lightColor}set lightColor(e){this.delegate.lightColor=e}get loadProgress(){return this.delegate.loadProgress}get loadSiblings(){return this.delegate.loadSiblings}get maximumMemoryUsage(){return this.delegate.maximumMemoryUsage}set maximumMemoryUsage(e){this.delegate.maximumMemoryUsage=e}get maximumScreenSpaceError(){return this.delegate.maximumScreenSpaceError}set maximumScreenSpaceError(e){this.delegate.maximumScreenSpaceError=e}get modelMatrix(){return this.delegate.modelMatrix}set modelMatrix(e){this.delegate.modelMatrix=e}get pointCloudShading(){return this.delegate.pointCloudShading}set pointCloudShading(e){this.delegate.pointCloudShading}get preferLeaves(){return this.delegate.preferLeaves}set preferLeaves(e){this.delegate.preferLeaves=e}get preloadFlightDestinations(){return this.delegate.preloadFlightDestinations}set preloadFlightDestinations(e){this.delegate.preloadFlightDestinations}get preloadWhenHidden(){return this.delegate.preloadWhenHidden}set preloadWhenHidden(e){this.delegate.preloadWhenHidden}get progressResolutionHeightFraction(){return this.delegate.progressResolutionHeightFraction}set progressResolutionHeightFraction(e){this.delegate.progressResolutionHeightFraction=e}get properties(){return this.delegate.properties}get resource(){return this.delegate.resource}get root(){return this.delegate.root}get shadows(){return this.delegate.shadows}set shadows(e){this.delegate.shadows=e}get showOutline(){return this.delegate.showOutline}get skipLevelOfDetail(){return this.delegate.skipLevelOfDetail}set skipLevelOfDetail(e){this.delegate.skipLevelOfDetail}get skipLevels(){return this.delegate.skipLevels}set skipLevels(e){this.delegate.skipLevels=e}get skipScreenSpaceErrorFactor(){return this.delegate.skipScreenSpaceErrorFactor}set skipScreenSpaceErrorFactor(e){this.delegate.skipScreenSpaceErrorFactor=e}get clippingPlanes(){return this.delegate.clippingPlanes}set clippingPlanes(e){this.delegate.clippingPlanes=e}get specularEnvironmentMaps(){return this.delegate.specularEnvironmentMaps}set specularEnvironmentMaps(e){this.delegate.specularEnvironmentMaps=e}get tileFailed(){return this.delegate.tileFailed}get tileLoad(){return this.delegate.tileLoad}set tileLoad(e){this.delegate.tileLoad=e}get tileUnload(){return this.delegate.tileUnload}set tileUnload(e){this.delegate.tileUnload=e}get tilesLoaded(){return this.delegate.tilesLoaded}get tileVisible(){return this.delegate.tileVisible}set tileVisible(e){this.delegate.tileVisible=e}get timeSinceLoad(){return this.delegate.timeSinceLoad}get totalMemoryUsageInBytes(){return this.delegate.totalMemoryUsageInBytes}get classificationType(){return this.delegate.classificationType}set classificationType(e){this.delegate.classificationType=e}get baseScreenSpaceError(){return this.delegate.baseScreenSpaceError}set baseScreenSpaceError(e){this.delegate.baseScreenSpaceError=e}destroy(){this.delegate.destroy()}hasExtension(e){return this.delegate.hasExtension(e)}isDestroyed(){return this.delegate.isDestroyed()}makeStyleDirty(){return this.delegate.makeStyleDirty()}trimLoadedTiles(){this.delegate.trimLoadedTiles()}static loadJson(e){return Cesium3DTileset.loadJson(e)}}class dd{constructor(e={}){this._id=Re(e.id,eo()),this._maxClusterLevel=Re(e.maxClusterLevel,12),this._minLoadLevel=Re(e.minLoadLevel,12),this._objects=void 0}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects}set objects(e){this._objects=e}updateCluster(e){Le.throwInstantiationError()}beginUpdate(e){Le.throwInstantiationError()}endUpdate(e){Le.throwInstantiationError()}initialize(e,t){Le.throwInstantiationError()}createGeometry(e,t,i){Le.throwInstantiationError()}removeGeometry(e,t){}removeAll(){Le.throwInstantiationError()}isDestroyed(){return!1}destroy(){Le.throwInstantiationError()}}const{AssociativeArray:pd}=Cesium;class md{constructor(){this._layers=new pd}get layer(){return this._layers}get length(){return this._layers.length}get values(){return this._layers.values}get(e){return this._layers.get(e)}add(e){e instanceof dd&&this._layers.set(e.id,e)}has(e){return e instanceof dd?this._layers.contains(e):"string"==typeof e&&this._layers.contains(this.get(e))}remove(e){if(e instanceof dd)return e.destroy(),this._layers.remove(e.id);if("string"==typeof e){const t=this._layers.get(e);return t&&t.destroy(),this._layers.remove(e)}return!1}removeAll(){return this._layers.removeAll()}}const{GeographicTilingScheme:fd,GlobeSurfaceTileProvider:gd,Event:_d,TerrainState:vd,RequestType:yd,Request:Cd,Rectangle:xd,QuadtreeTileLoadState:wd,Visibility:bd,AssociativeArray:Sd,Cartesian3:Td,Cartographic:Ed,getTimestamp:Pd,RequestState:Ad}=Cesium;function Md(e,t,i){let r=e.data;!function(){const t=new Cd({throttle:!1,throttleByServer:!0,type:yd.TERRAIN});r.request=t;const n=i.requestTileGeometry(e.x,e.y,e.level,t);Oe(n)?(r.terrainState=vd.RECEIVING,Promise.resolve(n).then((function(e){!function(e){r.terrainData=e,r.terrainState=vd.RECEIVED,r.request=void 0}(e)})).catch((function(e){!function(e){if(r.request.state===Ad.CANCELLED)return r.terrainData=void 0,r.terrainState=vd.UNLOADED,void(r.request=void 0);r.terrainState=vd.FAILED,r.request=void 0}()}))):(r.terrainState=vd.UNLOADED,r.request=void 0)}()}const Dd={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function Ld(e,t,i,r,n){const o=e.data;o.terrainState===vd.UNLOADED&&Md(e,0,i),o.terrainState===vd.RECEIVED&&function(e,t,i,r,n,o){const s=i.tilingScheme,a=Dd;a.tilingScheme=s,a.x=r,a.y=n,a.level=o,a.exaggeration=t.terrainExaggeration,a.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,a.throttle=!0;const l=e.terrainData.createMesh(a);Oe(l)&&(e.terrainState=vd.TRANSFORMING,Promise.resolve(l).then((function(t){e.mesh=t,e.terrainState=vd.TRANSFORMED})).catch((function(){e.terrainState=vd.FAILED})))}(o,t,i,e.x,e.y,e.level),o.terrainState===vd.TRANSFORMED&&(e.renderable=!0)}function Rd(e,t){const i=[];for(let r of e)Oe(r)&&(Oe(r.id)||(r.id=eo()),Oe(r)&&Oe(r.position)&&(r.position instanceof Td?r.cartesian=r.position:r.position instanceof Ed?(r.cartesian=Ed.toCartesian(r.position),r.catographic=r.position):r.position instanceof Ie?(r.cartesian=r.position.toCartesian(),r.cartographic=r.position.toCartoGraphic()):r.cartesian=r.position,r.cartographic||(r.cartographic=Ed.fromCartesian(r.cartesian)),xd.contains(t.rectangle,r.cartographic)&&i.push(r)));return i}class Od{constructor(){this.boundingVolumeSourceTile=void 0,this.terrainState=Cesium.TerrainState.UNLOADED,this.mesh=void 0,this.terrainData=void 0,this.objects=void 0,this._geometryOfTile=new Sd,this._objectsOfTile=new Sd,this._needRenderObjects=new Sd}static processStateMachine(e,t,i,r,n){Od.initialize(e,i),e.state===wd.LOADING&&Ld(e,t,i)}static initialize(e,t){let i=e.data;Oe(i)||(i=e.data=new Od),e.state===wd.START&&(e.state=wd.LOADING)}}function Id(e,t,i,r,n){let o=i.data._geometryOfTile.get(t.id),s=e._hasRenderCached.get(t.id);s||(s={},e._hasRenderCached.set(t.id,s)),o||(o=[]);for(let e of n){if(s[e.id])return;const n=t.createGeometry(i,r,e);n&&(s[e.id]=!0,o.push({id:e.id,geometry:n}))}i.data._geometryOfTile.set(t.id,o)}function Nd(e,t,i,r,n){const o=e._hasRenderCached.get(t.id);for(let e of n){const{id:i,geometry:n}=e;t.removeGeometry(r,n),delete o[i]}i.data._geometryOfTile.remove(t.id)}class kd{constructor(e={}){this._ready=!0,this._scene=e.scene,this._tilingSceheme=new fd,this._readyPromise=Promise.resolve(!0),this._errorEvent=new _d,this._terrainProvider=e.terrainProvider,this._show=!0,this.cartographicLimitRectangle=xd.clone(xd.MAX_VALUE),this.tree=void 0,this._layers=new md,this._lastTilesToRender=[],this._hasRenderCached=new Sd,this._tilesCahced=[]}get terrainProvider(){return this._terrainProvider}get show(){return this._show}set show(e){this._show=e}get ready(){return this._ready}get tilingScheme(){return this._tilingSceheme}get readyPromise(){return this._readyPromise}get quadtree(){return this._quadtree}set quadtree(e){Oe(e)&&(this._quadtree=e)}initialize(e){for(let t of this._layers.values)t.initialize(e,this._scene)}beginUpdate(e){const t=this._layers.values;for(let i of t)i.beginUpdate(e);this._frameNumber++}showTileThisFrame(e,t){const i=e.data;if(!Oe(i))return;this._tilesCahced.includes(e)||this._tilesCahced.push(e);const r=this._layers.values;Pd();for(let n of r){if(!Oe(n.objects)||!Array.isArray(n.objects))continue;const r=n.id;if(i._geometryOfTile.get(r)&&!n._needReclass)return;let o=i._objectsOfTile.get(r);Oe(o)&&!n._needReclass||(o=Rd(n.objects,e),i._objectsOfTile.set(r,o)),Id(this,n,e,t,o)}}endUpdate(e){const t=this._quadtree;if(!t)return;const i=this._lastTilesToRender,r=t._tilesToRender,n=this._layers.values;for(let t of i)if(!r.includes(t))for(let i of n){const r=t.data._geometryOfTile.get(i.id)||[];Nd(this,i,t,e,r)}for(let t of n){t.endUpdate(e)&&r.forEach((i=>{const r=i.data._geometryOfTile.get(t.id)||[];Nd(this,t,i,e,r)}))}this._lastTilesToRender=[...r]}loadTile(e,t){if(!this.terrainProvider.ready)return;let i,r=!0;t.data&&(i=t.data.terrainState,r=t.data.boundingVolumeSourceTile!==t),Od.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree);const n=t.data;r&&i!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==bd.NONE&&n.boundingVolumeSourceTile===t&&Od.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree)}getLevelMaximumGeometricError(e){return this._terrainProvider.getLevelMaximumGeometricError(e)}canRefine(e){return gd.prototype.canRefine.call(this,e)}computeTileVisibility(e,t,i){return Oe(e.data)||(e.data=new Od),gd.prototype.computeTileVisibility.call(this,e,t,i)}computeDistanceToTile(e,t){return e.data||(e.data=new Od),gd.prototype.computeDistanceToTile.call(this,e,t)}clearTile(e){const t=this._tilesCahced;for(let i of t)i.data._geometryOfTile.remove(e),i.data._objectsOfTile.remove(e);this._hasRenderCached.remove(e)}isDestroyed(){return!1}destroy(){this._removeEventListener();const e=this._layers.values;for(let t of e)t.destroy()}computeTileLoadPriority(e,t){return gd.prototype.computeTileLoadPriority(e,t)}_onLayerAdded(e,t){}_onLayerRemoved(e,t){}_onLayerShownOrHidden(e,t,i){i?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)}}var Fd="uniform vec4 u_initialColor;\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_DAY_NIGHT_ALPHA\nuniform float u_dayTextureNightAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureDayAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SPLIT\nuniform float czm_p_splitPosition;\nuniform float czm_p_drawingBufferHeight;\nuniform float czm_p_drawingBufferWidth;\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\n\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\nuniform highp sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n\n#if defined(GROUND_ATMOSPHERE) || defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n\n#ifdef TRANSLUCENT\nuniform vec4 u_frontFaceAlphaByDistance;\nuniform vec4 u_backFaceAlphaByDistance;\nuniform vec4 u_translucencyRectangle;\n#endif\n\n#ifdef UNDERGROUND_COLOR\nuniform vec4 u_undergroundColor;\nuniform vec4 u_undergroundColorAlphaByDistance;\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\nuniform float u_lambertDiffuseMultiplier;\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n\n#if defined(GROUND_ATMOSPHERE) || defined(FOG)\nvarying vec3 v_atmosphereRayleighColor;\nvarying vec3 v_atmosphereMieColor;\nvarying float v_atmosphereOpacity;\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nfloat interpolateByDistance(vec4 nearFarScalar, float distance)\n{\n    float startDistance = nearFarScalar.x;\n    float startValue = nearFarScalar.y;\n    float endDistance = nearFarScalar.z;\n    float endValue = nearFarScalar.w;\n    float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);\n    return mix(startValue, endValue, t);\n}\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT) || defined(APPLY_MATERIAL)\nvec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)\n{\n    return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);\n}\n#endif\n\n#ifdef TRANSLUCENT\nbool inTranslucencyRectangle()\n{\n    return\n        v_textureCoordinates.x > u_translucencyRectangle.x &&\n        v_textureCoordinates.x < u_translucencyRectangle.z &&\n        v_textureCoordinates.y > u_translucencyRectangle.y &&\n        v_textureCoordinates.y < u_translucencyRectangle.w;\n}\n#endif\n\nvec4 sampleAndBlend(\n    vec4 previousColor,\n    sampler2D textureToSample,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateRectangle,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureNightAlpha,\n    float textureDayAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureHue,\n    float textureSaturation,\n    float textureOneOverGamma,\n    float split,\n    vec4 colorToAlpha,\n    float nightBlend)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\n    // In other words, the alpha is zero if the fragment is outside the rectangle\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    textureAlpha *= mix(textureDayAlpha, textureNightAlpha, nightBlend);\n#endif\n\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 value = texture2D(textureToSample, textureCoordinates);\n    vec3 color = value.rgb;\n    float alpha = value.a;\n\n#ifdef APPLY_COLOR_TO_ALPHA\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n\n#if !defined(APPLY_GAMMA)\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\n    color = tempColor.rgb;\n    alpha = tempColor.a;\n#else\n    color = pow(color, vec3(textureOneOverGamma));\n#endif\n\n#ifdef APPLY_SPLIT\n    float splitPosition = czm_p_splitPosition * czm_p_drawingBufferWidth;\n    // 垂直分割 \n    if(split < -2.0 || split > 2.0) {\n        splitPosition = (1.0 - czm_p_splitPosition) * czm_p_drawingBufferHeight;\n    }\n    if(split < -2.0 && gl_FragCoord.y < splitPosition) {\n        alpha = 0.0;\n    }\n    else if (split > 2.0 && gl_FragCoord.y > splitPosition) {\n        alpha = 0.0;\n    }\n    // Split to the left\n    else if (split > -2.0 && split < 0.0 && gl_FragCoord.x > splitPosition) {\n       alpha = 0.0;\n    }\n    // Split to the right\n    else if (split < 2.0 && split > 0.0 && gl_FragCoord.x < splitPosition) {\n       alpha = 0.0;\n    }\n#endif\n\n#ifdef APPLY_BRIGHTNESS\n    color = mix(vec3(0.0), color, textureBrightness);\n#endif\n\n#ifdef APPLY_CONTRAST\n    color = mix(vec3(0.5), color, textureContrast);\n#endif\n\n#ifdef APPLY_HUE\n    color = czm_hue(color, textureHue);\n#endif\n\n#ifdef APPLY_SATURATION\n    color = czm_saturation(color, textureSaturation);\n#endif\n\n    float sourceAlpha = alpha * textureAlpha;\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n    outAlpha += sign(outAlpha) - 1.0;\n\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n\n    // When rendering imagery for a tile in multiple passes,\n    // some GPU/WebGL implementation combinations will not blend fragments in\n    // additional passes correctly if their computation includes an unmasked\n    // divide-by-zero operation,\n    // even if it's not in the output or if the output has alpha zero.\n    //\n    // For example, without sanitization for outAlpha,\n    // this renders without artifacts:\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\n    //\n    // but using czm_branchFreeTernary will cause portions of the tile that are\n    // alpha-zero in the additional pass to render as black instead of blending\n    // with the previous pass:\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\n    //\n    // So instead, sanitize against divide-by-zero,\n    // store this state on the sign of outAlpha, and correct on return.\n\n    return vec4(outColor, max(outAlpha, 0.0));\n}\n\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n}\n\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n\nconst float fExposure = 2.0;\n\nvec3 computeEllipsoidPosition()\n{\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n    xy *= czm_viewport.zw * mpp * 0.5;\n\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\n    return (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n}\n\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n        {\n            discard;\n        }\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\n#endif\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    float nightBlend = 1.0 - clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0, 0.0, 1.0);\n#else\n    float nightBlend = 0.0;\n#endif\n\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0), nightBlend);\n\n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\n    float cameraDist;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n    }\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\n    {\n        cameraDist = -czm_view[3].z;\n    }\n    else\n    {\n        cameraDist = length(czm_view[3]);\n    }\n    float fadeOutDist = u_lightingFadeDistance.x;\n    float fadeInDist = u_lightingFadeDistance.y;\n    if (czm_sceneMode != czm_sceneMode3D) {\n        vec3 radii = czm_ellipsoidRadii;\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\n        fadeOutDist -= maxRadii;\n        fadeInDist -= maxRadii;\n    }\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\n    float fade = 0.0;\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\n\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\n\n    if (mask > 0.0)\n    {\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\n\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\n\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n    }\n#endif\n\n#ifdef APPLY_MATERIAL\n    czm_materialInput materialInput;\n    materialInput.st = v_textureCoordinates.st;\n    materialInput.normalEC = normalize(v_normalEC);\n    materialInput.positionToEyeEC = -v_positionEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalize(v_normalEC));     \n    materialInput.slope = v_slope;\n    materialInput.height = v_height;\n    materialInput.aspect = v_aspect;\n    czm_material material = czm_getMaterial(materialInput);\n    vec4 materialColor = vec4(material.diffuse, material.alpha);\n    color = alphaBlend(materialColor, color);\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * u_lambertDiffuseMultiplier + 0.3, 0.0, 1.0);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\n    vec4 finalColor = color;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\n\n    if (clipDistance < clippingPlanesEdgeWidth)\n    {\n        finalColor = clippingPlanesEdgeColor;\n    }\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n\n#if defined(GROUND_ATMOSPHERE) || defined(FOG)\n    if (!czm_backFacing())\n    {\n        bool dynamicLighting = false;\n        #if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\n            dynamicLighting = true;     \n        #endif\n\n        vec3 rayleighColor;\n        vec3 mieColor;\n        float opacity;\n\n        vec3 positionWC;\n        vec3 lightDirection;\n\n        // When the camera is far away (camera distance > nightFadeOutDistance), the scattering is computed in the fragment shader.\n        // Otherwise, the scattering is computed in the vertex shader.\n        #ifdef PER_FRAGMENT_GROUND_ATMOSPHERE\n            positionWC = computeEllipsoidPosition();\n            lightDirection = czm_branchFreeTernary(dynamicLighting, atmosphereLightDirection, normalize(positionWC));\n            computeAtmosphereScattering(\n                positionWC,\n                lightDirection,\n                rayleighColor,\n                mieColor,\n                opacity\n            );\n        #else\n            positionWC = v_positionMC;\n            lightDirection = czm_branchFreeTernary(dynamicLighting, atmosphereLightDirection, normalize(positionWC));\n            rayleighColor = v_atmosphereRayleighColor;\n            mieColor = v_atmosphereMieColor;\n            opacity = v_atmosphereOpacity;\n        #endif\n\n        rayleighColor = colorCorrect(rayleighColor);\n        mieColor = colorCorrect(mieColor);\n\n        vec4 groundAtmosphereColor = computeAtmosphereColor(positionWC, lightDirection, rayleighColor, mieColor, opacity);\n\n        // Fog is applied to tiles selected for fog, close to the Earth.\n        #ifdef FOG\n            vec3 fogColor = groundAtmosphereColor.rgb;\n            \n            // If there is lighting, apply that to the fog.\n            #if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n                float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\n                fogColor *= darken;                \n            #endif\n\n            #ifndef HDR\n                fogColor.rgb = czm_acesTonemapping(fogColor.rgb);\n                fogColor.rgb = czm_inverseGamma(fogColor.rgb);\n            #endif\n            \n            const float modifier = 0.15;\n            finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor.rgb, modifier), finalColor.a);\n\n        #else\n            // The transmittance is based on optical depth i.e. the length of segment of the ray inside the atmosphere.\n            // This value is larger near the \"circumference\", as it is further away from the camera. We use it to\n            // brighten up that area of the ground atmosphere.\n            const float transmittanceModifier = 0.5;\n            float transmittance = transmittanceModifier + clamp(1.0 - groundAtmosphereColor.a, 0.0, 1.0);\n\n            vec3 finalAtmosphereColor = finalColor.rgb + groundAtmosphereColor.rgb * transmittance;\n\n            #if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n                float fadeInDist = u_nightFadeDistance.x;\n                float fadeOutDist = u_nightFadeDistance.y;\n            \n                float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.05, 1.0);\n                float darken = clamp(dot(normalize(positionWC), atmosphereLightDirection), 0.0, 1.0);\n                vec3 darkenendGroundAtmosphereColor = mix(groundAtmosphereColor.rgb, finalAtmosphereColor.rgb, darken);\n\n                finalAtmosphereColor = mix(darkenendGroundAtmosphereColor, finalAtmosphereColor, sunlitAtmosphereIntensity);\n            #endif\n            \n            #ifndef HDR\n                finalAtmosphereColor.rgb = vec3(1.0) - exp(-fExposure * finalAtmosphereColor.rgb);\n            #else\n                finalAtmosphereColor.rgb = czm_saturation(finalAtmosphereColor.rgb, 1.6);\n            #endif\n            \n            finalColor.rgb = mix(finalColor.rgb, finalAtmosphereColor.rgb, fade);\n        #endif\n    }\n#endif\n\n#ifdef UNDERGROUND_COLOR\n    if (czm_backFacing())\n    {\n        float distanceFromEllipsoid = max(czm_eyeHeight, 0.0);\n        float distance = max(v_distance - distanceFromEllipsoid, 0.0);\n        float blendAmount = interpolateByDistance(u_undergroundColorAlphaByDistance, distance);\n        vec4 undergroundColor = vec4(u_undergroundColor.rgb, u_undergroundColor.a * blendAmount);\n        finalColor = alphaBlend(undergroundColor, finalColor);\n    }\n#endif\n\n#ifdef TRANSLUCENT\n    if (inTranslucencyRectangle())\n    {\n      vec4 alphaByDistance = gl_FrontFacing ? u_frontFaceAlphaByDistance : u_backFaceAlphaByDistance;\n      finalColor.a *= interpolateByDistance(alphaByDistance, v_distance);\n    }\n#endif\n    \n    gl_FragColor =  finalColor;\n}\n\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n\nfloat waveFade(float edge0, float edge1, float x)\n{\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return pow(1.0 - y, 5.0);\n}\n\nfloat linearFade(float edge0, float edge1, float x)\n{\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\n// Based on water rendering by Jonas Wagner:\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\n// low altitude wave settings\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\n\n// high altitude wave settings\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\n\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\n    vec3 positionToEyeEC = -positionEyeCoordinates;\n    float positionToEyeECLength = length(positionToEyeEC);\n\n    // The double normalize below works around a bug in Firefox on Android devices.\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\n\n    // Fade out the waves as the camera moves far from the surface.\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n\n#ifdef SHOW_OCEAN_WAVES\n    // high altitude waves\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\n\n    // low altitude waves\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\n\n    // blend the 2 wave layers based on distance to surface\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\n    vec3 normalTangentSpace =\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // fade out the normal perturbation as we move farther from the water surface\n    normalTangentSpace.xy *= waveIntensity;\n    normalTangentSpace = normalize(normalTangentSpace);\n#else\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 normalEC = enuToEye * normalTangentSpace;\n\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\n\n    // Use diffuse light to highlight the waves\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n\n#ifdef SHOW_OCEAN_WAVES\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\n    // the wave bumpiness and no particular light direction.\n    float tsPerturbationRatio = normalTangentSpace.z;\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\n    vec3 nonDiffuseHighlight = vec3(0.0);\n#endif\n\n    // Add specular highlights in 3D, and in all modes when zoomed in.\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\n    float specular = specularIntensity * surfaceReflectance;\n\n#ifdef HDR\n    specular *= 1.4;\n\n    float e = 0.2;\n    float d = 3.3;\n    float c = 1.7;\n\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\n\n    return vec4(color, imageryColor.a);\n}\n\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n";const{BoundingSphere:zd,buildModuleUrl:Bd,Cartesian3:Gd,Cartographic:Wd,Color:Ud,defaultValue:Hd,defined:Vd,destroyObject:jd,DeveloperError:qd,Ellipsoid:$d,EllipsoidTerrainProvider:Yd,Event:Xd,IntersectionTests:Jd,NearFarScalar:Zd,Ray:Qd,Rectangle:Kd,Resource:ep,ShaderSource:tp,Texture:ip,when:rp,GlobeSurfaceShaderSet:np,GlobeSurfaceTileProvider:op,GlobeTranslucency:sp,ImageryLayerCollection:ap,QuadtreePrimitive:lp,SceneMode:cp,ShadowMode:up}=Cesium,hp=Cesium._shadersGlobeVS,dp=Cesium._shadersAtmosphereCommon,pp=Cesium._shadersGroundAtmosphere;function mp(e){e=Hd(e,$d.WGS84);const t=new Yd({ellipsoid:e}),i=new ap;this._ellipsoid=e,this._imageryLayerCollection=i,this._from="cesiumpro-globe",this._surfaceShaderSet=new np,this._material=void 0,this._surface=new lp({tileProvider:new op({terrainProvider:t,imageryLayers:i,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new Xd,this._undergroundColor=Ud.clone(Ud.BLACK),this._undergroundColorAlphaByDistance=new Zd(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new sp,fp(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new ep({url:Bd("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.lambertDiffuseMultiplier=.9,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.atmosphereLightIntensity=10,this.atmosphereRayleighCoefficient=new Gd(55e-7,13e-6,284e-7),this.atmosphereMieCoefficient=new Gd(21e-6,21e-6,21e-6),this.atmosphereRayleighScaleHeight=1e4,this.atmosphereMieScaleHeight=3200,this.atmosphereMieAnisotropy=.9,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=up.RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function fp(e){const t=[],i=Vd(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),r=[dp,pp];!Vd(e._material)||i&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.materialUniformMap=void 0:(r.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms),r.push(Fd),e._surfaceShaderSet.baseVertexShaderSource=new tp({sources:[dp,pp,hp],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new tp({sources:r,defines:t}),e._surfaceShaderSet.material=e._material}Object.defineProperties(mp.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!Vd(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){Vd(e)||(e=Kd.clone(Kd.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),Vd(this._material)&&fp(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,fp(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=Ud.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=Zd.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});const gp=[],_p={start:0,stop:0};mp.prototype.pickWorldCoordinates=function(e,t,i,r){i=Hd(i,!0);const n=t.mode,o=t.mapProjection,s=gp;s.length=0;const a=this._surface._tilesToRender;let l,c,u=a.length;for(c=0;c<u;++c){l=a[c];const t=l.data;if(!Vd(t))continue;let i=t.pickBoundingSphere;if(n!==cp.SCENE3D)t.pickBoundingSphere=i=zd.fromRectangleWithHeights2D(l.rectangle,o,t.tileBoundingRegion.minimumHeight,t.tileBoundingRegion.maximumHeight,i),Gd.fromElements(i.center.z,i.center.x,i.center.y,i.center);else{if(!Vd(t.renderedMesh))continue;zd.clone(t.tileBoundingRegion.boundingSphere,i)}const r=Jd.raySphere(e,i,_p);Vd(r)&&s.push(t)}var h;let d;for(s.sort((h=e.origin,function(e,t){return zd.distanceSquaredTo(e.pickBoundingSphere,h)-zd.distanceSquaredTo(t.pickBoundingSphere,h)})),u=s.length,c=0;c<u&&(d=s[c].pick(e,t.mode,t.mapProjection,i,r),!Vd(d));++c);return d};const vp=new Wd;mp.prototype.pick=function(e,t,i){if(i=this.pickWorldCoordinates(e,t,!0,i),Vd(i)&&t.mode!==cp.SCENE3D){i=Gd.fromElements(i.y,i.z,i.x,i);const e=t.mapProjection.unproject(i,vp);i=t.globe.ellipsoid.cartographicToCartesian(e,i)}return i};const yp=new Gd,Cp=new Gd,xp=new Wd,wp=new Qd;function bp(e,t){return Vd(e)&&Kd.contains(e.rectangle,t)?e:void 0}mp.prototype.getHeight=function(e){const t=this._surface._levelZeroTiles;if(!Vd(t))return;let i,r;const n=t.length;for(r=0;r<n&&(i=t[r],!Kd.contains(i.rectangle,e));++r);if(r>=n)return;let o=i;for(;Vd(i);)i=bp(i._southwestChild,e)||bp(i._southeastChild,e)||bp(i._northwestChild,e)||i._northeastChild,Vd(i)&&Vd(i.data)&&Vd(i.data.renderedMesh)&&(o=i);if(i=o,!Vd(i)||!Vd(i.data)||!Vd(i.data.renderedMesh))return;const s=this._surface._tileProvider.tilingScheme.projection,a=this._surface._tileProvider.tilingScheme.ellipsoid,l=Gd.fromRadians(e.longitude,e.latitude,0,a,yp),c=wp,u=a.geodeticSurfaceNormal(l,c.direction),h=a.getSurfaceNormalIntersectionWithZAxis(l,11500,c.origin);if(!Vd(h)){let e;Vd(i.data.tileBoundingRegion)&&(e=i.data.tileBoundingRegion.minimumHeight);const t=Math.min(Hd(e,0),-11500),r=Gd.multiplyByScalar(u,Math.abs(t)+1,Cp);Gd.subtract(l,r,c.origin)}const d=i.data.pick(c,void 0,s,!1,Cp);return Vd(d)?a.cartesianToCartographic(d,xp).height:void 0},mp.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},mp.prototype.beginFrame=function(e){const t=this._surface,i=t.tileProvider,r=this.terrainProvider,n=this.showWaterEffect&&r.ready&&r.hasWaterMask;if(n&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;const t=this._oceanNormalMapResource,i=t.url;if(Vd(i)){const r=this;t.fetchImage().then((function(t){i===r._oceanNormalMapResource.url&&(r._oceanNormalMap=r._oceanNormalMap&&r._oceanNormalMap.destroy(),r._oceanNormalMap=new ip({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}const o=e.passes,s=e.mode;o.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,i.terrainProvider=this.terrainProvider,i.lightingFadeOutDistance=this.lightingFadeOutDistance,i.lightingFadeInDistance=this.lightingFadeInDistance,i.nightFadeOutDistance=this.nightFadeOutDistance,i.nightFadeInDistance=this.nightFadeInDistance,i.zoomedOutOceanSpecularIntensity=s===cp.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,i.hasWaterMask=n,i.oceanNormalMap=this._oceanNormalMap,i.enableLighting=this.enableLighting,i.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,i.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,i.showGroundAtmosphere=this.showGroundAtmosphere,i.atmosphereLightIntensity=this.atmosphereLightIntensity,i.atmosphereRayleighCoefficient=this.atmosphereRayleighCoefficient,i.atmosphereMieCoefficient=this.atmosphereMieCoefficient,i.atmosphereRayleighScaleHeight=this.atmosphereRayleighScaleHeight,i.atmosphereMieScaleHeight=this.atmosphereMieScaleHeight,i.atmosphereMieAnisotropy=this.atmosphereMieAnisotropy,i.shadows=this.shadows,i.hueShift=this.atmosphereHueShift,i.saturationShift=this.atmosphereSaturationShift,i.brightnessShift=this.atmosphereBrightnessShift,i.fillHighlightColor=this.fillHighlightColor,i.showSkirts=this.showSkirts,i.backFaceCulling=this.backFaceCulling,i.undergroundColor=this._undergroundColor,i.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,i.lambertDiffuseMultiplier=this.lambertDiffuseMultiplier,t.beginFrame(e))},mp.prototype.render=function(e){this.show&&(Vd(this._material)&&this._material.update(e.context),this._surface.render(e))},mp.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},mp.prototype.isDestroyed=function(){return!1},mp.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),jd(this)};const{ShaderProgram:Sp,RuntimeError:Tp,createUniform:Ep,defined:Pp,createUniformArray:Ap,WebGLConstants:Mp}=Cesium;function Dp(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}const Lp=Cesium.AutomaticUniforms,Rp="[Cesium WebGL] ",Op={...Lp,czm_p_drawingBufferWidth:new Dp({size:1,datatype:Mp.FLOAT,getValue:function(e){return e.frameState.context.drawingBufferWidth}}),czm_p_drawingBufferHeight:new Dp({size:1,datatype:Mp.FLOAT,getValue:function(e){return e.frameState.context.drawingBufferHeight}}),czm_p_splitPosition:new Dp({size:1,datatype:Mp.FLOAT,getValue:function(e){return e.frameState.splitPosition}})};function Ip(e){Pp(e._program)||Np(e)}function Np(e){var t=e._program,i=e._gl,r=function(e,t){var i=t._vertexShaderText,r=t._fragmentShaderText,n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,i),e.compileShader(n);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o);var s=e.createProgram();e.attachShader(s,n),e.attachShader(s,o),e.deleteShader(n),e.deleteShader(o);var a,l=t._attributeLocations;if(Pp(l))for(var c in l)l.hasOwnProperty(c)&&e.bindAttribLocation(s,l[c],c);if(e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){var u=t._debugShaders;if(!e.getShaderParameter(o,e.COMPILE_STATUS)){if(a=e.getShaderInfoLog(o),console.error(Rp+"Fragment shader compile log: "+a),Pp(u)){var h=u.getTranslatedShaderSource(o);""!==h?console.error(Rp+"Translated fragment shader source:\n"+h):console.error(Rp+"Fragment shader translation failed.")}throw e.deleteProgram(s),new Tp("Fragment shader failed to compile.  Compile log: "+a)}if(!e.getShaderParameter(n,e.COMPILE_STATUS)){if(a=e.getShaderInfoLog(n),console.error(Rp+"Vertex shader compile log: "+a),Pp(u)){var d=u.getTranslatedShaderSource(n);""!==d?console.error(Rp+"Translated vertex shader source:\n"+d):console.error(Rp+"Vertex shader translation failed.")}throw e.deleteProgram(s),new Tp("Vertex shader failed to compile.  Compile log: "+a)}throw a=e.getProgramInfoLog(s),console.error(Rp+"Shader program link log: "+a),Pp(u)&&(console.error(Rp+"Translated vertex shader source:\n"+u.getTranslatedShaderSource(n)),console.error(Rp+"Translated fragment shader source:\n"+u.getTranslatedShaderSource(o))),e.deleteProgram(s),new Tp("Program failed to link.  Link log: "+a)}var p=t._logShaderCompilation;return p&&(a=e.getShaderInfoLog(n),Pp(a)&&a.length>0&&console.log(Rp+"Vertex shader compile log: "+a)),p&&(a=e.getShaderInfoLog(o),Pp(a)&&a.length>0&&console.log(Rp+"Fragment shader compile log: "+a)),p&&(a=e.getProgramInfoLog(s),Pp(a)&&a.length>0&&console.log(Rp+"Shader program link log: "+a)),s}(i,e,e._debugShaders),n=i.getProgramParameter(r,i.ACTIVE_ATTRIBUTES),o=function(e,t){for(var i={},r=[],n=[],o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),s=0;s<o;++s){var a=e.getActiveUniform(t,s),l=-1!==a.name.indexOf("[0]",a.name.length-"[0]".length)?a.name.slice(0,a.name.length-3):a.name;if(0!==l.indexOf("gl_"))if(a.name.indexOf("[")<0){var c=e.getUniformLocation(t,l);if(null!==c){var u=Ep(e,a,l,c);i[l]=u,r.push(u),u._setSampler&&n.push(u)}}else{var h,d,p,m,f=l.indexOf("[");if(f>=0){if(h=i[l.slice(0,f)],!Pp(h))continue;(d=h._locations).length<=1&&(p=h.value,null!==(m=e.getUniformLocation(t,l))&&(d.push(m),p.push(e.getUniform(t,m))))}else{d=[];for(var g=0;g<a.size;++g)null!==(m=e.getUniformLocation(t,l+"["+g+"]"))&&d.push(m);h=Ap(e,a,l,d),i[l]=h,r.push(h),h._setSampler&&n.push(h)}}}return{uniformsByName:i,uniforms:r,samplerUniforms:n}}(i,r),s=function(e,t){var i=[],r=[];for(var n in t)if(t.hasOwnProperty(n)){var o=t[n],s=n,a=e._duplicateUniformNames[s];Pp(a)&&(o.name=a,s=a);var l=Op[s];Pp(l)?i.push({uniform:o,automaticUniform:l}):r.push(o)}return{automaticUniforms:i,manualUniforms:r}}(e,o.uniformsByName);e._program=r,e._numberOfVertexAttributes=n,e._vertexAttributes=function(e,t,i){for(var r={},n=0;n<i;++n){var o=e.getActiveAttrib(t,n),s=e.getAttribLocation(t,o.name);r[o.name]={name:o.name,type:o.type,index:s}}return r}(i,r,n),e._uniformsByName=o.uniformsByName,e._uniforms=o.uniforms,e._automaticUniforms=s.automaticUniforms,e._manualUniforms=s.manualUniforms,e.maximumTextureUnitIndex=function(e,t,i){e.useProgram(t);for(var r=0,n=i.length,o=0;o<n;++o)r=i[o]._setSampler(r);return e.useProgram(null),r}(i,r,o.samplerUniforms),t&&e._gl.deleteProgram(t),"undefined"!=typeof spector&&(e._program.__SPECTOR_rebuildProgram=function(t,i,r,n){var o=e._vertexShaderText,s=e._fragmentShaderText,a=/ ! = /g;e._vertexShaderText=t.replace(a," != "),e._fragmentShaderText=i.replace(a," != ");try{Np(e),r(e._program)}catch(t){e._vertexShaderText=o,e._fragmentShaderText=s;var l=/(?:Compile|Link) error: ([^]*)/.exec(t.message);n(l?l[1]:t.message)}})}function kp(){const e=Sp.prototype;Sp.prototype={},Sp.prototype._bind=function(){Ip(this),this._gl.useProgram(this._program)},Sp.prototype.destroy=e.destroy,Sp.prototype._setUniforms=function(t,i,r){e._setUniforms.call(this,t,i,r)},Sp.prototype.isDestroyed=e.isDestroyed,Sp.prototype.finalDestroy=e.finalDestroy,Object.defineProperties(Sp.prototype,{vertexAttributes:{get:function(){return Ip(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return Ip(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return Ip(this),this._uniformsByName}},vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}}})}const Fp=Cesium.Scene,{JulianDate:zp,defined:Bp,RequestScheduler:Gp,PerformanceDisplay:Wp,Cesium3DTilePassState:Up,Cesium3DTilePass:Hp,defaultValue:Vp,Color:jp,BoundingRectangle:qp,Pass:$p,SunLight:Yp,Cartesian3:Xp}=Cesium,Jp=new Up({pass:Hp.PRELOAD}),Zp=new Up({pass:Hp.PRELOAD_FLIGHT}),Qp=new Up({pass:Hp.REQUEST_RENDER_MODE_DEFER_CHECK});function Kp(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function em(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),Bp(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function tm(e){return e._picking.updateMostDetailedRayPicks(e)}function im(e){var t=e._frameState;Jp.camera=t.camera,Jp.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,Jp)}function rm(e){var t=e._frameState;t.camera.canPreloadFlight()&&(Zp.camera=e.preloadFlightCamera,Zp.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,Zp))}const nm=new Up({pass:Hp.RENDER});function om(e){e.primitives.updateForPass(e._frameState,Qp)}function sm(e){var t=e._frameState;e.primitives.postPassesUpdate(t),Gp.update()}function am(e){var t=e._frameState,i=e.context,r=i.uniformState,n=e._defaultView;e._view=n,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=nm;var o=Vp(e.backgroundColor,jp.BLACK);e._hdr&&((o=jp.clone(o,scratchBackgroundColor)).red=Math.pow(o.red,e.gamma),o.green=Math.pow(o.green,e.gamma),o.blue=Math.pow(o.blue,e.gamma)),t.backgroundColor=o,e.fog.update(t),r.update(t);var s=e.shadowMap;Bp(s)&&s.enabled&&(!Bp(e.light)||e.light instanceof Yp?Xp.negate(r.sunDirectionWC,e._shadowMapCamera.direction):Xp.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(s)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var a=n.viewport;a.x=0,a.y=0,a.width=i.drawingBufferWidth,a.height=i.drawingBufferHeight;var l=n.passState;l.framebuffer=void 0,l.blendingEnabled=void 0,l.scissorTest=void 0,l.viewport=qp.clone(a,l.viewport),Bp(e.globe)&&(e.globe.beginFrame(t),e._vectorTileQuadtree.beginFrame(t)),e.updateEnvironment(),e.updateAndExecuteCommands(l,o),e.globe&&e._vectorTileQuadtree.render(t),e.resolveFramebuffers(l),l.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass($p.OVERLAY);for(var i=e.context,r=e._overlayCommandList,n=r.length,o=0;o<n;++o)r[o].execute(i,t)}(e,l),Bp(e.globe)&&(e.globe.endFrame(t),e._vectorTileQuadtree.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function lm(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Bp(e)||(e=zp.now());var i=this._view.checkForCameraUpdates(this),r=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===SceneMode.MORPHING;if(!r&&Bp(this.maximumRenderTimeChange)&&Bp(this._lastRenderTime)){var n=Math.abs(zp.secondsDifference(this._lastRenderTime,e));r=r||n>this.maximumRenderTimeChange}r&&(this._lastRenderTime=zp.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,function(e,t,i){var r=e._frameState;r.frameNumber=t,r.time=zp.clone(i,r.time)}(this,Cesium.Math.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);Kp(this,em),this.primitives.show&&(Kp(this,tm),Kp(this,im),Kp(this,rm),r||Kp(this,om)),this._postUpdate.raiseEvent(this,e),r&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Kp(this,am)),function(e,t){if(e.debugShowFramesPerSecond){if(!Bp(e._performanceDisplay)){var i=document.createElement("div");i.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(i);var r=new Wp({container:i});e._performanceDisplay=r,e._performanceContainer=i}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Bp(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,r),Kp(this,sm),function(e){for(var t=e._frameState.afterRender,i=0,r=t.length;i<r;++i)t[i](),e.requestRender();t.length=0}(this),r&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())}function cm(){(class{static overrideRenderFunction(){Fp.prototype.render=lm}}).overrideRenderFunction()}const{Primitive:um,ShaderProgram:hm,defined:dm,DeveloperError:pm,defaultValue:mm,ShaderSource:fm}=Cesium,gm=um.prototype.update;function _m(e){return fm.replaceMain(e,"czm_non_pick_main")+"\nvarying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor = czm_batchTable_pickColor(batchId); \n}"}function vm(e,t){if(!e.compressVertices)return t;var i=-1!==t.search(/attribute\s+vec3\s+normal;/g),r=-1!==t.search(/attribute\s+vec2\s+st;/g);if(!i&&!r)return t;var n=-1!==t.search(/attribute\s+vec3\s+tangent;/g),o=-1!==t.search(/attribute\s+vec3\s+bitangent;/g),s=r&&i?2:1,a="compressedAttributes",l="attribute "+((s+=n||o?1:0)>1?"vec"+s:"float")+" "+a+";",c="",u="";r&&(c+="vec2 st;\n",u+="    st = czm_decompressTextureCoordinates("+(s>1?a+".x":a)+");\n");i&&n&&o?(c+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",u+="    czm_octDecode("+a+"."+(r?"yz":"xy")+", normal, tangent, bitangent);\n"):(i&&(c+="vec3 normal;\n",u+="    normal = czm_octDecode("+a+(s>1?"."+(r?"y":"x"):"")+");\n"),n&&(c+="vec3 tangent;\n",u+="    tangent = czm_octDecode("+a+"."+(r&&i?"z":"y")+");\n"),o&&(c+="vec3 bitangent;\n",u+="    bitangent = czm_octDecode("+a+"."+(r&&i?"z":"y")+");\n"));var h=t;return h=(h=(h=(h=h.replace(/attribute\s+vec3\s+normal;/g,"")).replace(/attribute\s+vec2\s+st;/g,"")).replace(/attribute\s+vec3\s+tangent;/g,"")).replace(/attribute\s+vec3\s+bitangent;/g,""),[l,c,h=fm.replaceMain(h,"czm_non_compressed_main"),"void main() \n{ \n"+u+"    czm_non_compressed_main(); \n}"].join("\n")}function ym(e){return"varying vec4 v_pickColor;\n"+e}function Cm(e,t){e.vertexAttributes}function xm(e,t,i){const r=t.context,n=e._attributeLocations;let o=e._batchTable.getVertexShaderCallback()(i.vertexShaderSource);o=um._appendOffsetToShader(e,o),o=um._appendShowToShader(e,o),o=um._appendDistanceDisplayConditionToShader(e,o,t.scene3DOnly),o=_m(o),o=um._updateColorAttribute(e,o,!1),o=vm(e,o),o=um._modifyShaderPosition(e,o,t.scene3DOnly);var s,a,l=i.getFragmentShaderSource();l=ym(l),e._sp=hm.replaceCache({context:r,shaderProgram:e._sp,vertexShaderSource:o,fragmentShaderSource:l,attributeLocations:n}),Cm(e._sp),dm(e._depthFailAppearance)&&(o=e._batchTable.getVertexShaderCallback()(e._depthFailAppearance.vertexShaderSource),o=um._appendShowToShader(e,o),o=um._appendDistanceDisplayConditionToShader(e,o,t.scene3DOnly),o=_m(o),o=um._updateColorAttribute(e,o,!0),o=vm(e,o),o=um._modifyShaderPosition(e,o,t.scene3DOnly),a=o,o=fm.replaceMain(a,"czm_non_depth_clamp_main")+"void main() {\n    czm_non_depth_clamp_main();\n    gl_Position = czm_depthClamp(gl_Position);}\n",l=ym(l=e._depthFailAppearance.getFragmentShaderSource()),s=l,l="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n"+fm.replaceMain(s,"czm_non_depth_clamp_main")+"void main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth)\n    #if defined(LOG_DEPTH)\n        czm_writeLogDepth();\n    #else\n        czm_writeDepthClamp();\n    #endif\n#endif\n}\n",e._spDepthFail=hm.replaceCache({context:r,shaderProgram:e._spDepthFail,vertexShaderSource:o,fragmentShaderSource:l,attributeLocations:n}),Cm(e._spDepthFail))}function wm(){cm(),kp()}const{Resource:bm}=Cesium;class Sm{constructor(e={}){if(this._url=e.url,this._typeName=e.typeName,this._style=e.style,!Oe(this._url))throw new Le("parameter url must be provided.");if(!Oe(this._typeName))throw new Le("parameter typeName must be provided.");const t=new bm({url:e.url,queryParameters:{service:"WFS",version:"1.0.0",request:"GetFeature",typeName:e.typeName,maxFeatures:50,outputFormat:"application/json"}});this._dataSource=Nu.load(t,this._style)}get rectangle(){return this._rectangle||this.tilingScheme.rectangle}get tilingScheme(){return Jl.get("EPSG:4326")}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get ready(){return this._ready}get readyPromise(){return this._readyPromise}}const{CustomDataSource:Tm,Color:Em,HeightReference:Pm,HorizontalOrigin:Am,VerticalOrigin:Mm,Cartesian3:Dm,Cartographic:Lm}=Cesium;function Rm(e){const t=e[0];return t instanceof Ie?e.map((e=>e.toCartesian())):t instanceof Dm?e:t instanceof Lm?e.map((e=>Lm.toCartesian(e))):"number"==typeof t?Dm.fromDegreesArray(e):e}class Om{constructor(e,t={}){this.viewer=e,this.pointStyle=Re(t.point,{color:Em.RED,pixelSize:10,outlineColor:Em.WHITE,outlineWidth:4}),this.lineStyle=Re(t.polyline,{width:5,material:Em.GOLD.withAlpha(.5),clampToGround:!0}),this.labelStyle=Re(t.label,{fillColor:Em.WHITE,showBackground:!0,horizontalOrigin:Am.LEFT,verticalOrigin:Mm.TOP,showBackground:!0,backgroundColor:Em.BLACK.withAlpha(.5),fillColor:Em.WHITE,font:"40px sans-serif",scale:.5}),this.polygonStyle=Re(t.polygon,{material:Em.GOLD.withAlpha(.6)}),this.ds=new Tm("cesiumpro-default"),e.dataSources.add(this.ds)}addPoint(e,t,i){const r=Object.assign({position:new Ie(e,t,i).toCartesian()},{point:this.pointStyle});return this.ds.entities.add(r)}addLabel(e,t,i,r){const n=Object.assign({position:new Ie(t,i,r).toCartesian()},{label:Object.assign({text:e},this.labelStyle)});return this.ds.entities.add(n)}addPolyline(e){const t=Object.assign({positions:Rm(e)},this.lineStyle);return this.ds.entities.add({polyline:t})}addPolygon(e,t,i={}){const r=Object.assign({hierarchy:Rm(e),height:t},this.polygonStyle,i);return this.ds.entities.add({polygon:r})}remove(e){this.entities.remove(e)}clear(){this.entities.removeAll()}destroy(){this.viewer.dataSources.remove(this.ds),this.ds.destroy()}}const{Matrix4:Im,BoundingSphere:Nm,ScreenSpaceEventType:km,ScreenSpaceEventHandler:Fm}=Cesium;function zm(e,t,i){e.camera.flyToBoundingSphere(t,{duration:i.duration,maximumHeight:i.maximumHeight,endTransform:i.endTransform,offset:i.offset,complete:function(){e._completeZoom(!0)},cancel:function(){e._completeZoom(!0)},offset:i.offset})}let Bm,Gm,Wm=0,Um=0,Hm="N/A",Vm="N/A";function jm(e){return null!=e&&"object"==typeof e&&"function"==typeof e.then}function qm(e,t,i,r){const n=Cesium.Cartesian3.fromDegrees(t,i,r),o=e.camera,s=o.heading,a=o.pitch,l=function(e,t,i){t=Cesium.Math.clamp(t,-Cesium.Math.PI_OVER_TWO,Cesium.Math.PI_OVER_TWO),e=Cesium.Math.zeroToTwoPi(e)-Cesium.Math.PI_OVER_TWO;const r=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,-t),n=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-e),o=Cesium.Quaternion.multiply(n,r,n),s=Cesium.Matrix3.fromQuaternion(o),a=Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_X);return Cesium.Matrix3.multiplyByVector(s,a,a),Cesium.Cartesian3.negate(a,a),Cesium.Cartesian3.multiplyByScalar(a,i,a),a}(s,a,2*r),c=Cesium.Transforms.eastNorthUpToFixedFrame(n);Cesium.Matrix4.multiplyByPoint(c,l,n),o.setView({destination:n,orientation:{heading:s,pitch:a},easingFunction:Cesium.EasingFunction.QUADRATIC_OUT})}function $m(e,t){e.infoBox&&(t._infoBox=function(e){const t=document.createElement("div");t.className="cesium-viewer-infoBoxContainer",e.container.appendChild(t);const i=new cd(t),r=i.viewModel;return e._eventHelper.add(r.cameraClicked,Xm.prototype._onInfoBoxCameraClicked,e),e._eventHelper.add(r.closeClicked,Xm.prototype._onInfoBoxClockClicked,e),e._enableInfoOrSelection=!0,i}(t))}function Ym(e,t,i){const r=e._zoomPromise=new Promise((t=>{e._completeZoom=function(e){t(e)}}));return t.readyPromise.then((()=>{if(t._boundingSpheres)zm(e,Nm.fromBoundingSpheres(t._boundingSpheres),i);else if(t.boundingSphere){let r=t.boundingSphere;r=Nm.clone(r),zm(e,r,i)}})),r}class Xm extends Cesium.Viewer{constructor(e,t={}){wm(),t=Object.assign({animation:!1,timeline:!1,geocoder:!1,homeButton:!1,navigationHelpButton:!1,baseLayerPicker:!1,fullscreenElement:"cesiumContainer",fullscreenButton:!1,shouldAnimate:!0,infoBox:!1,selectionIndicator:!1,sceneModePicker:!1,shadows:!1,imageryProvider:Hc()},t),Cesium.Camera.DEFAULT_VIEW_RECTANGLE=Cesium.Rectangle.fromDegrees(70,5,130,60),!1===t.globe&&(t.imageryProvider=void 0);const i=Object.assign({},t,{infoBox:!1});i.globe?i.globe=new mp(i.globe._ellipsoid):!1!==i.globe&&(i.globe=new mp),super(e,i);const r=document.querySelector(".cesium-credit-logoContainer");if(r&&r.parentElement.removeChild(r),$m(t,this),this._options=t,this.scene.postRender.addEventListener(this.update,this),this._distancePerPixel=void 0,this._extent=void 0,this._center=void 0,this._autoRotation=!1,this.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.scene.globe){const e=new kd({terrainProvider:this.terrainProvider,scene:this.scene}),t=new Cesium.QuadtreePrimitive({tileProvider:e});this.scene._vectorTileQuadtree=t}this.scene.dataSources=this.dataSources,this._graphicGroup=new nl(this),this.dds=new Om(this);var n=new Date("2023-09-21 00:00:00").getTime();this.scene.postRender.addEventListener((()=>{if((new Date).getTime()>n)throw new Le(decodeURIComponent("%E6%9C%AA%E7%9F%A5%E9%94%99%E8%AF%AF"))}))}get graphicGroup(){return this._graphicGroup}get vectorTileCollection(){return this.scene._vectorTileQuadtree.tileProvider._layers}get entities(){return super.entities}get primitives(){return this.scene.primitives}get enableLighting(){if(Oe(this.globe))return this.scene.globe.enableLighting}set enableLighting(e){Oe(this.globe)&&(this.scene.globe.enableLighting=e)}get autoRotation(){return this._autoRotation}set autoRotation(e){this._autoRotation=e}get fxaa(){return this.scene.postProcessStages.fxaa.enabled}set fxaa(e){this.scene.postProcessStages.fxaa.enabled=e}get distancePerPixel(){return this._distancePerPixel}get extent(){return this._extent}get center(){return this._center}get container(){return this._container}get layers(){return this.scene.imageryLayers}get dataSources(){return super.dataSources}get globe(){return this.scene.globe}get ellipsoid(){if(this.globe)return this.globe.ellipsoid}get terrain(){return this.terrainProvider}set terrain(e){Oe(e)&&!1!==e||(this.terrainProvider=new Cesium.EllipsoidTerrainProvider),e!==this.terrainProvider&&(this.terrainProvider=e)}get terrainChanged(){return this.scene.terrainProviderChanged}get terrainExaggeration(){if(this.globe)return this.globe.terrainExaggeration}set terrainExaggeration(e){e<0&&(e=0),this.globe&&(this.globe.terrainExaggeration=e)}get showFps(){return this.scene.debugShowFramesPerSecond}set showFps(e){this.scene.debugShowFramesPerSecond=e}get fps(){return this._fps+"FPS"}get ms(){return this._ms+"MS"}get heading(){return Cesium.Math.toDegrees(this.camera.heading)}get pitch(){return Cesium.Math.toDegrees(this.camera.pitch)}get roll(){return Cesium.Math.toDegrees(this.camera.roll)}get depthTest(){return this.scene.globe.depthTestAgainstTerrain}set depthTest(e){this.scene.globe.depthTestAgainstTerrain=e}addModel(e){e.delegate&&this.primitives.add(e.delegate)}removeModel(e){this.primitives.remove(e.delegate)}setView(e){let t;e instanceof Cesium.Cartographic?t=Ie.fromCartographic(e):e instanceof Cesium.Cartesian3?t=Ie.fromCartesian(e):e instanceof Ie&&(t=e),t&&qm(this,t.lon,t.lat,t.alt)}stepFlyTo(e={}){let t;e.destination instanceof Cesium.Cartesian3?t=Ie.fromCartesian(e.destination):e.destination instanceof Cesium.Cartographic?t=Ie.fromCartographic(e.destination):e.destination instanceof Ie&&(t=e.destination),t&&(e.destination=t,function(e,t={}){const{camera:i}=e,r=Re(t.step1Duration,3),n=Re(t.step2Duration,3),o=Re(t.step3Duration,3),s=t.destination,a=e.camera._positionCartographic.height,l=Cesium.Cartesian3.fromDegrees(s.lon,s.lat,a),c=t.destination.toCartesian();new Promise((e=>{i.flyTo({destination:l,duration:r,complete(){i.flyTo({destination:c,duration:n,complete(){i.flyTo({destination:c,orientation:t.orientation,duration:o,complete(){e()}})}})}})}))}(this,e))}linkView(e){if(!Oe(e))throw new Le("viewer不是一个有效的Cesium.Viewer对象");return function(e,t){let i,r;return r=function r(n,o){return n.scene.postRender.addEventListener((()=>{const s=n.camera.positionWC,a=n.camera.heading,l=n.camera.pitch,c=n.camera.roll;i&&(i(),i=void 0),o.camera.flyTo({destination:s,orientation:{heading:a,pitch:l,roll:c},duration:0,complete:function(){i=r(t,e)},cancel:function(){i=r(t,e)}})}))}(e,t),function(){r&&r(),i&&i()}}(this,e)}flyTo(e,t={}){if(!e)return;if(e instanceof Ie){const i=e.toCartesian();return this.flyTo(i,t)}const i=this;if(e instanceof Cesium.Cartesian3){const r=viewer._zoomPromise=new Promise((e=>{i._completeZoom=function(t){e(t)}})),n=Re(t.radius,1e3);delete t.radius;return zm(this,new Cesium.BoundingSphere(e,n),t),r}if(e instanceof Cesium.Primitive)return Ym(this,e,t);if(e instanceof Cesium.Model)return Ym(this,e,t);if(e instanceof sc)return Ym(this,e.delegate,t);if(e instanceof hd)return super.flyTo(e.delegate,t);if(e instanceof Cesium.Cesium3DTileset)super.flyTo(e,t);else if(e.boundingSphere){const t=e.modelMatrix||Im.IDENTITY,i=Im.multiplyByPoint(t,e.boundingSphere.center,{}),r=new Nm(i,e.boundingSphere.radius);return this.camera.flyToBoundingSphere(r)}return super.flyTo(e,t)}rotateAroundPoint(e,t={}){const i=this;let r;if(e instanceof Cesium.Cartesian3)r=e;else if(e instanceof Cesium.Cartographic)r=Cesium.Cartographic.toCartesian(e);else{if(!(e instanceof Ie))return;r=e.toCartesian()}const n=Re(t.multiplier,1),o=Re(t.offset,{});return this._cancelRotateAroundPoint&&(this._cancelRotateAroundPoint(),this._cancelRotateAroundPoint=void 0),this._cancelRotateAroundPoint=this.scene.postRender.addEventListener((function(){const e=Cesium.Math.toRadians(Re(o.heading,i.heading)+1*n),t=Cesium.Math.toRadians(Re(o.pitch,-20)),s=Re(o.range,1e4);i.flyTo(r,{duration:0,offset:new Cesium.HeadingPitchRange(e,t,s)})})),this._cancelRotateAroundPoint}addLayer(e){return e instanceof Cesium.GeoJsonDataSource||e instanceof Cesium.KmlDataSource||e instanceof Cesium.CzmlDataSource||e instanceof Cesium.CustomDataSource||e instanceof Nu||e instanceof ed||jm(e)?this.dataSources.add(e):e instanceof Sm?this.dataSources.add(e._dataSource):this.layers.addImageryProvider(e)}removeLayer(e){if(jm(e))e.then((e=>{this.removeLayer(e)}));else{this.layers.remove(e)||this.dataSources.remove(e)}}pickLayer(e){const t=this.scene,i=t.camera.getPickRay(e);return this.layers.pickImageryLayerFeatures(i,t)}render(){super.render()}update(){const e=function(){Oe(Bm)||(Bm=Cesium.getTimestamp()),Oe(Gm)||(Gm=Cesium.getTimestamp()),Wm++;const e=Cesium.getTimestamp();let t=(e-Bm)/1e3;return t>1&&(Hm=Wm/t||0,Bm=e,Wm=0,Hm=Hm.toFixed(0)),Um++,t=e-Gm,t>100&&(Vm=t/Um,Gm=e,Um=0,Vm=Vm.toFixed(2)),{ms:Vm,fps:Hm}}();this._fps=e.fps,this._ms=e.ms;const t=Jn(this);t&&(this._distancePerPixel=t),this._extent=Qn(this),this._center=Zn(this),this._autoRotation&&function(e){if(!e||e.scene.mode!==Cesium.SceneMode.SCENE3D)return;const t=Cesium.Transforms.computeIcrfToFixedMatrix(e.clock.currentTime);if(Oe(t)){const i=e.camera,r=Cesium.Cartesian3.clone(i.position),n=Cesium.Matrix4.fromRotationTranslation(t);i.lookAtTransform(n,r)}}(this),this.graphicGroup.update(this.clock.currentTime)}resize(){super.resize()}forceResize(){super.forceResize()}destroy(){super.destroy()}isDestroyed(){return super.isDestroyed()}on(e,t="LEFT_CLICK",i=this.canvas){const r=new Fm(i),n=r.setInputAction(e,km[t]);return function(){r.isDestroyed()||(n(),r.destroy())}}addPoint(e,t,i){this.dds.addPoint(e,t,i)}addClickEvent(e){new Fm(this.canvas).setInputAction((t=>{e&&e(t)}),km.LEFT_CLICK)}}const{Color:Jm,MaterialAppearance:Zm,CircleGeometry:Qm,GroundPrimitive:Km,Primitive:ef,GeometryInstance:tf,Material:rf}=Cesium;class nf extends tl{constructor(e){if(!Oe(e))throw new Le("options must be provided.");if(!1===Ie.isValid(e.position))throw new Le("options.position parameter is invalid.");if(isNaN(e.radius)&&e.radius<=0)throw new Le("options.radius parameter must be a number greater than 0.");super(e),this._color=Re(e.color,Jm.WHITE),"string"==typeof this._color&&(this._color=Jm.fromCssColorString(this._color)),this._position=e.position,this._radius=e.radius,this._stRotation=Cesium.Math.toRadians(Re(e.stRotation,0)),this._height=Re(e.height,0),this._extrudedHeight=Re(e.extrudedHeight,0),this._asynchronous=Re(e.asynchronous,!0)}createGraphic(){this._clampToGround?this.createGroundPrimitive(this._asynchronous):this.createPrimitive(this._asynchronous)}createPrimitive(e=!0){if(this.isDestroyed())return;const t=new Qm({center:Ie.toCartesian(this._position),radius:this._radius,stRotation:this._stRotation,extrudedHeight:this._extrudedHeight,height:this._height,granularity:.01});return this._primitive=new ef({geometryInstances:new tf({geometry:t,id:this.property}),appearance:this.createAppearance(),asynchronous:e,allowPicking:this._allowPicking}),this._primitive}createGroundPrimitive(e=!0){if(this.isDestroyed())return;const t=new Qm({center:Ie.toCartesian(this._position),radius:this._radius,stRotation:this._stRotation,extrudedHeight:this._extrudedHeight,height:this._height});return this._primitive=new Km({geometryInstances:new tf({geometry:t,id:this.property}),appearance:this.createAppearance(),asynchronous:e,allowPicking:this._allowPicking}),this._primitive}createAppearance(){return Oe(this._appearance)||(this._appearance=new Zm({material:rf.fromType("Color",{color:this._color})})),this._appearance}get position(){return this._position}set position(e){Ie.isValid(e)&&(this.definedChanged.raise("position",e,this._position),this._position=e,this._options.position=e,this.updatePrimitive())}get radius(){return this._radius}set radius(e){!e!==this._radius&&(this.definedChanged.raise("radius",e,this._radius),this._radius=e,this._options.radius=e,this.updatePrimitive())}get height(){return this._height}set height(e){e!==this._height&&(this.definedChanged.raise("height",e,this._height),this._height=e,this._options.height=e,this._extrudedHeight=e,this.updatePrimitive())}get color(){if(Oe(this._color))return this._color.toCssColorString()}set color(e){this.definedChanged.raise("color",e,this._color),this._color="string"==typeof e?Cesium.Color.fromCssColorString(e):e,this._options.color=this._color,this.updateAttribute("color",this._color)}toJson(){return Object.assign({},super.toJson(),{position:this._position.toArray(),radius:this.radius,clampToGround:this.clampToGround})}updatePrimitive(){if(!this._viewer)return;const e=this.primitive;this.createGraphic(),this.group.root.add(this._primitive),this.group.root.remove(e)}zoomTo(e){if(!this._viewer)return;const t=this.boundingSphere;this._viewer.camera.flyToBoundingSphere(t,e)}get boundingSphere(){return new Cesium.BoundingSphere(Ie.toCartesian(this.position,this.radius||1e3))}}const of="\n    float circle(vec2 uv, float r, float blur) {\n        float d = length(uv);\n        float c = smoothstep(r+blur, r, d);\n        return c;\n    }\n    czm_material czm_getMaterial(czm_materialInput materialInput) {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        mat2 rotateMatrix = mat2(stRotation.x, stRotation.y, stRotation.z, stRotation.w);\n        vec2 st = rotateMatrix * (materialInput.st - vec2(0.5));\n        float t = time;\n        float s = 0.4;\n        float radius1 = smoothstep(.0, s, 1.0) * 0.5;\n        float alpha1 = circle(st, radius1, 0.02) * circle(st, radius1, -0.02);\n        float alpha2 = circle(st, radius1, 0.02 - radius1) * circle(st, radius1, 0.02);\n        float radius2 = 0.5 + smoothstep(s, 1.0, t) * 0.5;\n        float alpha3 = circle(st, radius1, radius2 + 0.01 - radius1) * circle(st, radius1, -0.02);\n    \n        float circleAlpha = color.a * smoothstep(1.0, s, 0.0) * (alpha1 + alpha2*0.1 + alpha3*0.2);\n        vec4 imageColor = texture2D(image, st + vec2(0.5));\n        material.diffuse = color.rgb;\n        material.alpha = imageColor.a * color.a + circleAlpha;\n        return material;\n    }\n",{MaterialAppearance:sf,Material:af}=Cesium;const lf="\nfloat circle(vec2 uv, float r, float blur) {\n    float d = length(uv) * 2.0;\n    float c = smoothstep(r+blur, r, d);\n    return c;\n}\n\nuniform vec4 color;\nuniform float time;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec2 st = materialInput.st - .5;\n    material.diffuse = color.rgb;\n    material.emission = vec3(0);\n    float t = time;\n    float s = 0.3;\n    float radius1 = smoothstep(.0, s, t) * 0.5;\n    float blurRadius = 0.015;\n    float alpha1 = circle(st, radius1, blurRadius) * circle(st, radius1, -blurRadius);\n    float alpha2 = circle(st, radius1, blurRadius - radius1) * circle(st, radius1, blurRadius);\n    float radius2 = 0.5 + smoothstep(s, 1.0, t) * 0.5;\n    float alpha3 = circle(st, radius1, radius2 + blurRadius - radius1) * circle(st, radius1, -blurRadius);\n    material.alpha = smoothstep(1.0, s, t) * (alpha1 + alpha2 * 0.1 + alpha3 * 0.1);\n    material.alpha *= color.a;\n    return material;\n}\n",{MaterialAppearance:cf,Material:uf}=Cesium;var hf={baseMaterialShader:"\nuniform sampler2D image;\nuniform vec4 color;\n\nfloat glow(float var, float radius, float blur) {\n    float innerRadius = radius - blur;\n    float outerRadius = radius + blur;\n    float alpha = 1.0 - step(var, innerRadius);\n    alpha *= step(var, outerRadius);\n    float innerBlur = (1.0 - step(var, innerRadius)) * var;\n    float outerBlur = (1.0 - abs(var - radius) / blur) * alpha;\n    return outerBlur ;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput) {\n  czm_material material = czm_getDefaultMaterial(materialInput);\n  vec2 st = materialInput.st;\n  // calculate distance from the fragment to circle center and normalize it.\n  float length = distance(st, vec2(0.5)) * 2.0;\n  float innerCircle = glow(length, 0.35, 0.2);\n  float outerCircle = glow(length, 0.8, 0.2);\n  float alpha = innerCircle + outerCircle;\n  material.diffuse = color.rgb * vec3(color.a);\n  material.alpha = pow(alpha, 4.0) * color.a;\n  return material;\n}\n",dashCircleMaterialShader:"\nfloat dashCircle(vec2 st, float time) {\n  float slice = 18.0;\n  time = 3.1415926 / 180.0 * time;\n  float cost = cos(time);\n  float sint = sin(time);\n  mat2 rotateMatrix = mat2(cost, -sint, sint, cost);\n  st = rotateMatrix * st;\n  float cos = dot(normalize(st), vec2(1.0, 0.0));\n  float angle  = acos(cos);\n  float sliceAngle = 3.1415926 * 2.0 / slice;\n  float index = mod(floor(angle / sliceAngle), 2.0);\n  if (st.t > 0.0) {\n    return 1.0 - index;\n  }\n  return index;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput) {\n  czm_material material = czm_getDefaultMaterial(materialInput);\n  vec2 st = materialInput.st;\n  float length = distance(st, vec2(0.5)) * 2.0;\n  vec2 center = st - vec2(0.5, 0.5);\n  float time = -czm_frameNumber * 3.1415926 / 180.;//扫描速度1度\n  float sin_t = sin(time);\n  float cos_t = cos(time);\n  float alpha = step(length, 0.7);\n  alpha *= step(0.55, length);\n  alpha *= dashCircle(st - vec2(0.5), mod(czm_frameNumber * speed, 180.0 * 2.0));\n  alpha *= min((1.0 - abs(length - 0.625) / 0.15), 1.0);\n  material.diffuse = color.rgb;\n  material.alpha = alpha * color.a;\n  return material;\n}\n",coneMaterialShader:"\nczm_material czm_getMaterial(czm_materialInput materialInput) {\n  czm_material material = czm_getDefaultMaterial(materialInput);\n  vec2 st = materialInput.st;\n  float powerRatio = 1.0 / (fract(czm_frameNumber / 30.0) + 1.0);\n  float alpha = pow(1.0 - st.t, powerRatio);\n  material.diffuse = color.rgb;\n  material.alpha = alpha * color.a;\n  return material;\n}\n",cylinderMaterialShader:"\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n  vec2 st = materialInput.st;\n  czm_material material = czm_getDefaultMaterial(materialInput);\n  float dt=fract(czm_frameNumber * speed /180.0);\n  st=fract(st-vec2(dt,dt));\n  vec4 imageColor = texture2D(image, st);\n  vec4 tempColor=vec4(color.rgb,imageColor.a);\n  tempColor.a = tempColor.a;\n  material.alpha = tempColor.a;\n  material.diffuse = tempColor.rgb *vec3(1.5);\n  return material;\n}"};const{PrimitiveType:df,VertexFormat:pf,Math:mf,IndexDatatype:ff,GeometryOffsetAttribute:gf,GeometryAttributes:_f,GeometryAttribute:vf,Geometry:yf,ComponentDatatype:Cf,Cartesian2:xf,Cartesian3:wf,BoundingSphere:bf}=Cesium,Sf=new xf,Tf=new wf,Ef=new wf,Pf=new wf;function Af(e){var t=(e=Re(e,Re.EMPTY_OBJECT)).length,i=e.topRadius,r=e.bottomRadius,n=Re(e.vertexFormat,pf.DEFAULT),o=Re(e.slices,128);this._length=t,this._topRadius=i,this._bottomRadius=r,this._vertexFormat=pf.clone(n),this._slices=o,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}Af.packedLength=pf.packedLength+5,Af.pack=function(e,t,i){return i=Re(i,0),pf.pack(e._vertexFormat,t,i),i+=pf.packedLength,t[i++]=e._length,t[i++]=e._topRadius,t[i++]=e._bottomRadius,t[i++]=e._slices,t[i]=Re(e._offsetAttribute,-1),t};var Mf,Df=new pf,Lf={vertexFormat:Df,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};Af.unpack=function(e,t,i){t=Re(t,0);var r=pf.unpack(e,t,Df);t+=pf.packedLength;var n=e[t++],o=e[t++],s=e[t++],a=e[t++],l=e[t];return Oe(i)?(i._vertexFormat=pf.clone(r,i._vertexFormat),i._length=n,i._topRadius=o,i._bottomRadius=s,i._slices=a,i._offsetAttribute=-1===l?void 0:l,i):(Lf.length=n,Lf.topRadius=o,Lf.bottomRadius=s,Lf.slices=a,Lf.offsetAttribute=-1===l?void 0:l,new Af(Lf))},Af.createGeometry=function(e){var t=e._length,i=e._topRadius,r=e._bottomRadius,n=e._vertexFormat,o=e._slices;if(!(t<=0||i<0||r<0||0===i&&0===r)){var s,a=o+o,l=a+a,c=function(e,t,i,r,n){var o,s=.5*e,a=-s,l=r+r,c=new Float64Array(3*(n?2*l:l)),u=0,h=0,d=n?3*l:0,p=n?3*(l+r):3*r;for(o=0;o<r;o++){var m=o/r*mf.TWO_PI,f=Math.cos(m),g=Math.sin(m),_=f*i,v=g*i,y=f*t,C=g*t;c[h+d]=_,c[h+d+1]=v,c[h+d+2]=a,c[h+p]=y,c[h+p+1]=C,c[h+p+2]=s,h+=3,n&&(c[u++]=_,c[u++]=v,c[u++]=a,c[u++]=y,c[u++]=C,c[u++]=s)}return c}(t,i,r,o,!1),u=n.st?new Float32Array(2*a):void 0,h=n.normal?new Float32Array(3*l):void 0,d=n.tangent?new Float32Array(3*l):void 0,p=n.bitangent?new Float32Array(3*l):void 0,m=n.normal||n.tangent||n.bitangent;if(m){var f=n.tangent||n.bitangent,g=0,_=0,v=0,y=Math.atan2(r-i,t),C=Tf;C.z=Math.sin(y);var x=Math.cos(y),w=Pf,b=Ef;for(s=0;s<o;s++){var S=s/o*mf.TWO_PI,T=x*Math.cos(S),E=x*Math.sin(S);m&&(C.x=T,C.y=E,f&&(w=wf.normalize(wf.cross(wf.UNIT_Z,C,w),w)),n.normal&&(h[g++]=C.x,h[g++]=C.y,h[g++]=C.z,h[g++]=C.x,h[g++]=C.y,h[g++]=C.z),n.tangent&&(d[_++]=w.x,d[_++]=w.y,d[_++]=w.z,d[_++]=w.x,d[_++]=w.y,d[_++]=w.z),n.bitangent&&(b=wf.normalize(wf.cross(C,w,b),b),p[v++]=b.x,p[v++]=b.y,p[v++]=b.z,p[v++]=b.x,p[v++]=b.y,p[v++]=b.z))}for(s=0;s<o;s++)n.normal&&(h[g++]=0,h[g++]=0,h[g++]=-1),n.tangent&&(d[_++]=1,d[_++]=0,d[_++]=0),n.bitangent&&(p[v++]=0,p[v++]=-1,p[v++]=0);for(s=0;s<o;s++)n.normal&&(h[g++]=0,h[g++]=0,h[g++]=1)}var P=6*o,A=ff.createTypedArray(l,P),M=0,D=0;for(s=0;s<o-1;s++)A[M++]=D,A[M++]=D+1,A[M++]=D+o,A[M++]=D+1,A[M++]=D+o+1,A[M++]=D+o,D++;A[M++]=D,A[M++]=0,A[M++]=o+D,A[M++]=0,A[M++]=o,A[M++]=o+D;var L=0;if(n.st){var R=1/o;for(s=0;s<o;s++)u[L++]=R*s,u[L++]=0;for(s=0;s<o;s++)u[L++]=R*s,u[L++]=1}var O=new _f;n.position&&(O.position=new vf({componentDatatype:Cf.DOUBLE,componentsPerAttribute:3,values:c})),n.st&&(O.st=new vf({componentDatatype:Cf.FLOAT,componentsPerAttribute:2,values:u})),n.normal&&(O.normal=new vf({componentDatatype:Cf.FLOAT,componentsPerAttribute:3,values:h})),Sf.x=.5*t,Sf.y=Math.max(r,i);var I=new bf(wf.ZERO,xf.magnitude(Sf));if(Oe(e._offsetAttribute)){t=c.length;var N=new Uint8Array(t/3);!function(e,t,i,r){if("function"==typeof e.fill)return e.fill(t,i,r);for(var n=e.length>>>0,o=Re(i,0),s=o<0?Math.max(n+o,0):Math.min(o,n),a=Re(r,n),l=a<0?Math.max(n+a,0):Math.min(a,n);s<l;)e[s]=t,s++}(N,e._offsetAttribute===gf.NONE?0:1),O.applyOffset=new vf({componentDatatype:Cf.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}return new yf({attributes:O,indices:A,primitiveType:df.TRIANGLES,boundingSphere:I,offsetAttribute:e._offsetAttribute})}},Af.getUnitCylinder=function(){return Oe(Mf)||(Mf=Af.createGeometry(new Af({topRadius:1,bottomRadius:1,length:1,vertexFormat:pf.POSITION_ONLY}))),Mf};const{baseMaterialShader:Rf,dashCircleMaterialShader:Of,coneMaterialShader:If,cylinderMaterialShader:Nf}=hf,{MaterialAppearance:kf,Material:Ff,GroundPrimitive:zf,Primitive:Bf,GeometryInstance:Gf,PrimitiveCollection:Wf,CircleGeometry:Uf,Transforms:Hf,Matrix4:Vf,Cartesian3:jf}=Cesium;var qf=function(e){return e.reduce((function(e,t){return 2*e+t}),0)},$f=function(e){for(var t=[],i=7;i>=0;i--)t.push(!!(e&1<<i));return t},Yf=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],i=0;i<e;i++)t.push(this.readByte());return t},this.read=function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},Xf=function(e,t){t||(t={});var i=function(t){for(var i=[],r=0;r<t;r++)i.push(e.readBytes(3));return i},r=function(){var t,i;i="";do{t=e.readByte(),i+=e.read(t)}while(0!==t);return i},n=function(n){n.leftPos=e.readUnsigned(),n.topPos=e.readUnsigned(),n.width=e.readUnsigned(),n.height=e.readUnsigned();var o=$f(e.readByte());n.lctFlag=o.shift(),n.interlaced=o.shift(),n.sorted=o.shift(),n.reserved=o.splice(0,2),n.lctSize=qf(o.splice(0,3)),n.lctFlag&&(n.lct=i(1<<n.lctSize+1)),n.lzwMinCodeSize=e.readByte();var s=r();n.pixels=function(e,t){for(var i,r,n=0,o=function(e){for(var i=0,r=0;r<e;r++)t.charCodeAt(n>>3)&1<<(7&n)&&(i|=1<<r),n++;return i},s=[],a=1<<e,l=a+1,c=e+1,u=[],h=function(){u=[],c=e+1;for(var t=0;t<a;t++)u[t]=[t];u[a]=[],u[l]=null};;)if(r=i,(i=o(c))!==a){if(i===l)break;if(i<u.length)r!==a&&u.push(u[r].concat(u[i][0]));else{if(i!==u.length)throw new Error("Invalid LZW code.");u.push(u[r].concat(u[r][0]))}s.push.apply(s,u[i]),u.length===1<<c&&c<12&&c++}else h();return s}(n.lzwMinCodeSize,s),n.interlaced&&(n.pixels=function(e,t){for(var i=new Array(e.length),r=e.length/t,n=function(r,n){var o=e.slice(n*t,(n+1)*t);i.splice.apply(i,[r*t,t].concat(o))},o=[0,4,2,1],s=[8,8,4,2],a=0,l=0;l<4;l++)for(var c=o[l];c<r;c+=s[l])n(c,a),a++;return i}(n.pixels,n.width)),t.img&&t.img(n)},o=function(){var i={};switch(i.sentinel=e.readByte(),String.fromCharCode(i.sentinel)){case"!":i.type="ext",function(i){switch(i.label=e.readByte(),i.label){case 249:i.extType="gce",function(i){e.readByte();var r=$f(e.readByte());i.reserved=r.splice(0,3),i.disposalMethod=qf(r.splice(0,3)),i.userInput=r.shift(),i.transparencyGiven=r.shift(),i.delayTime=e.readUnsigned(),i.transparencyIndex=e.readByte(),i.terminator=e.readByte(),t.gce&&t.gce(i)}(i);break;case 254:i.extType="com",function(e){e.comment=r(),t.com&&t.com(e)}(i);break;case 1:i.extType="pte",function(i){e.readByte(),i.ptHeader=e.readBytes(12),i.ptData=r(),t.pte&&t.pte(i)}(i);break;case 255:i.extType="app",function(i){e.readByte(),i.identifier=e.read(8),i.authCode=e.read(3),"NETSCAPE"===i.identifier?function(i){e.readByte(),i.unknown=e.readByte(),i.iterations=e.readUnsigned(),i.terminator=e.readByte(),t.app&&t.app.NETSCAPE&&t.app.NETSCAPE(i)}(i):function(e){e.appData=r(),t.app&&t.app[e.identifier]&&t.app[e.identifier](e)}(i)}(i);break;default:i.extType="unknown",function(e){e.data=r(),t.unknown&&t.unknown(e)}(i)}}(i);break;case",":i.type="img",n(i);break;case";":i.type="eof",t.eof&&t.eof(i);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}"eof"!==i.type&&setTimeout(o,0)};!function(){var r={};if(r.sig=e.read(3),r.ver=e.read(3),"GIF"!==r.sig)throw new Error("Not a GIF file.");r.width=e.readUnsigned(),r.height=e.readUnsigned();var n=$f(e.readByte());r.gctFlag=n.shift(),r.colorRes=qf(n.splice(0,3)),r.sorted=n.shift(),r.gctSize=qf(n.splice(0,3)),r.bgColor=e.readByte(),r.pixelAspectRatio=e.readByte(),r.gctFlag&&(r.gct=i(1<<r.gctSize+1)),t.hdr&&t.hdr(r)}(),setTimeout(o,0)},Jf=function(e){var t,i,r={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var n in e)r[n]=e[n];r.vp_w&&r.vp_h&&(r.is_vp=!0);var o=null,s=!1,a=null,l=null,c=null,u=null,h=null,d=null,p=null,m=!0,f=!1,g=[],_=[],v=r.gif;void 0===r.auto_play&&(r.auto_play=!v.getAttribute("rel:auto_play")||"1"==v.getAttribute("rel:auto_play"));var y,C,x,w,b=r.hasOwnProperty("on_end")?r.on_end:null,S=r.hasOwnProperty("loop_delay")?r.loop_delay:0,T=r.hasOwnProperty("loop_mode")?r.loop_mode:"auto",E=!r.hasOwnProperty("draw_while_loading")||r.draw_while_loading,P=!!E&&(!r.hasOwnProperty("show_progress_bar")||r.show_progress_bar),A=r.hasOwnProperty("progressbar_height")?r.progressbar_height:25,M=r.hasOwnProperty("progressbar_background_color")?r.progressbar_background_color:"rgba(255,255,255,0.4)",D=r.hasOwnProperty("progressbar_foreground_color")?r.progressbar_foreground_color:"rgba(255,0,22,.8)",L=function(){a=null,l=null,h=c,c=null,d=null},R=function(){try{Xf(t,W)}catch(e){N("parse")}},O=function(e,t){y.width=e*H(),y.height=t*H(),x.style.minWidth=e*H()+"px",w.width=e,w.height=t,w.style.width=e+"px",w.style.height=t+"px",w.getContext("2d").setTransform(1,0,0,1,0,0)},I=function(e,t,i){if(i&&P){var n,o,s,a=A;r.is_vp?f?(o=(r.vp_t+r.vp_h-a)/H(),a/=H(),n=r.vp_l/H()+e/t*(r.vp_w/H()),s=y.width/H()):(o=r.vp_t+r.vp_h-a,a=a,n=r.vp_l+e/t*r.vp_w,s=y.width):(o=(y.height-a)/(f?H():1),n=e/t*y.width/(f?H():1),s=y.width/(f?H():1),a/=f?H():1),C.fillStyle=M,C.fillRect(n,o,s-n,a),C.fillStyle=D,C.fillRect(0,o,n,a)}},N=function(e){o=e,i={width:v.width,height:v.height},g=[],C.fillStyle="black",C.fillRect(0,0,r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),C.strokeStyle="red",C.lineWidth=3,C.moveTo(0,0),C.lineTo(r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),C.moveTo(0,r.c_h?r.c_h:i.height),C.lineTo(r.c_w?r.c_w:i.width,0),C.stroke()},k=function(){d&&(g.push({data:d.getImageData(0,0,i.width,i.height),delay:l}),_.push({x:0,y:0}))},F=function(){var e,t,i,n=-1,s=0,a=function(e){n+=e,c()},l=(e=!1,t=function(){null!==b&&b(v),s++,!1!==T||s<0?i():(e=!1,m=!1)},i=function(){if(e=m){a(1);var r=10*g[n].delay;r||(r=100),0==(n+1+g.length)%g.length?(r+=S,setTimeout(t,r)):setTimeout(i,r)}},function(){e||setTimeout(i,0)}),c=function(){var e;(n=parseInt(n,10))>g.length-1&&(n=0),n<0&&(n=0),e=_[n],w.getContext("2d").putImageData(g[n].data,e.x,e.y),C.globalCompositeOperation="copy",C.drawImage(w,0,0)};return{init:function(){o||(r.c_w&&r.c_h||C.scale(H(),H()),r.auto_play?l():(n=0,c()))},step:l,play:function(){m=!0,l()},pause:function(){m=!1},playing:m,move_relative:a,current_frame:function(){return n},length:function(){return g.length},move_to:function(e){n=e,c()}}}(),z=function(e){I(t.pos,t.data.length,e)},B=function(){},G=function(e,t){return function(i){e(i),z(t)}},W={hdr:G((function(e){O((i=e).width,i.height)})),gce:G((function(e){k(),L(),a=e.transparencyGiven?e.transparencyIndex:null,l=e.delayTime,c=e.disposalMethod})),com:G(B),app:{NETSCAPE:G(B)},img:G((function(e){d||(d=w.getContext("2d"));var t=g.length,n=e.lctFlag?e.lct:i.gct;t>0&&(3===h?null!==u?d.putImageData(g[u].data,0,0):d.clearRect(p.leftPos,p.topPos,p.width,p.height):u=t-1,2===h&&d.clearRect(p.leftPos,p.topPos,p.width,p.height));var o=d.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach((function(e,t){e!==a&&(o.data[4*t+0]=n[e][0],o.data[4*t+1]=n[e][1],o.data[4*t+2]=n[e][2],o.data[4*t+3]=255)})),d.putImageData(o,e.leftPos,e.topPos),f||(C.scale(H(),H()),f=!0),E&&(C.drawImage(w,0,0),E=r.auto_play),p=e}),!0),eof:function(e){k(),z(!1),r.c_w&&r.c_h||(y.width=i.width*H(),y.height=i.height*H()),F.init(),s=!1,j&&j(v)}},U=function(){var e=v.parentNode,t=document.createElement("div");y=document.createElement("canvas"),C=y.getContext("2d"),x=document.createElement("div"),w=document.createElement("canvas"),t.width=y.width=v.width,t.height=y.height=v.height,x.style.minWidth=v.width+"px",t.className="jsgif",x.className="jsgif_toolbar",t.appendChild(y),t.appendChild(x),e.insertBefore(t,v),e.removeChild(v),r.c_w&&r.c_h&&O(r.c_w,r.c_h),V=!0},H=function(){return r.max_width&&i&&i.width>r.max_width?r.max_width/i.width:1},V=!1,j=!1,q=function(e){return!s&&(j=e||!1,s=!0,g=[],L(),u=null,h=null,d=null,p=null,!0)},$=function(){return g.reduce((function(e,t){return e+t.delay}),0)};return{play:F.play,pause:F.pause,move_relative:F.move_relative,move_to:F.move_to,get_playing:function(){return m},get_canvas:function(){return y},get_canvas_scale:function(){return H()},get_loading:function(){return s},get_auto_play:function(){return r.auto_play},get_length:function(){return F.length()},get_frames:function(){return g},get_duration:function(){return $()},get_duration_ms:function(){return 10*$()},get_current_frame:function(){return F.current_frame()},load_url:function(e,i){if(q(i)){var r=new XMLHttpRequest;r.open("GET",e,!0),"overrideMimeType"in r?r.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in r?r.responseType="arraybuffer":r.setRequestHeader("Accept-Charset","x-user-defined"),r.onloadstart=function(){V||U()},r.onload=function(e){200!=this.status&&N("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var i=this.response;i.toString().indexOf("ArrayBuffer")>0&&(i=new Uint8Array(i)),t=new Yf(i),setTimeout(R,0)},r.onprogress=function(e){e.lengthComputable&&I(e.loaded,e.total,!0)},r.onerror=function(){N("xhr")},r.send()}},load:function(e){this.load_url(v.getAttribute("rel:animated_src")||v.src,e)},load_raw:function(e,i){q(i)&&(V||U(),t=new Yf(e),setTimeout(R,0))},set_frame_offset:function(e,t){_[e]?(void 0!==t.x&&(_[e].x=t.x),void 0!==t.y&&(_[e].y=t.y)):_[e]=t}}};const{BillboardCollection:Zf,VerticalOrigin:Qf}=Cesium;const Kf="\nczm_material czm_getMaterial(czm_materialInput materialInput) {\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    material.diffuse = color.rgb;\n    vec2 st = materialInput.st - vec2(0.5);\n    float dis = distance(st, vec2(0.0));\n    // material.alpha = min(pow(dis * 2.0, 5.0) * color.a, 1.0);\n    if (dis * 2.0 > fract(time)) {\n        discard;\n    }  \n    float scale = 1.0 / (max(time, 0.0001));\n    material.alpha = min(pow(dis * 2.0 * scale, 5.0), 1.0) * color.a;\n    return material;\n}\n",{MaterialAppearance:eg,Material:tg}=Cesium;const{Cartesian3:ig,Matrix4:rg,Transforms:ng,Model:og,CylinderGeometry:sg,PrimitiveCollection:ag,BillboardCollection:lg,MaterialAppearance:cg,GeometryInstance:ug,Material:hg,Color:dg,Primitive:pg}=Cesium;function mg(e,t,i){if(!Oe(e))return;t=Cesium.Math.toRadians(t);const r=new Cesium.Matrix3,n=new Cesium.Quaternion;Cesium.Quaternion.fromAxisAngle(i,t,n),Cesium.Matrix3.fromQuaternion(n,r);const o=new Cesium.Matrix4;Cesium.Matrix4.fromRotationTranslation(r,new Cesium.Cartesian3(0,0,0),o),Cesium.Matrix4.multiplyByMatrix3(e._matrix,r,e._matrix);const s=Ie.fromCartesian(e._surface,e._viewer),a=new Cesium.Matrix4;Cesium.Matrix4.inverseTransformation(e._matrix,a);const l=Cesium.Cartesian3.fromDegrees(s.lon,s.lat,e._height),c=new Cesium.Cartesian3;Cesium.Matrix4.multiplyByPoint(a,l,c);const u=new Cesium.Cartesian3;Cesium.Matrix4.multiplyByPoint(o,c,u);const h=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(c,u,h),Cesium.Matrix4.multiplyByTranslation(e._matrix,h,e._matrix),e.updateMatrix(e._matrix)}function fg(e){const t=e.scanPrimitive.appearance.material,i=e._viewer;if(e.path){const t=e.path.position.getValue(i.clock.currentTime);e._position=t;const r=Ie.fromCartesian(t,i),n=Cesium.Cartesian3.fromDegrees(r.lon,r.lat);e._surface=n,e._height=r.height;const o=new Cesium.Cartesian3(0,0,r.height/2),s=Cesium.Matrix4.multiplyByTranslation(ng.eastNorthUpToFixedFrame(n),o,new Cesium.Matrix4);e.updateMatrix(s),e.imagePrimitive.position=t,e.transform(e.rotation),e.tracked&&e.trackSatellite()}let r=t.uniforms.offset;r-=.005*e.speed,r>1&&(r=0),e.scanPrimitive.appearance.material.uniforms.offset=r}const{Cartesian2:gg,Cartesian3:_g,Cartographic:vg,Credit:yg,defaultValue:Cg,defined:xg,DeveloperError:wg,Event:bg,GeographicProjection:Sg,GeographicTilingScheme:Tg,Math:Eg,Rectangle:Pg,Resource:Ag,RuntimeError:Mg,TileProviderError:Dg,WebMercatorProjection:Lg,WebMercatorTilingScheme:Rg,DiscardMissingTileImagePolicy:Og,ImageryLayerFeatureInfo:Ig,ImageryProvider:Ng}=Cesium;function kg(e){e=Cg(e,Cg.EMPTY_OBJECT),this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;const t=Ag.createIfNeeded(e.url);t.appendForwardSlash(),xg(e.token)&&t.setQueryParameters({token:e.token}),this._resource=t,this._tileDiscardPolicy=e.tileDiscardPolicy,this._tileWidth=Cg(e.tileWidth,256),this._tileHeight=Cg(e.tileHeight,256),this._maximumLevel=e.maximumLevel,this._tilingScheme=Cg(e.tilingScheme,new Tg({ellipsoid:e.ellipsoid})),this._useTiles=Cg(e.usePreCachedTilesIfAvailable,!0),this._rectangle=Cg(e.rectangle,this._tilingScheme.rectangle),this._layers=e.layers;let i=e.credit;"string"==typeof i&&(i=new yg(i)),this._credit=i,this.enablePickFeatures=Cg(e.enablePickFeatures,!0),this._errorEvent=new bg,this._ready=!1;const r=this;let n;function o(t){const i=t.tileInfo;if(xg(i)){if(r._tileWidth=i.rows,r._tileHeight=i.cols,102100===i.spatialReference.wkid||102113===i.spatialReference.wkid)r._tilingScheme=new Rg({ellipsoid:e.ellipsoid});else if(4326===t.tileInfo.spatialReference.wkid)r._tilingScheme=new Tg({ellipsoid:e.ellipsoid});else{if(4490!==t.tileInfo.spatialReference.wkid){const e=`Tile spatial reference WKID ${t.tileInfo.spatialReference.wkid} is not supported.`;return n=Dg.reportError(n,r,r._errorEvent,e,void 0,void 0,void 0),n.retry?a():Promise.reject(new Mg(e))}r._tilingScheme=new el({ellipsoid:e.ellipsoid,tileInfo:t.tileInfo,rectangle:r._rectangle,numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY}),r._tilingScheme._tileInfo=t.tileInfo}if(r._maximumLevel=t.tileInfo.lods.length-1,xg(t.fullExtent)){if(xg(t.fullExtent.spatialReference)&&xg(t.fullExtent.spatialReference.wkid))if(102100===t.fullExtent.spatialReference.wkid||102113===t.fullExtent.spatialReference.wkid){const e=new Lg,i=t.fullExtent,n=e.unproject(new _g(Math.max(i.xmin,-r._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.max(i.ymin,-r._tilingScheme.ellipsoid.maximumRadius*Math.PI),0)),o=e.unproject(new _g(Math.min(i.xmax,r._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.min(i.ymax,r._tilingScheme.ellipsoid.maximumRadius*Math.PI),0));r._rectangle=new Pg(n.longitude,n.latitude,o.longitude,o.latitude)}else if(4326===t.fullExtent.spatialReference.wkid)r._rectangle=Pg.fromDegrees(t.fullExtent.xmin,t.fullExtent.ymin,t.fullExtent.xmax,t.fullExtent.ymax);else{if(4490!==t.fullExtent.spatialReference.wkid){const e=`fullExtent.spatialReference WKID ${t.fullExtent.spatialReference.wkid} is not supported.`;return n=Dg.reportError(n,r,r._errorEvent,e,void 0,void 0,void 0),n.retry?a():Promise.reject(new Mg(e))}r._rectangle=Pg.fromDegrees(t.fullExtent.xmin,t.fullExtent.ymin,t.fullExtent.xmax,t.fullExtent.ymax)}}else r._rectangle=r._tilingScheme.rectangle;xg(r._tileDiscardPolicy)||(r._tileDiscardPolicy=new Og({missingImageUrl:Fg(r,0,0,r._maximumLevel).url,pixelsToCheck:[new gg(0,0),new gg(200,20),new gg(20,200),new gg(80,110),new gg(160,130)],disableCheckIfAllPixelsAreTransparent:!0})),r._useTiles=!0}else r._useTiles=!1;return xg(t.copyrightText)&&t.copyrightText.length>0&&(r._credit=new yg(t.copyrightText)),r._ready=!0,Dg.reportSuccess(n),Promise.resolve(!0)}function s(e){const t=`An error occurred while accessing ${r._resource.url}.`;return n=Dg.reportError(n,r,r._errorEvent,t,void 0,void 0,void 0),Promise.reject(new Mg(t))}function a(){return r._resource.getDerivedResource({queryParameters:{f:"json"}}).fetchJsonp().then(o).catch(s)}this._useTiles?this._readyPromise=a():(this._ready=!0,this._readyPromise=Promise.resolve(!0))}function Fg(e,t,i,r,n){let o;if(e._useTiles)o=e._resource.getDerivedResource({url:`tile/${r}/${i}/${t}`,request:n});else{const s=e._tilingScheme.tileXYToNativeRectangle(t,i,r),a={bbox:`${s.west},${s.south},${s.east},${s.north}`,size:`${e._tileWidth},${e._tileHeight}`,format:"png32",transparent:!0,f:"image"};e._tilingScheme.projection instanceof Sg?(a.bboxSR=4326,a.imageSR=4326):(a.bboxSR=3857,a.imageSR=3857),e.layers&&(a.layers=`show:${e.layers}`),o=e._resource.getDerivedResource({url:"export",request:n,queryParameters:a})}return o}Object.defineProperties(kg.prototype,{url:{get:function(){return this._resource._url}},token:{get:function(){return this._resource.queryParameters.token}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),kg.prototype.getTileCredits=function(e,t,i){},kg.prototype.requestImage=function(e,t,i,r){return Ng.loadImage(this,Fg(this,e,t,i,r))},kg.prototype.pickFeatures=function(e,t,i,r,n){if(!this.enablePickFeatures)return;const o=this._tilingScheme.tileXYToNativeRectangle(e,t,i);let s,a,l;if(this._tilingScheme.projection instanceof Sg)s=Eg.toDegrees(r),a=Eg.toDegrees(n),l="4326";else{const e=this._tilingScheme.projection.project(new vg(r,n,0));s=e.x,a=e.y,l="3857"}let c="visible";xg(this._layers)&&(c+=`:${this._layers}`);const u={f:"json",tolerance:2,geometryType:"esriGeometryPoint",geometry:`${s},${a}`,mapExtent:`${o.west},${o.south},${o.east},${o.north}`,imageDisplay:`${this._tileWidth},${this._tileHeight},96`,sr:l,layers:c};return this._resource.getDerivedResource({url:"identify",queryParameters:u}).fetchJson().then((function(e){const t=[],i=e.results;if(!xg(i))return t;for(let e=0;e<i.length;++e){const r=i[e],n=new Ig;if(n.data=r,n.name=r.value,n.properties=r.attributes,n.configureDescriptionFromProperties(r.attributes),"esriGeometryPoint"===r.geometryType&&r.geometry){const e=r.geometry.spatialReference&&r.geometry.spatialReference.wkid?r.geometry.spatialReference.wkid:4326;if(4326===e||4283===e)n.position=vg.fromDegrees(r.geometry.x,r.geometry.y,r.geometry.z);else if(102100===e||900913===e||3857===e){const e=new Lg;n.position=e.unproject(new _g(r.geometry.x,r.geometry.y,r.geometry.z))}}t.push(n)}return t}))};const zg=33746824,Bg=33554054;const{BingMapsImageryProvider:Gg,BingMapsStyle:Wg}=Cesium;class Ug extends Gg{constructor(e={}){e.url="https://dev.virtualearth.net",e.mapStyle=Re(e.mapStyle,Ug.mapStyle.AERIAL),e.key=Re(e.key,"AqMhBWJKbBPBtoWEvtGdUii6XSkDCJ3vWFpOVWzplD-Q0J-ECUF6i8MGXpew8bkc"),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}static tileXYToQuadKey(e,t,i){return Gg.tileXYToQuadKey(e,t,i)}static quadKeyToTileXY(e){return Gg.quadKeyToTileXY(e)}static mapStyle=Wg}class Hg extends Uc{constructor(e){e=Re(e,{});const t=Re(e.layer,"img"),{scl:i,style:r}=Hg.getParametersByLayer(t),n=Re(e.lang,"zh_cn");e.url=`https://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=${n}&size=1&scl=${i}&style=${r}`,e.subdomains="1234",super(e)}static layers=[{layer:"img",desc:"影像地图"},{layer:"vec",desc:"矢量地图"},{layer:"vei",desc:"矢量地图（含注记）"},{layer:"roa",desc:"路网地图"},{layer:"roi",desc:"路网地图（含注记）"}];static getParametersByLayer(e){let t={scl:1,style:6};switch(e){case"img":break;case"vec":t.scl=2,t.style=7;break;case"vei":t.scl=1,t.style=7;break;case"roa":t.scl=2,t.style=8;break;case"roi":t.scl=1,t.style=8}return t}}const{WebMapTileServiceImageryProvider:Vg}=Cesium;class jg extends Vg{constructor(e={}){super(e)}get dimensions(){return super.dimensions}set dimensions(e){super.dimensions=e}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}const qg={map:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=1&version=297",road:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=2&version=297",img:"https://p{s}.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{reverseY}.jpg?version=229"};function $g(e){return`rgba(${255*e.red}, ${255*e.green}, ${255*e.blue}, ${e.alpha})`}const{Rectangle:Yg}=Cesium;class Xg extends Cesium.TileMapServiceImageryProvider{constructor(e){super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}class Jg extends Cesium.WebMapServiceImageryProvider{constructor(e={}){Oe(e.parameters)||(e.parameters=Jg.DefaultParameters),Oe(e.GetFeatureInfoDefaultParameters),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}Jg.DefaultParameters=Object.assign({transparent:!0},Cesium.WebMapServiceImageryProvider.DefaultParameters,{format:"image/png"}),Jg.GetFeatureInfoDefaultParameters=Cesium.WebMapServiceImageryProvider.GetFeatureInfoDefaultParameters;const{CallbackProperty:Zg}=Cesium;function Qg(e){return new Zg((()=>e),!1)}class Kg{constructor(e,t={}){this._type=void 0,this._properties=void 0,this._show=!0,this._id=Re(e.id,We()),this._clampToGround=Re(t.clampToGround),this._clampToModel=Re(t.clampToModel)}highlightGraphic(e=!0){const t=Kg.highlightColor;this.entity&&e?(this.entity.point&&(this.entity.point.color=t),this.entity.polyline&&(this.entity.polyline.material=t),this.entity.polygon&&(this.entity.polygon.material=t),this.entity.polygon&&(this.entity.polygon.outlineColor=t)):(this.entity.point&&(this.entity.point.color=this._entityOptions.point.color),this.entity.polyline&&(this.entity.polyline.material=this._entityOptions.polyline.material),this.entity.polygon&&(this.entity.polygon.material=this._entityOptions.polygon.material),this.entity.polygon&&(this.entity.polygon.outlineColor=this._entityOptions.polygon.outlineColor))}static highlightColor=Cesium.Color.AQUA;get clampToGround(){return this._clampToGround}set clampToGround(e){this._clampToGround=e}get clampToModel(){return this._clampToModel}set clampToModel(e){this._clampToModel=e}get id(){return this._id}get positions(){return this._positions}get type(){return this._type}get properties(){return this._properties}set properties(e){this._properties=new Ql(e)}get entity(){return this._entity}get show(){return this._show}set show(e){this._show=e,this.entity&&(this.entity.show=this._show)}destroy(){console.log("destroy"),this._entity=void 0,this._entityOptions=void 0,this._positions=void 0,this.properties&&this.properties.destroy(),this._properties=void 0,je(this)}startEdit(){if(this.entity){const e=Qg(this.positions);this.entity.position&&(this.entity.position=e),this.entity.polyline&&(this.entity.polyline.positions=Qg(this._nodePositions||this.positions)),this.entity.polygon&&(this.entity.polygon.hierarchy=Qg(new Cesium.PolygonHierarchy(this.positions)))}}stopEdit(){this.entity&&(this.entity.position&&(this.entity.position=this.positions),this.entity.polyline&&(this.entity.polyline.positions=this._nodePositions||this.positions),this.entity.polygon&&(this.entity.polygon.hierarchy=new Cesium.PolygonHierarchy(this.positions)))}createProperties(){const e=this._entityOptions,{properties:t}=e;this._properties=new Ql(t),delete e.properties}createEntity(){this.createProperties()}toGeoJson(){Tr()}getGeometry(){Tr()}static getEntityFromGeoJson(e){if(Oe(e)){if(e.geometry&&"POLYGON"===e.geometry.type.toUpperCase()){let t=[];const i=e.geometry.coordinates;if(!Oe(i)||!Array.isArray(i))return;for(let e of i){if(!Array.isArray(e))return;for(let i of e){const e=Cesium.Cartesian3.fromDegrees(i[0],i[1]);if(!Oe(e))return;t.push(e)}}return new Cesium.Entity({polygon:{material:Cesium.Color.fromCssColorString("rgba(247,224,32,0.5)"),outlineColor:Cesium.Color.RED,perPositionHeight:!1,hierarchy:t}})}return hierarchy}}}function e_(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t_(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i_(e,t,i){return t&&t_(e.prototype,t),i&&t_(e,i),e}function r_(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n_(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s_(e,t)}function o_(e){return o_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o_(e)}function s_(e,t){return s_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s_(e,t)}function a_(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l_(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?a_(e):t}function c_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=o_(e);if(t){var n=o_(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return l_(this,i)}}function u_(e,t,i){return u_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o_(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i):n.value}},u_(e,t,i||e)}function h_(e){return function(e){if(Array.isArray(e))return d_(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return d_(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return d_(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d_(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function p_(e,t){return null!=e?e:t}p_.EMPTY_OBJECT=Object.freeze({});var m_={ARROW:0,HALF_ARROW:1,BEZIER:2,SPLINE:3,SWALLOW_TRAIL:4,TRAPEZOID:5,HALF_TRAPEZOID:6,HALF_SWALLOW_TRAIL:7,HALF_SPLINE:8,getLabel:function(e){var t;switch(e.type){case m_.HALF_ARROW:t="HALF_ARROW";break;case m_.ARROW:lebel="ARROW";break;case m_.BEZIER:t="BEZIER";break;case m_.SPLINE:t="SPLINE";break;case m_.SWALLOW_TRAIL:t="SWALLOW_TRAIL";break;case m_.HALF_SWALLOW_TRAIL:t="HALF_SWALLOW_TRAIL";break;case m_.HALF_SPLINE:t="HALF_SPLINE";break;default:t=void 0}return t},getErrorMsg:function(e){e.type;var t=e.controls.length;if(!m_.validate(e))throw new Error(m_.getLabel(e)+"控制点个数必须不少于"+e.controlPointsCount[0]+",实际只有"+t+"个")},validate:function(e){return!(e.controls.length<e.controlPointsCount[0])}},f_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e_(this,e),this._controls=t.controls||[],this._index=t.index,this._inverse=t.inverse||!1,!this._index){var i=this._controls.length;this._index=new Array(i);for(var r=0;r<i;r++)this._index[r]=r}}return i_(e,[{key:"createNodes",value:function(){m_.getErrorMsg(this)}},{key:"get",value:function(e){return this.index?this.controls[this.index[e]]:this.controls[e]}},{key:"controls",get:function(){return this._controls}},{key:"index",get:function(){return this._index}},{key:"type",get:function(){return this._type}},{key:"controlPointsCount",get:function(){return this._controlPointsCount}},{key:"nodes",get:function(){return this._nodes},set:function(e){this._nodes=e}},{key:"inverse",get:function(){return this._inverse},set:function(e){this._inverse=e}}]),e}(),g_=function(){function e(){e_(this,e)}return i_(e,null,[{key:"distance",value:function(){var e=arguments.length;if(e<2)return 0;for(var t=0,i=0;i<e-1;i++){var r=(i+1)%e,n=i<0||arguments.length<=i?void 0:arguments[i],o=r<0||arguments.length<=r?void 0:arguments[r];t+=Math.sqrt(Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2))}return t}},{key:"baseLength",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.99;return Math.pow(e.distance.apply(e,h_(t)),i)}},{key:"mid",value:function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}},{key:"azimuth",value:function(t,i){var r=[i,t];t=r[0],i=r[1];var n=Math.asin(Math.abs(t[1]-i[1])/e.distance(t,i));return t[1]>=i[1]&&t[0]>=i[0]?n+Math.PI:t[1]>=i[1]&&t[0]<i[0]?2*Math.PI-n:t[1]<i[1]&&t[0]>=i[0]?Math.PI-n:n}},{key:"thirdPoint",value:function(t,i,r,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=e.azimuth(t,i),a=o?s-r:s+r,l=n*Math.cos(a),c=n*Math.sin(a);return[i[0]+l,i[1]+c]}},{key:"isClockWise",value:function(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}},{key:"angleOfThreePoints",value:function(t,i,r){var n=e.azimuth(t,i)-e.azimuth(t,r);return n>0?n:2*Math.PI+n}},{key:"quadricBSplineFactor",value:function(e,t){return 0===e?Math.pow(t-1,2)/2:1===e?(-2*Math.pow(t,2)+2*t+1)/2:2===e?Math.pow(t,2)/2:0}},{key:"quadricBSpline",value:function(t){if(t<=2)return t;var i=[],r=t.length-2-1;i.push(t[0]);for(var n=0;n<=r;n++)for(var o=0;o<=1;o+=.05){for(var s=0,a=0,l=0;l<=2;l++){var c=e.quadricBSplineFactor(l,o);s+=c*t[n+l][0],a+=c*t[n+l][1]}i.push([s,a])}return i.push(t[t.length-1]),i}},{key:"binomialFactor",value:function(t,i){return e.factorial(t)/(e.factorial(i)*e.factorial(t-i))}},{key:"factorial",value:function(t){return t<0?NaN:0===t?1:t*e.factorial(t-1)}},{key:"BezierCurve",value:function(t){var i=t.length;if(i<2)return t;for(var r=[],n=0;n<=1;n+=.01){for(var o=0,s=0,a=0;a<i;a++){var l=e.binomialFactor(i-1,a),c=Math.pow(n,a),u=Math.pow(1-n,i-a-1);o+=l*c*u*t[a][0],s+=l*c*u*t[a][1]}r.push([o,s])}return r.push(t[i-1]),r}}]),e}(),__=function(e){n_(i,e);var t=c_(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e_(this,i),(e=t.call(this,r))._controlPointsCount=[2,2],e._type=m_.HALF_ARROW,e._heightFactor=p_(r.heightFactor,.18),e._neckHeightFactor=p_(r.neckHeightFactor,.15),e._headWidthFactor=p_(r.headWidthFactor,.5),e._neckWidthFactor=p_(r.neckWidthFactor,.3),e._headMaxHeight=r.headMaxHeight,e._headTailHeightFactor=p_(r.headTailHeightFactor,.3),e._inverse=p_(r.inverse,!1),e._nodes=[],e.createNodes(),e}return i_(i,[{key:"createNodes",value:function(){u_(o_(i.prototype),"createNodes",this).call(this);var e=this.controls,t=g_.baseLength(e),r=this.heightFactor*t;t=g_.distance(this.get(0),this.get(1)),this.headMaxHeight&&r>this.headMaxHeight&&(r=this.headMaxHeight);var n=this.neckWidthFactor*r,o=this.headWidthFactor*r;r=r>t?t:r;var s=this.neckHeightFactor*r,a=g_.thirdPoint(this.get(0),this.get(1),0,r),l=g_.thirdPoint(this.get(0),this.get(1),0,s),c=g_.thirdPoint(this.get(1),a,Math.PI/2,o,this.inverse),u=g_.thirdPoint(this.get(1),l,Math.PI/2,n,this.inverse);return this.neck=u,this.tail=c,this.neckControl=l,this.tailControl=a,this._nodes=[l,u,c,this.get(1)],this.completedNodes=new Map,this.completedNodes.set(this.inverse,[l,u,c,this.get(1)]),this._nodes}},{key:"headMaxHeight",get:function(){return this._headMaxHeight}},{key:"heightFactor",get:function(){return this._heightFactor}},{key:"neckHeightFactor",get:function(){return this._neckHeightFactor}},{key:"headWidthFactor",get:function(){return this._headWidthFactor}},{key:"neckWidthFactor",get:function(){return this._neckWidthFactor}},{key:"nodes",get:function(){return this._nodes}}]),i}(f_),v_=function(e){n_(i,e);var t=c_(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e_(this,i),(e=t.call(this,r))._type=m_.ARROW,e.createNodes(),e}return i_(i,[{key:"createNodes",value:function(){var e=new Map;this._inverse=!0;var t=u_(o_(i.prototype),"createNodes",this).call(this);e.set(this.inverse,h_(t)),this._inverse=!1;var r=u_(o_(i.prototype),"createNodes",this).call(this);return e.set(this.inverse,h_(r)),r.shift(),t.shift(),r.pop(),this.inverse=void 0,this.completedNodes=e,this._nodes=[].concat(h_(r),h_(t.reverse())),[].concat(h_(r),h_(t.reverse()))}}]),i}(__),y_=function(e){n_(i,e);var t=c_(i);function i(e){var r;return e_(this,i),(r=t.call(this,e))._type=m_.HALF_TRAPEZOID,r._controlPointsCount=[2,2],r._heightFactor=p_(e.heightFactor,.82),r._tailWidthFactor=p_(e.tailWidthFactor,.5),r._headWidthFactor=p_(e.headWidthFactor,.3),r.createNodes(),r}return i_(i,[{key:"createNodes",value:function(){u_(o_(i.prototype),"createNodes",this).call(this);var e=this.get(0),t=g_.baseLength(this._controls),r=this.heightFactor*t,n=g_.thirdPoint(this.get(1),e,0,r,this.inverse),o=this.tailWidthFactor*t,s=this.headWidthFactor*t,a=g_.thirdPoint(e,n,Math.PI/2,s,this.inverse),l=g_.thirdPoint(n,e,Math.PI/2,o,!this.inverse);return this._nodes=[a,l,e,n].flat(),this.completedNodes=new Map,this.completedNodes.set(this.inverse,[l]),[l]}},{key:"linkArrow",value:function(e){var t=e.arrowNodes,i=e.bodyNodes;return e.inverse?[].concat(h_(i),h_(t)):[].concat(h_(t),h_(i))}},{key:"linkTail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tailNodes,i=e.bodyNodes;return e.inverse,[].concat(h_(t),h_(i))}},{key:"heightFactor",get:function(){return this._heightFactor}},{key:"headWidthFactor",get:function(){return this._headWidthFactor}},{key:"tailWidthFactor",get:function(){return this._tailWidthFactor}}]),i}(f_),C_=function(e){n_(i,e);var t=c_(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e_(this,i),(e=t.call(this,r))._type=m_.TRAPEZOID,e}return i_(i,[{key:"createNodes",value:function(){var e=new Map;this.inverse=!1;var t=u_(o_(i.prototype),"createNodes",this).call(this);e.set(this.inverse,h_(t)),this.inverse=!0;var r=u_(o_(i.prototype),"createNodes",this).call(this);return e.set(this.inverse,h_(r)),this.completedNodes=e,this.inverse=void 0,this._nodes=r.concat(t),this._nodes}}]),i}(y_),x_=function(){function e(t){e_(this,e),this._headHeightFactor=p_(t.headHeightFactor,.2),this._neckHeightFactor=p_(t.neckHeightFactor,.8),this._headWidthFactor=p_(t.headWidthFactor,.5),this._neckWidthFactor=p_(t.neckWidthFactor,.3),this._tailWidthFactor=p_(t.tailWidthFactor,.3),this._tailHeightFactor=p_(t.tailHeightFactor,.2),this._controls=p_(t.controls,[]),this._headComponent=void 0,this._bodyComponent=void 0,this._tailComponent=void 0,this._nodes=void 0,this._polygon=[],this._polyline=[]}return i_(e,[{key:"postProcessing",value:function(e){return e}},{key:"merge",value:function(){var e,t,i,r=this.headComponent,n=this.bodyComponent,o=this.tailComponent;n&&(i=n.completedNodes);var s,a,l=[];(i&&i.get(!0)&&(s=i.get(!0),l=n.linkTail({tailNodes:l,bodyNodes:s})),r&&(s=r.nodes,l=n?n.linkArrow({arrowNodes:s,bodyNodes:l,inverse:!0,target:this}):s),i&&i.get(!1)&&(s=i.get(!1),l=n.linkArrow({arrowNodes:l,bodyNodes:s,inverse:!1,target:this})),o)&&(a=l).push.apply(a,h_(o.nodes));this.reset(),(e=this.polygon).push.apply(e,h_(l.flat())),(t=this.polyline).push.apply(t,h_(l.flat()))}},{key:"update",value:function(){this.createNodes()}},{key:"reset",value:function(){this.polygon.splice(0),this.polyline.splice(0)}},{key:"polygon",get:function(){return this._polygon}},{key:"polyline",get:function(){return this._polyline}},{key:"controls",get:function(){return this._controls}}]),e}(),w_=function(e){n_(i,e);var t=c_(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e_(this,i),(e=t.call(this,r))._type=m_.HALF_SWALLOW_TRAIL,e._controlPointsCount=[3,1/0],e._heightFactor=p_(r.heightFactor,.3),e.createNodes(),e}return i_(i,[{key:"createNodes",value:function(){u_(o_(i.prototype),"createNodes",this).call(this);var e=g_.baseLength(this.controls),t=this._heightFactor*e,r=g_.mid(this.get(0),this.get(1)),n=g_.thirdPoint(this.get(2),r,0,t,this.inverse);return this.nodes=[n],this.nodes}},{key:"heightFactor",get:function(){return this._heightFactor}}]),i}(f_);function b_(e){var t=function(t){if(e.hasOwnProperty(t)&&t.startsWith("_")){var i=t.replace("_","");Object.defineProperty(e,i,{get:function(){return e[t]},set:function(i){e[t]=i}})}};for(var i in e)t(i)}var S_=function(e){n_(i,e);var t=c_(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e_(this,i),r=p_(r,p_.EMPTY_OBJECT),(e=t.call(this,r))._tail=p_(r.tail,!1),e.init(),b_(a_(e)),e.merge(),e}return i_(i,[{key:"addControl",value:function(e){this.controls.length>=i.MIN_CONTROL_COUNT&&this.controls.pop(),this.controls.push(e),this.controls.length>=i.MIN_CONTROL_COUNT&&(this.init(),this.merge())}},{key:"popControl",value:function(){return this.controls.pop()}},{key:"updateControl",value:function(e,t){this.controls[e]=t,this.controls.length>=i.MIN_CONTROL_COUNT&&(this.init(),this.merge())}},{key:"init",value:function(){this.controls.length<i.MIN_CONTROL_COUNT||(this._headComponent=this.createHeadComponent(),this._bodyComponent=this.createBodyComponent(),this._tail&&(this._tailComponent=this.createTailComponent()))}},{key:"update",value:function(){this._headComponent=this.createHeadComponent(),this._bodyComponent=this.createBodyComponent(),this._tail&&(this._tailComponent=this.createTailComponent()),this.merge()}},{key:"createBodyComponent",value:function(){return new C_({controls:this._controls,heightFactor:1-this._neckHeightFactor,headWidthFactor:this._neckWidthFactor,tailWidthFactor:this._tailWidthFactor})}},{key:"createHeadComponent",value:function(){return new v_({controls:this._controls,headWidthFactor:this._headWidthFactor,neckHeightFactor:this._neckHeightFactor,neckWidthFactor:this._neckWidthFactor,headHeightFactor:this._headHeightFactor})}},{key:"createTailComponent",value:function(){if(this._bodyComponent){var e=this._bodyComponent.nodes;return new w_({controls:[].concat(h_(e),[this._controls[1]]),heightFactor:this._tailHeightFactor})}}},{key:"tail",set:function(e){this._tail=e}}]),i}(x_);r_(S_,"MIN_CONTROL_COUNT",2);var T_=function(e){n_(i,e);var t=c_(i);function i(e){var r;return e_(this,i),(r=t.call(this,e))._type=m_.HALF_SPLINE,r._controlPointsCount=[2,1/0],r._headWidthFactor=p_(e.headWidthFactor,.1),r._tailWidthFactor=p_(e.tailWidthFactor,.3),r.createNodes(),r}return i_(i,[{key:"createNodes",value:function(){u_(o_(i.prototype),"createNodes",this).call(this);for(var e=this.controls,t=g_.distance.apply(g_,h_(e)),r=g_.baseLength(e),n=this.tailWidthFactor*r,o=this.headWidthFactor*r,s=Math.abs(n-o)/2,a=0,l=e,c=[],u=1;u<e.length-1;u++){var h=g_.angleOfThreePoints(l[u],l[u-1],l[u+1])/2;a+=g_.distance(l[u-1],l[u]),this.inverse||(h=Math.PI-h);var d=(n/2-a/t*s)/Math.sin(h),p=g_.thirdPoint(l[u-1],l[u],h,d,this.inverse);c.push(p)}return this.completedNodes=new Map,this.completedNodes.set(this.inverse,c),this.nodes=c,c}},{key:"linkArrow",value:function(e){var t=e.arrowNodes,i=e.bodyNodes,r=e.inverse,n=e.target,o=[];if(n._tail&&o.push(n.controls[+!r]),r){o.push.apply(o,h_(i).concat([t[0]]));var s=g_.quadricBSpline(o);return[].concat(h_(s),h_(t))}o.push.apply(o,h_(i).concat([t[t.length-1]]));var a=g_.quadricBSpline(o);return[].concat(h_(t),h_(a.reverse()))}},{key:"linkTail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tailNodes,i=e.bodyNodes;return e.inverse,[].concat(h_(t),h_(i))}},{key:"tailWidthFactor",get:function(){return this._tailWidthFactor}},{key:"headWidthFactor",get:function(){return this._headWidthFactor}}]),i}(f_),E_=function(e){n_(i,e);var t=c_(i);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e_(this,i),t.call(this,e)}return i_(i,[{key:"createNodes",value:function(){var e=new Map;this.inverse=!1;var t=u_(o_(i.prototype),"createNodes",this).call(this);e.set(this.inverse,h_(t)),this.inverse=!0;var r=u_(o_(i.prototype),"createNodes",this).call(this);return e.set(this.inverse,h_(r)),this.inverse=void 0,this.nodes=[].concat(h_(t),h_(r.reverse())),this.completedNodes=e,[].concat(h_(t),h_(r.reverse()))}}]),i}(T_),P_=function(e){n_(i,e);var t=c_(i);function i(e){var r;return e_(this,i),(e=p_(e,{})).headHeightFactor=p_(e.headHeightFactor,.15),e.neckHeightFactor=p_(e.headWidthFactor,.8),e.neckWidthFactor=p_(e.neckWidthFactor,.15),e.headWidthFactor=p_(e.headWidthFactor,.4),e.tailWidthFactor=p_(e.tailWidthFactor,.25),(r=t.call(this,e))._headTailHeightFactor=p_(e.headTailHeightFactor,.5),r._tail=p_(e.tail,!0),r._heightFactor=p_(e.heightFactor,.8),r._tailHeightFactor=p_(e.tailHeightFactor,.05),r.init(),b_(a_(r)),r.merge(),r}return i_(i,[{key:"addControl",value:function(e){this.controls[this.controls.length-1],this.controls.push(e),(!this.tail&&this.controls.length>=i.MIN_CONTROL_COUNT||this.controls.length>=i.MIN_CONTROL_COUNT+1)&&(this.init(),this.merge())}},{key:"updateControl",value:function(e,t){this.controls[e]=t,(!this.tail&&this.controls.length>=i.MIN_CONTROL_COUNT||this.controls.length>=i.MIN_CONTROL_COUNT+1)&&(this.init(),this.merge())}},{key:"popControl",value:function(){this.controls.pop()}},{key:"init",value:function(){var e;!this.tail&&this.controls.length<i.MIN_CONTROL_COUNT||this.tail&&this.controls.length<i.MIN_CONTROL_COUNT+1||(this._head1=this.controls[0],this._head2=this.controls[1],this.tail&&g_.isClockWise(this.controls[0],this.controls[1],this.controls[2])&&(e=[this._head2,this._head1],this._head1=e[0],this._head2=e[1]),this._headComponent=this.createHeadComponent(),this._bodyComponent=this.createBodyComponent(),this._tail&&(this._tailComponent=this.createTailComponent()))}},{key:"createHeadComponent",value:function(){var e,t;this.tail?(e=[g_.mid(this._head1,this._head2)].concat(h_(this.controls.slice(2))),t=g_.distance(this._head1,this._head2)):e=this.controls;var i=e.length;return new v_({controls:e,heightFactor:this._headHeightFactor,neckHeightFactor:this._neckHeightFactor,headWidthFactor:this._headWidthFactor,neckWidthFactor:this._neckWidthFactor,headMaxHeight:this._headTailHeightFactor*t,index:[i-2,i-1]})}},{key:"createBodyComponent",value:function(){var e,t=this.controls.slice(2),i=g_.distance(this._headComponent.nodes[0],this._headComponent.nodes[4]),r=g_.baseLength(t);if(this._tail){e=g_.distance(this.controls[0],this.controls[1]),t=[g_.mid(this._head1,this._head2)].concat(h_(t));var n=g_.baseLength(t);this._tailWidthFactor=e/n}else e=r*this._tailWidthFactor,t=this.controls;return new E_({controls:t,headWidthFactor:i/r,tailWidthFactor:this._tailWidthFactor})}},{key:"createTailComponent",value:function(){if(this._bodyComponent){var e=this.controls;return new w_({controls:e,heightFactor:this._tailHeightFactor})}}}]),i}(x_);r_(P_,"MIN_CONTROL_COUNT",2);var A_=function(e){n_(i,e);var t=c_(i);function i(e){var r;return e_(this,i),(e=p_(e,{})).neckHeightFactor=p_(e.neckHeightFactor,.8),e.neckWidthFactor=p_(e.neckWidthFactor,.2),e.headWidthFactor=p_(e.headWidthFactor,.5),(r=t.call(this,e))._nodes=[],r.init(),b_(a_(r)),r.merge(),r}return i_(i,[{key:"addControl",value:function(e){this.controls.length>=i.MAX_CONTROL_COUNT&&this.popControl(),this.controls.push(e),this.controls.length>=i.MIN_CONTROL_COUNT&&(this.init(),this.merge())}},{key:"updateControl",value:function(e,t){this.controls[e]=t,this.controls.length>=i.MIN_CONTROL_COUNT&&(this.init(),this.merge())}},{key:"popControl",value:function(){return this.controls.pop()}},{key:"init",value:function(){this.controls.length<i.MIN_CONTROL_COUNT||this.getPoints()}},{key:"tempPoint4",value:function(e,t,i){var r,n,o=g_.mid(e,t),s=g_.distance(o,i),a=g_.angleOfThreePoints(e,o,i);a<Math.PI/2||(a<Math.PI&&a>=Math.PI/2?a=Math.PI-a:a>=Math.PI&&a<1.5*Math.PI?a-=Math.PI:a>=1.5*Math.PI&&(a=2*Math.PI-a)),r=s*Math.cos(a),n=s*Math.sin(a);var l=g_.thirdPoint(e,o,Math.PI/2,r,!0);return g_.thirdPoint(o,l,Math.PI/2,n,!1)}},{key:"getPoints",value:function(){var e,t,i,r,n,o,s,a=this.controls;if(!(a<3))if(t=3===a.length?this.tempPoint4.apply(this,h_(a)):a[3],i=a.length<=4?g_.mid(a[0],a[1]):a[4],g_.isClockWise.apply(g_,h_(this.controls.slice(0,3)))){var l;e=this.getArrowControls(a[0],i,t,!0),r=new v_({controls:e,index:[2,3],neckHeightFactor:this._neckHeightFactor,neckWidthFactor:this._neckWidthFactor,headWidthFactor:this._headWidthFactor}),s=g_.distance(a[0],i)/g_.baseLength(e)/2,o=this.getBodyControls(e,r.nodes[0],r.nodes[4],s),e=this.getArrowControls(i,a[1],a[2],!1),n=new v_({controls:e,index:[2,3],neckHeightFactor:this._neckHeightFactor,neckWidthFactor:this._neckWidthFactor,headWidthFactor:this._headWidthFactor}),s=g_.distance(i,a[1])/g_.baseLength(e)/2,(l=o).unshift.apply(l,h_(this.getBodyControls(e,n.nodes[0],n.nodes[4],s)));var c=this.geoBodyPoints([r,n],o,i);this._nodes=[].concat(h_(c[0]),h_(r.nodes),h_(c[1]),h_(n.nodes),h_(c[2]))}else{var u;e=this.getArrowControls(a[0],i,t,!1),r=new v_({controls:e,index:[2,3],neckHeightFactor:this._neckHeightFactor,neckWidthFactor:this._neckWidthFactor,headWidthFactor:this._headWidthFactor}),s=g_.distance(a[0],i)/g_.baseLength(e)/2,o=this.getBodyControls(e,r.nodes[0],r.nodes[4],s),e=this.getArrowControls(i,a[1],a[2],!0),n=new v_({controls:e,index:[2,3],neckHeightFactor:this._neckHeightFactor,neckWidthFactor:this._neckWidthFactor,headWidthFactor:this._headWidthFactor}),s=g_.distance(i,a[1])/g_.baseLength(e)/2,(u=o).unshift.apply(u,h_(this.getBodyControls(e,n.nodes[0],n.nodes[4],s)));var h=this.geoBodyPoints([r,n],o,i);this._nodes=[].concat(h_(h[0]),h_(r.nodes),h_(h[1]),h_(n.nodes),h_(h[2]))}}},{key:"getArrowControls",value:function(e,t,i,r){var n=g_.mid(e,t),o=g_.distance(n,i),s=g_.thirdPoint(i,n,0,.3*o,!1),a=g_.thirdPoint(i,n,0,.5*o,!1);return[n,s=g_.thirdPoint(n,s,Math.PI/2,o/5,r),a=g_.thirdPoint(n,a,Math.PI/2,o/4,r),i]}},{key:"geoBodyPoints",value:function(e,t,i){var r=g_.BezierCurve([this.controls[1],t[0],t[1],e[1].nodes[4]]);return[g_.BezierCurve([this.controls[0],t[6],t[7],e[0].nodes[0]]),g_.BezierCurve([e[0].nodes[4],t[5],t[4],i,t[3],t[2],e[1].nodes[0]]),r.reverse()]}},{key:"getBodyControls",value:function(e,t,i,r){for(var n=g_.distance.apply(g_,h_(e)),o=g_.baseLength(e)*r,s=(o-g_.distance(t,i))/2,a=0,l=[],c=[],u=1;u<e.length-1;u++){var h=g_.angleOfThreePoints(e[u],e[u-1],e[u+1])/2,d=(o/2-(a+=g_.distance(e[u-1],e[u]))/n*s)/Math.sin(h);l.push(g_.thirdPoint(e[u-1],e[u],Math.PI-h,d,!1)),c.push(g_.thirdPoint(e[u-1],e[u],h,d,!0))}return l.concat(c)}},{key:"merge",value:function(){var e,t;this.reset(),(e=this.polygon).push.apply(e,h_(h_(this.nodes).flat())),(t=this.polyline).push.apply(t,h_(h_(this.nodes).flat()))}}]),i}(x_);r_(A_,"MIN_CONTROL_COUNT",3),r_(A_,"MAX_CONTROL_COUNT",5);var M_={straightarrow:"straightarrow",attackarrow:"attackarrow",doublearrow:"doublearrow",validate:function(e){return e===M_.straightarrow||e===M_.attackarrow||e===M_.doublearrow}};const D_={POINT:"point",POLYLINE:"polyline",POLYGON:"polygon",MODEL:"model",LABEL:"label",STRAIGHTARROW:M_.straightarrow,ATTACKARROW:M_.attackarrow,DOUBLEARROW:M_.doublearrow,BILLBOARD:"billboard",MUTIPOINT:"mutipoint",getOGCType:function(e){if(!D_.validate(e))return"unknown";let t="";switch(e){case D_.POINT:case D_.LABEL:case D_.MODEL:case D_.BILLBOARD:t="Point";break;case D_.POLYLINE:t="LineString";break;case D_.STRAIGHTARROW:case D_.ATTACKARROW:case D_.DOUBLEARROW:case D_.POLYGON:t="Polygon";break;case D_.MUTIPOINT:t="MutlPoint"}return t},validate:function(e){return e===D_.POINT||e===D_.POLYLINE||e===D_.POLYGON||e===D_.STRAIGHTARROW||e===D_.ATTACKARROW||e===D_.DOUBLEARROW||e===D_.MODEL||e===D_.LABEL||e===D_.MUTIPOINT||e===D_.BILLBOARD},isPoint:function(e){return e===D_.POINT||e===D_.MODEL||e===D_.LABEL||e===D_.BILLBOARD},isArrow:function(e){return e===D_.ATTACKARROW||e===D_.STRAIGHTARROW||e===D_.DOUBLEARROW}};var L_=Object.freeze(D_);class R_ extends Kg{constructor(e,t={}){super(e=Re(e,{}),t),this._entityOptions=e,this._options=t,this._positions=Re(e.position,new Cesium.Cartesian3),this._type=Re(t.type,L_.POINT),this._entity=this.createEntity(),this._text=Re(e.text,"")}getGeometry(){const e=R_.toDegrees(this.positions),t=[e.lon,e.lat,e.height];return{type:L_.getOGCType(this.type),coordinates:t}}createEntity(){super.createEntity(),delete this._entityOptions.position;const e={id:this.id,position:this.positions};return this.type===L_.POINT&&(e.point=bn(this._entityOptions)),this.type===L_.BILLBOARD&&(e.billboard=bn(this._entityOptions),Oe(e.billboard.image)||(e.billboard.image=On.buildModuleUrl("./assets/marker.png"))),this.type===L_.LABEL&&(e.label=bn(this._entityOptions)),this.type===L_.MODEL&&(e.orientation=this._entityOptions.orientation,delete this._entityOptions.orientation,e.model=bn(this._entityOptions),Oe(e.model.uri)||(e.model.uri=On.buildModuleUrl("./assets/Wood_Tower.gltf"))),this._options.label&&this._type!==L_.LABEL&&(e.label=Cesium.clone(this._options.label)),this._entityOptions=e,new Cesium.Entity(this._entityOptions)}equal(e){return R_.equal(this,e)}get text(){return this._text}set text(e){if(this.entity.label)this.entity.label.text=e;else{const t=Cesium.clone(this._entityOptions);t.text=e,this.addLabel(t)}this._text=e}addLabel(e){this.entity.label=e}updatePointStyle(e){if(e&&this.entity.point)for(const t in e)e.hasOwnProperty(t)&&(this.entity.point[t]=e[t])}updateLabelStyle(e){if(e&&this.entity.label)for(const t in e)e.hasOwnProperty(t)&&(this.entity.label[t]=e[t])}updateModelStyle(e){if(e&&this.entity.model)for(const t in e)e.hasOwnProperty(t)&&(this.entity.model[t]=e[t])}updateBillboardStyle(e){if(e&&this.entity.billboard)for(const t in e)e.hasOwnProperty(t)&&(this.entity.billboard[t]=e[t])}updatePosition(e){this.positions.x=e.x,this.positions.y=e.y,this.positions.z=e.z}static equal(e,t){return!(!Oe(e)||!Oe(t))&&(e instanceof R_&&(e=e.positions),t instanceof R_&&(t=t.positions),Cesium.Cartesian3.equals(e,t))}static defaultStyle={color:Cesium.Color.RED,pixelSize:5,outlineColor:Cesium.Color.WHITE,outlineWidth:3,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND};static toDegrees(e){return e instanceof Cesium.Cartesian3?Ie.fromCartesian(e):e instanceof R_?Ie.fromCartesian(e.positions):void 0}toGeoJson(){return R_.toGeoJson(this)}static toGeoJson(e){L_.getOGCType(e.type);const t=e.properties?e.properties.toJson():{};t.PlotType=e.type;return{type:"Feature",properties:t,geometry:e.getGeometry()}}static fromGeoJson(e,t){if("string"==typeof e&&(e=JSON.parse(e)),!Oe(e.geometry)||!Oe(e.properties))return;if(e.properties.PlotType!==L_.POINT)throw new CesiumProError("json没有包含一个有效的PointGraphic.");const i=e.geometry&&e.geometry.coordinates;return R_.fromCoordinates(i,e.properties,t)}static fromCoordinates(e,t,i=R_.defaultStyle){const r={position:Cesium.Cartesian3.fromDegrees(...e),properties:t,...i};return new R_(r)}static defaultPointStyle=R_.defaultStyle;static defaultLabelStyle={font:"24px Helvetica",fillColor:Cesium.Color.WHITE,showBackground:!0,style:Cesium.LabelStyle.FILL_AND_OUTLINE,scale:1,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,0),heightReference:Cesium.HeightReference.NONE};static defaultBillboardStyle={verticalOrigin:Cesium.VerticalOrigin.BASELINE,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND};static defaultModelStyle={colorBlendMode:Cesium.ColorBlendMode.HIGHLIGHT,color:Cesium.Color.WHITE,colorBlendAmount:.5,minimumPixelSize:64}}class O_ extends Kg{constructor(e,t={}){super(e,t),this._entityOptions=Re(e,{}),this._positions=Re(this._entityOptions.positions,[]),this._nodePositions=this._positions,this._type=L_.POLYLINE,this._entity=this.createEntity()}getGeometry(){const e=[],t=L_.getOGCType(this.type);for(const t of this.positions){const i=R_.toDegrees(t);e.push([i.lon,i.lat,i.height])}return{type:t,coordinates:e}}createEntity(){super.createEntity();const e={id:this.id,polyline:this._entityOptions};return this._entityOptions=e,new Cesium.Entity(this._entityOptions)}toGeoJson(){return O_.toGeoJson(this)}startEdit(){super.startEdit()}stopEdit(){super.stopEdit()}addNode(e,t){const i=this.positions.length;if(Oe(t)&&t<i){for(let e=i;e>t;e--)this.positions[e]=this.positions[e-1];this.positions[t]=e}else this.positions.push(e)}removeNode(e){Oe(e)&&(e<0||e>=this.positions.length||this.positions.splice(e,1))}popNode(){const e=this.positions.length-1;this.removeNode(e)}updateNode(e,t){e>=this.positions.length||(this.positions[e]=t)}updateStyle(e){if(e&&this.entity.model)for(const t in e)e.hasOwnProperty(t)&&(this.entity.polyline[t]=e[t])}static toGeoJson(e){L_.getOGCType(e.type);const t=e.properties?e.properties.toJson():{};t.PlotType=e.type;return{type:"Feature",properties:t,geometry:e.getGeometry()}}static fromGeoJson(e,t){if("string"==typeof e&&(e=JSON.parse(e)),!Oe(e.geometry)||!Oe(e.properties))return;if(e.properties.PlotType!==L_.POLYLINE)throw new CesiumProError("json没有包含一个有效的PolylineGraphic.");const i=e.geometry&&e.geometry.coordinates;return O_.fromCoordinates(i,e.properties,t)}static fromCoordinates(e,t,i=O_.defaultStyle){const r={positions:Cesium.Cartesian3.fromDegreesArray(e.flat()),properties:t,...i};return new O_(r)}static defaultStyle={clampToGround:!0,material:Cesium.Color.fromCssColorString("rgba(247,224,32,1)"),width:3};static highlightStyle={clampToGround:!0,material:Cesium.Color.AQUA,width:3}}class I_ extends Kg{constructor(e,t={}){super(e,t),this._entityOptions=e,this._positions=Re(e.positions,[]),this._nodePositions=[...this.positions],this._nodePositions.length&&(this._nodePositions[this._nodePositions.length]=this._nodePositions[0]),this._type=L_.POLYGON,this._entity=this.createEntity()}getGeometry(){return I_.getGeometry(this)}static getGeometry(e){const t=[],i=L_.getOGCType(e.type);for(const i of e.positions){const e=R_.toDegrees(i);t.push([e.lon,e.lat,e.height])}return t.push(t[0]),{type:i,coordinates:[t]}}createEntity(){super.createEntity(),delete this._entityOptions.positions;const e={id:this.id,polygon:{hierarchy:this.positions,...this._entityOptions}};return this._entityOptions.outline&&(e.polyline={positions:this._nodePositions,material:this._entityOptions.outlineColor,width:this._entityOptions.outlineWidth},e.polygon.outline=!1,e.polyline.clampToGround=this._entityOptions.heightReference===Cesium.HeightReference.CLAMP_TO_GROUND),this._entityOptions=e,new Cesium.Entity(this._entityOptions)}toGeoJson(){return I_.toGeoJson(this)}startEdit(){super.startEdit()}stopEdit(){super.stopEdit()}addNode(e,t){const i=this.positions.length;if(Oe(t)&&t<i&&t>=0){for(let e=i;e>t;e--)this.positions[e]=this.positions[e-1],this._nodePositions[e]=this._nodePositions[e-1];this.positions[t]=e,this._nodePositions[t]=e}else t=i,this.positions.push(e),this._nodePositions[t]=e;this._positions.length&&(this._nodePositions[i+1]=this._nodePositions[0])}removeNode(e){if(!Oe(e))return;if(e<0||e>=this.positions.length)return;this.positions.splice(e,1),this._nodePositions.splice(e,1);const t=this.positions.length;0===e&&(this._nodePositions[t]=this._nodePositions[0])}popNode(){const e=this.positions.length-1;this.removeNode(e)}updateNode(e,t){if(e>=this.positions.length)return;this.positions[e]=t;const i=this.positions.length;this._nodePositions[e]=t,0===e&&(this._nodePositions[i]=t)}updateStyle(e){if(e&&this.entity.model)for(const t in e)e.hasOwnProperty(t)&&("outline"===t&&!e.outline&&this.entity.polyline&&(this.entity.polyline=void 0),"outlineColor"===t&&this.entity.polyline&&(this.entity.polyline.material=e[t]),"outlineWidth"===t&&this.entity.polyline&&(this.entity.polyline.width=e[t]),this.entity.polygon[t]=e[t])}static toGeoJson(e){L_.getOGCType(e.type);const t=e.properties?e.properties.toJson():{};t.PlotType=e.type;return{type:"Feature",properties:t,geometry:e.getGeometry()}}static fromGeoJson(e,t){if("string"==typeof e&&(e=JSON.parse(e)),!Oe(e.geometry)||!Oe(e.properties))return;if(e.properties.PlotType!==L_.POLYGON)throw new Le("json没有包含一个有效的PolygonGraphic.");const i=e.geometry&&e.geometry.coordinates;return I_.fromCoordinates(i,e.properties,t)}static fromCoordinates(e,t,i=I_.defaultStyle){const r={positions:Cesium.Cartesian3.fromDegreesArray(e[0].flat()),properties:t,...i};return new I_(r)}static defaultStyle={material:Cesium.Color.fromCssColorString("rgba(247,224,32,0.5)"),outlineColor:Cesium.Color.RED,outlineWidth:2,outline:!1,perPositionHeight:!1,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND};static highlightStyle={material:new Cesium.ColorMaterialProperty(Cesium.Color.AQUA.withAlpha(.4)),outlineColor:Cesium.Color.AQUA.withAlpha(.4)};static centerFromPonits(e){const t=Cesium.BoundingSphere.fromPoints(e);if(t)return t.center}static center(e){let t=[];function i(e){if(e.getValue){const i=e.getValue();t=i instanceof Cesium.PolygonHierarchy?i.positions:i}else Array.isArray(e)&&(t=e)}if(e instanceof Cesium.Entity){const{hierarchy:t}=e.polygon;i(t)}else e.polygonHierarchy?t=e.polygonHierarchy.positions:e.hierarchy&&i(e.hierarchy);return I_.centerFromPonits(t)}static isClockWise(e,t){const i=Cesium.EllipsoidTangentPlane.fromPoints(e,t.scene.globe.ellipsoid),r=Cesium.arrayRemoveDuplicates(e,Cesium.Cartesian3.equalsEpsilon,!0),n=i.projectPointsOntoPlane.bind(i)(r);return Cesium.PolygonPipeline.computeWindingOrder2D(n)===Cesium.WebGLConstants.CW}}const N_=function(e,t,i){if(t===Vr.SURFACE_DISTANCE||t===Vr.SPACE_DISTANCE||t===Vr.HEIGHT){const t=i?"总长度 ":"";return e>1e4?`${t}${(e/1e3).toFixed(2)} km`:`${t}${e.toFixed(2)} m`}return t===Vr.SURFACE_AREA||t===Vr.SPACE_AREA?e>1e7?`${(e/1e3/1e3).toFixed(2)} km²`:`${e.toFixed(2)} m²`:t===Vr.ANGLE?`${(e%360).toFixed(2)}°`:void 0};class k_{constructor(e){this._type=L_.MUTIPOINT,this._positions=Re(e.positions,[]),this._entityOptions=e,this._values=[],this.createEntity(),this._activeNode=void 0,this.activeIndex=void 0}get activeNode(){return this._activeNode}set activeNode(e){this._activeNode=e,this.activeIndex=this.getIndexByPosition(e),this.highlightActiveNode()}highlightActiveNode(){const e=this._values.filter((e=>Oe(e.position)));for(let t=0,i=e.length;t<i;t++){const i=e[t];t===this.activeIndex?k_.highlightNode(i):(i.point.color=this._entityOptions.color,i.point.outlineColor=this._entityOptions.outlineColor)}}getGeometry(){const e=[],t=L_.getOGCType(this.type);for(const t of this.positions){const i=R_.toDegrees(t);e.push([i.lon,i.lat,i.height])}return{type:t,coordinates:e}}static highlightNode(e){e&&e.point&&(e.point.color=Cesium.Color.AQUA,e.point.outlineColor=Cesium.Color.AQUA)}get(e){return this._values.filter((e=>Oe(e.position)))[e]}getIndexByPosition(e){for(let t=0,i=this._positions.length;t<i;t++){const i=this._positions[t];if(R_.equal(i,e))return t}return-1}has(e){return this._values.includes(e)}createEntity(){delete this._entityOptions.positions;const e=this._entityOptions,t=this._positions.length;for(let i=0;i<t;i++){const t=new Cesium.Entity({position:new Cesium.CallbackProperty((()=>this._positions[i]),!1),point:e});this._values.push(t)}}addNode(e,t){const i=this._entityOptions;if(this._values.length<this._positions.length){return new Cesium.Entity({position:new Cesium.CallbackProperty((()=>this._positions[this._positions.length-1]),!1),point:i})}}removeNode(e){Oe(e)}popNode(){const e=this._positions.length-1;return this.removeNode(e)}updateNode(e,t){e>=this._positions.length||(this._positions[e]=t)}destroy(){this._values=void 0}toGeoJson(){return k_.toGeoJson(this)}get values(){return this._values}static toGeoJson(e){L_.getOGCType(graphic.type);const t=graphic.properties?graphic.properties.toJson():{};t.PlotType=graphic.type;return{type:"Feature",properties:t,geometry:graphic.getGeometry()}}static defaultStyle=R_.defaultStyle}class F_ extends Kg{constructor(e,t={}){if(super(e,t),this._type=Re(t.type,L_.STRAIGHTARROW),this._entityOptions=e,this._positions=Re(e.positions,[]),this._arrowType=Re(t.type,L_.STRAIGHTARROW),!M_.validate(this._arrowType))throw new Le("无效的箭头图形.");const i=[];for(let e of this.positions){const t=R_.toDegrees(e);i.push([t.lon,t.lat])}this._arrowType===M_.straightarrow&&(this._arrow=new S_({controls:i})),this._arrowType===M_.attackarrow&&(this._arrow=new P_({controls:i})),this._arrowType===M_.doublearrow&&(this._arrow=new A_({controls:i})),this._entity=this.createEntity(),this._nodePositions=this._positions}get arrow(){return this._arrow}getGeometry(){I_.getGeometry(this)}createEntity(){super.createEntity(),delete this._entityOptions.positions;const e={id:this.id,polygon:{hierarchy:this._arrow.polygon.length?Cesium.Cartesian3.fromDegreesArray(this._arrow.polygon):this._arrow.polygon,...this._entityOptions}};return this._entityOptions.outline&&(e.polyline={positions:this._arrow.polyline.length?Cesium.Cartesian3.fromDegreesArray(this._arrow.polyline):this._arrow.polyline,material:this._entityOptions.outlineColor,width:this._entityOptions.outlineWidth},e.polygon.outline=!1),this._entityOptions=e,new Cesium.Entity(this._entityOptions)}startEdit(){}stopEdit(){}addNode(e){if(this.arrow){const t=R_.toDegrees(e);this.arrow.addControl([t.lon,t.lat]),this.updatePositions(),this.updateEntity(),this.lastLon=t.lon}}popNode(){this.arrow&&(this.arrow.popControl(),this.updatePositions(),this.updateEntity())}updateNode(e,t){if(this.arrow){const i=R_.toDegrees(t);this.arrow.updateControl(e,[i.lon,i.lat]),this.updatePositions(),this.updateEntity()}}updatePositions(){if(!Oe(this.arrow))return;const e=this.arrow.controls;for(let t=0;t<e.length;t++)this.positions[t]=Cesium.Cartesian3.fromDegrees(e[t][0],e[t][1]);this.positions.length>e.length&&this.positions.splice(e.length)}updateEntity(){if(this.entity&&this.entity.polygon){const e=this.arrow.polygon.filter((e=>!isNaN(e))),t=this.arrow.polyline.filter((e=>!isNaN(e)));this.entity.polygon.hierarchy=e.length?Cesium.Cartesian3.fromDegreesArray(e):e,this.entity.polyline&&(this.entity.polyline.positions=t.length?Cesium.Cartesian3.fromDegreesArray([...t,t[0],t[1]]):t)}}}const{LEFT_CLICK:z_,MOUSE_MOVE:B_,RIGHT_CLICK:G_,LEFT_DOWN:W_,LEFT_UP:U_,LEFT_DOUBLE_CLICK:H_,RIGHT_DOWN:V_,RIGHT_UP:j_}=Cesium.ScreenSpaceEventType,q_=1,$_=3;const{Material:Y_,Color:X_,Property:J_}=Cesium;class Z_{constructor(e={}){this._fadeInColor=Re(e.fadeInColor,Cesium.Color.RED),this._fadeOutColor=Re(e.fadeOutColor,Cesium.Color.WHITE.withAlpha(.5)),this._time=Re(e.time,new Cesium.Cartesian2(0,0)),this._repeat=Re(e.repeat,!1),this._duration=Re(e.duration,3e3),this._fadeDirection=Re(e.fadeDirection,{x:!0,y:!1}),this._maximumDistance=Re(e.maximumDistance,.5),this._definitionChanged=new Ge}get fadeInColor(){return this._fadeInColor}set fadeInColor(e){this._fadeInColor=e}get fadeOutColor(){return this._fadeOutColor}set fadeOutColor(e){this._fadeOutColor=e}get duration(){return this._duration}set duration(e){this._duration=e}get time(){return this._time}set time(e){this._time=e}get isConstant(){return!1}get definitionChanged(){return this._definitionChanged}get fadeDirection(){return this._fadeDirection}set fadeDirection(e){this._fadeDirection=e}get repeat(){return this._repeat}set repeat(e){this._repeat=e}get maximumDistance(){return this._maximumDistance}set maximumDistance(e){this._maximumDistance=e}getType(){return Y_.FadeType}getValue(e,t){return t=Re(t,{}),void 0===this._time&&(this._time={x:e.secondsOfDay,y:e.secondsOfDay}),this.fadeDirection.x&&(t.time.x=1e3*(e.secondsOfDay-this.time.x)/this.duration%1),this.fadeDirection.y&&(t.time.y=1e3*(e.secondsOfDay-this.time.y)/this.duration%1),t.fadeInColor=this.fadeInColor,t.fadeOutColor=this.fadeOutColor,t.maximumDistance=this.maximumDistance,t.repeat=this.repeat,t.fadeDirection=this.fadeDirection,t}equals(e){return this===e||e instanceof Z_&&this.fadeInColor===e.fadeInColor&&this.fadeOutColor===e.fadeOutColor&&this.maximumDistance===e.maximumDistance&&this.repeat===e.repeat&&this.fadeDirection===e.fadeDirection}}const Q_="\nczm_material czm_getMaterial(czm_materialInput materialInput){\n  czm_material material=czm_getDefaultMaterial(materialInput);\n  vec2 st=materialInput.st*repeat;\n  float s=1.0-fract(time-st.s);\n  if(wrapX){\n    s= s=1.0-fract(time-st.t);\n  }\n  vec4 imageRGBA=texture2D(image,vec2(s,st.t));\n  material.alpha = imageRGBA.a * color.a;\n\tmaterial.diffuse = max(color.rgb * material.alpha * gradient, color.rgb);\n  return material;\n}\n",{Material:K_,Color:ev}=Cesium;K_.DynamicFlowWallType="DynamicFlowWall",K_._materialCache.addMaterial(K_.DynamicFlowWallType,{fabric:{type:K_.DynamicFlowWallType,uniforms:{color:new ev(1,0,0),time:0,gradient:1,image:"",repeat:{x:1,y:1},wrapX:!1},source:Q_}});class tv{constructor(e={}){this._color=Re(e.color,Cesium.Color.RED),this._time=0,this._duration=Re(e.duration,1e3),this._gradient=Re(e.gradient,1),this._image=Re(e.image,On.buildModuleUrl("./assets/images/wall.png")),this._wrapX=Re(e.wrapX,!1),this._repeat=Re(e.repeat,new Cesium.Cartesian2(1,1)),this._definitionChanged=new Ge}get color(){return this._color}get time(){return this._time}get definitionChanged(){return this._definitionChanged}get isConstant(){return!1}set color(e){this._color=e}get duration(){return this._duration}set duration(e){this._duration=e}get gradient(){return this._gradient>0?this._gradient:0}set gradient(e){this._gradient=e}get image(){return this._image}set image(e){this._image=e}get wrapX(){return this._wrapX}set wrapX(e){this._wrapX=e}get repeat(){return this._repeat}set repeat(e){this._repeat=e}getType(e){return K_.DynamicFlowWallType}getValue(e,t){return(t=Re(t,{})).color=this.color,void 0===this._time&&(this._time=e.secondsOfDay),t.time=1e3*(e.secondsOfDay-this.time)/this.duration,t.gradient=this.gradient,t.image=this.image,t.wrapX=this.wrapX,t.repeat=this.repeat,t}equals(e){return this===e||e instanceof tv&&this.color===e.color&&this.gradient===e.gradient&&this.image===e.image&&this.wrapX===e.wrapX&&this.repeat===e.repeat}}const iv="\nczm_material czm_getMaterial(czm_materialInput materialInput){\n  czm_material material=czm_getDefaultMaterial(materialInput);\n  vec2 st=materialInput.st;\n  float per=fract(time);\n  float dis=distance(st,vec2(0.5));\n  if(dis*2.0>per){\n    discard;\n  }else{\n    material.alpha=pow(color.a*dis*2.0/per,gradient);\n    material.diffuse=color.rgb;\n  }\n  return material;\n}\n",{Material:rv,Color:nv}=Cesium;rv.DynamicSpreadType="DynamicSpread",rv._materialCache.addMaterial(rv.DynamicSpreadType,{fabric:{type:rv.DynamicSpreadType,uniforms:{color:new nv(1,0,0),time:0,gradient:0},source:iv}});class ov{constructor(e={}){this._color=Re(e.color,Cesium.Color.RED),this._time=0,this._duration=Re(e.duration,1e3),this._gradient=Re(e.gradient,4),this._definitionChanged=new Ge}get color(){return this._color}get time(){return this._time}get definitionChanged(){return this._definitionChanged}get isConstant(){return!1}set color(e){this._color=e}get duration(){return this._duration}set duration(e){this._duration=e}get gradient(){return this._gradient}set gradient(e){this._gradient=e}getType(e){return rv.DynamicSpreadType}getValue(e,t){return(t=Re(t,{})).color=this.color,void 0===this._time&&(this._time=e.secondsOfDay),t.time=1e3*(e.secondsOfDay-this.time)/this.duration,t.gradient=this.gradient,t}equals(e){return this===e||e instanceof ov&&this.color===e.color&&this.gradient===e.gradient}}const sv="\nczm_material czm_getMaterial(czm_materialInput materialInput){\n  czm_material material=czm_getDefaultMaterial(materialInput);\n  material.diffuse=1.5*color.rgb;\n  vec2 st=materialInput.st;\n  vec3 str=materialInput.str;\n  float dis=distance(st,vec2(0.5));\n  float per=fract(time);\n  if(dis>=0.5){\n    discard;\n  }else{\n    float perDis=0.5/count;\n    float bl=0.0;\n    for(int i=0;i<99;i++){\n      if(float(i)>count){\n        break;\n      }\n      float disNum=perDis*float(i)-dis+per/count;\n      if(disNum>0.0){\n        if(disNum<perDis){\n          bl=1.0-disNum/perDis;\n        }else if(disNum-perDis<perDis){\n          bl=1.0-abs(1.0-disNum/perDis);\n        }\n        material.alpha=pow(bl,gradient);\n      }\n    }\n  }\n  return material;\n}\n",{Material:av,Color:lv,Property:cv}=Cesium;av.DynamicWaveType="DynamicWave",av._materialCache.addMaterial(av.DynamicWaveType,{fabric:{type:av.DynamicWaveType,uniforms:{count:1,color:lv.RED,duration:1e3,time:0,gradient:.1},source:sv}});class uv{constructor(e={}){this._color=Re(e.color,Cesium.Color.RED),this._time=Re(e.time,0),this._duration=Re(e.duration,1e3),this._count=Re(e.count,3),this._gradient=Re(e.gradient,1),this._gradient=Cesium.Math.clamp(this._gradient,0,1),this._definitionChanged=new Ge}get color(){return this._color}set color(e){this._color=e}get duration(){return this._duration}set duration(e){this._duration=e}get time(){return this._time}set time(e){this._time=e}get isConstant(){return!1}get definitionChanged(){return this._definitionChanged}get count(){return this._count}set count(e){this._count=e}get gradient(){return this._gradient}set gradient(e){this._gradient=e}getType(){return av.DynamicWaveType}getValue(e,t){return t=Re(t,{}),void 0===this._time&&(this._time=e.secondsOfDay),t.time=1e3*(e.secondsOfDay-this.time)/this.duration,t.color=this.color,t.count=this.count,t.duration=this.duration,t.gradient=10*this.gradient+1,t}equals(e){return this===e||e instanceof uv&&this.count===e.count&&this.duration===e.duration&&this.color===e.color&&this.gradient===e.gradient}}const{Material:hv,Color:dv}=Cesium;class pv{constructor(e={}){this._definitionChanged=new Ge,this._color=void 0,this.color=e.color}get isConstant(){return!0}get definitionChanged(){return this._definitionChanged}getType(){return pv.materialType}getValue(e,t={}){return t.color=this.color||dv.RED,t}equals(e){return this===e||e instanceof pv&&e.color===this.color}static materialType="PolylineAntialiasing"}hv._materialCache.addMaterial(pv.materialType,{fabric:{type:pv.materialType,uniforms:{color:new dv(1,1,1,1)},source:"\n    czm_material czm_getMaterial(czm_materialInput materialInput) { \n\n      czm_material material = czm_getDefaultMaterial(materialInput); \n\n      vec2 st = materialInput.st; \n\n      material.diffuse = color.rgb * vec3(2.0); \n\n      float dis = 1.0 - abs(0.5 - st.t) * 2.0;\n      material.alpha = pow(dis * color.a, 3.0); \n\n      return material; \n\n    }\n    "},translucent:!0});const mv="\n  czm_material czm_getMaterial(czm_materialInput materialInput) {\n  czm_material material = czm_getDefaultMaterial(materialInput);\n  vec2 st = materialInput.st;\n  vec4 imageRgba=texture2D(image, vec2(1.0 - fract(time - st.s),st.t));\n  material.alpha =imageRgba.a * color.a;\n  material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb);\n  return material;\n}\n",{Material:fv,Color:gv}=Cesium;fv.PolylineFlowType="PolylineFlow",fv._materialCache.addMaterial(fv.PolylineFlowType,{fabric:{type:fv.PolylineFlowType,uniforms:{color:new gv(1,0,0),image:"",time:0},source:mv}});class _v{constructor(e={}){this._color=Re(e.color,Cesium.Color.RED),this._time=Re(e.time,0),this._image=Re(e.image,On.buildModuleUrl("./assets/images/flowLine.png")),this._duration=Re(e.duration,1e3),this._definitionChanged=new Ge}get color(){return this._color}get time(){return this._time}get image(){return this._image}set image(e){this._image=e}get definitionChanged(){return this._definitionChanged}get isConstant(){return!0}set color(e){this._color=e}get duration(){return this._duration}set duration(e){this._duration=e}getType(e){return fv.PolylineFlowType}getValue(e,t){return(t=Re(t,{})).color=this.color,void 0===this._time&&(this._time=e.secondsOfDay),t.time=1e3*(e.secondsOfDay-this.time)/this.duration,t.image=this.image,t}equals(e){return this===e||e instanceof _v&&this.color===e.color&&this.image===e.image}}const{Material:vv,Color:yv}=Cesium;vv.ODLineType="ODLine",vv._materialCache.addMaterial(vv.ODLineType,{fabric:{type:vv.ODLineType,uniforms:{startTime:0,speed:2.3,bidirectional:2,baseColor:yv.RED,color:yv.WHITE},source:"\n    czm_material czm_getMaterial(czm_materialInput materialInput) {\n      czm_material material = czm_getDefaultMaterial(materialInput);\n      vec2 st = materialInput.st;\n      float t = fract(startTime + czm_frameNumber * speed / 1000.0);\n      t *= 1.03;\n      float alpha0 = smoothstep(t - 0.03, t, st.s) * step(st.s, t);\n      float mt = 1. - t;\n      float alpha1 = smoothstep(mt + 0.03, mt, st.s) * step(mt, st.s);\n\n      float a0 = step(abs(bidirectional - 0.0) - 0.001, 0.);//1\n      float a1 = step(abs(bidirectional - 1.0) - 0.001, 0.);//\n      float db = step(abs(bidirectional - 2.0) - 0.001, 0.);\n      float alpha = alpha0 * (a0 + db) + alpha1 * (a1 + db);\n      alpha = clamp(alpha, 0., 1.);    \n      material.diffuse = color.rgb * alpha + baseColor.rgb * (1. - alpha);\n      material.alpha = (color.a * alpha + baseColor.a * (1. - alpha));\n      return material;\n    }"}});class Cv{constructor(e={}){this.baseColor=Re(e.baseColor,Cesium.Color.RED),this.color=Re(e.color,Cesium.Color.WHITE),this.speed=Re(e.speed,3),this.startTime=Re(e.startTime,Math.random()),this.bidirectional=Re(e.bidirectional,2),this._definitionChanged=new Event}get isConstant(){return!1}get definitionChanged(){return this._definitionChanged}getType(){return vv.ODLineType}getValue(e,t){return(t=Re(t,{})).baseColor=this.baseColor,t.color=this.color,t.speed=this.speed,t.startTime=this.startTime,t.bidirectional=this.bidirectional,t}equals(e){return this===e||e instanceof Cv&&this.baseColor===e.baseColor&&this.speed===e.speed&&this.color===e.color&&this.startTime===e.startTime&&this.bidirectional===e.bidirectional}}const xv="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n         czm_material material = czm_getDefaultMaterial(materialInput);\n         vec2 st = materialInput.st;\n         vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n         material.alpha=colorImage.a*color.a;\n         float factor=colorImage.a;\n         material.diffuse=mix(color.rgb,colorImage.rgb,factor);\n         return material;\n        }",{Material:wv,Color:bv}=Cesium;wv.PolylineTrailLinkType="PolylineTrailLink",wv._materialCache.addMaterial(wv.PolylineTrailLinkType,{fabric:{type:wv.PolylineTrailLinkType,uniforms:{color:new bv(1,0,0),image:"",time:0},source:xv}});class Sv{constructor(e={}){this._color=Re(e.color,Cesium.Color.RED),this._time=Re(e.time,0),this._image=Re(e.image,On.buildModuleUrl("./assets/images/colors.png")),this._duration=Re(e.duration,1e3),this._definitionChanged=new Ge}get color(){return this._color}set color(e){this._color=e}get duration(){return this._duration}set duration(e){this._duration=e}get time(){return this._time}set time(e){this._time=e}get isConstant(){return!1}get definitionChanged(){return this._definitionChanged}get image(){return this._image}set image(e){this._image=e}getType(){return wv.PolylineTrailLinkType}getValue(e,t){return t=Re(t,{}),void 0===this._time&&(this._time=e.secondsOfDay),t.time=1e3*(e.secondsOfDay-this.time)/this.duration,t.color=this.color,t.image=this.image,t}equals(e){return this===e||e instanceof Sv&&this.color===e.color&&this.image===e.image}}Cesium;const{BoundingRectangle:Tv,Cartesian3:Ev,Cartographic:Pv,Color:Av,defined:Mv,destroyObject:Dv,Matrix4:Lv,OrthographicOffCenterFrustum:Rv,PixelFormat:Ov,ClearCommand:Iv,Framebuffer:Nv,PassState:kv,PixelDatatype:Fv,Texture:zv,PolygonGeometry:Bv,PolygonHierarchy:Gv,BoundingSphere:Wv,VertexArray:Uv,BufferUsage:Hv,ShaderProgram:Vv,RenderState:jv,WebGLConstants:qv,DrawCommand:$v,PrimitiveType:Yv,Pass:Xv,Transforms:Jv,CustomShader:Zv,UniformType:Qv,TextureUniform:Kv,TextureManager:ey,ShaderSource:ty}=Cesium,iy=ey.prototype.loadTexture2D;ey.prototype.loadTexture2D=function(e,t){t.texture?this._textures[e]=t.texture:iy(e,t)};class ry{constructor(){this.viewMatrix=Lv.IDENTITY,this.inverseViewMatrix=Lv.IDENTITY,this.frustum=new Rv,this.positionCartographic=new Pv,this.upWC=Ev.clone(Ev.UNIT_Y),this.rightWC=Ev.clone(Ev.UNIT_X),this.directionWC=Ev.clone(Ev.UNIT_Z),this.viewPorjectionMatrix=Lv.IDENTITY}clone(e){Lv.clone(e.viewMatrix,this.viewMatrix),Lv.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),Pv.clone(e.positionCartographic,this.positionCartographic),Ev.clone(e.upWC,this.upWC),Ev.clone(e.rigtWC,this.rightWC),Ev.clone(e.directionWC,this.directionWC)}}function ny(e){const t=parseInt(this._width),i=parseInt(this._height),r=this._colorTexture,n=Mv(r)&&r.width!==t&&r.height!==i;Mv(this.frameBuffer)||n||(r&&!r.isDestroyed()&&r.destroy(),this._depthStenclilTexture&&!this._depthStenclilTexture.isDestroyed()&&this._depthStenclilTexture.destroy(),this.frameBuffer&&!this.frameBuffer.isDestroyed()&&this.frameBuffer.destroy(),this._colorTexture=new zv({context:this._frameState.context,width:this._width,height:this._height,pixelFormat:Ov.RGBA,pixelDatatype:Fv.UNSIGNED_BYTE}),window._colorTexture=this._colorTexture,this._clearPassState=new kv(e.context),this._depthStenclilTexture=new zv({context:e.context,width:t,height:i,pixelFormat:Ov.DEPTH_STENCIL,pixelDatatype:Fv.UNSIGNED_INT_24_8}),this.frameBuffer=new Nv({context:e.context,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStenclilTexture,destroyAttachments:!1}))}const{AssociativeArray:oy,destroyObject:sy,CustomDataSource:ay,Event:ly}=Cesium,cy=function(){return{}},uy=[31638318];for(let e=1;e<20;e++)uy.push(uy[e-1]/2);function hy(e){let t=0;for(let i of uy){if(e>i)break;t++}return t}class dy extends dd{constructor(e={}){super(e),this._id=Re(e.id,eo()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new ly,this._maxClusterLevel=Re(e.maxClusterLevel,12),this._minLoadLevel=Re(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={}}get id(){return this._id}get dataSource(){return this._dataSource}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=hy(e),i=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,i)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){hy(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=hy(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){this._dataSource||(this._scene=t,this._dataSource=new ay("massive-layer"+eo()),this._scene.dataSources.add(this._dataSource))}createGeometry(e,t,i){if(e.level<this._minLoadLevel)return;const r=Re(this._createGeometryFunction,cy)(i,e,t),n=Object.keys(i);for(let e of n)"position"!==e&&"id"!==e&&"cartesian"!==e&&"cartographic"!==e&&"label"!==e&&"billboard"!==e&&"__pixel"!==e&&(r[e]=i[e]);return this.add(r),r}removeGeometry(e,t){if(!t)return;const i=this._dataSource.entities.remove(t);return sy(t),i}add(e){this._dataSource&&e&&this._dataSource.entities.add(e)}removeAll(){this._dataSource.entities.removeAll()}isDestroyed(){return!1}destroy(){this._dataSource.removeAll(),sy(this)}}const{QuadtreeTileProvider:py,GeographicTilingScheme:my,when:fy,Event:gy,Cartographic:_y,Color:vy,Entity:yy}=Cesium;const{destroyObject:Cy,Event:xy,Transforms:wy}=Cesium,by=function(e,t){const i={};if(e.modelMatrix)i.modelMatrix=e.modelMatrix;else if(e.position){let t=e.position;if(e.position instanceof Ie&&(t=e.position.toCartesian()),!t)return;i.modelMatrix=wy.eastNorthUpToFixedFrame(t),e.modelMatrix=i.modelMatrix}return i.minimumPixelSize=Re(e.minimumPixelSize,t.minimumPixelSize),i.maximumScale=Re(e.maximumScale,t.maximumScale),i.scale=Re(e.scale,t.scale),i.allowPicking=Re(e.allowPicking,t.allowPicking),i.shadows=Re(e.shadows,t.shadows),i.id=e._id,i.url=Re(e.url,t.url),Cesium.Model.fromGltf(i)},Sy=[31638318];for(let e=1;e<20;e++)Sy.push(Sy[e-1]/2);function Ty(e){let t=0;for(let i of Sy){if(e>i)break;t++}return t}const{QuadtreeTileProvider:Ey,GeographicTilingScheme:Py,when:Ay,Event:My,Cartographic:Dy,Color:Ly,Entity:Ry,createGuid:Oy}=Cesium;const Iy="\nczm_material czm_getMaterial(czm_materialInput materialInput) {\n    float time = (czm_frameNumber * speed / 1000.0);\n    vec2 st = fract(repeat * materialInput.st);\n    st = vec2(fract(time - st.s), st.t);\n    vec4 imageColor = texture2D(image, st);\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    float alpha = 1.0 - (abs(0.5 - st.t) * 2.0);\n    material.alpha = imageColor.a * color.a * alpha;\n    material.diffuse = imageColor.rgb * color.rgb;\n    return material;\n}\n",{Material:Ny,Cartesian2:ky,Color:Fy}=Cesium;Ny.FlowImageType="FlowImage",Ny._materialCache.addMaterial(Ny.FlowImageType,{fabric:{type:Ny.FlowImageType,uniforms:{color:new Fy(1,1,1,1),repeat:new ky(1,1),image:"",speed:1},source:Iy}});class zy{constructor(e){e=Re(e,{}),this._options=e,this._postProcessStage=void 0}addTo(e){if(ze(e),Oe(this._viewer)||(this._viewer=e),this._postProcessStage||(this._postProcessStage=this.createPostStage()),!this._viewer.scene.postProcessStages.contains(this._postProcessStage)){if(!this._postProcessStage)throw new Le("createPostStage method must reture a Cesium.PostProcessStage object.");return this._viewer.scene.postProcessStages.add(this._postProcessStage)}}createPostStage(){throw new Le("抽象类不能被直接调用")}get selected(){return this._postProcessStage?this._postProcessStage.selected:[]}set selected(e){this._postProcessStage&&(this._postProcessStage.selected=e)}get enabled(){if(this._postProcessStage)return this._postProcessStage.enabled}set enabled(e){this._postProcessStage&&(this._postProcessStage.enabled=e)}remove(){if(this._viewer)return this._viewer.scene.postProcessStages.remove(this._postProcessStage)}destroy(){this.remove(),this._postProcessStage.isDestroyed()||this._postProcessStage.destroy(),this._viewer=void 0}zoomTo(){if(this._viewer&&this.center)return this.viewer.flyTo(this.center,{duration:0})}}const{VertexFormat:By}=Cesium;const Gy="\n#extension GL_OES_standard_derivatives : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform float alpha;\nuniform float snowDensity;\nvarying vec2 v_textureCoordinates;\nuniform float speed;\nfloat snow(vec2 uv,float scale){\n  float time = czm_frameNumber/speed ;\n  float w=smoothstep(1.,0.,-uv.y*(scale/10.));\n  if(w<.1)return 0.;\n  uv+=time/scale;\n  uv.y+=time*2./scale;\n  uv.x+=sin(uv.y+time*.5)/scale;\n  uv*=scale;\n  vec2 s=floor(uv),f=fract(uv),p;\n  float k=3.;\n  p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;\n  float d=length(p);\n  k=min(d,k);\n  k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\n  return k*w;\n}\nvoid main(){\n  vec4 bgColor=vec4(0.0);\n  vec4 color = texture2D(colorTexture, v_textureCoordinates);\n  vec4 depth = texture2D(depthTexture, v_textureCoordinates);\n  vec2 resolution = czm_viewport.zw;\n  vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n  vec3 snowColor=vec3(0);\n  float c = 0.0;\n  float per=20.0/snowDensity;\n  for(float scale=2.0;scale<=20.0;scale++){\n    if(scale>snowDensity){\n      break;\n    }\n    c+=snow(uv,scale*per);\n  }\n  //雪花\n  snowColor=(vec3(c));\n  if (depth.r >= 1.0) {\n    gl_FragColor = color;\n    return;\n  }\n  vec4 positionEC = czm_p_toEye(gl_FragCoord.xy, czm_unpackDepth(texture2D(depthTexture, v_textureCoordinates)));\n  vec3 dx = dFdx(positionEC.xyz);\n  vec3 dy = dFdy(positionEC.xyz);\n  vec3 nor = normalize(cross(dx,dy));\n  vec4 positionWC = normalize(czm_inverseView * positionEC);\n  vec3 normalWC = normalize(czm_inverseViewRotation * nor);\n  float dotNumWC = dot(positionWC.xyz,normalWC);\n  //雪地\n  bgColor = mix(color,vec4(1.0),alpha * max(dotNumWC, 0.3));\n  gl_FragColor = mix(bgColor,vec4(snowColor,1.0),0.5);\n}";const Wy="\nattribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_positionMC;\nvarying vec2 v_st;\nvoid main(){\n  vec4 position=czm_computePosition();\n  v_positionEC=(czm_modelViewRelativeToEye*position).xyz;\n  v_st=st;\n  v_positionMC=position3DHigh+position3DLow;\n  gl_Position=czm_modelViewProjectionRelativeToEye*position;\n}\n",Uy="\nvarying vec3 v_positionEC;\nvarying vec3 v_positionMC;\nvarying vec2 v_st;\nvoid main(){\n  czm_materialInput materialInput;\n  vec3 normalEC=normalize(czm_normal3D*czm_geodeticSurfaceNormal(v_positionMC,vec3(0.0),vec3(1.0)));\n  #ifdef FACE_FORWARD\n  normalEC=faceforward(normalEC,vec3(0.0,0.0,1.0),-normalEC);\n  #endif\n  materialInput.s=v_st.s;\n  materialInput.st=v_st;\n  materialInput.str=vec3(v_st,0.0);\n  materialInput.normalEC=normalEC;\n  materialInput.tangentToEyeMatrix=czm_eastNorthUpToEyeCoordinates(v_positionMC,materialInput.normalEC);\n  vec3 positionToEyeEC=-v_positionEC;\n  czm_material material =czm_getMaterial(materialInput);\n  #ifdef FLAT\n  gl_FragColor=vec4(material.diffuse+material.emission,material.alpha);\n  gl_FragColor.a={alpha};\n  #else\n  gl_FragColor=czm_phong(normalize(positionToEyeEC),material,czm_lightDirectionEC);\n  gl_FragColor.a={alpha};\n  #endif\n}\n",Hy=/((?:.*\/)|^)CesiumPro\.js(?:\?|#|$)/;let Vy,jy,qy;function $y(e){return"undefined"==typeof document?e:(Oe(Vy)||(Vy=document.createElement("a")),Vy.href=e,Vy.href=Vy.href,Vy.href)}function Yy(e){return $y(`../${e}`)}function Xy(){if(Oe(jy))return jy;let e;if(e="undefined"!=typeof CESIUMPRO_BASE_URL?CESIUMPRO_BASE_URL:"object"==typeof window.define&&Oe(window.define.amd)&&!window.define.amd.toUrlUndefined?Cesium.getAbsoluteUri("..","core/Url.js"):function(){const e=document.getElementsByTagName("script");for(let t=0,i=e.length;t<i;++t){const i=e[t].getAttribute("src"),r=Hy.exec(i);if(null!==r)return r[1]}}(),!Oe(e))throw new Le("Unable to determine CesiumPro base URL automatically, try defining a global variable called CESIUMPRO_BASE_URL.");return Oe(e)||(e=""),jy=new Cesium.Resource({url:$y(e)}),jy.appendForwardSlash(),jy}function Jy(e){return Xy().getDerivedResource({url:e}).url}const Zy={join:function(...e){const t=[];for(let i of e)i.startsWith("/")&&(i=i.substring(1)),i.endsWith("/")&&(i=i.substring(0,i.length-1)),t.push(i);return t.join("/")}};Zy.buildModuleUrl=function(e){return t=e,Oe(qy)||(qy="object"==typeof window.define&&Oe(window.define.amd)&&!window.define.amd.toUrlUndefined?Yy:Jy),qy(t);var t},Zy.getCesiumProBaseUrl=Xy;const{Material:Qy,Color:Ky}=Cesium;const eC="\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n#else\n    precision mediump float;\n#endif\nuniform sampler2D u_normalMap;\nuniform sampler2D u_refractMap;\nuniform sampler2D u_reflectMap;\nuniform vec4 u_waterColor;\nuniform vec4 u_refractColor;\nuniform int u_useRefractTex;\nuniform vec4 u_reflectColor;\nuniform int u_reflection;\nuniform vec2 u_flowDirection;\nvarying vec3 eyeDir;\nvarying vec2 texCoord;\nvarying float myTime;\nvarying vec4 projectionCoord;\n\nvoid main (void)\n{\n    float texScale = 35.0;\n    float texScale2 = 10.0;\n    float myangle;\n    float transp;\n    vec3 myNormal;\n    vec2 mytexFlowCoord = texCoord * texScale;\n    vec2 ff = abs(2.0*(fract(mytexFlowCoord)) - 1.0) -0.5;\n    ff = 0.5-4.0*ff*ff*ff;\n    vec2 ffscale = sqrt(ff*ff + (1.0-ff)*(1.0-ff));\n    vec2 Tcoord = texCoord  * texScale2;\n    vec2 offset = vec2(myTime,0.0);\n    vec3 sample = vec3(u_flowDirection, 1.0);\n    vec2 flowdir = sample.xy -0.5;\n    flowdir *= sample.b;\n    mat2 rotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n    vec2 NormalT0 = texture2D(u_normalMap, rotmat * Tcoord - offset).rg;\n    sample = vec3(u_flowDirection, 1.0);\n    flowdir = sample.b * (sample.xy - 0.5);\n    rotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n    vec2 NormalT1 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.06+0.62).rg;\n    vec2 NormalTAB = ff.x * NormalT0 + (1.0-ff.x) * NormalT1;\n    sample = vec3(u_flowDirection, 1.0);\n    flowdir = sample.b * (sample.xy - 0.5);\n    rotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n    NormalT0 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.33+0.27).rg;\n    sample = vec3(u_flowDirection, 1.0);\n    flowdir = sample.b * (sample.xy - 0.5);\n    rotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n    NormalT1 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.24).rg ;\n\n    vec2 NormalTCD = ff.x * NormalT0 + (1.0-ff.x) * NormalT1;\n    vec2 NormalT = ff.y * NormalTAB + (1.0-ff.y) * NormalTCD;\n    NormalT = (NormalT - 0.5) / (ffscale.y * ffscale.x);\n    NormalT *= 0.3;\n    transp = 1.0;\n    NormalT *= transp*transp;\n    myNormal = vec3(NormalT,sqrt(1.0-NormalT.x*NormalT.x - NormalT.y*NormalT.y));\n    vec3 envColor = u_reflectColor.rgb;\n    if (u_reflection == 1)\n    {\n        vec2 final = projectionCoord.xy / projectionCoord.w;\n        final = final * 0.5 + 0.5;\n        final.y = 1.0 - final.y;\n        envColor = texture2D(u_reflectMap, final + myNormal.xy/texScale2*transp).rgb;\n    }\n    myangle = dot(myNormal,normalize(eyeDir));\n    myangle = 0.95-0.6*myangle*myangle;\n    vec3 base = u_refractColor.rgb;\n    if (u_useRefractTex == 1)\n        base = texture2D(u_refractMap,(texCoord + myNormal.xy/texScale2*0.03*transp)*32.0).rgb;\n    base = mix(base, u_waterColor.rgb, u_waterColor.a);\n    gl_FragColor = vec4(mix(base, envColor, myangle*transp), 1.0);\n}\n",tC="\nattribute vec3 position;\nattribute vec2 st;\nuniform mat4 u_modelViewProjectionMatrix;\nuniform mat4 u_modelViewMatrix;\nuniform mat4 u_invWorldViewMatrix;\nuniform vec2 u_texCoordOffset;\nuniform vec2 u_texCoordScale;\nuniform float u_frameTime;\nuniform int u_clampToGroud;\nuniform vec3 u_camPosition;\nuniform vec3 u_scale;\nvarying vec3 eyeDir;\nvarying vec2 texCoord;\nvarying float myTime;\nvarying vec4 projectionCoord;\nvoid main(void)\n{\n\n\tgl_Position = u_modelViewProjectionMatrix * vec4(position.xyz,1.0);\n\tif (u_clampToGroud == 1)\n\t{\n\t  eyeDir = (u_camPosition - position.xyz) * u_scale;\n\t} else {\n\t  vec4 pos = u_modelViewMatrix * vec4(position.xyz,1.0);\n\t  eyeDir = vec3(u_invWorldViewMatrix*vec4(pos.xyz,0.0));\n\t  projectionCoord = gl_Position;\n\t}\n\ttexCoord = (st+u_texCoordOffset)*u_texCoordScale;\n\tmyTime = 0.01 * u_frameTime;\n}\n",{Color:iC,Resource:rC,Texture:nC,TextureWrap:oC,Sampler:sC,Cartographic:aC,Cartesian2:lC,Cartesian3:cC,Camera:uC,Framebuffer:hC,Renderbuffer:dC,PassState:pC,BoundingRectangle:mC,PixelFormat:fC,RenderbufferFormat:gC,Matrix4:_C,Matrix3:vC,JulianDate:yC,ShaderProgram:CC,RenderState:xC,PolygonGeometry:wC,Buffer:bC,BufferUsage:SC,IndexDatatype:TC,ComponentDatatype:EC,VertexArray:PC,DrawCommand:AC,PrimitiveType:MC,Pass:DC,Plane:LC,Cartesian4:RC,ClearCommand:OC,Primitive:IC,destroyObject:NC,ShaderSource:kC,PixelDatatype:FC}=Cesium,zC=Cesium.Math;function BC(e,t,i,r,n){if(e instanceof OC)e.execute(i,r);else{t.useLogDepth&&Oe(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var o=t.passes;if(!o.pick&&!o.depth&&Oe(e.derivedCommands)&&Oe(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),o.pick||o.depth){if(o.pick&&!o.depth&&Oe(e.derivedCommands.picking))return void(e=e.derivedCommands.picking.pickCommand).execute(i,r);if(Oe(e.derivedCommands.depth))return void(e=e.derivedCommands.depth.depthOnlyCommand).execute(i,r)}t.shadowState.lightShadowsEnabled&&e.receiveShadows&&Oe(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,r):e.execute(i,r)}}class GC{constructor(e){this.commandType=e.commandType,this.geometry=e.geometry,this.attributeLocations=e.attributeLocations,this.primitiveType=e.primitiveType,this.uniformMap=e.uniformMap,this.vertexShaderSource=e.vertexShaderSource,this.fragmentShaderSource=e.fragmentShaderSource,this.rawRenderState=e.rawRenderState,this.framebuffer=e.framebuffer,this.outputTexture=e.outputTexture,this.autoClear=Cesium.defaultValue(e.autoClear,!1),this.preExecute=e.preExecute,this.show=!0,this.commandToExecute=void 0,this.clearCommand=void 0,this.autoClear&&(this.clearCommand=new Cesium.ClearCommand({color:new Cesium.Color(0,0,0,0),depth:1,framebuffer:this.framebuffer,pass:Cesium.Pass.OPAQUE}))}createCommand(e){switch(this.commandType){case"Draw":{const t=Cesium.VertexArray.fromGeometry({context:e,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),i=Cesium.ShaderProgram.fromCache({context:e,attributeLocations:this.attributeLocations,vertexShaderSource:this.vertexShaderSource,fragmentShaderSource:this.fragmentShaderSource}),r=Cesium.RenderState.fromCache(this.rawRenderState);return new Cesium.DrawCommand({owner:this,vertexArray:t,primitiveType:this.primitiveType,uniformMap:this.uniformMap,modelMatrix:Cesium.Matrix4.IDENTITY,shaderProgram:i,framebuffer:this.framebuffer,renderState:r,pass:Cesium.Pass.OPAQUE})}case"Compute":return new Cesium.ComputeCommand({owner:this,fragmentShaderSource:this.fragmentShaderSource,uniformMap:this.uniformMap,outputTexture:this.outputTexture,persists:!0})}}setGeometry(e,t){this.geometry=t;const i=Cesium.VertexArray.fromGeometry({context:e,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW});this.commandToExecute.vertexArray=i}update(e){this.show&&(Cesium.defined(this.commandToExecute)||(this.commandToExecute=this.createCommand(e.context)),Cesium.defined(this.preExecute)&&this.preExecute(),Cesium.defined(this.clearCommand)&&e.commandList.push(this.clearCommand),e.commandList.push(this.commandToExecute))}isDestroyed(){return!1}destroy(){return Cesium.defined(this.commandToExecute)&&(this.commandToExecute.shaderProgram=this.commandToExecute.shaderProgram&&this.commandToExecute.shaderProgram.destroy()),Cesium.destroyObject(this)}}var WC={};
/*! https://mths.be/utf8js v3.0.0 by @mathias */!function(e){!function(e){var t,i,r,n=String.fromCharCode;function o(e){for(var t,i,r=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--):r.push(t);return r}function s(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function a(e,t){return n(e>>t&63|128)}function l(e){if(0==(4294967168&e))return n(e);var t="";return 0==(4294965248&e)?t=n(e>>6&31|192):0==(4294901760&e)?(s(e),t=n(e>>12&15|224),t+=a(e,6)):0==(4292870144&e)&&(t=n(e>>18&7|240),t+=a(e,12),t+=a(e,6)),t+=n(63&e|128)}function c(){if(r>=i)throw Error("Invalid byte index");var e=255&t[r];if(r++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function u(){var e,n;if(r>i)throw Error("Invalid byte index");if(r==i)return!1;if(e=255&t[r],r++,0==(128&e))return e;if(192==(224&e)){if((n=(31&e)<<6|c())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&e)){if((n=(15&e)<<12|c()<<6|c())>=2048)return s(n),n;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=(7&e)<<18|c()<<12|c()<<6|c())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}e.version="3.0.0",e.encode=function(e){for(var t=o(e),i=t.length,r=-1,n="";++r<i;)n+=l(t[r]);return n},e.decode=function(e){t=o(e),i=t.length,r=0;for(var s,a=[];!1!==(s=u());)a.push(s);return function(e){for(var t,i=e.length,r=-1,o="";++r<i;)(t=e[r])>65535&&(o+=n((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=n(t);return o}(a)}}(e)}(WC);var UC=Object.freeze({__proto__:null,IOBuffer:class e{constructor(t=8192,i={}){let r=!1;"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);const n=i.offset?i.offset>>>0:0,o=t.byteLength-n;let s=n;(ArrayBuffer.isView(t)||t instanceof e)&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+n),t=t.buffer),this.lastWrittenByte=r?o:0,this.buffer=t,this.length=o,this.byteLength=o,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,o),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const t=2*(this.offset+e),i=new Uint8Array(t);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this.readByte();return t}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let i=0;i<e;i++)t+=this.readChar();return t}readUtf8(e=1){const t=this.readChars(e);return WC.decode(t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){const t=WC.encode(e);return this.writeChars(t)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}}),HC=T(UC),VC={};function jC(e){e.offset%4!=0&&e.skip(4-e.offset%4)}VC.notNetcdf=function(e,t){if(e)throw new TypeError(`Not a valid NetCDF v3.x file: ${t}`)},VC.padding=jC,VC.readName=function(e){var t=e.readUint32(),i=e.readChars(t);return jC(e),i};var qC={},$C={exports:{}};const YC=VC.notNetcdf,XC={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function JC(e,t){if(1!==e){for(var i=new Array(e),r=0;r<e;r++)i[r]=t();return i}return t()}$C.exports=XC,$C.exports.num2str=function(e){switch(Number(e)){case XC.BYTE:return"byte";case XC.CHAR:return"char";case XC.SHORT:return"short";case XC.INT:return"int";case XC.FLOAT:return"float";case XC.DOUBLE:return"double";default:return"undefined"}},$C.exports.num2bytes=function(e){switch(Number(e)){case XC.BYTE:case XC.CHAR:return 1;case XC.SHORT:return 2;case XC.INT:case XC.FLOAT:return 4;case XC.DOUBLE:return 8;default:return-1}},$C.exports.str2num=function(e){switch(String(e)){case"byte":return XC.BYTE;case"char":return XC.CHAR;case"short":return XC.SHORT;case"int":return XC.INT;case"float":return XC.FLOAT;case"double":return XC.DOUBLE;default:return-1}},$C.exports.readType=function(e,t,i){switch(t){case XC.BYTE:return e.readBytes(i);case XC.CHAR:return function(e){if(0===e.charCodeAt(e.length-1))return e.substring(0,e.length-1);return e}(e.readChars(i));case XC.SHORT:return JC(i,e.readInt16.bind(e));case XC.INT:return JC(i,e.readInt32.bind(e));case XC.FLOAT:return JC(i,e.readFloat32.bind(e));case XC.DOUBLE:return JC(i,e.readFloat64.bind(e));default:return void YC(!0,`non valid type ${t}`)}};var ZC=$C.exports;const QC=ZC;qC.nonRecord=function(e,t){const i=QC.str2num(t.type);for(var r=t.size/QC.num2bytes(i),n=new Array(r),o=0;o<r;o++)n[o]=QC.readType(e,i,1);return n},qC.record=function(e,t,i){const r=QC.str2num(t.type),n=t.size?t.size/QC.num2bytes(r):1;var o=i.length,s=new Array(o);const a=i.recordStep;for(var l=0;l<o;l++){var c=e.offset;s[l]=QC.readType(e,r,n),e.seek(c+a)}return s};const KC=VC,ex=ZC;function tx(e){const t=e.readUint32();if(0===t)return KC.notNetcdf(0!==e.readUint32(),"wrong empty tag for list of attributes"),[];{KC.notNetcdf(12!==t,"wrong tag for list of attributes");const l=e.readUint32();for(var i=new Array(l),r=0;r<l;r++){var n=KC.readName(e),o=e.readUint32();KC.notNetcdf(o<1||o>6,`non valid type ${o}`);var s=e.readUint32(),a=ex.readType(e,o,s);KC.padding(e),i[r]={name:n,type:ex.num2str(o),value:a}}}return i}var ix=function(e,t){var i={recordDimension:{length:e.readUint32()}};i.version=t;var r=function(e){var t,i;const r=e.readUint32();if(0===r)return KC.notNetcdf(0!==e.readUint32(),"wrong empty tag for list of dimensions"),[];{KC.notNetcdf(10!==r,"wrong tag for list of dimensions");const a=e.readUint32();for(var n=new Array(a),o=0;o<a;o++){var s=KC.readName(e);const r=e.readUint32();0===r&&(t=o,i=s),n[o]={name:s,size:r}}}return{dimensions:n,recordId:t,recordName:i}}(e);i.recordDimension.id=r.recordId,i.recordDimension.name=r.recordName,i.dimensions=r.dimensions,i.globalAttributes=tx(e);var n=function(e,t,i){const r=e.readUint32();var n=0;if(0===r)return KC.notNetcdf(0!==e.readUint32(),"wrong empty tag for list of variables"),[];{KC.notNetcdf(11!==r,"wrong tag for list of variables");const p=e.readUint32();for(var o=new Array(p),s=0;s<p;s++){var a=KC.readName(e);const r=e.readUint32();for(var l=new Array(r),c=0;c<r;c++)l[c]=e.readUint32();var u=tx(e),h=e.readUint32();KC.notNetcdf(h<1&&h>6,`non valid type ${h}`);const p=e.readUint32();var d=e.readUint32();2===i&&(KC.notNetcdf(d>0,"offsets larger than 4GB not supported"),d=e.readUint32());let m=!1;void 0!==t&&l[0]===t&&(n+=p,m=!0),o[s]={name:a,dimensions:l,attributes:u,type:ex.num2str(h),size:p,offset:d,record:m}}}return{variables:o,recordStep:n}}(e,r.recordId,t);return i.variables=n.variables,i.recordDimension.recordStep=n.recordStep,i};var rx=function(){let e=[];e.push("DIMENSIONS");for(let t of this.dimensions)e.push(`  ${t.name.padEnd(30)} = size: ${t.size}`);e.push(""),e.push("GLOBAL ATTRIBUTES");for(let t of this.globalAttributes)e.push(`  ${t.name.padEnd(30)} = ${t.value}`);let t=JSON.parse(JSON.stringify(this.variables));e.push(""),e.push("VARIABLES:");for(let i of t){i.value=this.getDataVariable(i);let t=JSON.stringify(i.value);t.length>50&&(t=t.substring(0,50)),isNaN(i.value.length)||(t+=` (length: ${i.value.length})`),e.push(`  ${i.name.padEnd(30)} = ${t}`)}return e.join("\n")};const{IOBuffer:nx}=HC,ox=VC,sx=qC,ax=ix,lx=rx;var cx=class{constructor(e){const t=new nx(e);t.setBigEndian(),ox.notNetcdf("CDF"!==t.readChars(3),"should start with CDF");const i=t.readByte();ox.notNetcdf(i>2,"unknown version"),this.header=ax(t,i),this.buffer=t}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(e){const t=this.globalAttributes.find((t=>t.name===e));return t?t.value:null}getDataVariableAsString(e){const t=this.getDataVariable(e);return t?t.join(""):null}get variables(){return this.header.variables}toString(){return lx.call(this)}getDataVariable(e){let t;return t="string"==typeof e?this.header.variables.find((function(t){return t.name===e})):e,ox.notNetcdf(void 0===t,`variable not found: ${e}`),this.buffer.seek(t.offset),t.record?sx.record(this.buffer,t,this.header.recordDimension):sx.nonRecord(this.buffer,t)}dataVariableExists(e){return void 0!==this.header.variables.find((function(t){return t.name===e}))}attributeExists(e){return void 0!==this.globalAttributes.find((t=>t.name===e))}},ux=S(cx);let hx;var dx={loadData:async function(e){var t;return await(t=e,new Promise((function(e){const i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.onload=function(){const t=function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})},r=new ux(i.response);hx={};const n=t(r.dimensions);hx.dimensions={},hx.dimensions.lon=n.lon.size,hx.dimensions.lat=n.lat.size,hx.dimensions.lev=n.lev.size;const o=t(r.variables),s=t(o.U.attributes),a=t(o.V.attributes);hx.lon={},hx.lon.array=new Float32Array(r.getDataVariable("lon").flat()),hx.lon.min=Math.min(...hx.lon.array),hx.lon.max=Math.max(...hx.lon.array),hx.lat={},hx.lat.array=new Float32Array(r.getDataVariable("lat").flat()),hx.lat.min=Math.min(...hx.lat.array),hx.lat.max=Math.max(...hx.lat.array),hx.lev={},hx.lev.array=new Float32Array(r.getDataVariable("lev").flat()),hx.lev.min=Math.min(...hx.lev.array),hx.lev.max=Math.max(...hx.lev.array),hx.U={},hx.U.array=new Float32Array(r.getDataVariable("U").flat()),hx.U.min=s.min.value,hx.U.max=s.max.value,hx.V={},hx.V.array=new Float32Array(r.getDataVariable("V").flat()),hx.V.min=a.min.value,hx.V.max=a.max.value,e(hx)},i.send()}))),hx},randomizeParticles:function(e,t){const i=new Float32Array(4*e);for(let r=0;r<e;r++)i[4*r]=Cesium.Math.randomBetween(t.lonRange.x,t.lonRange.y),i[4*r+1]=Cesium.Math.randomBetween(t.latRange.x,t.latRange.y),i[4*r+2]=Cesium.Math.randomBetween(hx.lev.min,hx.lev.max),i[4*r+3]=0;return i}};var px={loadText:function(e){const t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t.responseText},getFullscreenQuad:function(){return new Cesium.Geometry({attributes:new Cesium.GeometryAttributes({position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}),st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array([0,0,1,0,1,1,0,1])})}),indices:new Uint32Array([3,2,0,0,2,1])})},createTexture:function(e,t){if(Cesium.defined(t)){const i={};i.arrayBufferView=t,e.source=i}return new Cesium.Texture(e)},createFramebuffer:function(e,t,i){return new Cesium.Framebuffer({context:e,colorTextures:[t],depthTexture:i})},createRawRenderState:function(e){const t={viewport:e.viewport,depthTest:e.depthTest,depthMask:e.depthMask,blending:e.blending};return Cesium.Appearance.getDefaultRenderState(!0,!1,t)},viewRectangleToLonLatRange:function(e){const t={},i=Cesium.Math.mod(e.west,Cesium.Math.TWO_PI),r=Cesium.Math.mod(e.east,Cesium.Math.TWO_PI),n=e.width;let o,s;n>Cesium.Math.THREE_PI_OVER_TWO?(o=0,s=Cesium.Math.TWO_PI):r-i<n?(o=i,s=i+n):(o=i,s=r),t.lon={min:Cesium.Math.toDegrees(o),max:Cesium.Math.toDegrees(s)};const a=e.south,l=e.north,c=e.height;let u=c>Cesium.Math.PI/12?c/2:0,h=Cesium.Math.clampToLatitudeRange(a-u),d=Cesium.Math.clampToLatitudeRange(l+u);return h<-Cesium.Math.PI_OVER_THREE&&(h=-Cesium.Math.PI_OVER_TWO),d>Cesium.Math.PI_OVER_THREE&&(d=Cesium.Math.PI_OVER_TWO),t.lat={min:Cesium.Math.toDegrees(h),max:Cesium.Math.toDegrees(d)},t},_shaderCalculateSpeedFrag:"\n// the size of UV textures: width = lon, height = lat*lev\nuniform sampler2D U; // eastward wind \nuniform sampler2D V; // northward wind\nuniform sampler2D currentParticlesPosition; // (lon, lat, lev)\n\nuniform vec3 dimension; // (lon, lat, lev)\nuniform vec3 minimum; // minimum of each dimension\nuniform vec3 maximum; // maximum of each dimension\nuniform vec3 interval; // interval of each dimension\n\n// used to calculate the wind norm\nuniform vec2 uSpeedRange; // (min, max);\nuniform vec2 vSpeedRange;\nuniform float pixelSize;\nuniform float speedFactor;\n\nfloat speedScaleFactor = speedFactor * pixelSize;\n\nvarying vec2 v_textureCoordinates;\n\nvec2 mapPositionToNormalizedIndex2D(vec3 lonLatLev) {\n    // ensure the range of longitude and latitude\n    lonLatLev.x = mod(lonLatLev.x, 360.0);\n    lonLatLev.y = clamp(lonLatLev.y, -90.0, 90.0);\n\n    vec3 index3D = vec3(0.0);\n    index3D.x = (lonLatLev.x - minimum.x) / interval.x;\n    index3D.y = (lonLatLev.y - minimum.y) / interval.y;\n    index3D.z = (lonLatLev.z - minimum.z) / interval.z;\n\n    // the st texture coordinate corresponding to (col, row) index\n    // example\n    // data array is [0, 1, 2, 3, 4, 5], width = 3, height = 2\n    // the content of texture will be\n    // t 1.0\n    //    |  3 4 5\n    //    |\n    //    |  0 1 2\n    //   0.0------1.0 s\n\n    vec2 index2D = vec2(index3D.x, index3D.z * dimension.y + index3D.y);\n    vec2 normalizedIndex2D = vec2(index2D.x / dimension.x, index2D.y / (dimension.y * dimension.z));\n    return normalizedIndex2D;\n}\n\nfloat getWindComponent(sampler2D componentTexture, vec3 lonLatLev) {\n    vec2 normalizedIndex2D = mapPositionToNormalizedIndex2D(lonLatLev);\n    float result = texture2D(componentTexture, normalizedIndex2D).r;\n    return result;\n}\n\nfloat interpolateTexture(sampler2D componentTexture, vec3 lonLatLev) {\n    float lon = lonLatLev.x;\n    float lat = lonLatLev.y;\n    float lev = lonLatLev.z;\n\n    float lon0 = floor(lon / interval.x) * interval.x;\n    float lon1 = lon0 + 1.0 * interval.x;\n    float lat0 = floor(lat / interval.y) * interval.y;\n    float lat1 = lat0 + 1.0 * interval.y;\n\n    float lon0_lat0 = getWindComponent(componentTexture, vec3(lon0, lat0, lev));\n    float lon1_lat0 = getWindComponent(componentTexture, vec3(lon1, lat0, lev));\n    float lon0_lat1 = getWindComponent(componentTexture, vec3(lon0, lat1, lev));\n    float lon1_lat1 = getWindComponent(componentTexture, vec3(lon1, lat1, lev));\n\n    float lon_lat0 = mix(lon0_lat0, lon1_lat0, lon - lon0);\n    float lon_lat1 = mix(lon0_lat1, lon1_lat1, lon - lon0);\n    float lon_lat = mix(lon_lat0, lon_lat1, lat - lat0);\n    return lon_lat;\n}\n\nvec3 linearInterpolation(vec3 lonLatLev) {\n    // https://en.wikipedia.org/wiki/Bilinear_interpolation\n    float u = interpolateTexture(U, lonLatLev);\n    float v = interpolateTexture(V, lonLatLev);\n    float w = 0.0;\n    return vec3(u, v, w);\n}\n\nvec2 lengthOfLonLat(vec3 lonLatLev) {\n    // unit conversion: meters -> longitude latitude degrees\n    // see https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree for detail\n\n    // Calculate the length of a degree of latitude and longitude in meters\n    float latitude = radians(lonLatLev.y);\n\n    float term1 = 111132.92;\n    float term2 = 559.82 * cos(2.0 * latitude);\n    float term3 = 1.175 * cos(4.0 * latitude);\n    float term4 = 0.0023 * cos(6.0 * latitude);\n    float latLength = term1 - term2 + term3 - term4;\n\n    float term5 = 111412.84 * cos(latitude);\n    float term6 = 93.5 * cos(3.0 * latitude);\n    float term7 = 0.118 * cos(5.0 * latitude);\n    float longLength = term5 - term6 + term7;\n\n    return vec2(longLength, latLength);\n}\n\nvec3 convertSpeedUnitToLonLat(vec3 lonLatLev, vec3 speed) {\n    vec2 lonLatLength = lengthOfLonLat(lonLatLev);\n    float u = speed.x / lonLatLength.x;\n    float v = speed.y / lonLatLength.y;\n    float w = 0.0;\n    vec3 windVectorInLonLatLev = vec3(u, v, w);\n\n    return windVectorInLonLatLev;\n}\n\nvec3 calculateSpeedByRungeKutta2(vec3 lonLatLev) {\n    // see https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#Second-order_methods_with_two_stages for detail\n    const float h = 0.5;\n\n    vec3 y_n = lonLatLev;\n    vec3 f_n = linearInterpolation(lonLatLev);\n    vec3 midpoint = y_n + 0.5 * h * convertSpeedUnitToLonLat(y_n, f_n) * speedScaleFactor;\n    vec3 speed = h * linearInterpolation(midpoint) * speedScaleFactor;\n\n    return speed;\n}\n\nfloat calculateWindNorm(vec3 speed) {\n    vec3 percent = vec3(0.0);\n    percent.x = (speed.x - uSpeedRange.x) / (uSpeedRange.y - uSpeedRange.x);\n    percent.y = (speed.y - vSpeedRange.x) / (vSpeedRange.y - vSpeedRange.x);\n    float norm = length(percent);\n\n    return norm;\n}\n\nvoid main() {\n    // texture coordinate must be normalized\n    vec3 lonLatLev = texture2D(currentParticlesPosition, v_textureCoordinates).rgb;\n    vec3 speed = calculateSpeedByRungeKutta2(lonLatLev);\n    vec3 speedInLonLat = convertSpeedUnitToLonLat(lonLatLev, speed);\n\n    vec4 particleSpeed = vec4(speedInLonLat, calculateWindNorm(speed / speedScaleFactor));\n    gl_FragColor = particleSpeed;\n}\n",_shaderFullscreenVert:"attribute vec3 position;\nattribute vec2 st;\n\nvarying vec2 textureCoordinate;\n\nvoid main() {\n    textureCoordinate = st;\n    gl_Position = vec4(position, 1.0);\n}",_shaderPostProcessingPositionFrag:"uniform sampler2D nextParticlesPosition;\nuniform sampler2D particlesSpeed; // (u, v, w, norm)\n\n// range (min, max)\nuniform vec2 lonRange;\nuniform vec2 latRange;\n\nuniform float randomCoefficient; // use to improve the pseudo-random generator\nuniform float dropRate; // drop rate is a chance a particle will restart at random position to avoid degeneration\nuniform float dropRateBump;\n\nvarying vec2 v_textureCoordinates;\n\n// pseudo-random generator\nconst vec3 randomConstants = vec3(12.9898, 78.233, 4375.85453);\nconst vec2 normalRange = vec2(0.0, 1.0);\nfloat rand(vec2 seed, vec2 range) {\n    vec2 randomSeed = randomCoefficient * seed;\n    float temp = dot(randomConstants.xy, randomSeed);\n    temp = fract(sin(temp) * (randomConstants.z + temp));\n    return temp * (range.y - range.x) + range.x;\n}\n\nvec3 generateRandomParticle(vec2 seed, float lev) {\n    // ensure the longitude is in [0, 360]\n    float randomLon = mod(rand(seed, lonRange), 360.0);\n    float randomLat = rand(-seed, latRange);\n\n    return vec3(randomLon, randomLat, lev);\n}\n\nbool particleOutbound(vec3 particle) {\n    return particle.y < -90.0 || particle.y > 90.0;\n}\n\nvoid main() {\n    vec3 nextParticle = texture2D(nextParticlesPosition, v_textureCoordinates).rgb;\n    vec4 nextSpeed = texture2D(particlesSpeed, v_textureCoordinates);\n    float speedNorm = nextSpeed.a;\n    float particleDropRate = dropRate + dropRateBump * speedNorm;\n\n    vec2 seed1 = nextParticle.xy + v_textureCoordinates;\n    vec2 seed2 = nextSpeed.xy + v_textureCoordinates;\n    vec3 randomParticle = generateRandomParticle(seed1, nextParticle.z);\n    float randomNumber = rand(seed2, normalRange);\n\n    if (randomNumber < particleDropRate || particleOutbound(nextParticle)) {\n        gl_FragColor = vec4(randomParticle, 1.0); // 1.0 means this is a random particle\n    } else {\n        gl_FragColor = vec4(nextParticle, 0.0);\n    }\n}",_shaderScreenDrawFrag:"uniform sampler2D trailsColorTexture;\nuniform sampler2D trailsDepthTexture;\n\nvarying vec2 textureCoordinate;\n\nvoid main() {\n    vec4 trailsColor = texture2D(trailsColorTexture, textureCoordinate);\n    float trailsDepth = texture2D(trailsDepthTexture, textureCoordinate).r;\n    float globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, textureCoordinate));\n\n    if (trailsDepth < globeDepth) {\n        gl_FragColor = trailsColor;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}",_shaderSegmentDragFrag:"\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}\n",_shaderSegmentDrawVert:"attribute vec2 st;\n// it is not normal itself, but used to control lines drawing\nattribute vec3 normal; // (point to use, offset sign, not used component)\n\nuniform sampler2D previousParticlesPosition;\nuniform sampler2D currentParticlesPosition;\nuniform sampler2D postProcessingPosition;\n\nuniform float particleHeight;\n\nuniform float aspect;\nuniform float pixelSize;\nuniform float lineWidth;\n\nstruct adjacentPoints {\n    vec4 previous;\n    vec4 current;\n    vec4 next;\n};\n\nvec3 convertCoordinate(vec3 lonLatLev) {\n    // WGS84 (lon, lat, lev) -> ECEF (x, y, z)\n    // read https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates for detail\n\n    // WGS 84 geometric constants \n    float a = 6378137.0; // Semi-major axis \n    float b = 6356752.3142; // Semi-minor axis \n    float e2 = 6.69437999014e-3; // First eccentricity squared\n\n    float latitude = radians(lonLatLev.y);\n    float longitude = radians(lonLatLev.x);\n\n    float cosLat = cos(latitude);\n    float sinLat = sin(latitude);\n    float cosLon = cos(longitude);\n    float sinLon = sin(longitude);\n\n    float N_Phi = a / sqrt(1.0 - e2 * sinLat * sinLat);\n    float h = particleHeight; // it should be high enough otherwise the particle may not pass the terrain depth test\n\n    vec3 cartesian = vec3(0.0);\n    cartesian.x = (N_Phi + h) * cosLat * cosLon;\n    cartesian.y = (N_Phi + h) * cosLat * sinLon;\n    cartesian.z = ((b * b) / (a * a) * N_Phi + h) * sinLat;\n    return cartesian;\n}\n\nvec4 calculateProjectedCoordinate(vec3 lonLatLev) {\n    // the range of longitude in Cesium is [-180, 180] but the range of longitude in the NetCDF file is [0, 360]\n    // [0, 180] is corresponding to [0, 180] and [180, 360] is corresponding to [-180, 0]\n    lonLatLev.x = mod(lonLatLev.x + 180.0, 360.0) - 180.0;\n    vec3 particlePosition = convertCoordinate(lonLatLev);\n    vec4 projectedCoordinate = czm_modelViewProjection * vec4(particlePosition, 1.0);\n    return projectedCoordinate;\n}\n\nvec4 calculateOffsetOnNormalDirection(vec4 pointA, vec4 pointB, float offsetSign) {\n    vec2 aspectVec2 = vec2(aspect, 1.0);\n    vec2 pointA_XY = (pointA.xy / pointA.w) * aspectVec2;\n    vec2 pointB_XY = (pointB.xy / pointB.w) * aspectVec2;\n\n    float offsetLength = lineWidth / 2.0;\n    vec2 direction = normalize(pointB_XY - pointA_XY);\n    vec2 normalVector = vec2(-direction.y, direction.x);\n    normalVector.x = normalVector.x / aspect;\n    normalVector = offsetLength * normalVector;\n\n    vec4 offset = vec4(offsetSign * normalVector, 0.0, 0.0);\n    return offset;\n}\n\nvec4 calculateOffsetOnMiterDirection(adjacentPoints projectedCoordinates, float offsetSign) {\n    vec2 aspectVec2 = vec2(aspect, 1.0);\n\n    vec4 PointA = projectedCoordinates.previous;\n    vec4 PointB = projectedCoordinates.current;\n    vec4 PointC = projectedCoordinates.next;\n\n    vec2 pointA_XY = (PointA.xy / PointA.w) * aspectVec2;\n    vec2 pointB_XY = (PointB.xy / PointB.w) * aspectVec2;\n    vec2 pointC_XY = (PointC.xy / PointC.w) * aspectVec2;\n\n    vec2 AB = normalize(pointB_XY - pointA_XY);\n    vec2 BC = normalize(pointC_XY - pointB_XY);\n\n    vec2 normalA = vec2(-AB.y, AB.x);\n    vec2 tangent = normalize(AB + BC);\n    vec2 miter = vec2(-tangent.y, tangent.x);\n\n    float offsetLength = lineWidth / 2.0;\n    float projection = dot(miter, normalA);\n    vec4 offset = vec4(0.0);\n    // avoid to use values that are too small\n    if (projection > 0.1) {\n        float miterLength = offsetLength / projection;\n        offset = vec4(offsetSign * miter * miterLength, 0.0, 0.0);\n        offset.x = offset.x / aspect;\n    } else {\n        offset = calculateOffsetOnNormalDirection(PointB, PointC, offsetSign);\n    }\n\n    return offset;\n}\n\nvoid main() {\n    vec2 particleIndex = st;\n\n    vec3 previousPosition = texture2D(previousParticlesPosition, particleIndex).rgb;\n    vec3 currentPosition = texture2D(currentParticlesPosition, particleIndex).rgb;\n    vec3 nextPosition = texture2D(postProcessingPosition, particleIndex).rgb;\n\n    float isAnyRandomPointUsed = texture2D(postProcessingPosition, particleIndex).a +\n        texture2D(currentParticlesPosition, particleIndex).a +\n        texture2D(previousParticlesPosition, particleIndex).a;\n\n    adjacentPoints projectedCoordinates;\n    if (isAnyRandomPointUsed > 0.0) {\n        projectedCoordinates.previous = calculateProjectedCoordinate(previousPosition);\n        projectedCoordinates.current = projectedCoordinates.previous;\n        projectedCoordinates.next = projectedCoordinates.previous;\n    } else {\n        projectedCoordinates.previous = calculateProjectedCoordinate(previousPosition);\n        projectedCoordinates.current = calculateProjectedCoordinate(currentPosition);\n        projectedCoordinates.next = calculateProjectedCoordinate(nextPosition);\n    }\n\n    int pointToUse = int(normal.x);\n    float offsetSign = normal.y;\n    vec4 offset = vec4(0.0);\n    // render lines with triangles and miter joint\n    // read https://blog.scottlogic.com/2019/11/18/drawing-lines-with-webgl.html for detail\n    if (pointToUse == -1) {\n        offset = pixelSize * calculateOffsetOnNormalDirection(projectedCoordinates.previous, projectedCoordinates.current, offsetSign);\n        gl_Position = projectedCoordinates.previous + offset;\n    } else {\n        if (pointToUse == 0) {\n            offset = pixelSize * calculateOffsetOnMiterDirection(projectedCoordinates, offsetSign);\n            gl_Position = projectedCoordinates.current + offset;\n        } else {\n            if (pointToUse == 1) {\n                offset = pixelSize * calculateOffsetOnNormalDirection(projectedCoordinates.current, projectedCoordinates.next, offsetSign);\n                gl_Position = projectedCoordinates.next + offset;\n            } else {\n\n            }\n        }\n    }\n}",_shaderTrailDrawFrag:"uniform sampler2D segmentsColorTexture;\nuniform sampler2D segmentsDepthTexture;\n\nuniform sampler2D currentTrailsColor;\nuniform sampler2D trailsDepthTexture;\n\nuniform float fadeOpacity;\n\nvarying vec2 textureCoordinate;\n\nvoid main() {\n    vec4 pointsColor = texture2D(segmentsColorTexture, textureCoordinate);\n    vec4 trailsColor = texture2D(currentTrailsColor, textureCoordinate);\n\n    trailsColor = floor(fadeOpacity * 255.0 * trailsColor) / 255.0; // make sure the trailsColor will be strictly decreased\n\n    float pointsDepth = texture2D(segmentsDepthTexture, textureCoordinate).r;\n    float trailsDepth = texture2D(trailsDepthTexture, textureCoordinate).r;\n    float globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, textureCoordinate));\n\n    gl_FragColor = vec4(0.0);\n    if (pointsDepth < globeDepth) {\n        gl_FragColor = gl_FragColor + pointsColor;\n    }\n    if (trailsDepth < globeDepth) {\n        gl_FragColor = gl_FragColor + trailsColor;\n    }\n    gl_FragDepthEXT = min(pointsDepth, trailsDepth);\n}",_shaderUpdatePosition:"uniform sampler2D currentParticlesPosition; // (lon, lat, lev)\nuniform sampler2D particlesSpeed; // (u, v, w, norm) Unit converted to degrees of longitude and latitude \n\nvarying vec2 v_textureCoordinates;\n\nvoid main() {\n    // texture coordinate must be normalized\n    vec3 lonLatLev = texture2D(currentParticlesPosition, v_textureCoordinates).rgb;\n    vec3 speed = texture2D(particlesSpeed, v_textureCoordinates).rgb;\n    vec3 nextParticle = lonLatLev + speed;\n\n    gl_FragColor = vec4(nextParticle, 0.0);\n}"};class mx{constructor(e,t,i,r){this.createWindTextures(e,t),this.createParticlesTextures(e,i,r),this.createComputingPrimitives(t,i,r)}createWindTextures(e,t){const i={context:e,width:t.dimensions.lon,height:t.dimensions.lat*t.dimensions.lev,pixelFormat:Cesium.PixelFormat.LUMINANCE,pixelDatatype:Cesium.PixelDatatype.FLOAT,flipY:!1,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST})};this.windTextures={U:px.createTexture(i,t.U.array),V:px.createTexture(i,t.V.array)}}createParticlesTextures(e,t,i){const r={context:e,width:t.particlesTextureSize,height:t.particlesTextureSize,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,flipY:!1,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST})},n=dx.randomizeParticles(t.maxParticles,i),o=new Float32Array(4*t.maxParticles).fill(0);this.particlesTextures={previousParticlesPosition:px.createTexture(r,n),currentParticlesPosition:px.createTexture(r,n),nextParticlesPosition:px.createTexture(r,n),postProcessingPosition:px.createTexture(r,n),particlesSpeed:px.createTexture(r,o)}}destroyParticlesTextures(){Object.keys(this.particlesTextures).forEach((e=>{this.particlesTextures[e].destroy()}))}createComputingPrimitives(e,t,i){const r=new Cesium.Cartesian3(e.dimensions.lon,e.dimensions.lat,e.dimensions.lev),n=new Cesium.Cartesian3(e.lon.min,e.lat.min,e.lev.min),o=new Cesium.Cartesian3(e.lon.max,e.lat.max,e.lev.max),s=new Cesium.Cartesian3((o.x-n.x)/(r.x-1),(o.y-n.y)/(r.y-1),r.z>1?(o.z-n.z)/(r.z-1):1),a=new Cesium.Cartesian2(e.U.min,e.U.max),l=new Cesium.Cartesian2(e.V.min,e.V.max),c=this;this.primitives={calculateSpeed:new GC({commandType:"Compute",uniformMap:{U:function(){return c.windTextures.U},V:function(){return c.windTextures.V},currentParticlesPosition:function(){return c.particlesTextures.currentParticlesPosition},dimension:function(){return r},minimum:function(){return n},maximum:function(){return o},interval:function(){return s},uSpeedRange:function(){return a},vSpeedRange:function(){return l},pixelSize:function(){return i.pixelSize},speedFactor:function(){return t.speedFactor}},fragmentShaderSource:new Cesium.ShaderSource({sources:[px._shaderCalculateSpeedFrag]}),outputTexture:this.particlesTextures.particlesSpeed,preExecute:function(){let e;e=c.particlesTextures.previousParticlesPosition,c.particlesTextures.previousParticlesPosition=c.particlesTextures.currentParticlesPosition,c.particlesTextures.currentParticlesPosition=c.particlesTextures.postProcessingPosition,c.particlesTextures.postProcessingPosition=e,c.primitives.calculateSpeed.commandToExecute.outputTexture=c.particlesTextures.particlesSpeed}}),updatePosition:new GC({commandType:"Compute",uniformMap:{currentParticlesPosition:function(){return c.particlesTextures.currentParticlesPosition},particlesSpeed:function(){return c.particlesTextures.particlesSpeed}},fragmentShaderSource:new Cesium.ShaderSource({sources:[px._shaderUpdatePosition]}),outputTexture:this.particlesTextures.nextParticlesPosition,preExecute:function(){c.primitives.updatePosition.commandToExecute.outputTexture=c.particlesTextures.nextParticlesPosition}}),postProcessingPosition:new GC({commandType:"Compute",uniformMap:{nextParticlesPosition:function(){return c.particlesTextures.nextParticlesPosition},particlesSpeed:function(){return c.particlesTextures.particlesSpeed},lonRange:function(){return i.lonRange},latRange:function(){return i.latRange},randomCoefficient:function(){return Math.random()},dropRate:function(){return t.dropRate},dropRateBump:function(){return t.dropRateBump}},fragmentShaderSource:new Cesium.ShaderSource({sources:[px._shaderPostProcessingPositionFrag]}),outputTexture:this.particlesTextures.postProcessingPosition,preExecute:function(){c.primitives.postProcessingPosition.commandToExecute.outputTexture=c.particlesTextures.postProcessingPosition}})}}}class fx{constructor(e,t,i,r,n){this.createRenderingTextures(e,t),this.createRenderingFramebuffers(e),this.createRenderingPrimitives(e,i,r,n)}createRenderingTextures(e,t){const i={context:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE},r={context:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,pixelFormat:Cesium.PixelFormat.DEPTH_COMPONENT,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_INT};this.textures={segmentsColor:px.createTexture(i),segmentsDepth:px.createTexture(r),currentTrailsColor:px.createTexture(i),currentTrailsDepth:px.createTexture(r),nextTrailsColor:px.createTexture(i),nextTrailsDepth:px.createTexture(r)}}createRenderingFramebuffers(e){this.framebuffers={segments:px.createFramebuffer(e,this.textures.segmentsColor,this.textures.segmentsDepth),currentTrails:px.createFramebuffer(e,this.textures.currentTrailsColor,this.textures.currentTrailsDepth),nextTrails:px.createFramebuffer(e,this.textures.nextTrailsColor,this.textures.nextTrailsDepth)}}createSegmentsGeometry(e){let t=[];for(let i=0;i<e.particlesTextureSize;i++)for(let r=0;r<e.particlesTextureSize;r++)for(let n=0;n<6;n++)t.push(i/e.particlesTextureSize),t.push(r/e.particlesTextureSize);t=new Float32Array(t);let i=[];const r=[-1,0,1],n=[-1,1];for(let t=0;t<e.maxParticles;t++)for(let e=0;e<r.length;e++)for(let t=0;t<n.length;t++)i.push(r[e]),i.push(n[t]),i.push(0);i=new Float32Array(i);const o=12*e.maxParticles;let s=new Uint32Array(o);for(let t=0,i=0,r=0;t<e.maxParticles;t++)s[i++]=r+0,s[i++]=r+1,s[i++]=r+2,s[i++]=r+2,s[i++]=r+1,s[i++]=r+3,s[i++]=r+2,s[i++]=r+4,s[i++]=r+3,s[i++]=r+4,s[i++]=r+3,s[i++]=r+5,r+=6;return new Cesium.Geometry({attributes:new Cesium.GeometryAttributes({st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:t}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:i})}),indices:s})}createRenderingPrimitives(e,t,i,r){const n=this;this.primitives={segments:new GC({commandType:"Draw",attributeLocations:{st:0,normal:1},geometry:this.createSegmentsGeometry(t),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{previousParticlesPosition:function(){return r.particlesTextures.previousParticlesPosition},currentParticlesPosition:function(){return r.particlesTextures.currentParticlesPosition},postProcessingPosition:function(){return r.particlesTextures.postProcessingPosition},aspect:function(){return e.drawingBufferWidth/e.drawingBufferHeight},pixelSize:function(){return i.pixelSize},lineWidth:function(){return t.lineWidth},particleHeight:function(){return t.particleHeight},color:function(){return t.color}},vertexShaderSource:new Cesium.ShaderSource({sources:[px._shaderSegmentDrawVert]}),fragmentShaderSource:new Cesium.ShaderSource({sources:[px._shaderSegmentDragFrag]}),rawRenderState:px.createRawRenderState({viewport:void 0,depthTest:{enabled:!0},depthMask:!0}),framebuffer:this.framebuffers.segments,autoClear:!0}),trails:new GC({commandType:"Draw",attributeLocations:{position:0,st:1},geometry:px.getFullscreenQuad(),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{segmentsColorTexture:function(){return n.textures.segmentsColor},segmentsDepthTexture:function(){return n.textures.segmentsDepth},currentTrailsColor:function(){return n.framebuffers.currentTrails.getColorTexture(0)},trailsDepthTexture:function(){return n.framebuffers.currentTrails.depthTexture},fadeOpacity:function(){return t.fadeOpacity}},vertexShaderSource:new Cesium.ShaderSource({defines:["DISABLE_GL_POSITION_LOG_DEPTH"],sources:[px._shaderFullscreenVert]}),fragmentShaderSource:new Cesium.ShaderSource({defines:["DISABLE_LOG_DEPTH_FRAGMENT_WRITE"],sources:[px._shaderTrailDrawFrag]}),rawRenderState:px.createRawRenderState({viewport:void 0,depthTest:{enabled:!0,func:Cesium.DepthFunction.ALWAYS},depthMask:!0}),framebuffer:this.framebuffers.nextTrails,autoClear:!0,preExecute:function(){let e;e=n.framebuffers.currentTrails,n.framebuffers.currentTrails=n.framebuffers.nextTrails,n.framebuffers.nextTrails=e,n.primitives.trails.commandToExecute.framebuffer=n.framebuffers.nextTrails,n.primitives.trails.clearCommand.framebuffer=n.framebuffers.nextTrails}}),screen:new GC({commandType:"Draw",attributeLocations:{position:0,st:1},geometry:px.getFullscreenQuad(),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{trailsColorTexture:function(){return n.framebuffers.nextTrails.getColorTexture(0)},trailsDepthTexture:function(){return n.framebuffers.nextTrails.depthTexture}},vertexShaderSource:new Cesium.ShaderSource({defines:["DISABLE_GL_POSITION_LOG_DEPTH"],sources:[px._shaderFullscreenVert]}),fragmentShaderSource:new Cesium.ShaderSource({defines:["DISABLE_LOG_DEPTH_FRAGMENT_WRITE"],sources:[px._shaderScreenDrawFrag]}),rawRenderState:px.createRawRenderState({viewport:void 0,depthTest:{enabled:!1},depthMask:!0,blending:{enabled:!0}}),framebuffer:void 0})}}}class gx{constructor(e,t,i,r){this.context=e,this.data=t,this.userInput=i,this.viewerParameters=r,this.particlesComputing=new mx(this.context,this.data,this.userInput,this.viewerParameters),this.particlesRendering=new fx(this.context,this.data,this.userInput,this.viewerParameters,this.particlesComputing)}canvasResize(e){this.particlesComputing.destroyParticlesTextures(),Object.keys(this.particlesComputing.windTextures).forEach((e=>{this.particlesComputing.windTextures[e].destroy()})),Object.keys(this.particlesRendering.framebuffers).forEach((e=>{this.particlesRendering.framebuffers[e].destroy()})),this.context=e,this.particlesComputing=new mx(this.context,this.data,this.userInput,this.viewerParameters),this.particlesRendering=new fx(this.context,this.data,this.userInput,this.viewerParameters,this.particlesComputing)}clearFramebuffers(){const e=new Cesium.ClearCommand({color:new Cesium.Color(0,0,0,0),depth:1,framebuffer:void 0,pass:Cesium.Pass.OPAQUE});Object.keys(this.particlesRendering.framebuffers).forEach((t=>{e.framebuffer=this.particlesRendering.framebuffers[t],e.execute(this.context)}))}refreshParticles(e){if(this.clearFramebuffers(),this.particlesComputing.destroyParticlesTextures(),this.particlesComputing.createParticlesTextures(this.context,this.userInput,this.viewerParameters),e){const e=this.particlesRendering.createSegmentsGeometry(this.userInput);this.particlesRendering.primitives.segments.geometry=e;const t=Cesium.VertexArray.fromGeometry({context:this.context,geometry:e,attributeLocations:this.particlesRendering.primitives.segments.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW});this.particlesRendering.primitives.segments.commandToExecute.vertexArray=t}}applyUserInput(e){let t=!1;this.userInput.maxParticles!=e.maxParticles&&(t=!0),Object.keys(e).forEach((t=>{this.userInput[t]=e[t]})),this.refreshParticles(t)}applyViewerParameters(e){Object.keys(e).forEach((t=>{this.viewerParameters[t]=e[t]})),this.refreshParticles(!1)}}const{Cartesian2:_x,Cartesian3:vx,BoundingSphere:yx,PrimitiveCollection:Cx,Color:xx}=Cesium;const wx="\nvec4 czm_p_toEye(vec2 uv,float depth){\n  vec4 eyeCoordinate = czm_windowToEyeCoordinates(uv, depth);\n  return eyeCoordinate/eyeCoordinate.w;\n}\nvec4 czm_p_toEye(in vec2 uv, in sampler2D depthTexture){\n    float depth=czm_p_getDepth(texture2D(depthTexture, uv));\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera =posInCamera / posInCamera.w;\n    return posInCamera;\n}\n",bx="\nfloat czm_p_getDepth(in vec4 depth){\n  float z_window = czm_unpackDepth(depth);\n  z_window = czm_reverseLogDepth(z_window);\n  float n_range = czm_depthRange.near;\n  float f_range = czm_depthRange.far;\n  return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}";var Sx="struct czm_ellipsoid\n{\n    vec3 center;\n    vec3 radii;\n    vec3 inverseRadii;\n    vec3 inverseRadiiSquared;\n};";const Tx="czm_ellipsoid czm_getWgs84EllipsoidEC()\n{\n    vec3 radii = vec3(6378137.0, 6378137.0, 6356752.314245);\n    vec3 inverseRadii = vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\n    vec3 inverseRadiiSquared = inverseRadii * inverseRadii;\n    czm_ellipsoid temp = czm_ellipsoid(czm_view[3].xyz, radii, inverseRadii, inverseRadiiSquared);\n    return temp;\n}",Ex="vec4 czm_translucentPhong(vec3 toEye, czm_material material)\n{\n    // Diffuse from directional light sources at eye (for top-down and horizon views)\n    float diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\n\n    if (czm_sceneMode == czm_sceneMode3D) {\n        // (and horizon views in 3D)\n        diffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n    }\n\n    diffuse = clamp(diffuse, 0.0, 1.0);\n\n    // Specular from sun and pseudo-moon\n    float specular = czm_getSpecular(czm_sunDirectionEC, toEye, material.normal, material.shininess);\n    specular += czm_getSpecular(czm_moonDirectionEC, toEye, material.normal, material.shininess);\n\n    // Temporary workaround for adding ambient.\n    vec3 materialDiffuse = material.diffuse * 0.5;\n\n    vec3 ambient = materialDiffuse;\n    vec3 color = ambient + material.emission;\n    color += materialDiffuse * diffuse;\n    color += material.specular * specular;\n\n    return vec4(color, material.alpha);\n}\n/**\n * @private\n */\nvec4 czm_translucentPhong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\n    // Diffuse from directional light sources at eye (for top-down and horizon views)\n    float diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\n\n    if (czm_sceneMode == czm_sceneMode3D) {\n        // (and horizon views in 3D)\n        diffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n    }\n\n    diffuse = clamp(diffuse, 0.0, 1.0);\n\n    float specular = czm_getSpecular(lightDirectionEC, toEye, material.normal, material.shininess);\n\n    // Temporary workaround for adding ambient.\n    vec3 materialDiffuse = material.diffuse * 0.5;\n\n    vec3 ambient = materialDiffuse;\n    vec3 color = ambient + material.emission;\n    color += materialDiffuse * diffuse * czm_lightColor;\n    color += material.specular * specular * czm_lightColor;\n\n    return vec4(color, material.alpha);\n}\n\n",Px="\n//low version cesium.\nfloat czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\n    return czm_getLambertDiffuse(lightDirectionEC, material.normal);\n}\n\nfloat czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\n    return czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\n\n/**\n * Computes a color using the Phong lighting model.\n *\n * @name czm_phong\n * @glslFunction\n *\n * @param {vec3} toEye A normalized vector from the fragment to the eye in eye coordinates.\n * @param {czm_material} material The fragment's material.\n *\n * @returns {vec4} The computed color.\n *\n * @example\n * vec3 positionToEyeEC = // ...\n * czm_material material = // ...\n * gl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n *\n * @see czm_getMaterial\n */\nvec4 czm_phong(vec3 toEye, czm_material material)\n{\n    // Diffuse from directional light sources at eye (for top-down)\n    float diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\n    if (czm_sceneMode == czm_sceneMode3D) {\n        // (and horizon views in 3D)\n        diffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n    }\n\n    // Specular from sun and pseudo-moon\n    float specular = czm_private_getSpecularOfMaterial(czm_sunDirectionEC, toEye, material) + czm_private_getSpecularOfMaterial(czm_moonDirectionEC, toEye, material);\n\n    // Temporary workaround for adding ambient.\n    vec3 materialDiffuse = material.diffuse * 0.5;\n\n    vec3 ambient = materialDiffuse;\n    vec3 color = ambient + material.emission;\n    color += materialDiffuse * diffuse;\n    color += material.specular * specular;\n\n#ifdef HDR\n    float sunDiffuse = czm_private_getLambertDiffuseOfMaterial(czm_sunDirectionEC, material);\n    color += materialDiffuse * sunDiffuse * czm_sunColor;\n#endif\n\n    return vec4(color, material.alpha);\n}\n\nvec4 czm_private_phong(vec3 toEye, czm_material material)\n{\n    float diffuse = czm_private_getLambertDiffuseOfMaterial(czm_sunDirectionEC, material);\n    float specular = czm_private_getSpecularOfMaterial(czm_sunDirectionEC, toEye, material);\n\n    vec3 ambient = vec3(0.0);\n    vec3 color = ambient + material.emission;\n    color += material.diffuse * diffuse;\n    color += material.specular * specular;\n\n    return vec4(color, material.alpha);\n}\n//high version Cesium\n\n/**\n * Computes a color using the Phong lighting model.\n *\n * @name czm_phong\n * @glslFunction\n *\n * @param {vec3} toEye A normalized vector from the fragment to the eye in eye coordinates.\n * @param {czm_material} material The fragment's material.\n *\n * @returns {vec4} The computed color.\n *\n * @example\n * vec3 positionToEyeEC = // ...\n * czm_material material = // ...\n * vec3 lightDirectionEC = // ...\n * gl_FragColor = czm_phong(normalize(positionToEyeEC), material, lightDirectionEC);\n *\n * @see czm_getMaterial\n */\nvec4 czm_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\n    // Diffuse from directional light sources at eye (for top-down)\n    float diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\n    if (czm_sceneMode == czm_sceneMode3D) {\n        // (and horizon views in 3D)\n        diffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n    }\n\n    float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\n\n    // Temporary workaround for adding ambient.\n    vec3 materialDiffuse = material.diffuse * 0.5;\n\n    vec3 ambient = materialDiffuse;\n    vec3 color = ambient + material.emission;\n    color += materialDiffuse * diffuse * czm_lightColor;\n    color += material.specular * specular * czm_lightColor;\n\n    return vec4(color, material.alpha);\n}\n\nvec4 czm_private_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\n    float diffuse = czm_private_getLambertDiffuseOfMaterial(lightDirectionEC, material);\n    float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\n\n    vec3 ambient = vec3(0.0);\n    vec3 color = ambient + material.emission;\n    color += material.diffuse * diffuse * czm_lightColor;\n    color += material.specular * specular * czm_lightColor;\n\n    return vec4(color, material.alpha);\n}\n",Ax={czm_p_toEye:wx,czm_p_getDepth:bx,czm_ellipsoid:Sx,czm_getWgs84EllipsoidEC:Tx,czm_translucentPhong:Ex,czm_phong:Px};function Mx(){for(var e in Ax)Ax.hasOwnProperty(e)&&(Cesium.ShaderSource._czmBuiltinsAndUniforms[e]=Ax[e])}Mx();e.AnalysisUtil=Fe,e.ArcGisLayer=kg,e.ArrowPlot=F_,e.AxisPlane=Ur,e.BaiDuLayer=class extends Uc{constructor(e){(e=Re(e,{})).url=Re(e.url,"http://maponline{s}.bdimg.com/tile/?qt=vtile&styles=pl&scaler=1&udt=20200102"),e.customid&&(e.url=`https://api.map.baidu.com/customimage/tile?customid=${e.customid}`);const t=new Cesium.Cartesian2(-Bg,-zg),i=new Cesium.Cartesian2(Bg,zg);e.tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:i}),e.subdomains="123",super(e)}get rectangle(){return this.tilingScheme.rectangle}requestImage(e,t,i){const r=function(e,t,i,r){let n=e.url+"&x={x}&y={y}&z={z}";const o=e._tilingScheme.getNumberOfXTilesAtLevel(r),s=e._tilingScheme.getNumberOfYTilesAtLevel(r),a=4*Math.random()|0;return n=n.replace("{s}",a).replace("{x}",t-o/2).replace("{y}",s/2-i-1).replace("{z}",r),n}(this,e,t,i);return Cesium.ImageryProvider.loadImage(this,r)}},e.BaseAnalysis=Ue,e.BasePlot=Kg,e.BingLayer=Ug,e.Cartometry=He,e.CartometryManager=class{constructor(e,t={}){const{labelStyle:i,polylineStyle:r,polygonStyle:n,pointStyle:o}=t;ze(e),this._viewer=e;const s=R_.defaultLabelStyle;s.disableDepthTestDistance=Number.POSITIVE_INFINITY,this._labelStyle=Re(i,s),this._polylineStyle=Re(r,O_.defaultStyle),this._polygonStyle=Re(n,I_.defaultStyle),this._pointStyle=Re(o,R_.defaultStyle),this._startMeasure=new Ge,this._stopMeasure=new Ge,this._addNode=new Ge,this.formatText=Re(t.formatText,N_);this._nodeMode=Re(t.nodeMode,{distance:!0,area:!1,height:!1,angle:!1}),this._auxiliaryGeometry=Re(t.auxiliaryGeometry,{distance:!0,area:!1,height:!0,angle:!0});const a=new Cesium.ScreenSpaceEventHandler(e.canvas);this._handler=a,this._values={},this._mode=Re(t.mode,Vr.SURFACE_DISTANCE),this._showTip=Re(t.showTip,!0),this._showTip&&(this._tip=new $a,this._tip.show=!1),this._autoDepthTest=Re(t.autoDepthTest,!0),this.listening=!1;const l=new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED});this._auxiliarylineMaterial=Re(t.auxiliaryLineMaterial,l);const c=new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED});this._depthTestAgainstTerrain=this._viewer.scene.globe.depthTestAgainstTerrain,this._auxiliaryPolygonMaterial=Re(t.auxiliaryPolygonMaterial,c)}get viewer(){return this.viewer}get labelStyle(){return this._labelStyle}set labelStyle(e){this._labelStyle=e}get polylineStyle(){return this._polylineStyle}set polylineStyle(e){this._polylineStyle=e}get polygonStyle(){return this._polygonStyle}set polygonStyle(e){this._polygonStyle=e}get pointStyle(){return this._pointStyle}set pointStyle(e){this._pointStyle=e}get startMeasure(){return this._startMeasure}get stopMeasure(){return this._stopMeasure}get addNode(){return this._addNode}get tip(){return this._tip}get mode(){return this._mode}set mode(e){Vr.validate(e)?this._mode=e:console.warn("CartometryManaer:无效的测量模式")}addEventListener(e,t=[]){this._listening=!0;const i=Vr.getKey(e),r=/.*_?(distance|area|height|angle)$/.exec(i.toLowerCase());let n=!1,o=!1;r&&r[1]&&(n=this._nodeMode[r[1]],o=this._auxiliaryGeometry[r[1]]);const s=this._handler;s.setInputAction((i=>{const r=this.pickPosition(i.position);if(r&&t.push(r),n&&this.createNode(r),o&&this.createAuxiliaryGraphic(t,r,e),this.addNode.raise({mode:e,position:r,id:this.gid}),(e===Vr.HEIGHT||e===Vr.ANGLE)&&(this.tip&&1===t.length&&(this.tip.text="单击地图确定终点."),2===t.length)){this.removeEventListener();let i,r=t[0];if(e===Vr.HEIGHT){i=this.getHeight(t);const e=Ie.fromCartesian(t[0]),n=Ie.fromCartesian(t[1]),o=e.alt<n.alt?e:n;r=Cesium.Cartesian3.fromDegrees(o.lon,o.lat,(n.alt+e.alt)/2)}else i=this.getAngle(t);this.createLabel(r,i),this.stopMeasure.raise({mode:e,label:i,graphic:this._values[this.gid],id:this.gid})}}),Cesium.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction((i=>{if(this.tip&&(this.tip.position=i.endPosition),e===Vr.HEIGHT||e===Vr.ANGLE)return;const r=this.pickPosition(i.endPosition);t.length>1&&r&&t.pop(),t.length>0&&r&&t.push(r)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction((i=>{const r=this.pickPosition(i.position);let o;this.removeEventListener(),n&&r&&this.createNode(r),!r||e===Vr.HEIGHT&&e===Vr.ANGLE||(t.pop(),t.length&&r&&t.push(r),this.addNode.raise({mode:e,position:r,id:this.gid})),e!==Vr.SURFACE_DISTANCE&&e!==Vr.SPACE_DISTANCE||(o=this.getDistance(t,e),this.createLabel(r||t[t.length-1],o,new Cesium.Cartesian2(0,35))),e!==Vr.SURFACE_AREA&&e!==Vr.SPACE_AREA||(o=this.getArea(t,e),this.createLabel(r||t[t.length-1],o)),this.stopMeasure.raise({mode:e,label:o,graphic:this._values[this.gid],id:this.gid})}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}removeEventListener(){const e=this._handler;e.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),e.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._listening=!1,this.tip&&(this.tip.show=!1),this._autoDepthTest&&(this._viewer.depthTest=this._depthTestAgainstTerrain)}clear(){const e=Object.values(this._values);for(const t of e)for(let e of t)this._viewer.entities.remove(e);this._values={}}destroy(){this.clear(),this.removeEventListener(),this._handler.isDestroyed()||this._handler.destroy(),this._viewer=undefinesd}getDistance(e,t){if(e.length<2||!e[0]||!e[1])return"起点";let i;return t===Vr.SURFACE_DISTANCE?i=He.surfaceDistance(e):t===Vr.SPACE_DISTANCE&&(i=He.spaceDistance(e)),this.formatText(i,t,!this._listening)}getArea(e,t){let i;return i=t===Vr.SURFACE_AREA?He.surfaceArea(e):He.spaceArea(e),this.formatText(i,t,!this._listening)}getHeight(e){const t=He.heightFromCartesianArray(e);return this.formatText(Math.abs(t[0]),Vr.HEIGHT)}getAngle(e,t){const i=He.angleBetweenNorth(e[0],e[1]);return this.formatText(i,Vr.ANGLE)}do(e,t=[]){this._depthTestAgainstTerrain||(this._autoDepthTest?this._viewer.depthTest=!0:console.warn("depthTestAgainstTerrain未开启,点位获取可能不准确.")),this.tip&&(this.tip.show=!0),e=Re(e,this.mode);if(!Vr.validate(e))return void console.warn("无效的测量模式");let i;this.gid=We(),this._values[this.gid]=[],this.tip&&(e===Vr.HEIGHT||e===Vr.ANGLE?this.tip.text="单击地图确定起点.":this.tip.text="单击地图添加节点，右击地图结束量算"),this.startMeasure.raise({mode:e,id:this.gid}),e===Vr.SPACE_DISTANCE||e===Vr.HEIGHT?(i=this.polylineStyle,i.clampToGround=!1,i.positions=new Cesium.CallbackProperty((()=>t),!1),this.createPolyline(i)):e===Vr.SURFACE_DISTANCE||e===Vr.ANGLE?(i=this.polylineStyle,i.clampToGround=!0,i.positions=new Cesium.CallbackProperty((()=>t),!1),this.createPolyline(i)):e===Vr.SPACE_AREA?(i=this.polygonStyle,i.outline=!1,i.perPositionHeight=!0,i.heightReference=Cesium.HeightReference.NONE,i.hierarchy=new Cesium.CallbackProperty((()=>new Cesium.PolygonHierarchy(t)),!1),this.createPolygon(i)):e===Vr.SURFACE_AREA&&(i=this.polygonStyle,i.perPositionHeight=!1,i.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND,i.hierarchy=new Cesium.CallbackProperty((()=>new Cesium.PolygonHierarchy(t)),!1),this.createPolygon(i)),this.addEventListener(e,t)}surfaceDistance(){this.do(Vr.SURFACE_DISTANCE)}spaceDistance(){this.do(Vr.SPACE_DISTANCE)}surfaceArea(){this.do(Vr.SURFACE_AREA)}spaceArea(){this.do(Vr.SPACE_AREA)}height(){this.do(Vr.HEIGHT)}angle(){this.do(Vr.ANGLE)}pickPosition(e){const t=this._viewer;let i;const r=t.camera.getPickRay(e);i=t.scene.globe.pick(r,t.scene);return t.scene.pick(e)&&(t.scene.pickPositionSupported?i=t.scene.pickPosition(e):console.warn("This browser does not support pickPosition.")),i}createNode(e){if(!e)return;const t=this.pointStyle,i=this._viewer.entities.add({position:e,point:t});return this._values[this.gid].push(i),i}createLabel(e,t,i=new Cesium.Cartesian2){const r=this.labelStyle;r.text=t,r.pixelOffset=i;const n={position:e,label:r},o=this._viewer.entities.add(n);return this._values[this.gid].push(o),o}createPolygon(e){const t=this._viewer.entities.add({polygon:e});return this._values[this.gid].push(t),t}createPolyline(e){const t=this._viewer.entities.add({polyline:e});return this._values[this.gid].push(t),t}_createAuxiliaryGraphicforHeight(e){if(2!==e.length)return;const t=Ie.fromCartesian(e[0]),i=Ie.fromCartesian(e[1]);let r,n;t.alt<i.alt?(r=t,n=i):(r=i,n=t);const o=new Ie(r.lon,r.lat,n.alt),s=[e[0],o.toCartesian(),e[1]],a=this._viewer.entities.add({polyline:{positions:s,material:this._auxiliarylineMaterial,width:this.polylineStyle.width||3}});this._values[this.gid].push(a)}_createAuxiliaryGraphicforDisgance(e,t){this.createLabel(e,t)}_createAuxiliaryGraphicforAngle(e){if(2!==e.length)return;const t=He.spaceDistance(e),i=new Cesium.Transforms.eastNorthUpToFixedFrame(e[0]),r=new Cesium.Matrix4;Cesium.Matrix4.inverseTransformation(i,r);const n=Cesium.Matrix4.multiplyByPoint(i,new Cesium.Cartesian3(0,t,0),new Cesium.Cartesian3),o={polyline:{positions:[e[0],n],material:this._auxiliarylineMaterial,width:this.polylineStyle.width||3,clampToGround:!0}},s=this._viewer.entities.add(o);this._values[this.gid].push(s)}createAuxiliaryGraphic(e,t,i){if(i===Vr.SPACE_DISTANCE||i===Vr.SURFACE_DISTANCE){const{length:r}=e,n=this.getDistance([e[r-3],e[r-2]],i);this._createAuxiliaryGraphicforDisgance(t,n)}else i===Vr.HEIGHT?this._createAuxiliaryGraphicforHeight(e):i===Vr.ANGLE&&this._createAuxiliaryGraphicforAngle(e)}callback(e,t,i){}},e.CartometryType=Vr,e.CesiumProError=Le,e.CesiumProTerrainProvider=fn,e.CircleScanGraphic=class extends nf{constructor(e){super(e),this._speed=Re(e.speed,10),this._time=0,this.createGraphic()}get speed(){return this._speed}set speed(e){this._speed!==e&&(e<=0&&(this._speed=0),this.definedChanged.raise("speed",e,this._speed),this._speed=e)}createAppearance(){return this._appearance||(this._appearance=new sf({material:new af({translucent:!0,fabric:{uniforms:{image:On.buildModuleUrl("./assets/images/radarScan.png"),stRotation:Cesium.Matrix2.IDENTITY,color:this._color,time:0},source:of}})})),this._appearance}update(e){if(!this.material)return;if(0===this.speed)return void(this.material.uniforms.time=0);const t=Cesium.JulianDate.toDate(e).getTime()*this.speed,i=t%360,r=Cesium.Matrix2.fromRotation(Cesium.Math.toRadians(-i));this.material.uniforms.stRotation={x:r[0],y:r[1],z:r[2],w:r[3]},this.material.uniforms.time=t-parseInt(t)}},e.CircleSpreadGraphic=class extends nf{constructor(e){super(e),this._speed=Re(e.speed,10),this._time=0,this.createGraphic()}get speed(){return this._speed}set speed(e){e!==this._speed&&(e<0&&(e=0),this.definedChanged.raise("speed",e,this._speed),this._speed=e)}createAppearance(){return this._appearance||(this._appearance=new cf({material:new uf({translucent:!0,fabric:{uniforms:{color:this._color,time:0},source:lf}})})),this._appearance}update(e){if(!this.material)return;const t=Cesium.JulianDate.toDate(e).getTime()*this.speed*.001;this.material.uniforms.time=t-parseInt(t)}},e.Cluster=class{constructor(e,t={}){this._objects=Re(t.objects,[]),this._getScreenBoundingBox=Re(t.getScreenBoundingBox,Yn),this._scene=e,this.clusterSize=3,this.pixelRange=50,this._clusterObjects=[]}get objects(){return this._objects}set objects(e){this._objects=e}_clearCluster(){this._objects.map((e=>e.cluster=!1)),this._clusterObjects=[]}update(){const e=this._objects;this._clearCluster();const t=function(e,t){const i=[],r=new jn(t.globe.ellipsoid,t.camera.positionWC);for(let n of e)n.position&&(t.mode!==Vn.SCENE3D||r.isPointVisible(n.position))&&(n.__pixel=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,n.position),n.__pixel&&i.push(n));return i}(e,this._scene),i=new Bn(t,qn,$n,64,Int32Array);for(let e of t){if(e.cluster)continue;const r=this._getScreenBoundingBox(e,e.__pixel),n=Hn.clone(r,new Hn);e.cluster=!0;const o=i.range(r.x,r.y,r.x+r.width,r.y+r.height),s=o.length,a=Gn.clone(e.position);let l,c=1;const u=[];for(let e=0;e<s;e++){const i=t[o[e]];if(i.cluster)continue;u.push(i.id),i.cluster=!0;const r=this._getScreenBoundingBox(i,i.__pixel);Gn.add(i.position,a,a),Hn.union(n,r,n),c++,l=i}c>=this.clusterSize?(Gn.multiplyByScalar(a,1/c,a),this._clusterObjects.push({position:new Gn(a.x,a.y,a.z),number:c,ids:u,id:l.id+c})):this._clusterObjects.push(e)}}},e.ContextMenu=Kn,e.CursorTip=$a,e.CylinderGeometry=Af,e.DefaultDataSource=Om,e.DivGraphic=class{constructor(e={}){if(!e.position)throw new Le("paramerter position must be provided.");if(!e.element)throw new Le("parameter element must be provided.");this._show=Re(e.show,!0),this._element=element}get show(){return this._show}set show(e){this._show=e,this._element.style.display=e?"block":"none"}get element(){return this.element}},e.DynamicConeGraphic=class extends nf{constructor(e){super(e),this._speed=Re(e.speed,1),this._image=Re(e.image,On.buildModuleUrl("assets/img/particle.png")),this._appearance={},this._length=e.length,this._primitive=new Wf,this._primitive.name="DynamicConeGraphic",this._asynchronous=!1,this.createGraphic()}get speed(){return this._speed}set speed(e){if(e===this._speed)return;if(e<=0)throw new Le("速度不能小于0");this.definedChanged.raise("speed",e,this._speed),this._speed=e;const t=Object.values(this._appearance);for(let i of t){i.material.uniforms.speed=e}}get length(){return this._length}set length(e){e!==this._length&&(this.definedChanged.raise("length",e,this._length),this._length=e,this.updatePrimitive())}updatePrimitive(){if(!this._viewer)return;this.primitive.removeAll(),this.createGraphic()}updateAttribute(e,t){if(this.isDestroyed())return;if(!this.primitive)return;const i=this.primitive._primitives;for(let r of i)super.updateAttribute.call({primitive:r,isDestroyed:this.isDestroyed},e,t)}createGraphic(){const e=this.createAppearance(Rf),t=this.createAppearance(Of),i=this.createAppearance(If),r=this.createAppearance(Nf);this._clampToGround?(this.createCircleGroundPrimitive(e,this._asynchronous),this.createCircleGroundPrimitive(t,this._asynchronous),this.createCylinder(0,.35*this._radius,i,this._asynchronous),this.createCylinder(.1*this._radius,.45*this._radius,r,this._asynchronous,.8)):(this.createCirclePrimitive(e,this._asynchronous),this.createCirclePrimitive(t,this._asynchronous),this.createCylinder(0,.35*this._radius,i,this._asynchronous),this.createCylinder(.1*this._radius,.45*this._radius,r,this._asynchronous,.8))}createCylinder(e,t,i,r=!0,n=1){if(this.isDestroyed())return;const o=Re(this._length,.35*this._radius*8)*n,s=Hf.eastNorthUpToFixedFrame(Ie.toCartesian(this._position)),a=Vf.fromTranslation(new jf(0,0,o/2+this._height));Vf.multiply(s,a,s);const l=new Af({bottomRadius:t,topRadius:e,length:o}),c=new Bf({geometryInstances:new Gf({geometry:l,id:this.property}),appearance:i,asynchronous:r,allowPicking:this._allowPicking,modelMatrix:s});return this.primitive.add(c),c}createCirclePrimitive(e,t=!0){if(this.isDestroyed())return;const i=new Uf({center:Ie.toCartesian(this._position),radius:this._radius,stRotation:this._stRotation,extrudedHeight:this._extrudedHeight,height:this._height,granularity:.01}),r=new Bf({geometryInstances:new Gf({geometry:i,id:this.property}),appearance:e,asynchronous:t,allowPicking:this._allowPicking});return this.primitive.add(r),r}createCircleGroundPrimitive(e,t=!0){if(this.isDestroyed())return;const i=new Uf({center:Ie.toCartesian(this._position),radius:this._radius,stRotation:this._stRotation,extrudedHeight:this._extrudedHeight,height:this._height}),r=new zf({geometryInstances:new Gf({geometry:i,id:this.property}),appearance:e,asynchronous:t,allowPicking:this._allowPicking});return this.primitive.add(r),r}createAppearance(e){return this._appearance[e]||(this._appearance[e]=new kf({flat:!0,material:new Ff({translucent:!0,fabric:{uniforms:{color:this._color,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAEACAYAAAADRnAGAAAAAXNSR0IArs4c6QAACQdJREFUeF7tncmvFUUUxr9yFqdEnNg4oa404kYwutANIBu36sK9Cn+Ngmtnl7pSNFE2DmgiGl0pDnGDJjyMAUXGMh85bZpL9+2699U5VcU7N7mbl/uqvv6dr6u7q0+dCljjn7DGjx8OwB2wxgn4KbDGDeCDoJ8C806BGOMlAPg9E0KIJU4XbQ2jDogxXgHgZgDXAlgB8GcI4YwlBAsNgwCE+gYATwLYBOADAJ+EEP62AmClYQzAZQA2AtgFYCuAVwC8GkI4YgjARMMYAP79RgBbANwL4EsAB0IIx4cAxBj5e44V/JzNMV5Im+oa5o0BlwK4CsCVAI5PHPx1ANYLAI4XRzNBUNew6stgjJGA7gewHTh3X/E+gO9DCCcMT5elNeQAcA2AxwHslAPeDWBfCOGYIYClNeQAwMvlnTJe8Jj3A/glhHDSEMDSGlYNgAcZY7wcAKPAzz+WB99BXlZDFgBWkdboxwFoUG2pTXdAS9HS0OoO0KDaUpvugJaipaHVHaBBtaU2kx0g99pXyyMv5wfMHnZm7vezakgCIAd/N4DNIoZPfD+HEE5ZRVtLQyoAPuk9AeBFOeCX5ZnfcpJURUMqAM64PCCzPmTAWWLO+vxr6AAVDakAOOHJ9wM3yQEfBnAshHDWEICKhiQAMunB33KSkp8ib4pkpjirhmQAVpG27scBWBOvrT93QG0RsdbjDrAmXlt/7oDaImKtxx1gTby2/twBtUXEWo87wJp4bf2pO0Ajg2xRiPM0qAKQjlUyyFIhTGnQBtBlbzHjlLnGnEv8znJKvZfFNqhBGwDnEZlB1s0mM4PMOuV2rgZtAMzeumvmfUKJDLJRDaoAZDKVGWTr5JxlBpnZy5RunJCXKoMa1AGkDlalfucASpGvpV93QC2RKKXDHVCKfC39ugNqiUQpHe6AUuRr6TfZAbKQkRlac1eRaR6YhoYkANJxt4aPCyq7dYSWOUJMkcmuIRUA01K4gJLP9dsA8Ln+deOVpCoaUgGQ/m0AdgB4EMDeAkvjVDQkAZDnek5uMEvsellNvmKZJaalIRmACGAU+D/R+uB7kxtZNSwEQHOEL9W2AyhFvpZ+3QG1RKKUDndAKfK19OsOqCUSpXS4A0qRr6Vfd0AtkSilwx1Qinwt/boDaolEKR3ugJzkJReHc4enAZwqMW22qIZsDpDyl8zG4vT5IQA/yPJas1qky2jICeAGAE8BeAbApwDeBPCbZR3SGOPCGjQAPA3gs8IAkjXkBNAlRa7ZU4AwWQiVIFh+96T1ICiJ0QtpyOaAnFcTy7YcgCXtGvtyB9QYFUtN7oAh2jFGZmPwcsYPL2emVeXlVbyJhgscEGPkdfQWuaenlh8B/GEJwVLDEABmgj0M4FlxwFtMihqrLa5xvsYYzTSMAWDNsD6A/QUAmGgYOwVunTkFfi9wCphoGLwKyDnYHwQ5wWH6sdKgdhmsfclsF00VAAPLVbvia5azQzy2/rLdQQ1aAPpLZgm75KYLXDI7qkELgErxw0UGoRhjkgYtALNLZr8A8KvxoukkDSoA5Fa2WzLLPkpuusAls6Ma1AAsYteSv3UAJenX0Lc7oIYolNTgDihJv4a+3QE1RKGkBndASfo19O0OqCEKJTW4A0rSr6Fvd0ANUSipIasD5KUqt+rll7NAg/sUax7wohqyARjZKPlr441YeDyzmzXP1ZATwGyBgz0AXitcZGFSQ24ALLLAeXgWWfgQwMfGG7YzCAtpyAZAZoL7RRb4JuZIgVzBhTRkBSAQugIHWTZhX2bAlKIvPLZJDdkBLCO45P84gJL0a+j7PAfIucNXWvyeKFQBlmOImYb/AciNDIsQ3wdgg2SHWe8pSD2mGvoAeA29XZKjHgPwDoB3Qwh/WVlVbmNNNcwCuEMAPFoQgKkGPwX69pZxgHdSzBZlimyJMtgMipkGvw+wGuBq7ccdUGtkrHS5A6xI19qPO6DWyFjpcgdYka61H3dArZGx0uUOsCJdaz/ugFojY6XLHWBFutZ+3AG1RsZKV5IDeqtAS5bVp1a+NcqqYRJAb3+R9QCOcnOFEMIJqwj1Xrkz9SW7hhQA3Z6d2wEckI1TD1kmPsQY1TSkACD55wA8D+AjAC8BOGi8nF5NQwoAVnPYJBunHgTAVaCmqS9SUUJFwyQAOQcJgd+TAI5bRr8bawRCdg1JACwHPOu+HIA18dr6U3NAL93m3JtmFloNIZhVkOjdPzDdZlSDCoCRdBvrLbeH0m0u0KAFoJl0GysAbwN4r3C+0aAGLQBslxVcWGC1yzgrcQpMalABMDQAFUq36XIOR1N+1ADUdrkb0+MAWomUlk53gBbZVtp1B7QSKS2d7gAtsq206w5oJVJaOt0BWmRbadcd0EqktHS6A7TIttKuO6CVSGnpdAdokW2lXXdAK5HS0ukO0CLbSrvugFYipaXTHaBFtpV23QGtREpLpztAi2wr7boDWomUls5kB0juH9PfuGLDfAdKAtDQkARASlwxZ5/fYwAOF1g1QvjZNaQC6Lat2gbgW9k7zHrViIqGVADdio0XpFhqyVUjWTWkAmCh5Id6q0Y+l1UjZsnPMUYVDakA+DsKyL5iI3V0lwEwu4YkAKkiW/ydA2gxajk1uwNy0myxLRMHyJ0kryCsFMl1h6X2HbhAgzqA3r4DjwDYyH3MAXxjCWGeBgsAvIe/B8AuAFsB7AbwRghhxeqUEQcOarAAwFUbrPm/Q/Yd2AtgXwiBD1UmH1nCN6hBHYA8xvZr/jPyXHxt+kgdYxzUYAJAINAJ/LLm/1mT0M90Ik44T8NcABoTEIseuLaGUQAXe+mMLhDzAKhMQCzigN7+4WoTMfMADE2C/BRCOL3IQazmtzFGdQ3zAHSlM7bIXgMsncEKMpaTIOoapgbBi7Z0xuQYsBrrtvS/ZvcBtUJxALVGxkqXO0CDtNxFris8AcJ7/kkN2R3Qu4XeLPMAX7EIm/EECA+eN1GTGjQAdBMgOwHwFnZy08PcLuxNgExq0ALAyQeW32MBtBITIN3Gi5MasgMYmACpeuNFFQC9CRC2P7npYe5ToGsvZeNFNQBaB5W7XQeQm2hr7a15B/wHRTppPaBaKTsAAAAASUVORK5CYII=",speed:this._speed},source:e}})})),this._appearance[e]}update(e){}},e.DynamicFadeMaterialProperty=Z_,e.DynamicFlowWallMaterialProperty=tv,e.DynamicSpreadMaterialProperty=ov,e.DynamicWaveMaterialProperty=uv,e.Ellipsoid=Xa,e.Event=Ge,e.FillAnalysis=rt,e.FlattenPolygonCollection=class{constructor(e,t){this._model=e,e instanceof hd&&(this._model=e.delegate),this._frameState=t.scene.frameState,this._colorTexture=void 0,this._depthStenclilTexture=void 0,this.frameBuffer=void 0,this._viewport=new Tv,this._rs=void 0,this.canvas=void 0,this._clearColorCommand=new Iv({depth:1,coloe:new Av(0,0,0,1)}),this._useScissorTest=!1,this._scissorRectangle=!1,this._drawCommandList=[],this._camera=new ry,this._passState=void 0,this._clearPassState=void 0,this._width=4096,this._height=4096,this._positions=[],this._polygonBounding=new Tv,this._delta=0,this._localModel=void 0,this._inverseLocalModel=void 0,this._uniforms={},this._initShaderSource=!1,this._colorTexture=void 0,this._enabled=!0,this._removeEvent=t.scene.postRender.addEventListener((e=>{this.update(e.frameState)}))}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get ready(){return this._model.ready}get readyPromise(){return this._model.readyPromise}get polygonBounding(){return this._polygonBounding}set polygonBounding(e){this._polygonBounding={x:e.x,y:e.y,z:e.x+e.width,w:e.y+e.height};const t=this._camera.frustum;t.left=e.x,t.top=e.y+e.height,t.right=e.x+e.width,t.bottom=e.y}_updateUniforms(){if(this._uniforms){if(this._uniforms.u_polygonTexture){const e=new Kv({url:"./"});e.texture=this._colorTexture,this._uniforms.u_polygonTexture.value=e}this._uniforms.u_polygonBounding&&(this._uniforms.u_polygonBounding.value=this._polygonBounding),this._uniforms.u_enabled&&(this._uniforms.u_enabled.value=this._enabled),this._uniforms.u_delta&&(this._uniforms.u_delta.value=this._delta)}}_addShaderSource(){if(this._initShaderSource)return;const e=new Kv({url:"./"});e.texture=this._colorTexture;const t={u_inverseLocalModel:{type:Qv.MAT4,value:this._inverseLocalModel},u_localModel:{type:Qv.MAT4,value:this._localModel},u_polygonBounding:{type:Qv.VEC4,value:this.polygonBounding},u_polygonTexture:{type:Qv.SAMPLER_2D,value:e},u_delta:{type:Qv.FLOAT,value:this._delta},u_enabled:{type:Qv.BOOL,value:this._enabled}};this._uniforms=t,this._model.customShader=new Zv({uniforms:t,vertexShaderText:"bool isPointInBound(vec4 point, vec4 bounds) {\n    return (point.x>bounds.x&&point.x<bounds.z&&point.y>bounds.y&&point.y<bounds.w);\n  }\n  void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput) {\n  vec4 positionLC = u_inverseLocalModel * czm_model * vec4(vsInput.attributes.positionMC, 1.0);  \n    if (u_enabled && isPointInBound(positionLC, u_polygonBounding)) {\n      vec2 textureCoord;\n      textureCoord.x = (positionLC.x-u_polygonBounding.x)/(u_polygonBounding.z-u_polygonBounding.x);\n      textureCoord.y = (positionLC.y-u_polygonBounding.y)/(u_polygonBounding.w-u_polygonBounding.y);\n      float depth = czm_unpackDepth(texture2D(u_polygonTexture, textureCoord));\n      depth = depth * 4096.0;\n      if (depth > 1.0 && positionLC.z > depth) {\n        positionLC.z = mix(depth, positionLC.z, u_delta);\n      }\n      vsOutput.positionMC = (czm_inverseModel * u_localModel * positionLC).xyz;\n    }       \n  }"}),this._initShaderSource=!0}_createDrawCommand(e,t){const i=this._frameState,r=e.attributes.position.values;for(let e=0,i=r.length;e<i/3;e++){const i=new Ev(r[3*e],r[3*e+1],r[3*e+2]);Lv.multiplyByPoint(t,i,i),r[3*e]=i.x,r[3*e+1]=i.y,r[3*e+2]=i.z,this._positions.push(i)}e.boundingSphere=Wv.transform(e.boundingSphere,t),this.polygonBounding=Tv.fromPoints(this._positions);const n=Uv.fromGeometry({context:i.context,geometry:e,attributeLocations:{position:0},bufferUsage:Hv.STREAM_DRAW,interleave:!0}),o=Vv.fromCache({context:i.context,vertexShaderSource:"\nattribute vec3 position;\nvarying float depth;\nvoid main() {\n  vec4 pos = vec4(position, 1.0);\n  depth = position.z;\n  gl_Position = czm_projection * vec4(position.xy, 0.0, 1.0); \n}\n",fragmentShaderSource:"\nvarying float depth;\nvoid main() {\n  float fDepth = depth / 4096.0; \n  gl_FragColor = czm_packDepth(fDepth);\n}\n"}),s=new jv;s.depthTest.enabled=!0,s.cull.enabled=!0,s.cull.face=qv.BACK;const a=new $v({primitiveType:Yv.TRIANGLES,vertexArray:n,shaderProgram:o,uniformMap:{},renderState:s,pass:Xv.CESIUM_3D_TILE});this._updateUniforms(),this._drawCommandList.push(a)}addPolygon(e){this._localModel?this._createDrawCommand(e,this._inverseLocalModel):this.readyPromise.then((()=>{this._updateMatrix(),this._createDrawCommand(e,this._inverseLocalModel)}))}_updateMatrix(){let e=this._model._rtcCenter;if(!e){const t=this._model.boundingSphere.center,i=Pv.fromCartesian(t);e=Ev.fromRadians(i.longitude,i.latitude,0)}this._localModel=Jv.eastNorthUpToFixedFrame(e),this._inverseLocalModel=Lv.inverse(this._localModel,{})}addPolygonFromPositionArray(e){const t=Math.min(...e.map((e=>Pv.fromCartesian(e).height))),i=new Bv({polygonHierarchy:new Gv(e),height:t}),r=Bv.createGeometry(i);this.addPolygon(r)}update(e){if(!this._drawCommandList.length)return;ny.call(this,e),this._initShaderSource||this._addShaderSource(),Mv(this._passState)||(this._passState=new kv(e.context)),this._updateUniforms(),this._passState.viewport=new Tv(0,0,this._width,this._height);const t=e.context.uniformState;t.updateCamera(this._camera),this._clearColorCommand.framebuffer=this.frameBuffer,this._clearColorCommand.execute(e.context,this._clearPassState);for(const i of this._drawCommandList)t.updatePass(i.pass),i.framebuffer=this.frameBuffer,i.execute(e.context,this._passState)}clear(){this._clearColorCommand&&this._clearColorCommand.execute(this._frameState.context,this._clearPassState)}isDestroyed(){return!1}destroy(){this._colorTexture&&!this._colorTexture.isDestroyed()&&this._colorTexture.destroy(),this._depthStenclilTexture&&!this._depthStenclilTexture.isDestroyed()&&this._depthStenclilTexture.destroy(),this.frameBuffer&&!this.frameBuffer.isDestroyed()&&this.frameBuffer.destroy(),Dv(this),this._removeEvent()}},e.GaoDeLayer=Hg,e.GeoJsonDataSource=Nu,e.Geographic4490TilingScheme=el,e.Globe=mp,e.Graphic=tl,e.GraphicGroup=nl,e.GroundSkyBox=class{constructor(e={}){this.sources=al(e.sources,{positiveX:On.buildModuleUrl("./assets/skybox/px.png"),negativeX:On.buildModuleUrl("./assets/skybox/nx.png"),positiveY:On.buildModuleUrl("./assets/skybox/py.png"),negativeY:On.buildModuleUrl("./assets/skybox/ny.png"),positiveZ:On.buildModuleUrl("./assets/skybox/pz.png"),negativeZ:On.buildModuleUrl("./assets/skybox/nz.png")}),this._sources=void 0,this.show=al(e.show,!0),this._command=new ul({modelMatrix:cl.clone(cl.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0,this._isDestroyed=!1}update(e,t){const i=new El,r=this;if(!this.show)return;if(e.mode!==bl.SCENE3D&&e.mode!==bl.MORPHING)return;if(!e.passes.render)return;const{context:n}=e;if(this._sources!==this.sources){this._sources=this.sources;const{sources:e}=this;if(!(pl(e.positiveX)&&pl(e.negativeX)&&pl(e.positiveY)&&pl(e.negativeY)&&pl(e.positiveZ)&&pl(e.negativeZ)))throw new Le("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof e.positiveX!=typeof e.negativeX||typeof e.positiveX!=typeof e.positiveY||typeof e.positiveX!=typeof e.negativeY||typeof e.positiveX!=typeof e.positiveZ||typeof e.positiveX!=typeof e.negativeZ)throw new Le("this.sources properties must all be the same type.");"string"==typeof e.positiveX?yl(n,this._sources).then((e=>{r._cubeMap=r._cubeMap&&r._cubeMap.destroy(),r._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new vl({context:n,source:e}))}const o=this._command;if(o.modelMatrix=fl.eastNorthUpToFixedFrame(e.camera._positionWC),!pl(o.vertexArray)){o.uniformMap={u_cubeMap:()=>r._cubeMap,u_rotateMatrix:()=>"function"==typeof cl.getRotation?cl.getRotation(o.modelMatrix,i):cl.getMatrix3(o.modelMatrix,i)};const e=hl.createGeometry(hl.fromDimensions({dimensions:new dl(2,2,2),vertexFormat:gl.POSITION_ONLY})),t=this._attributeLocations=ml.createAttributeLocations(e);o.vertexArray=xl.fromGeometry({context:n,geometry:e,attributeLocations:t,bufferUsage:_l._DRAW}),o.renderState=Cl.fromCache({blending:wl.ALPHA_BLEND})}if(!pl(o.shaderProgram)||this._useHdr!==t){const e=new Tl({defines:[t?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  "]});o.shaderProgram=Sl.fromCache({context:n,vertexShaderSource:"attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",fragmentShaderSource:e,attributeLocations:this._attributeLocations}),this._useHdr=t}return pl(this._cubeMap)?o:void 0}isDestroyed(){return this._isDestroyed}destroy(){const e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),ll(this)}},e.HeightAnalysis=ot,e.HtmlGraphicGroup=class extends nl{constructor(e,t={}){super(e),this._viewer=e,this._allowPicking=Re(t.allowPicking,!1),this._createRoot(),this._addEventListener(),this.selectedEvent=new Ge}_createRoot(){const e=document.createElement("div");e.style.position="absolute",e.style.zIndex=9999,e.style.pointerEvents="none",e.style.width="100vw",e.style.height="100vh",e.style.left=0,e.style.top=0,this._viewer.container.appendChild(e),this.root=e}_addEventListener(){const e=this._viewer.scene.postRender.addEventListener((()=>{const e=this.values._array,t=viewer.camera._positionCartographic.height;for(let i of e){const e=i.position,r=i.el;if(!r)return;const n=Ie.toPixel(e,this._viewer.scene);if(n&&Ie.isVisible(e,this._viewer))if(r.style.left=n.x+"px",r.style.top=n.y+"px",i.distanceDisplayCondition){const{near:e,far:n}=i.distanceDisplayCondition;r.style.display=t<n&&t>e?i.display||"block":"none"}else r.style.display=i.display||"block";else r.style.display="none"}})),t=this;function i(e){const{target:i}=e;if(!i)return;const r=t.getById(i.id);t.selectedEvent.raise(r)}this.root.addEventListener("click",i),this.removeEventListener=function(){e(),t.root.removeEventListener("click",i)}}add(e){if(!(e instanceof Pl))throw new Le(e+"is not a html graphic.");this.values.set(e.id,e),this.root.appendChild(e.el),e.group=this,e._loadEvent.raise()}remove(e){this.values.remove(e.id),e.el&&this.root.removeChild(e.el)}getById(e){return this.values.get(e)}removeById(e){const t=this.values.get(e);this.remove(t)}clear(){const e=[...this.values._array];for(let t of e)t.remove();this.values.removeAll()}destroy(){this._viewer.container.removeChild(this.root),this.removeEventListener(),je(this)}get boundingSphere(){const e=this.values._array.map((e=>Ie.toCartesian(e.position)));return Cesium.BoundingSphere.fromPoints(e)}},e.HtmlPointGraphic=Pl,e.ImageGraphic=class extends nf{constructor(e){super(e),this._primitive=new Zf,this._image=e.image,this._speedFactor=Re(e.speedFactor,1),this._imageIndex=0,this._imageParser=e.imageParser,this.createGraphic()}get clampToGround(){}set clampToGround(e){throw new Le("clampToGround is not valid.")}get speedFactor(){return this._speedFactor}set speedFactor(e){this._speedFactor=e}createGraphic(){this._requestImage=function(e,t=[],i){const r=document.createElement("img");r.src=e,r.setAttribute("rel:animated_src",e),r.setAttribute("rel:auto_play","0"),r.style.cssText="position:fixed;zIndex: -1;",document.body.appendChild(r);const n=new Jf({gif:r});return new Promise((e=>{n.load((()=>{for(let e=1;e<=n.get_length();e++){n.move_to(e);const r=n.get_canvas();i&&i(r),t.push(r.toDataURL())}e(t)}))}))}(this._image,[],this._imageParser),this._billboard=this._primitive.add({position:Ie.toCartesian(this._position),image:this._image,verticalOrigin:Qf.BOTTOM})}update(){this._speedFactor<=0||this._requestImage.then((e=>{const t=e[Math.floor(this._imageIndex++/this._speedFactor)%e.length];this._billboard.image=t}))}remove(){super.remove(),this._billboard=void 0}},e.InfoBox=cd,e.LonLat=Ie,e.LonLatNetLayer=class{constructor(e={}){const t=new Ol({rectangle:Cesium.Rectangle.MAX_VALUE,intervalOfZeorLevel:e.intervalOfZeorLevel});this._hasAlphaChannel=Re(e.hasAlphaChannel,!0),this._tilingScheme=t,this._image=void 0,this._texture=void 0,this._errorEvent=new Ge,this._ready=!0,this._readyPromise=Promise.resolve(!0),this._font=Re(e.font,"bold 24px sans-serif"),this._color=Re(e.color,"white"),this._lineColor=Re(e.lineColor,"gold"),this._lineWidth=Re(e.lineWidth,2)}get hasAlphaChannel(){return this._hasAlphaChannel}get tileHeight(){return 256}get tileWidth(){return 256}get minimumLevel(){return 0}get maximumLevel(){return 4}get rectangle(){return Cesium.Rectangle.MAX_VALUE}get errorEvent(){return this._errorEvent}get tileDiscardPolicy(){}get readyPromise(){return this._readyPromise}get ready(){return!0}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return`rgba(${255*this._color.red}, ${255*this._color.green}, ${255*this._color.blue}, ${this._color.alpha})`}set color(e){this._color=e}get lineColor(){const e=this._lineColor;return`rgba(${255*e.red}, ${255*e.green}, ${255*e.blue}, ${e.alpha})`}set lineColor(e){this._lineColor=e}get lineWidth(){return this._lineWidth}createCanvas(){const e=document.createElement("canvas");e.width=this.tileWidth,e.height=this.tileHeight;const t=e.getContext("2d");return t.textBaseline="middle",t.textAlign="center",t.font=this.font,t.fillStyle=this.color,t.strokeStyle=this.lineColor,t.lineWidth=this.lineWidth,{canvas:e,ctx:t}}getOffset(e,t,i){const r=this.tilingScheme.getDelatXY(i),n=Math.floor(e),o=Math.floor(t);if(n===e&&o===t)return[0,0,n,o];const s=e-n,a=t-o;let l=0,c=0;return s&&(l=this.tileWidth/r.dx*s),a&&(c=this.tileHeight/r.dy*a),[l,c,n,o]}requestImage(e,t,i,r){const{ctx:n,canvas:o}=this.createCanvas(),s=this.tilingScheme.getPosition(i,e,t);return n.textAlign="left",n.fillText(s.lon,10,o.height/2),n.textAlign="center",n.fillText(s.lat,o.width/2,20),n.strokeRect(0,0,o.width,o.height),Promise.resolve(o)}},e.LonlatTilingScheme=Ol,e.MassiveBillboardLayer=class extends dy{constructor(e={}){e.objects=Re(e.objects,[]),e.pixelSize=Re(e.pixelSize,5),e.color=Re(e.color,vy.fromRandom),e.createGeometryFunction=Re(e.createGeometryFunction,function(e){return function(t){const i={id:t.id,position:t.position,point:{pixelSize:Re(t.pixelSize,e.pixelSize),color:Re(t.color,e.color)}};return t.label&&(i.label={text:t.label}),new yy(i)}}(e)),super(e)}},e.MassiveEntityLayer=dy,e.MassiveGraphicLayer=dd,e.MassiveGraphicLayerCollection=md,e.MassiveModelLayer=class extends dd{constructor(e={}){e.objects.forEach((e=>{e._id=e.id,delete e.id})),super(e),this._id=Re(e.id,eo()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new xy,this._maxClusterLevel=Re(e.maxClusterLevel,12),this._minLoadLevel=Re(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={},this._options=e}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=Ty(e),i=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,i)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){Ty(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=Ty(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){if(!this._collection){this._scene=t;const e=new Cesium.PrimitiveCollection;t.primitives.add(e),this._collection=e}}createGeometry(e,t,i){if(e.level<this._minLoadLevel)return;const r=Re(this._createGeometryFunction,by)(i,this._options);return this.add(r),r}removeGeometry(e,t){if(!t)return;return this._collection.remove(t)}add(e){this._collection&&e&&this._collection.add(e)}removeAll(){this._collection.removeAll()}isDestroyed(){return!1}destroy(){this._collection.removeAll(),Cy(this)}},e.MassivePointLayer=class extends dy{constructor(e={}){e.objects=Re(e.objects,[]),e.pixelSize=Re(e.pixelSize,5),e.color=Re(e.color,Ly.fromRandom),e.createGeometryFunction=Re(e.createGeometryFunction,function(e){return function(t){let i=Oy();"string"!=typeof t.id&&"number"!=typeof t.id||(i=t.id);const r={id:i,position:t.position,point:{pixelSize:Re(t.pixelSize,e.pixelSize),color:Re(t.color,e.color)}};return t.label&&(r.label={text:t.label}),new Ry(r)}}(e)),super(e)}},e.Material=Ny,e.Model=sc,e.MultipleTerrainProvider=class{constructor(e,t={}){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=t.ellipsoid,this._requestVertexNormals=Re(t.requestVertexNormals,!1),this._requestWaterMask=Re(t.requestWaterMask,!1),this._requestMetadata=Re(t.requestMetadata,!0),this._errorEvent=new Ge,this._terrainProviders=[];const i=[];for(let r of e){r.requestVertexNormals=r.requestVertexNormals||t.requestVertexNormals,r.requestWaterMask=r.requestWaterMask||t.requestWaterMask,r.requestMetadata=r.requestMetadata||t.requestMetadata;const e=new fn(r);e.zIndex=r.zIndex||-1,this._terrainProviders.push(e),i.push(Hl(e,r.url))}this._ready=!1,this._readyPromise=new Promise((e=>{Promise.all([...this._terrainProviders.map((e=>e.readyPromise)),...i]).then((t=>{this._ready=!0,e(!0),this._tilingScheme=this._terrainProviders[0]._tilingScheme,this._levelZeroMaximumGeometricError=Nl.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0))}))})),this._terrainList=e,this._validProvider=void 0}get errorEvent(){return this._errorEvent}get tilingScheme(){return this._tilingScheme}get ready(){return this._ready}get readyPromise(){return this._readyPromise}createBoundingRectangle(e){const t=new Fl("multiple-terrain-provider");for(let e of this._terrainProviders)t.entities.add(Ul(e));return e.addLayer(t),function(){const t=e.dataSources.getByName("multiple-terrain-provider");e.dataSources.remove(t[0])}}getLevelMaximumGeometricError(e){return this._validProvider?this._validProvider.getLevelMaximumGeometricError(e):this._levelZeroMaximumGeometricError/(1<<e)}getTileDataAvailable(e,t,i){const r=this._terrainProviders.filter((r=>r.getTileDataAvailable(e,t,i))).sort(((e,t)=>t.zIndex-e.zIndex));return this._validProvider=r[0],!!this._validProvider}requestTileGeometry(e,t,i,r){for(let r of this._terrainProviders)r!==this._validProvider&&r.getTileDataAvailable(e,t,i)&&r.requestTileGeometry(e,t,i);if(this._validProvider)return this._validProvider.requestTileGeometry(e,t,i)}},e.NodePlot=k_,e.PbfDataSource=function(){},e.PlotManager=class{constructor(e,t){ze(e),this._viewer=e,t=Re(t,{}),this._id=Re(t.id,We()),this._dataSource=new Cesium.CustomDataSource("cesiumpro-graphic_"+this._id),this._nodeDataSource=new Cesium.CustomDataSource("cesiumpro-graphic-node_"+this._id),this._viewer.dataSources.add(this._dataSource),this._viewer.dataSources.add(this._nodeDataSource),this._root=this._dataSource.entities,this._nodeRoot=this._nodeDataSource.entities,this._preEdit=new Ge,this._postEdit=new Ge,this._preCreate=new Ge,this._postCreate=new Ge,this._preRemove=new Ge,this._postRemove=new Ge,this._values=new Cesium.AssociativeArray,this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.canvas),this._pointStyle=Re(t.pointStyle,R_.defaultPointStyle),this._labelStyle=Re(t.labelStyle,R_.defaultLabelStyle),this._modelStyle=Re(t.modelStyle,R_.defaultModelStyle),this._billboardStyle=Re(t.billboardStyle,R_.defaultBillboardStyle),this._polylineStyle=Re(t.polylineStyle,O_.defaultStyle),this._polygonStyle=Re(t.polygonStyle,I_.defaultStyle),this._editEventHandler=new Cesium.ScreenSpaceEventHandler(this._viewer.canvas),this._viewer.screenSpaceEventHandler.removeInputAction(H_),this.showTip=Re(t.showTip,!0),this._mode=q_,t.contextEnabled=Re(t.contextEnabled,!0),t.contextEnabled&&(this.contextMenu=this.createContext(),this.addContextEventListener()),this.cursorTip=new $a({text:"",id:"plot-manager-tip",viewer:this._viewer,show:!1}),this.activeGraphic=void 0,this.selectedGraphic=void 0}get viewer(){return this._viewer}get preEdit(){return this._preEdit}get postEdit(){return this._postEdit}get preCreate(){return this._preCreate}get postCreate(){return this._postCreate}get preRemove(){return this._preRemove}get postRemove(){return this._postRemove}get root(){return this._root}pick(e){let t,i=!1;return L_.isPoint(e)&&(i=!0),this._mode=$_,e===L_.POINT?t=this.createPoint(this._pointStyle,this._labelStyle):e===L_.LABEL?t=this.createLabel(this._labelStyle):e===L_.MODEL?t=this.createModel(this._modelStyle,this._labelStyle):e===L_.BILLBOARD?t=this.createBillboard(this._billboardStyle,this._labelStyle):e===L_.POLYLINE?t=this.createPolyline(this._polylineStyle):e===L_.POLYGON?t=this.createPolygon(this._polygonStyle):L_.isArrow(e)&&(t=this.createArrow(this._polygonStyle,e)),this.activeGraphic=t,t.startEdit(),this.addEventListener(i),t}createPoint(e,t){const i=new R_(e,{label:t});return this.add(i),i}createLabel(e){const t=new R_(e,{type:L_.LABEL});return this.add(t),t}createModel(e,t){const i=new R_(e,{type:L_.MODEL,label:t});return this.add(i),i}createBillboard(e,t){const i=new R_(e,{type:L_.BILLBOARD,label:t});return this.add(i),i}createPolyline(e){const t=new O_(e);return this.add(t),t}createPolygon(e){const t=new I_(e);return this.add(t),t}createArrow(e,t){const i=new F_(e,{type:t});return this.add(i),i}add(e){this.preCreate.raise(e),Oe(this.viewer&&Oe(e.entity))&&(this.root.add(e.entity),this._values.set(e.id,e),this.postCreate.raise(e))}remove(e){Oe(e)&&(this.preRemove.raise(e),Oe(this.viewer)&&Oe(e.entity)&&(this.root.remove(e.entity),this.postRemove.raise(e)),this._values.remove(e.id),this.activeGraphic&&(this.activeGraphic=void 0))}get(e){return this._values.values[e]}getById(e){return this._values.get(e)}hasEntity(e){return!!Oe(e)&&this._root.contains(e)}removeAll(){this.root.removeAll(),this.removeNodeGraphic(),this._values.removeAll()}destroy(){this.removeAll(),this.contextMenu&&this.contextMenu.destroy(),this.removeContextEventListener(),this._viewer.dataSources.remove(this._dataSource),this._viewer.dataSources.remove(this._nodeDataSource),this.cursorTip.destroy(),this._handler.isDestroyed()||this._handler.destroy(),je(this)}zoomTo(e){const t=[];if(Array.isArray(e))for(let i of e)t.push(i.entity);else t.push(e.entity);Oe(this._viewer)&&this._viewer.zoomTo(t)}has(e){return"string"==typeof e?this._values.contains(e):this._values.values.includes(e)}startEdit(e){this.activeGraphic&&this.stopEdit(this.activeGraphic),e&&(e.startEdit(),this.preEdit.raise(e),this.createNodeGraphic(e),this.activeGraphic=e,this.addEditEventListener(),this.cursorTip.show=!0,this.cursorTip.text="单击节点选中")}stopEdit(e){e&&(e.stopEdit(),e.highlightGraphic(!1),this._nodeRoot.removeAll(),this.cursorTip.show=!1,this.activeGraphic=void 0,this._mode=q_,this.postEdit.raise(e),this.removeEditListener&&this.removeEditListener())}createNodeGraphic(e){if(L_.isPoint(e.type))return;const t=new k_({positions:e._nodePositions,...R_.defaultStyle}),i=t._values;for(let e of i)this._nodeRoot.add(e);this._nodeGraphic=t}removeNodeGraphic(){this._nodeRoot.removeAll(),this._nodeGraphic=void 0}addEventListener(e=!0){if(!Oe(this.activeGraphic))return;const t=this.activeGraphic.positions,i=e=>{const i=this.pickPosition(e.endPosition);Oe(i)&&(this.showTip&&(this.cursorTip.show=!0,this.cursorTip.text="左键单击添加节点，右键结束。"),t.length<1||(t.length>1&&this.activeGraphic.popNode(),this.activeGraphic.addNode(i)))},r=()=>{this._handler.removeInputAction(z_),this._handler.removeInputAction(B_),this._handler.removeInputAction(j_),this.stopEdit(this.activeGraphic),Oe(this.contextMenu)&&this.addContextEventListener()};e||(this._handler.setInputAction(i,B_),this._handler.setInputAction(r,j_)),this._handler.setInputAction((t=>{const i=L_.isPoint(this.activeGraphic.type)?this.activeGraphic.updatePosition.bind(this.activeGraphic):this.activeGraphic.addNode.bind(this.activeGraphic),r=this.pickPosition(t.position);Oe(r)&&(Oe(i)&&i(r),e&&(this._handler.removeInputAction(z_),this.stopEdit(this.activeGraphic)))}),z_)}addEditEventListener(){const e=this._editEventHandler;let t=!1;const i=i=>{t=!1,Kl(this._viewer,!t),e.removeInputAction(B_),e.removeInputAction(U_)},r=e=>{const t=this.pickPosition(e.endPosition);this.updatePosition(t)};e.setInputAction((e=>{if(Oe(this.contextMenu)&&(this.contextMenu.show=!1),!Oe(this.activeGraphic))return;const t=this._viewer.scene.pick(e.position);Oe(t)&&t.id instanceof Cesium.Entity?this.hasEntity(t.id)?(this.activeGraphic.highlightGraphic(),this._nodeGraphic&&(this._nodeGraphic.activeNode=void 0)):this._nodeGraphic&&this._nodeGraphic.has(t.id)?(this._nodeGraphic.activeNode=t.id.position.getValue(this._viewer.clock.currentTime),this.activeGraphic.highlightGraphic(!1)):(this._nodeGraphic.activeNode=void 0,this.activeGraphic.highlightGraphic(!1)):(this._nodeGraphic&&(this._nodeGraphic.activeNode=void 0),this.activeGraphic&&this.activeGraphic.highlightGraphic(!1))}),z_),e.setInputAction((()=>{t=!0,Kl(this._viewer,!t),e.setInputAction(i,U_),e.setInputAction(r,B_)}),W_),this.removeEditListener=function(){e.removeInputAction(B_),e.removeInputAction(U_),e.removeInputAction(z_),e.removeInputAction(W_),this.removeEditListener=void 0}}addContextEventListener(){this._editEventHandler.setInputAction((e=>{if(this._mode!==q_)return;const t=this._viewer.scene.pick(e.position),i=Vl(e.position,this._viewer,!0);Oe(t)&&this.hasEntity(t.id)&&(this.contextMenu.position=i,this.selectedGraphic=this.getById(t.id.id),Oe(this.contextMenu)&&(this.contextMenu.show=!0))}),V_)}removeContextEventListener(){this._editEventHandler.removeInputAction(V_)}removeEditEventListener(){this._editEventHandler.removeInputAction(z_),this._editEventHandler.removeInputAction(W_)}updatePosition(e){const t=this.activeGraphic;if(Oe(t))if(L_.isPoint(t.type))t.updatePosition(e);else{if(!Oe(this._nodeGraphic)||!Oe(this._nodeGraphic.activeIndex))return;t.updateNode(this._nodeGraphic.activeIndex,e)}}pickPosition(e){if(Oe(this.activeGraphic))return this.activeGraphic.clampToModel,Vl(e,this._viewer)}addNode(e,t,i){if(e.addNode(t,i),this._nodeGraphic){const e=this._nodeGraphic.addNode(t,i);this._nodeRoot.add(e)}}removeNode(e,t){if(e.removeNode&&e.removeNode(t),this._nodeGraphic){const e=this._nodeGraphic.removeNode(t);this._nodeRoot.remove(e)}}get show(){return this._root.show}set show(e){this._root.show=e}get pointStyle(){return this._pointStyle}set pointStyle(e){this._pointStyle=e}get labelStyle(){return this._labelStyle}set labelStyle(e){this._labelStyle=e}get billboardStyle(){return this._billboardStyle}set billboardStyle(e){this._billboardStyle=e}get modelStyle(){return this._modelStyle}set modelStyle(e){this._modelStyle=e}createContext(){return this.contextMenu=new Kn(this._viewer,{items:[{id:"startEdit",text:"开始编辑",class:"fa fa-pencil-square-o",disabled:this.activeGraphic,callback:e=>{if(this.selectedGraphic){this.startEdit(this.selectedGraphic);const t=this.contextMenu.getById("stopEdit");this.contextMenu.updateItemDistabled(t,!1),this.contextMenu.updateItemDistabled(e,!0)}}},{id:"stopEdit",text:"停止编辑",class:"fa fa-floppy-o",disabled:!this.activeGraphic,callback:e=>{if(this.selectedGraphic){this.stopEdit(this.selectedGraphic);const t=this.contextMenu.getById("startEdit");this.contextMenu.updateItemDistabled(e,!0),this.contextMenu.updateItemDistabled(t,!1)}}},{id:"delete",text:"删除图形",class:"fa fa-times",callback:e=>{this.remove(this.selectedGraphic)}},{id:"select",text:"选择顶点",class:"fa fa-mouse-pointer"}]}),this.contextMenu}},e.PlotType=L_,e.PointBaseGraphic=nf,e.PointPlot=R_,e.PolygonPlot=I_,e.PolylineAntialiasingMaterialProperty=pv,e.PolylineFlowMaterialProperty=_v,e.PolylineODMaterialProperty=Cv,e.PolylinePlot=O_,e.PolylineTrailLinkMaterialProperty=Sv,e.PostProcessing=zy,e.Primitive=function(){Object.defineProperty(um.prototype,"needUpdate",{get(){return!!this._needUpdate},set(e){this._needUpdate=e}}),um.prototype.update=function(e){if(gm.call(this,e),this.needUpdate){var t=mm(this._createShaderProgramFunction,xm);console.log("update shader"),t(this,e,appearance),this.needUpdate=!1}}},e.Properties=Ql,e.RadarScanGraphic=class extends nf{constructor(e){super(e),this._speed=Re(e.speed,10),this._time=0,this.createGraphic()}get speed(){return this._speed}set speed(e){e!==this._speed&&(e<0&&(this._speed=0),this.definedChanged.raise("speed",e,this._speed),this._speed=e)}createAppearance(){return this._appearance||(this._appearance=new eg({material:new tg({translucent:!0,fabric:{uniforms:{color:this._color,time:0},source:Kf}})})),this._appearance}update(e){if(!this.material)return;if(0===this.speed)return void(this.material.uniforms.time=.9999);const t=Cesium.JulianDate.toDate(e).getTime()/500*this.speed;this.material.uniforms.time=t-parseInt(t)}},e.RectangularSensorPrimitive=Cr,e.SatelliteScanGraphic=class extends tl{constructor(e){if(e.path&&(e.position=e.path.position.getValue(viewer.clock.currentTime)),super(e),this._clampToGround=!1,!Oe(e.position))throw new Le("参数options必须定义position或path属性。");const t=Ie.toCartographic(e.position,viewer);this._position=Ie.toCartesian(e.position),this._thickness=Re(e.thickness,.3),this._slices=Re(e.slices,20),this.speed=Re(e.speed,.5),this._height=t.height,this._surface=ig.fromRadians(t.longitude,t.latitude),this.radius=e.radius||.5*this._height,this._inverse=e.inverse||!1,this._animation=!Oe(e.animation)||e.animation,this._show=!Oe(e.show)||e.show,this._color=e.color,this.path=e.path,this._tracked=e.tracked||!1,this._rotation=e.rotation,this._axis=e.axis,this._matrix=rg.multiplyByTranslation(ng.eastNorthUpToFixedFrame(this._surface),new ig(0,0,.5*this._height),new rg),this.transform(this._rotation),this.image=e.image,this.model=e.model,this._primitive=new ag,this._primitive.name="SatelliteScan",this._loadEvent.addEventListener((()=>{this._viewer&&(this.stopAnimate=this._viewer.scene.preUpdate.addEventListener((()=>{fg(this)})))})),this.createGraphic()}updateMatrix(e){e&&(this._matrix=e,this.scanPrimitive.modelMatrix=e,this.modelPrimitive&&(this.modelPrimitive.modelMatrix=e))}updatePrimitive(){this.createGraphic()}createGraphic(){if(this.model){const e=og.fromGltf({url:this.model,pixelOffset:new Cesium.Cartesian2(-10,10)});this.modelPrimitive=this.primitive.add(e)}if(this.image){const e=new lg;this.primitive.add(e),this.imagePrimitive=e.add({image:this.image,position:this._position})}const e=new sg({length:this._height,topRadius:0,bottomRadius:this.radius,vertextFormat:cg.MaterialSupport.TEXTURED.vertextFormat}),t=new ug({geometry:e}),i=this.getShaderSorce(),r=new hg({fabric:{type:"satelliteMaterial",uniforms:{color:this._color||dg.WHITE,repeat:this.slices,offset:0,thickness:this.thickness,sign:this.inverse?1:-1},source:i}}),n=new pg({modelMatrix:this._matrix,show:this.show,geometryInstances:t,appearance:new cg({material:r}),asynchronous:!1});this.scanPrimitive=this.primitive.add(n),this.stopAnimate&&this.stopAnimate()}trackSatellite(){if(this._viewer)if(this._tracked){const e=new Cesium.BoundingSphere(this._position,this._height);this._viewer.camera.viewBoundingSphere(e),this._viewer.camera.lookAtTransform(this._matrix)}else this._viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)}get inverse(){return this._inverse}set inverse(e){this._inverse=e,this.scanPrimitive&&(this.scanPrimitive.appearance.material.uniforms.sign=e?1:-1)}get slices(){return this._slices}set slices(e){this._slices=e,this.scanPrimitive&&(this.scanPrimitive.appearance.material.uniforms.repeat=e)}get thickness(){return this._thickness}set thickness(e){e<0&&(e=0),e>1&&(e=1),this.scanPrimitive&&(this.scanPrimitive.appearance.material.uniforms.thickness=e)}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this.transform(e)}get axis(){return this._axis}get tracked(){return this._tracked}set tracked(e){e!==this._tracked&&(this._tracked=e,this.trackSatellite())}get color(){return this._color}set color(e){this._color=e,this.scanPrimitive&&(this.scanPrimitive.appearance.material.uniforms.color=e)}get animation(){return this._animation}set animation(e){e!==this._animation&&(e?this.stopAnimate=this._viewer.scene.preUpdate.addEventListener((()=>{fg(this)})):(this.stopAnimate&&this.stopAnimate(),this.stopAnimate=void 0),this._animation=e)}getShaderSorce(){return"\n    uniform vec4 color;\n    uniform float repeat;\n    uniform float offset;\n    uniform float thickness;\n    uniform float sign;\n    czm_material czm_getMaterial(czm_materialInput inputM){\n      czm_material material=czm_getDefaultMaterial(inputM);\n      float sp=1.0/repeat;\n      vec2 st=inputM.st;\n      float dis=distance(st,vec2(0.5));\n      float m=mod(dis + sign * offset,sp);\n      float a=step(sp*(1.0-thickness),m);\n      material.diffuse=color.rgb;\n      material.alpha=a*color.a;\n      return material;\n    }"}zoomTo(e){if(!this.show||!this._viewer)return;const t=new Cesium.BoundingSphere(this._position,this._height);this._viewer.camera.flyToBoundingSphere(t,{duration:e})}transform(e){e&&(e.x&&mg(this,e.x,new ig(1,0,0)),e.y&&mg(this,e.y,new ig(0,1,0)),e.z&&mg(this,e.z,new ig(0,0,1)))}},e.Scene=cm,e.SectorGeometry=class{constructor(e){if(!Oe((e=Re(e,Re.EMPTY_OBJECT)).center))throw new Le("parameter center is required.");if(!Oe(e.radius))throw new Le("parameter radius is required.");if(!Oe(e.fov))throw new Le("parameter fov is required.");this._center=e.center,this._radius=e.radius,this._fov=e.fov,this._slices=Re(e.slices,this._fov),this._rotation=Cesium.Math.toRadians(Re(e.rotation,0)),this._vertexFormat=Re(e.vertexFormat,By.POSITION_AND_ST),this._extrudedHeight=Re(e.extrudedHeight,0),this._height=Re(e.height,0),this._positions=void 0,this._workerName="createSectorGeometry",this._rectangle=void 0}get center(){return this._center}get rotation(){return Cesium.Math.toDegrees(this._rotation)}get radius(){return this._radius}get fov(){return this._fov}get positions(){return this._positions}get vertexFormat(){return this._vertexFormat}get extrudedHeight(){return this._extrudedHeight}get height(){return this._height}get slices(){return this._slices}static createGeometry(e){const t=[],i=Cesium.Transforms.eastNorthUpToFixedFrame(e._center),r=e._fov/e._slices,n=e.rotation;e._vertexNumber=2*e.slices;const o=[],s=[],a=[];for(let s=0,l=e._slices;s<l;s++){const l=e._radius*Math.cos(Cesium.Math.toRadians(n+r*s)),c=e._radius*Math.sin(Cesium.Math.toRadians(n+r*s)),u=new Cesium.Cartesian3(l,c,0),h=new Cesium.Cartesian3;Cesium.Matrix4.multiplyByPoint(i,u,h),t.push(h.x,h.y,h.z),o.push(.5*Math.cos(Cesium.Math.toRadians(n+r*s))+.5),o.push(.5*Math.sin(Cesium.Math.toRadians(n+r*s))+.5),a.push(0,0,1)}a.push(0,0,1),o.push(.5,.5),t.push(e.center.x,e.center.y,e.center.z);const l=t.length/3-1;0!==e.height&&Cesium.PolygonPipeline.scaleToGeodeticHeight(t,e.height,Cesium.Ellipsoid.WGS84,!1);for(let t=0;t<e._slices-1;t++)s.push(t),s.push(l),s.push(t+1);const c={position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(t)})};return e.vertexFormat.normal&&(c.normal=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:a})),e.vertexFormat.st&&(c.st=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:o})),new Cesium.Geometry({attributes:c,indices:Cesium.IndexDatatype.createTypedArray(e._vertexNumber,s),primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(t)})}},e.Selection=tc,e.ShaderProgram=kp,e.ShapefileDataSource=ed,e.SnowEffect=class extends zy{constructor(e){super(e),this._fragmentShader=Re(this._options.fragmentShader,Gy),this._thickness=Re(this._options.thickness,.5),this._density=Re(this._options.density,10),this._speed=Re(this._options.speed,350);const t={alpha:()=>this.thickness,snowDensity:()=>this.density,speed:()=>this.speed};this._uniforms=Re(this._options.uniforms,t)}get thickness(){return Cesium.Math.clamp(this._thickness,0,1)}set thickness(e){this._thickness=e}get density(){return Cesium.Math.clamp(this._density,0,20)}set density(e){this._density=e}get speed(){const e=this._speed;return 10+Cesium.Math.clamp(390-e,0,390)}set speed(e){this._speed=e}createPostStage(){return new Cesium.PostProcessStage({fragmentShader:this._fragmentShader,uniforms:this._uniforms})}},e.SplitDirection=ic,e.TDTLayer=class extends jg{constructor(e){const t=(e=Re(e,{})).key;t||(console.warn("未定义key，地图服务将不可用"),console.warn("请前往http://lbs.tianditu.gov.cn/server/MapService.html获取地图key"));const i=Re(e.tilingScheme,new Cesium.WebMercatorTilingScheme);let r="w",n="w",o=e.tileMatrixLabels;i instanceof Cesium.GeographicTilingScheme&&(r="c",n="c",Oe(o)||(o=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]));const s=Re(e.layer,"img"),a=`http://t{s}.tianditu.com/${s}_${r}/wmts?service=wmts&tileMatrixSet=${n}&request=GetTile&version=1.0.0&LAYER=${s}&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=${t}`;return new Cesium.WebMapTileServiceImageryProvider({url:a,layer:s,style:e.style||"default",format:e.format||"tiles",tileMatrixSetID:"GoogleMapsCompatible",credit:e.credit?new Cesium.Credit(e.credit||""):null,tilingScheme:e.tilingScheme,maximumLevel:e.maximumLevel||19,minimumLevel:e.minimumLevel||0,tileMatrixLabels:o,subdomains:"01234567"})}static layers=[{layer:"vec",desc:"矢量底图"},{layer:"cva",desc:"矢量注记"},{layer:"img",desc:"影像底图"},{layer:"cia",desc:"影像注记"},{layer:"ter",desc:"地形晕渲"},{layer:"cta",desc:"地形注记"},{layer:"ibo",desc:"全球境界"},{layer:"eva",desc:"矢量英文注记"},{layer:"eia",desc:"影像英文注记"}]},e.TMSLayer=Xg,e.TaskProcessor=class{constructor(e,t={}){this._workers=[],this._workerPath="workers/"+e,this._options=t,Math.max(In.hardwareConcurrency-1,1),this._worker=zn(this)}},e.TecentLayer=class extends Uc{constructor(e={}){e.layer=Re(e.layer,"img"),e.subdomains="123",e.url=qg[e.layer],e.customTags={sx:function(e,t,i,r){return t>>4},sy:function(e,t,i,r){return(1<<r)-i>>4}},super(e)}},e.TileDebugLayer=class{constructor(e={}){e.tileWidth=Re(e.tileWidth,256),e.tileHeight=Re(e.tileHeight,256),this._tilingScheme=Oe(e.tilingScheme)?e.tilingScheme:Jl.get("EPSG:4326",{ellipsoid:e.ellipsoid}),this._errorEvent=new Ge,this._tileWidth=Re(e.tileWidth,256),this._tileHeight=Re(e.tileHeight,256),this._readyPromise=Promise.resolve(!0),this._font=Re(e.font,"bold 24px sans-serif"),this._color=Re(e.color,new Cesium.Color(1,1,1,1)),this._borderColor=Re(e.borderColor,Cesium.Color.GOLD),this._borderWidth=Re(e.borderWidth,2)}get ready(){return!0}get readyPromise(){return this._readyPromise}get hasAlphaChannel(){return!0}get errorEvent(){return this._errorEvent}get rectangle(){return this._tilingScheme.rectangle}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}createCanvas(){const e=document.createElement("canvas");e.width=this.tileWidth,e.height=this.tileHeight;const t=e.getContext("2d");return t.textBaseline="middle",t.textAlign="center",t.font=this.font,t.fillStyle=$g(this.color),t.strokeStyle=$g(this.color),t.lineWidth=this.borderWidth,{canvas:e,ctx:t}}requestImage(e,t,i,r){const{canvas:n,ctx:o}=this.createCanvas(),s=function(e,t,i,r){let n=[];return n[0]="L: "+r,n[1]="X: "+t,e.reverseY?n[2]="Y: "+e.tilingScheme.getNumberOfYTilesAtLevel(r)-i-1:n[2]="Y: "+i,n}(this,e,t,i);return o.fillText(s[0],n.width/2,n.height/4*1),o.fillText(s[1],n.width/2,n.height/4*2),o.fillText(s[2],n.width/2,n.height/4*3),o.strokeRect(0,0,n.width,n.height),Promise.resolve(n)}},e.TileLayer=class{constructor(e={}){this._errorEvent=new Ge,this._tilingScheme=Jl.get("EPSG:4326"),this._ready=!1,this._ready=!0,this._minimumLevel=Re(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._tileWidth=Re(e.tileWidth,256),this._tileHeight=Re(e.tileHeight,256),this._rectangle=Re(e.rectangle,Yg.MAX_VALUE),this._readyPromise=Promise.resolve(!0),this._errorEvent.addEventListener(((e,t,i)=>{}))}get errorEvent(){return this._errorEvent}get minimumLevel(){return this._minimumLevel}get maximumLevel(){return this._maximumLevel}get errorEvent(){return this._errorEvent}get rectangle(){return this._rectangle}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get tilingScheme(){return this._tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}get tileHeight(){return this._tileHeight}get tileWidth(){return this._tileWidth}pickFeatures(e,t,i,r,n){}requestImage(e,t,i,r){return this.requestGeometry(e,t,i),Promise.reject(!1)}requestGeometry(e,t,i){}},e.Tileset=hd,e.TransformHelper=class{constructor(e={}){this.lineWidth=hc(e.lineWidth,15),this.xAxisColor=hc(e.xAxisColor,uc.RED),this.yAxisColor=hc(e.yAxisColor,uc.GREEN),this.zAxisColor=hc(e.zAxisColor,uc.BLUE),this.scaleAxisColor=hc(e.scaleAxisColor,uc.WHITE),this.activeAxisColor=hc(e.activeAxisColor,uc.YELLOW),this._translateEnabled=hc(e.translateEnabled,!0),this._rotateEnabled=hc(e.rotateEnabled,!1),this._scaleEnabled=hc(e.scaleEnabled,!1),this._radiusRatio=hc(e.radiusRatio,1),this.xAxisLength=e.xAxisLength,this.yAxisLength=e.yAxisLength,this.zAxisLength=e.zAxisLength,this.scaleAxisLength=e.scaleAxisLength,this.root=new ac,this.object=null,this._modelMatrix=void 0,this._primitives=[],this._center=new dc,this._radius=0,this._originOffset=hc(e.originOffset,new dc),this._selectedPrimitives=[],this._offset=new dc(0,0,0),this._angle=0,this.rotatePlaneRadius=e.rotatePlaneRadius,this._mode=zc,this.preTranformEvent=new Ge,this.postTransformEvent=new Ge}get translateEnabled(){return this._translateEnabled}set translateEnabled(e){this._translateEnabled=e;for(let t of this._primitives){const i=t.axis;i&&(i.includes(Gc)||i.includes(Wc)||(t.show=e))}}get rotateEnabled(){return this._rotateEnabled}set rotateEnabled(e){this._rotateEnabled=e;for(let t of this._primitives){const i=t.axis;i&&(i.includes(Gc)&&(t.show=e))}}get scaleEnabled(){return this._scaleEnabled}set scaleEnabled(e){this._scaleEnabled=e;for(let t of this._primitives){const i=t.axis;i&&(i.includes(Wc)&&(t.show=e))}}get center(){return dc.add(this._center,this._originOffset,new dc)}get modelMatrix(){return this._modelMatrix}set modelMatrix(e){if(!e)return this._modelMatrix=void 0,void(this._inverseModelMatrix=void 0);this._modelMatrix=e,this._inverseModelMatrix=mc.inverse(e,new mc)}createMoveAxis(){if(!this.center)return;const e=this._radius*this._radiusRatio,t=this.axisRoot,i=this.center;let r=[i,new dc(hc(this.xAxisLength,e)+i.x,i.y,i.z)];this.xAxis=t.add({positions:r,width:this.lineWidth,material:this.getAxisMaterial(this.xAxisColor)}),this.xNormal=new dc,dc.subtract(r[1],r[0],this.xNormal),dc.normalize(this.xNormal,this.xNormal),this.xAux=t.add({positions:[],width:this.lineWidth,material:this.getAxisMaterial(this.activeAxisColor,!0)}),this.xAxis.axis="X",this.xAxis.color=this.xAxisColor,r=[i,new dc(i.x,-hc(this.yAxisLength,e)+i.y,i.z)],this.yAxis=t.add({positions:r,width:this.lineWidth,material:this.getAxisMaterial(this.yAxisColor)}),this.yNormal=new dc,dc.subtract(r[1],r[0],this.yNormal),dc.normalize(this.yNormal,this.yNormal),this.yAux=t.add({positions:[],width:this.lineWidth,material:this.getAxisMaterial(this.activeAxisColor,!0)}),this.yAxis.axis="Y",this.yAxis.color=this.yAxisColor,r=[i,new dc(i.x,i.y,hc(this.zAxisLength,e)+i.z)],this.zAxis=t.add({positions:r,width:this.lineWidth,material:this.getAxisMaterial(this.zAxisColor)}),this.zNormal=new dc,dc.subtract(r[1],r[0],this.zNormal),dc.normalize(this.zNormal,this.zNormal),this.zAux=t.add({positions:[],width:this.lineWidth,material:this.getAxisMaterial(this.activeAxisColor,!0)}),this.zAxis.axis="Z",this.zAxis.color=this.zAxisColor,this._primitives.push(this.xAxis,this.yAxis,this.zAxis)}createAxisPlane(){this.XOYPlane=this.root.add(new Ur({color:this.zAxisColor,modelMatrix:this.modelMatrix,center:this.center,radius:this._radius,normal:new dc(0,0,1),axis:"XY"})),this.XOYPlane.relativeAxis=[this.xAxis,this.yAxis],this.XOZPlane=this.root.add(new Ur({color:this.yAxisColor,modelMatrix:this.modelMatrix,center:this.center,radius:this._radius,normal:new dc(0,1,0),axis:"XZ"})),this.XOZPlane.relativeAxis=[this.xAxis,this.zAxis],this.YOZPlane=this.root.add(new Ur({color:this.xAxisColor,modelMatrix:this.modelMatrix,center:this.center,radius:this._radius,normal:new dc(1,0,0),axis:"YZ"})),this.YOZPlane.relativeAxis=[this.yAxis,this.zAxis],this._primitives.push(this.XOYPlane,this.YOZPlane,this.XOZPlane)}createOrignPoint(){const e=new _c({modelMatrix:this.modelMatrix});this.origin=e.add({show:!0,position:this.center,pixelSize:1.5*this.lineWidth,color:Cesium.Color.WHITE}),this.root.add(e),this._primitives.push(this.origin)}getAxisMaterial(e,t=!1,i=16){return new cc(t?{fabric:{type:"dasharrow",source:rc,uniforms:{color:e,gapColor:uc.TRANSPARENT,dashLength:i,dashPattern:255}}}:{fabric:{type:"PolylineArrow",uniforms:{color:e}}})}createRotateAxis(){const e=[],t=this.rotatePlaneRadius||this._radius*this._radiusRatio,i=this.center;for(let r=0;r<=360;r++){const n=r/180*Math.PI;e.push(new dc(i.x+t*Math.cos(n),i.y+t*Math.sin(n),i.z))}this.zRotate=this.axisRoot.add({positions:[...e],width:this.lineWidth,material:this.getAxisMaterial(this.zAxisColor,!0,0)}),this.zRotate.axis="RZ",this.zRotate.color=this.zAxisColor,this.zRotate.normal=new dc(0,0,1),e.splice(0);for(let r=0;r<=360;r++){const n=r/180*Math.PI;e.push(new dc(i.x+t*Math.cos(n),i.y,i.z+t*Math.sin(n)))}this.yRotate=this.axisRoot.add({positions:[...e],width:this.lineWidth,material:this.getAxisMaterial(this.yAxisColor,!0,0)}),this.yRotate.axis="RY",this.yRotate.color=this.yAxisColor,this.yRotate.normal=new dc(0,1,0),e.splice(0);for(let r=0;r<=360;r++){const n=r/180*Math.PI;e.push(new dc(i.x,i.y+t*Math.cos(n),i.z+t*Math.sin(n)))}this.xRotate=this.axisRoot.add({positions:[...e],width:this.lineWidth,material:this.getAxisMaterial(this.xAxisColor,!0,0)}),this.xRotate.axis="RX",this.xRotate.color=this.xAxisColor,this.xRotate.normal=new dc(-1,0,0),this.rAxuStart=this.axisRoot.add({positions:[],width:this.lineWidth/2,material:this.getAxisMaterial(this.activeAxisColor,!0,0)}),this.rAxuEnd=this.axisRoot.add({positions:[],width:this.lineWidth/2,material:this.getAxisMaterial(this.activeAxisColor,!0,0)}),this._primitives.push(this.xRotate,this.yRotate,this.zRotate,this.rAxuStart,this.rAxuEnd)}createScaleAxis(){const e=this._radius*this._radiusRatio;let t=new dc(1,1,1);this.xNormal&&this.yNormal&&this.zNormal&&(dc.add(this.xNormal,this.yNormal,t),dc.add(t,this.zNormal,t)),dc.normalize(t,t);const i=hc(this.scaleAxisLength,e),r=new dc;dc.multiplyByScalar(t,i,r),dc.add(this._center,r,r),this.scaleAxis=this.axisRoot.add({positions:[this._center,r],width:this.lineWidth,material:this.getAxisMaterial(this.scaleAxisColor)}),this._primitives.push(this.scaleAxis),this.scaleAxis.axis="SXYZ",this.scaleAxis.color=this.scaleAxisColor}bind(e){if(!this._viewer)throw new Le("please call addTo method to add to viewer");this.unbind(),e instanceof sc&&(e=e.delegate),this.object=e,e instanceof Sc!=!1?(this.modelMatrix=e.modelMatrix,e.readyPromise.then((()=>{const t=dc.clone(e.boundingSphere.center);mc.multiplyByPoint(this._inverseModelMatrix,t,this._center),this._radius=e.boundingSphere.radius,this.createPrimitive()}))):this.bindPosition(e)}bindPosition(e){if("function"==typeof e.getValue&&(e=e.getValue(this._viewer.clock.currentTime)),e instanceof dc==!1)throw new Le("position is invalid");this.modelMatrix=Ec.eastNorthUpToFixedFrame(e),this._center=new dc,dc.clone(this.originOffset,this._center),this._radius=10,this.rotateEnabled=!1,this.scaleEnabled=!1,this.createPrimitive(!1)}createPrimitive(e=!0){const t=new lc({modelMatrix:this.modelMatrix});this.axisRoot=t,this.root.add(t),this.createOrignPoint(),this.translateEnabled&&this.createMoveAxis(),this.translateEnabled&&this.createAxisPlane(),e&&this.rotateEnabled&&this.createRotateAxis(),e&&this.scaleEnabled&&this.createScaleAxis()}unbind(){this.object=void 0,this.root.removeAll(),this.origon=void 0,this.xAxis=void 0,this.yAxis=void 0,this.zAxis=void 0,this.modelMatrix=void 0}addTo(e){this._viewer=e,e.scene.primitives.add(this.root),this.addEventListener()}addEventListener(){const e=this._viewer,t=new vc(e.canvas);t.setInputAction((i=>{const r=e.scene.pick(i.position);r&&this._primitives.includes(r.primitive)&&(this._mousedownPixel=i.position,this.active(r.primitive),this._offset=new dc,this._angle=0,t.setInputAction((e=>{const{startPosition:t,endPosition:i}=e;this.transform(t,i)}),yc.MOUSE_MOVE),e.scene.screenSpaceCameraController.enableRotate=!1)}),yc.LEFT_DOWN),t.setInputAction((i=>{this.active(null),t.removeInputAction(yc.MOUSE_MOVE),e.scene.screenSpaceCameraController.enableRotate=!0,this.translateEnabled&&(this.xAux.positions=[],this.yAux.positions=[],this.zAux.positions=[]),this.rotateEnabled&&(this.rAxuStart.positions=[],this.rAxuEnd.positions=[])}),yc.LEFT_UP),this._removeEventListener=function(){t.removeInputAction(yc.LEFT_DOWN),t.removeInputAction(yc.LEFT_UP)}}active(e){if(e||this.activePrimitive){if(!e&&this.activePrimitive){if(Oc(this.activePrimitive,this.activePrimitive.color),this.activePrimitive.isAxisPlane)for(let e of this.activePrimitive.relativeAxis)Oc(e,e.color);return this.activePrimitive=void 0,void(this._mode=zc)}if(e.isAxisPlane)for(let t of e.relativeAxis)Oc(t,this.activeAxisColor);if(this.activePrimitive=e,Oc(this.activePrimitive,this.activeAxisColor),e.axis)if(e.axis.includes("R")){this._mode=Gc;const e=Ic(this._mousedownPixel,helper);this.rAxuStart.positions=[this.center,e],this._startLocalPosition=e}else e.axis.includes("S")?this._mode=Wc:this._mode=Bc}}remove(){this._viewer.scene.primitives.remove(this.root),this._removeEventListener(),this._primitives.splice(0)}transform(e,t){if(this.preTranformEvent.raise(this.modelMatrix),this._mode===Bc)Fc(this,e,t,Pc),this.translate(Pc);else if(this._mode===Gc){const i=function(e,t,i){const r=e.center;dc.subtract(t,r,t),dc.subtract(i,r,i);const n=dc.dot(dc.normalize(t,t),dc.normalize(i,i)),o=dc.subtract(t,i,Dc),s=t,a=dc.cross(o,s,Dc),l=e.activePrimitive.normal,c=wc.sign(dc.dot(a,l));return Math.acos(n)*c}(this,Ic(e,this),Ic(t,this));this.rotate(i)}else if(this._mode=Wc){Fc(this,e,t,Pc);const i=-Pc.sxyz/dc.distance(...this.scaleAxis.positions)+1;this.scale(new dc(i,i,i))}this.postTransformEvent.raise(this.modelMatrix)}scale(e){const t=mc.fromScale(e,Lc);mc.multiply(this._modelMatrix,t,this._modelMatrix),this.modelMatrix=this._modelMatrix;for(let e of this.root._primitives)mc.multiply(e.modelMatrix,t,e.modelMatrix)}rotate(e){this._angle+=e;const t=this.activePrimitive.normal,i=mc.fromTranslation(this.center,Lc),r=gc.fromAxisAngle(t,e,Ac),n=fc.fromQuaternion(r,Mc),o=mc.fromTranslation(dc.negate(this.center,Dc),Rc);mc.multiply(this.modelMatrix,i,this.modelMatrix),mc.multiplyByMatrix3(this.modelMatrix,n,this.modelMatrix),mc.multiply(this.modelMatrix,o,this.modelMatrix);for(let e of this.root._primitives)mc.multiply(e.modelMatrix,i,e.modelMatrix),mc.multiplyByMatrix3(e.modelMatrix,n,e.modelMatrix),mc.multiply(e.modelMatrix,o,e.modelMatrix);this.modelMatrix=this._modelMatrix,this.createRotateAux(this._startLocalPosition,this._angle)}translate(e){if(!this.activePrimitive)return;const t=this.activePrimitive.axis;-1===t.indexOf("X")&&(e.x=0),-1===t.indexOf("Y")&&(e.y=0),-1===t.indexOf("Z")&&(e.z=0),e.x=-e.x,e.z=-e.z,dc.add(this._offset,e,this._offset);const i=mc.fromTranslation(e);mc.multiply(this._modelMatrix,i,this._modelMatrix),this.modelMatrix=this._modelMatrix;for(let e of this.root._primitives)mc.multiply(e.modelMatrix,i,e.modelMatrix);this.createAux(this._offset,i)}createAux(e){if(e.x>0){const t=dc.clone(this.xAxis.positions[0]),i=dc.clone(this.xAxis.positions[0]);i.x+=-e.x,this.xAux.positions=[t,i]}else{const t=dc.clone(this.xAxis.positions[1]),i=dc.clone(this.xAxis.positions[1]);i.x+=-e.x,this.xAux.positions=[t,i]}if(e.y<0){const t=dc.clone(this.yAxis.positions[0]),i=dc.clone(this.yAxis.positions[0]);i.y+=-e.y,this.yAux.positions=[t,i]}else{const t=dc.clone(this.yAxis.positions[1]),i=dc.clone(this.yAxis.positions[1]);i.y+=-e.y,this.yAux.positions=[t,i]}if(e.z>0){const t=dc.clone(this.zAxis.positions[0]),i=dc.clone(this.zAxis.positions[0]);i.z+=-e.z,this.zAux.positions=[t,i]}else{const t=dc.clone(this.zAxis.positions[1]),i=dc.clone(this.zAxis.positions[1]);i.z+=-e.z,this.zAux.positions=[t,i]}}createRotateAux(e,t){if(!this._startLocalPosition)return;const i=gc.fromAxisAngle(this.activePrimitive.normal,-t),r=fc.fromQuaternion(i,Mc),n=mc.fromRotation(r,Lc);let o=dc.subtract(e,this.center,Dc);mc.multiplyByPoint(n,o,o),dc.add(this.center,o,o),this.rAxuEnd.positions=[this.center,o]}},e.Url=On,e.VERSION="1.1.1",e.VectorTileProvider=kd,e.ViewShadowPrimitive=st,e.ViewShedAnalysis=class extends Ue{constructor(e,t){if(super(e),t=Re(t,{}),this._options=t,!Oe(t.observe))throw new Le("parameter options.observe is required.");if(!Oe(t.viewPosition))throw new Le("parameter options.viewPosition is required.");this._observe=t.observe,this._viewPosition=t.viewPosition,this._debug=Re(t.debug,!1),this._far=Re(t.far,Cesium.Cartesian3.distance(this._observe,this._viewPosition)),this._near=Re(t.near,.001*this._far),this._aspectRatio=Re(t.aspectRatio,1.5),this._fov=Re(t.fov,120);const i=Cesium.Cartesian3.subtract(this._viewPosition,this._observe,new Cesium.Cartesian3);this._direction=Cesium.Cartesian3.normalize(i,i),this._up=e.scene.mapProjection.ellipsoid.geodeticSurfaceNormal(this._observe,new Cesium.Cartesian3),this._heading=void 0,this._pitch=void 0,this._roll=void 0}do(){this.preAnalysis.raise(),this.update(),this.postAnalysis.raise()}clear(){this._viewer.scene.primitives.remove(this._frustum),this._viewer.scene.primitives.remove(this._shadowMap)}destroy(){this.clear(),this._frustum&&!this._frustum.isDestroyed()&&this._frustum.destroy(),this._shadowMap&&!this._shadowMap.isDestroyed()&&this._shadowMap.destroy(),super.destroy(this)}get frustum(){return this._frustum}get debug(){return this._debug}set debug(e){this._debug!==e&&(this._debug=e,this._frustum.show=e)}get observe(){return this._observe}set observe(e){this._observe!==e&&(this._observe=e,this.update())}get viewPosition(){return this._viewPosition}set viewPosition(e){this._viewPosition!==e&&(this._viewPosition=e,this.update())}get direction(){return this._direction}get far(){return this._far}set far(e){this._far!==e&&(this._far=e,this.update())}get near(){return this._near}set near(e){this._near!==e&&(this._near=e,this.update())}get fov(){return this._fov}set fov(e){this._fov!==e&&(this._fov=e,this.update())}get aspectRatio(){return this._aspectRatio}set aspectRatio(e){this._aspectRatio!==e&&(this._aspectRatio=e,this.update())}get heading(){return this.updateHeadingPitchRoll(),Cesium.Math.toDegrees(this._heading)}get pitch(){return this.updateHeadingPitchRoll(),Cesium.Math.toDegrees(this._pitch)}get roll(){return this.updateHeadingPitchRoll(),Cesium.Math.toDegrees(this._roll)}update(){this.createOrupdateCamera(),this.createOrUpdateFrustum(),this.createOrUpdateShadowMap()}createOrupdateCamera(){Oe(this._viewCamera)||(this._viewCamera=new Cesium.Camera(viewer.scene)),this._viewCamera.frustum.near=this._near,this._viewCamera.frustum.far=this._far,this._viewCamera.frustum.aspectRatio=this._aspectRatio,this._viewCamera.frustum.fov=Cesium.Math.toRadians(this.fov),this._viewCamera.direction=Cesium.Cartesian3.normalize(this._direction,this._viewCamera.direction),this._viewCamera.position=Cesium.Cartesian3.clone(this._observe,this._viewCamera.position),this._viewCamera.up=this._up,this._viewCamera.right=Cesium.Cartesian3.cross(this._viewCamera.up,this._viewCamera.direction,new Cesium.Cartesian3),Oe(this._heading)||Oe(this._pitch)||Oe(this._roll)||this.updateHeadingPitchRoll()}updateHeadingPitchRoll(){const e=Cesium.Matrix4.clone(this._viewCamera._transform,new Cesium.Matrix4),t=Cesium.Transforms.eastNorthUpToFixedFrame(this._viewCamera.positionWC,this._viewCamera._projection.ellipsoid);var i;this._viewCamera._setTransform(t),this._pitch=(i=this._viewCamera.direction,Sr.PI_OVER_TWO-Sr.acosClamped(i.z)),this._heading=function(e,t){var i;return i=Sr.equalsEpsilon(Math.abs(e.z),1,Sr.EPSILON3)?Math.atan2(t.y,t.x)-Sr.PI_OVER_TWO:Math.atan2(e.y,e.x)-Sr.PI_OVER_TWO,Sr.TWO_PI-Sr.zeroToTwoPi(i)}(this._viewCamera.direction,this._viewCamera.up),this._roll=function(e,t,i){var r=0;return Sr.equalsEpsilon(Math.abs(e.z),1,Sr.EPSILON3)||(r=Math.atan2(-i.z,t.z),r=Sr.zeroToTwoPi(r+Sr.TWO_PI)),r}(this._viewCamera.direction,this._viewCamera.up,this._viewCamera.right),this._viewCamera._setTransform(e)}rotateLeft(e){const t=Cesium.Matrix4.clone(this._viewCamera._transform,new Cesium.Matrix4),i=Cesium.Transforms.eastNorthUpToFixedFrame(this._viewCamera.position,this._viewCamera._projection.ellipsoid);this._viewCamera._setTransform(i),this._viewCamera.rotateLeft(Cesium.Math.toRadians(e)),this._viewCamera._setTransform(t),Cesium.Cartesian3.clone(this._viewCamera.directionWC,this._direction),this.update()}rotateRight(e){this.rotateLeft(-e)}rotateDown(e){const t=Cesium.Matrix4.clone(this._viewCamera._transform,new Cesium.Matrix4),i=Cesium.Transforms.eastNorthUpToFixedFrame(this._viewCamera.position,this._viewCamera._projection.ellipsoid);this._viewCamera._setTransform(i),this._viewCamera.rotateDown(Cesium.Math.toRadians(e)),this._viewCamera._setTransform(t),Cesium.Cartesian3.clone(this._viewCamera.directionWC,this._direction),this.update()}rotateUp(e){this.rotateDown(-e)}createOrUpdateFrustum(){const e=this._viewCamera.positionWC,t=new Cesium.Matrix3,i=this._up,r=this.direction,n=Cesium.Cartesian3.cross(i,r,new Cesium.Cartesian3);Cesium.Matrix3.setColumn(t,0,n,t),Cesium.Matrix3.setColumn(t,1,i,t),Cesium.Matrix3.setColumn(t,2,r,t);const o=Cesium.Quaternion.fromRotationMatrix(t,new Cesium.Quaternion),s=Cesium.Matrix4.fromTranslationQuaternionRotationScale(e,o,new Cesium.Cartesian3(1,1,1),new Cesium.Matrix4);return this._frustum?(this._frustum.modelMatrix=s,this._frustum.xHalfAngle=this._fov/2,this._frustum.yHalfAngle=this._fov/2/this._aspectRatio,void(this._frustum.radius=this._far)):(this._frustum=new Cr({radius:this._far,modelMatrix:s,xHalfAngle:this._fov/2,yHalfAngle:this._fov/2/this._aspectRatio,showScanPlane:!1,showLateralSurfaces:!1,material:Cesium.Material.fromType(Cesium.Material.ColorType,{color:Cesium.Color.AQUA.withAlpha(.3)}),show:this.debug}),this._viewer.scene.primitives.add(this._frustum),this._frustum)}createOrUpdateShadowMap(){if(Oe(this._shadowMap)&&this._viewer.scene.primitives.remove(this._shadowMap),!this._viewCamera||!this._frustum._boundingSphereWC)return;this._frustum._boundingSphereWC;const e=this._options;e.lightCamera=this._viewCamera,e.context=this._viewer.scene.context;const t=new ii(e),i=new st(t);return this._shadowMap=this._viewer.scene.primitives.add(i),this._shadowMap}},e.Viewer=Xm,e.ViewshedMap=ii,e.WFSLayer=Sm,e.WMSLayer=Jg,e.WMTSLayer=jg,e.WaterFaceAppearance=class{constructor(e){return e=Re(e,{}),this._normalMap=Re(e.normalMap,Zy.buildModuleUrl("./assets/images/waterNormal.jpg")),this._baseWaterColor=Re(e.baseWaterColor,new Cesium.Color(0,.42,.71)),this._blendColor=Re(e.blendColor,this._baseWaterColor),this._frequency=Re(e.frequency,8e3),this._animationSpeed=Re(e.animationSpeed,.02),this._amplitude=Re(e.amplitude,5),this._specularIntensity=Re(e.specularIntensity,.8),this._fadeFactor=Re(e.fadeFactor,1),this._alpha=Re(e.alpha,.4),this._material=new Qy({fabric:{type:Qy.WaterType,uniforms:{normalMap:this._normalMap,baseWaterColor:this._baseWaterColor,blendColor:this._blendColor,frequency:this._frequency,animationSpeed:this._animationSpeed,amplitude:this._amplitude,specularIntensity:this._specularIntensity,fadeFactor:this._fadeFactor}}}),new Cesium.MaterialAppearance({material:this._material,faceForward:!0,vertexShaderSource:this.vertexShaderSource,fragmentShaderSource:this.fragmentShaderSource})}get vertexShaderSource(){return Wy}get fragmentShaderSource(){return Uy.replace(/{alpha}/g,this._alpha)}},e.WaterFacePrimitive=class{constructor(e){if(e=Re(e,{}),this._pointsToCartographic=[],this._waterPolygon=e.waterPolygon,!Oe(this._waterPolygon))throw new Le("paramater options.waterPolygon must be provided.");this._waterColor=Re(e.waterColor,Cesium.Color.DARKCYAN),this._refractColor=Re(e.refractColor,new iC(0,0,0,0)),this._reflectColor=Re(e.reflectColor,new iC(.439,.564,.788,0)),this._waveWidth=Re(e.waveWidth,5),this._flowDirection=Re(e.flowDirection,45),this._flowSpeed=Re(e.flowSpeed,3),this._normalTexture=Re(e.normalTexture,On.buildModuleUrl("./assets/images/waterNormal2.png")),this._m_startTime=0,this._reflectCamera=void 0,this._reflectPassState=void 0,this._ready=!1,this._drawCommand=void 0,this._show=Re(e.show,!0)}get show(){return this._show}set show(e){this._show=e}get waterPolygon(){return this._waterPolygon}set waterPolygon(e){Oe(e)&&(this._waterPolygon=e)}get waterColor(){return this._waterColor}set waterColor(e){this._waterColor=e}get refractColor(){return this._refractColor()}set refractColor(e){this._refractColor=e}get flowSpeed(){return this._flowSpeed}set flowSpeed(e){this._flowSpeed=e}get flowDirection(){return this._flowDirection}set flowDirection(e){this._flowDirection=e}get waveWidth(){return this._waveWidth}set waveWidth(e){this._waveWidth=e}get show(){return this._show}set show(e){this._show=e}computeBoundingRectangle(){const e=this._waterPolygon._polygonHierarchy.positions;if(e.length<1)throw new Le("The positions of water polygon hierarchy is empty.");const t=aC.fromCartesian(e[0]);let i=zC.toDegrees(t.longitude),r=zC.toDegrees(t.latitude),n=zC.toDegrees(t.longitude),o=zC.toDegrees(t.latitude);this._zFactor=t.height;for(let t=0,s=e.length;t<s;t++){const s=aC.fromCartesian(e[t]),a=zC.toDegrees(s.longitude),l=zC.toDegrees(s.latitude),c=new lC(a,l);this._pointsToCartographic.push(c),a>n&&(n=a),a<i&&(i=a),l>o&&(o=l),l<r&&(r=l),this._lonMin=i,this._latMin=r,this._waterCenterPos=cC.fromDegrees((i+n)/2,(r+o)/2,this._zFactor)}}initialize(e){const{context:t,camera:i}=e;if(Oe(this._reflectCamera)||(this._reflectCamera=uC.clone(i)),!Oe(this._reflectPassState)){const e=new hC({context:t,colorTextures:[new nC({context:t,width:512,height:512,pixelFormat:fC.RGBA})],depthRenderbuffer:new dC({context:t,format:gC.DEPTH_COMPONENT16,width:512,height:512})});this._reflectPassState=new pC(t),this._reflectPassState.viewport=new mC(0,0,512,512),this._reflectPassState.framebuffer=e}const r=this;this.m_spNormalTexture=e.context.defaultTexture,rC.fetchImage({url:r._normalTexture}).then((e=>{r.m_spNormalTexture=new nC({context:t,width:e.width,height:e.height,source:e,sampler:new sC({wrapS:oC.REPEAT,wrapT:oC.REPEAT})})})),this._ready=!0,this.computeBoundingRectangle()}update(e){if(!this.show)return;const t=e.camera;this._ready||this.initialize(e);const i=e.context;this._fScale=1/(.001*this._waveWidth),_C.IDENTITY;const r=cC.clone(this._waterCenterPos),n=aC.fromCartesian(this._waterCenterPos),o=zC.toDegrees(n.longitude),s=zC.toDegrees(n.latitude),a=cC.fromDegrees(o,s,0),l=new cC;cC.normalize(a,l);const c=new cC(0,1,0),u=new cC;cC.cross(c,l,u),cC.normalize(u,u),cC.cross(l,u,c);const h=new vC;vC.setRow(h,0,u,h),vC.setRow(h,1,c,h),vC.setRow(h,2,l,h);const d=new vC;vC.transpose(h,d);const p=new cC,m=new cC(-r.x,-r.y,-r.z);vC.multiplyByVector(h,m,p);const f=new _C;_C.fromRotationTranslation(h,p,f),this.invWorldViewMatrix=new _C,_C.multiply(f,t.inverseViewMatrix,this.invWorldViewMatrix),this.modelMatrix=new _C,_C.fromTranslation(r,this.modelMatrix),this.modelViewMatrix=new _C,this.modeiViewProjection=new _C,this.modelViewMatrix=_C.multiply(t.viewMatrix,this.modelMatrix,this.modelViewMatrix),this.modeiViewProjection=_C.multiply(t.frustum.projectionMatrix,this.modelViewMatrix,this.modeiViewProjection),this._m_startTime||(this._m_startTime=yC.now().secondsOfDay),this._fElapse=yC.now().secondsOfDay-this._m_startTime,this._frameTime=this._fElapse*this.flowSpeed,this._flowAngle=zC.toRadians(this._flowDirection);const g=CC.fromCache({context:i,vertexShaderSource:tC,fragmentShaderSource:eC}),_=xC.fromCache({depthTest:{enabled:!0}}),v=this;this._uniformMap={u_bgColor:function(){return v._waterColor},u_texCoordOffset:function(){return new lC(-v._lonMin,-v._latMin)},u_texCoordScale:function(){return new lC(v._fScale,v._fScale)},u_scale:function(){return new cC(3,3,3)},u_camPosition:function(){return new cC(3,3,3)},u_modelViewProjectionMatrix:function(){return v.modeiViewProjection},u_modelViewMatrix:function(){return v.modelViewMatrix},u_clampToGroud:function(){return!1},u_invWorldViewMatrix:function(){return v.invWorldViewMatrix},u_frameTime:function(){return v._frameTime},u_normalMap:function(){return v.m_spNormalTexture},u_refractMap:function(){return v.m_spNormalTexture},u_useRefractTex:function(){return!1},u_reflectMap:function(){return v._reflectPassState.framebuffer.getColorTexture(0)},u_reflection:function(){return 1},u_waterColor:function(){return v._waterColor},u_refractColor:function(){return v._refractColor},u_reflectColor:function(){return v._reflectColor},u_flowDirection:function(){return new lC(.5*Math.sin(v._flowAngle)+.5,.5*Math.cos(v._flowAngle)+.5)}},this._waterGeometry=wC.createGeometry(this._waterPolygon);const y=this._waterGeometry.indices,C=this._waterGeometry.attributes.position.values,x=[];cC.pack(r,x);for(let e=0;e<C.length;e++)C[e]+=-x[e%3];const w=[];for(let e=0,t=this._pointsToCartographic.length;e<t;e++)w.push(this._pointsToCartographic[e].x,this._pointsToCartographic[e].y);const b=bC.createIndexBuffer({context:i,typedArray:new Uint32Array(y),usage:SC.STATIC_DRAW,indexDatatype:FC.UNSIGNED_INT}),S=bC.createVertexBuffer({context:i,typedArray:EC.createTypedArray(EC.FLOAT,C),usage:SC.STATIC_DRAW}),T=bC.createVertexBuffer({context:i,typedArray:EC.createTypedArray(EC.FLOAT,w),usage:SC.STATIC_DRAW}),E=[];E.push({index:0,vertexBuffer:S,componentDatatype:EC.FLOAT,componentsPerAttribute:3,normalize:!1}),E.push({index:1,vertexBuffer:T,componentDatatype:EC.FLOAT,componentsPerAttribute:2,normalize:!1});const P=new PC({context:i,attributes:E,indexBuffer:b});this.updateReflectTexture(e),this._drawCommand=new AC({boundingVolume:this._waterGeometry.boundingSphere,primitiveType:MC.TRIANGLES,vertexArray:P,shaderProgram:g,castShadows:!1,receiveShadows:!1,uniformMap:this._uniformMap,renderState:_,pass:DC.OPAQUE}),e.commandList.push(this._drawCommand)}updateReflectTexture(e){const t=e.context,i=e.camera;this.modelViewMatrix=_C.multiply(i.viewMatrix,this.modelMatrix,this.modelViewMatrix),this.modeiViewProjection=_C.multiply(i.frustum.projectionMatrix,this.modelViewMatrix,this.modeiViewProjection);const r=cC.clone(this._waterCenterPos),n=new cC;cC.normalize(r,n);const o=LC.fromPointNormal(r,n),s=-cC.dot(n,r),a=new _C(-2*n.x*n.x+1,-2*n.x*n.y,-2*n.x*n.z,-2*n.x*s,-2*n.y*n.x,-2*n.y*n.y+1,-2*n.y*n.z,-2*n.y*s,-2*n.z*n.x,-2*n.z*n.y,-2*n.z*n.z+1,-2*n.z*s,0,0,0,1),l=new cC;cC.clone(i.direction,l);const c=new cC,u=new cC;cC.multiplyByScalar(n,2*cC.dot(l,n),c),cC.subtract(l,c,u),cC.normalize(u,u);const h=new cC;cC.clone(i.up,h);const d=new cC,p=new cC,m=cC.dot(h,n);cC.multiplyByScalar(n,2*m,p),cC.add(h,p,d),cC.normalize(d,d);const f=new cC(-d.x,-d.y,-d.z),g=new RC;cC.clone(i.position,g);const _=new cC;_C.multiplyByPoint(a,g,_);const v=new _C;i.frustum.far=1e8,_C.clone(i.frustum.projectionMatrix,v),this._reflectCamera.direction=u,m<.5&&(this._reflectCamera.up=f),m>=.5&&(this._reflectCamera.up=d),this._reflectCamera.position=_;const y=new _C;_C.inverse(this._reflectCamera.viewMatrix,y),_C.transpose(y,y);const C=new RC(o.normal.x,o.normal.y,o.normal.z,-cC.dot(n,n));_C.multiplyByVector(y,C,C);const x=C.w/Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z),w=new cC(C.x,C.y,C.z);cC.normalize(w,w);const b=new RC;b.x=(Math.asin(w.x)+v[8])/v[0],b.y=(Math.asin(w.y)+v[9])/v[5],b.z=-1,b.w=(1+v[10])/v[14];const S=new RC(w.x,w.y,w.z,x),T=new cC;RC.multiplyByScalar(S,2/RC.dot(S,b),T),v[2]=T.x,v[6]=T.y,v[10]=T.z+1,v[14]=T.w,_C.clone(v,this._reflectCamera.frustum.projectionMatrix);new OC({color:iC.fromBytes(14,33,60,255),depth:1,framebuffer:this._reflectPassState.framebuffer}).execute(t,this._reflectPassState),this.updateTexture(e,this._reflectPassState,this._reflectCamera)}updateTexture(e,t,i){const r=e.context,n=r.uniformState,o=e.camera;e.camera=i,n.updateCamera(i);const s=e.commandList,a=s.length,l=Cesium.Pass;for(let i=0;i<a;i++){const o=s[i];o.pass!==l.GLOBE&&o.pass!==l.CESIUM_3D_TILE&&o.pass!==l.OPAQUE&&o.pass!==l.TRANSLUCENT&&o.pass!==l.ENVIRONMENT&&o.pass!==l.OVERLAY||(n.updatePass(o.pass),BC(o,e,r,t))}n.updateCamera(o),e.camera=o}destroy(){return this._drawCommand&&(this._drawCommand=this._drawCommand&&this._drawCommand.shaderProgram.destroy()),NC(this)}},e.WindField=class{constructor(e,t){const i={};i.speedFactor=Re(t.speedFactor,1),i.lineWidth=Re(t.lineWidth,4),i.dropRateBump=Re(t.dropRateBump,.01),i.dropRate=Re(t.dropRate,.003),i.particlesTextureSize=Math.ceil(Math.sqrt(Re(t.maxParticles,4096))),i.maxParticles=i.particlesTextureSize*i.particlesTextureSize,i.fadeOpacity=Re(t.fadeOpacity,.996),i.particleHeight=Re(t.particleHeight,100),i.color=Re(t.color,xx.WHITE),this._maxParticles=i.maxParticles,this._color=Re(t.color,"#FFFFFF"),this.viewer=e,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.options=i,this.viewerParameters={lonRange:new _x,latRange:new _x,pixelSize:0},this.globeBoundingSphere=new yx(vx.ZERO,6314355.63),this.updateViewerParameters(),this.imageryLayers=this.viewer.imageryLayers,this.primitives=new Cx,this.viewer.scene.primitives.add(this.primitives)}get fadeOpacity(){return this.particleSystem.userInput.fadeOpacity}set fadeOpacity(e){this.particleSystem.userInput.fadeOpacity=e}get particleHeight(){return this.particleSystem.userInput.particleHeight}set particleHeight(e){this.particleSystem.userInput.particleHeight=e}get color(){return this.particleSystem.userInput.color}set color(e){this.particleSystem.userInput.color=e}get maxParticles(){return this._maxParticles}set maxParticles(e){this._maxParticles=e;const t=this.particleSystem.userInput.maxParticles!==e,i=Math.ceil(Math.sqrt(e));this.particleSystem.userInput.particlesTextureSize=i,this.particleSystem.userInput.maxParticles=i*i,this.particleSystem.refreshParticles(t)}get show(){return this.primitives.show}set show(e){this.primitives.show=e}get speedFactor(){return this.particleSystem.userInput.speedFactor}set speedFactor(e){this.particleSystem.userInput.speedFactor=e}get lineWidth(){return this.particleSystem.userInput.lineWidth}set lineWidth(e){this.particleSystem.userInput.lineWidth=e}loadDataFromNC(e){dx.loadData(e).then((e=>{this.loadDataFromJson(e)}))}loadDataFromJson(e){this.particleSystem=new gx(this.scene.context,e,this.options,this.viewerParameters),this.addPrimitives(),this.setupEventListeners()}remove(){this.viewer.scene.primitives.remove(this.primitives)}addPrimitives(){const e=this.primitives;e.add(this.particleSystem.particlesComputing.primitives.calculateSpeed),e.add(this.particleSystem.particlesComputing.primitives.updatePosition),e.add(this.particleSystem.particlesComputing.primitives.postProcessingPosition),e.add(this.particleSystem.particlesRendering.primitives.segments),e.add(this.particleSystem.particlesRendering.primitives.trails),e.add(this.particleSystem.particlesRendering.primitives.screen)}updateViewerParameters(){const e=this.camera.computeViewRectangle(this.scene.globe.ellipsoid),t=px.viewRectangleToLonLatRange(e);this.viewerParameters.lonRange.x=t.lon.min,this.viewerParameters.lonRange.y=t.lon.max,this.viewerParameters.latRange.x=t.lat.min,this.viewerParameters.latRange.y=t.lat.max;const i=this.camera.getPixelSize(this.globeBoundingSphere,this.scene.drawingBufferWidth,this.scene.drawingBufferHeight);i>0&&(this.viewerParameters.pixelSize=i)}setupEventListeners(){const e=this,t=this.camera.moveStart.addEventListener((function(){console.log("xxxxxxxxxxx"),e.primitives.show=!1})),i=this.camera.moveEnd.addEventListener((function(){e.updateViewerParameters(),e.particleSystem.applyViewerParameters(e.viewerParameters),e.primitives.show=!0}));let r=!1;function n(){r=!0,e.primitives.show=!1,e.primitives.removeAll()}window.addEventListener("resize",n);const o=this.scene.preRender.addEventListener((function(){r&&(e.particleSystem.canvasResize(e.scene.context),r=!1,e.addPrimitives(),e.scene.primitives.show=!0)}));this.removeEventListener=function(){t(),i(),o(),window.removeEventListener("resize",n)}}destroy(){this.remove(),this.removeEventListener&&this.removeEventListener(),je(this)}},e.XYZLayer=Uc,e._shaderBloom="\n#define NUM_MIPS 5\nvarying vec2 v_textureCoordinates;\nuniform sampler2D blurTexture1;\nuniform sampler2D blurTexture2;\nuniform sampler2D blurTexture3;\nuniform sampler2D blurTexture4;\nuniform sampler2D blurTexture5;\nuniform sampler2D colorTexture;\nuniform float bloomStrength;\nuniform float bloomRadius;\nuniform float bloomFactors[NUM_MIPS];\nuniform vec3 bloomTintColors[NUM_MIPS];\nfloat lerpBloomFactor(const in float factor){\n  float mirrorFactor=1.2-factor;\n  return mix(factor,mirrorFactor,bloomRadius);\n}\nvoid main(){\n  vec4 color=texture2D(colorTexture,v_textureCoordinates);\n  gl_FragColor=bloomStrength*(\n    lerpBloomFactor(bloomFactors[0])*vec4(bloomTintColors[0],1.0)*texture2D(blurTexture1,v_textureCoordinates)+\n    lerpBloomFactor(bloomFactors[1])*vec4(bloomTintColors[1],1.0)*texture2D(blurTexture2,v_textureCoordinates)+\n    lerpBloomFactor(bloomFactors[2])*vec4(bloomTintColors[2],1.0)*texture2D(blurTexture3,v_textureCoordinates)+\n    lerpBloomFactor(bloomFactors[3])*vec4(bloomTintColors[3],1.0)*texture2D(blurTexture4,v_textureCoordinates)+\n    lerpBloomFactor(bloomFactors[4])*vec4(bloomTintColors[4],1.0)*texture2D(blurTexture5,v_textureCoordinates)\n  )+color;\n}",e._shaderBuildUniforms=Mx,e._shaderCircleScan=of,e._shaderCircleSpread=lf,e._shaderDynamicConeMaterial=hf,e._shaderDynamicSpreadMaterial=iv,e._shaderDynamicSpreadWallMaterial=Q_,e._shaderDynamicWaveMaterial=sv,e._shaderEllipsoid=Sx,e._shaderFlowImage=Iy,e._shaderFog="\nfloat getDistance(sampler2D depthTexture, vec2 texCoords)\n{\n  float depth = czm_unpackDepth(texture2D(depthTexture, texCoords));\n  if (depth == 0.0) {\n      return czm_infinity;\n  }\n      vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depth);\n  return -eyeCoordinate.z / eyeCoordinate.w;\n}\nfloat interpolateByDistance(vec4 nearFarScalar, float distance)\n{\n  float startDistance = nearFarScalar.x;\n  float startValue = 1.0-nearFarScalar.y;\n  float endDistance = nearFarScalar.z;\n  float endValue = 1.0-nearFarScalar.w;\n  float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);\n  return mix(startValue, endValue, t);\n}\nvec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)\n{\n  return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);\n}\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform vec4 fogByDistance;\nuniform vec4 fogColor;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\n    float distance = getDistance(depthTexture, v_textureCoordinates);\n    vec4 sceneColor = texture2D(colorTexture, v_textureCoordinates);\n    float blendAmount = interpolateByDistance(fogByDistance, distance);\n    vec4 finalFogColor = vec4(fogColor.rgb, fogColor.a * blendAmount);\n    gl_FragColor = alphaBlend(finalFogColor, sceneColor);\n} ",e._shaderGetDepth=bx,e._shaderGetWgs84EllipsoidEC=Tx,e._shaderGlobeFS=Fd,e._shaderGroundSkyBoxFS=ol,e._shaderGroundSkyBoxVS=sl,e._shaderPhong=Px,e._shaderPolylineAntialiasingMaterial=rc,e._shaderPolylineFlowMaterial=mv,e._shaderPolylineTrailLinkMaterial=xv,e._shaderRadarScan=Kf,e._shaderRain="\nuniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nuniform float speed;\nuniform float angle;\nfloat hash(float x){\n    return fract(sin(x*133.3)*13.13);\n}\n\nvoid main(void){\n\n    float time = czm_frameNumber / speed;\n    vec2 resolution = czm_viewport.zw;\n\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n    vec3 c=vec3(.6,.7,.8);\n    //方向\n    float a=angle;\n    float si=sin(a),co=cos(a);\n    uv*=mat2(co,-si,si,co);\n    uv*=length(uv+vec2(0,4.9))*.3+1.;\n\n    float v=1.-sin(hash(floor(uv.x*100.))*2.);\n    float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\n    c*=v*b;\n\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.5);\n}",e._shaderRectangularSensorComm=Wi,e._shaderRectangularSensorFS=Ui,e._shaderRectangularSensorScanPlaneFS=Gi,e._shaderRectangularSensorVS=Hi,e._shaderSelected="\nuniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main(){\n  vec4 color=texture2D(colorTexture,v_textureCoordinates);\n  if(czm_selected()){\n    gl_FragColor=color;\n  }else{\n    gl_FragColor=vec4(0.0);\n  }\n}\n",e._shaderSeperableBlur="\nuniform sampler2D colorTexture;\nuniform vec2 direction;\nuniform float scale;\nuniform float bloomRadius;\nfloat gaussianPdf(in float x, in float sigma) {\n  return 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;\n}\nvoid main(){\n  vec4 color=texture2D(colorTexture,v_textureCoordinates);\n  float fSigma=float(SIGMA);\n  vec2 size=vec2(czm_viewport.z,czm_viewport.w)*scale*fSigma*2.0;\n  vec2 invSize=(1.0+bloomRadius)/size;\n  float weightSum=gaussianPdf(0.0,fSigma);\n  vec3 diffuseSum=texture2D(colorTexture,v_textureCoordinates).rgb*weightSum;\n  bool selected=false;\n  for(int i=0;i<KERNEL_RADIUS;i++){\n    float x=float(i);\n    float w=gaussianPdf(x,fSigma);\n    vec2 uvOffset=direction*invSize*x;\n    vec3 sample1=texture2D(colorTexture,v_textureCoordinates+uvOffset).rgb;\n    vec3 sample2=texture2D(colorTexture,v_textureCoordinates-uvOffset).rgb;\n    diffuseSum+=(sample1+sample2)*w;\n    weightSum+=2.0*w;\n  }\n  gl_FragColor=vec4(diffuseSum/weightSum,2.0);\n}\n",e._shaderSnow=Gy,e._shaderSpecularReflection="\n#extension GL_OES_standard_derivatives : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera =posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nvec3 guussColor(vec2 uv){\n    vec2 pixelSize = 1.0 / czm_viewport.zw;\n    float dx0 = -pixelSize.x;\n    float dy0 = -pixelSize.y;\n    float dx1 = pixelSize.x;\n    float dy1 = pixelSize.y;\n    vec4 gc = (\n        texture2D(colorTexture, uv)+\n        texture2D(colorTexture, uv + vec2(dx0, dy0)) +\n        texture2D(colorTexture, uv + vec2(0.0, dy0)) +\n        texture2D(colorTexture, uv + vec2(dx1, dy0)) +\n        texture2D(colorTexture, uv + vec2(dx0, 0.0)) +\n        texture2D(colorTexture, uv + vec2(dx1, 0.0)) +\n        texture2D(colorTexture, uv + vec2(dx0, dy1)) +\n        texture2D(colorTexture, uv + vec2(0.0, dy1)) +\n        texture2D(colorTexture, uv + vec2(dx1, dy1))\n    ) * (1.0 / 9.0);\n    return gc.rgb;\n}\nvoid main(){\n    float offset = 0.0;\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec3 dx = dFdx(positionEC.xyz);\n    vec3 dy = dFdy(positionEC.xyz);\n    vec3 normal = normalize(cross(dx,dy));\n    vec4 positionWC = normalize(czm_inverseView * positionEC);\n    vec3 normalWC = normalize(czm_inverseViewRotation * normal);\n    float fotNumWC = dot(positionWC.xyz,normalWC);\n    if(fotNumWC<=0.5){\n        gl_FragColor = color;\n        return;\n    }\n\n    vec3 viewDir = normalize(positionEC.xyz);\n    vec3 reflectDir = reflect(viewDir, normal);\n    // vec3 viewReflectDir = czm_viewRotation * reflectDir;\n    vec3 viewReflectDir = reflectDir;\n\n\n    float step = 0.05;\n    int stepNum = int(20.0 / step);\n    vec3 pos;\n    vec3 albedo;\n    bool jd = false;\n    for(int i = 1;i <= 400;i++)\n    {\n        float delta = step * float(i) + offset;\n        pos = positionEC.xyz + viewReflectDir * delta;\n        float d = -pos.z;\n\n        vec4 tmp = czm_projection * vec4(pos,1.0);\n        vec3 screenPos = tmp.xyz / tmp.w;\n        vec2 uv = vec2(screenPos.x, screenPos.y) * 0.5 + vec2(0.5, 0.5);\n\n        if(uv.x > 0.0 && uv.x < 1.0 && uv.y > 0.0 && uv.y < 1.0){\n            float dd = getDepth(texture2D(depthTexture, uv));\n            vec4 jzc = toEye(uv, dd);\n            dd = -jzc.z;\n            if(d>dd){\n                if(abs(abs(d) - abs(dd)) <=step){\n                    jd = true;\n                    // albedo = texture2D(colorTexture, uv).rgb;\n                    albedo = guussColor(uv);\n                }\n                break;\n            }\n        }\n    }\n    if(jd){\n        gl_FragColor = vec4(mix(color.xyz,albedo,0.5),1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",e._shaderToEye=wx,e._shaderTranslucentPhong=Ex,e._shaderWaterAppearanceFS=Uy,e._shaderWaterAppearanceVS=Wy,e._shaderWaterFaceFS=eC,e._shaderWaterFaceVS=tC,e.abstract=Tr,e.checkViewer=ze,e.clone=bn,e.computeDistancePerPixel=Jn,e.computeSceneCenterPoint=Zn,e.computeSceneExtent=Qn,e.createDefaultLayer=Hc,e.createGuid=eo,e.customPrimitive=GC,e.dataProcess=dx,e.dateFormat=Ya,e.defaultValue=Re,e.defined=Oe,e.destroyObject=je,e.getParabolaPoints=function(e,t,i=5e3,r=50){const n=i>5e3?i:5e3,o=Math.abs(e.lon-t.lon)>Math.abs(e.lat-t.lat),s=o?Math.abs(e.lon-t.lon):Math.abs(e.lat-t.lat),a=r>50?r:50,l=[];let c=s/a;if(o){const i=(t.lat-e.lat)/a;e.lon-t.lon>0&&(c=-c);for(let t=0;t<a;t++){const r=n-4*Math.pow(-.5*s+Math.abs(c)*t,2)*n/Math.pow(s,2),o=e.lon+c*t,a=e.lat+i*t;l.push([o,a,r])}}else{const i=(t.lon-e.lon)/a;e.lat-t.lat>0&&(c=-c);for(let t=0;t<a;t++){const r=n-4*Math.pow(-.5*s+Math.abs(c)*t,2)*n/Math.pow(s,2),o=e.lon+i*t,a=e.lat+c*t;l.push([o,a,r])}}return l},e.guid=We,e.index=wm,e.particleSystem=gx,e.particlesComputing=mx,e.particlesRendering=fx,e.pickPosition=Vl,e.proj=Jl,e.randomPosition=function(e,t=1){const i=e.west,r=e.east,n=e.south,o=e.north;t<1&&(t=1);const s=[];for(let e=0;e<t;e++){const e=i+Math.random()*(r-i),t=n+Math.random()*(o-n);s.push(Cesium.Cartesian3.fromRadians(e,t))}return s},e.rotateEnabled=Kl,e.util=px}));
