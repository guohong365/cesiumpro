!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CesiumPro={})}(this,(function(e){"use strict";class t extends Error{constructor(e){super(e),this.name="CesiumProError"}}function i(e,t){return t-e}t.throwInstantiationError=function(){throw new DeveloperError("This function defines an interface and should not be called directly.")},t.throwNoInstance=function(){throw new t("它的定义了一个接口，不能被以直接调用.")};class r{constructor(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}get numberOfListeners(){return this._listeners.length-this._toRemove.length}addEventListener(e,i){if("function"!=typeof e)throw new t("侦听器应该是一个函数");this._listeners.push(e),this._scopes.push(i);const r=this;return function(){r.removeEventListener(e,i)}}removeEventListener(e,i){if("function"!=typeof e)throw new t("侦听器应该是一个函数");const r=this._listeners,n=this._scopes;let o=-1;for(let t=0;t<r.length;t++)if(r[t]===e&&n[t]===i){o=t;break}return-1!==o&&(this._insideRaiseEvent?(this._toRemove.push(o),r[o]=void 0,n[o]=void 0):(r.splice(o,1),n.splice(o,1)),!0)}raise(){let e;this._insideRaiseEvent=!0;const t=this._listeners,r=this._scopes;let{length:n}=t;for(e=0;e<n;e++){const i=t[e];Cesium.defined(i)&&t[e].apply(r[e],arguments)}const o=this._toRemove;if(n=o.length,n>0){for(o.sort(i),e=0;e<n;e++){const i=o[e];t.splice(i,1),r.splice(i,1)}o.length=0}this._insideRaiseEvent=!1}}const{RequestState:n,when:o,AttributeCompression:a,BoundingSphere:s,Cartesian3:l,Credit:c,defaultValue:u,defined:d,DeveloperError:h,GeographicTilingScheme:m,WebMercatorTilingScheme:g,getJsonFromTypedArray:f,HeightmapTerrainData:p,IndexDatatype:_,OrientedBoundingBox:y,QuantizedMeshTerrainData:C,Request:S,RequestType:b,Resource:w,RuntimeError:x,TerrainProvider:E,TileAvailability:T,TileProviderError:P}=Cesium;function L(e){this.resource=e.resource,this.version=e.version,this.isHeightmap=e.isHeightmap,this.tileUrlTemplates=e.tileUrlTemplates,this.availability=e.availability,this.hasVertexNormals=e.hasVertexNormals,this.hasWaterMask=e.hasWaterMask,this.hasMetadata=e.hasMetadata,this.availabilityLevels=e.availabilityLevels,this.availabilityTilesLoaded=e.availabilityTilesLoaded,this.littleEndianExtensionSize=e.littleEndianExtensionSize,this.availabilityPromiseCache={}}function A(e){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=e.ellipsoid,this._requestVertexNormals=u(e.requestVertexNormals,!1),this._requestWaterMask=u(e.requestWaterMask,!1),this._requestMetadata=u(e.requestMetadata,!0),this._errorEvent=new r;var t=e.credit;"string"==typeof t&&(t=new c(t)),this._credit=t,this._availability=void 0;var i=o.defer();this._ready=!1,this._readyPromise=i,this._tileCredits=void 0;var n,a,s,l=this,h=this._layers=[],f="",p=[],_=0;function v(e){var t;if(!e.format)return t="The tile format is not specified in the layer.json file.",void(s=P.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,b));if(!e.tiles||0===e.tiles.length)return t="The layer.json file does not specify any tile URL templates.",void(s=P.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,b));var i=!1,r=!1,c=!1,u=!0,C=!1;if("heightmap-1.0"===e.format)C=!0,d(l._heightmapStructure)||(l._heightmapStructure={heightScale:.2,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),r=!0,l._requestWaterMask=!0;else if(0!==e.format.indexOf("quantized-mesh-1."))return t='The tile format "'+e.format+'" is invalid or not supported.',void(s=P.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,b));var S,w=e.tiles,x=e.maxzoom;if(_=Math.max(_,x),e.projection&&"EPSG:4326"!==e.projection){if("EPSG:3857"!==e.projection)return t='The projection "'+e.projection+'" is invalid or not supported.',void(s=P.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,b));l._tilingScheme=new g({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid})}else l._tilingScheme=new m({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid});if(l._levelZeroMaximumGeometricError=E.getEstimatedLevelZeroGeometricErrorForAHeightmap(l._tilingScheme.ellipsoid,l._heightmapWidth,l._tilingScheme.getNumberOfXTilesAtLevel(0)),e.scheme&&"tms"!==e.scheme&&"slippyMap"!==e.scheme)return t='The scheme "'+e.scheme+'" is invalid or not supported.',void(s=P.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,b));l._scheme=e.scheme,d(e.extensions)&&-1!==e.extensions.indexOf("octvertexnormals")?i=!0:d(e.extensions)&&-1!==e.extensions.indexOf("vertexnormals")&&(i=!0,u=!1),d(e.extensions)&&-1!==e.extensions.indexOf("watermask")&&(r=!0),d(e.extensions)&&-1!==e.extensions.indexOf("metadata")&&(c=!0);var A,M=e.metadataAvailability,R=e.available;if(d(R)&&!d(M)){A=new T(l._tilingScheme,R.length);for(var D=0;D<R.length;++D){var N=R[D],F=l._tilingScheme.getNumberOfYTilesAtLevel(D);d(p[D])||(p[D]=[]);for(var O=0;O<N.length;++O){var I=N[O],k=F-I.endY-1,z=F-I.startY-1;p[D].push([I.startX,k,I.endX,z]),A.addAvailableTileRange(D,I.startX,k,I.endX,z)}}}else d(M)&&(S=new T(l._tilingScheme,x),A=new T(l._tilingScheme,x),p[0]=[[0,0,1,0]],A.addAvailableTileRange(0,0,0,1,0));l._hasWaterMask=l._hasWaterMask||r,l._hasVertexNormals=l._hasVertexNormals||i,l._hasMetadata=l._hasMetadata||c,d(e.attribution)&&(f.length>0&&(f+=" "),f+=e.attribution),h.push(new L({resource:n,version:e.version,isHeightmap:C,tileUrlTemplates:w,availability:A,hasVertexNormals:i,hasWaterMask:r,hasMetadata:c,availabilityLevels:M,availabilityTilesLoaded:S,littleEndianExtensionSize:u}));var U=e.parentUrl;if(d(U)){if(!d(A))return console.log("A layer.json can't have a parentUrl if it does't have an available array."),o.resolve();(n=n.getDerivedResource({url:U})).appendForwardSlash();var G=(a=n.getDerivedResource({url:"layer.json"})).fetchJson();return o(G,v,y)}return o.resolve()}function y(e){var t="An error occurred while accessing "+a.url+".";s=P.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,b)}function C(e){v(e).then((function(){if(!d(s)){var e=p.length;if(e>0)for(var t=l._availability=new T(l._tilingScheme,_),i=0;i<e;++i)for(var r=p[i],n=0;n<r.length;++n){var o=r[n];t.addAvailableTileRange(i,o[0],o[1],o[2],o[3])}if(f.length>0){var a=new c(f);d(l._tileCredits)?l._tileCredits.push(a):l._tileCredits=[a]}l._ready=!0,l._readyPromise.resolve(!0)}}))}function S(e){d(e)&&404===e.statusCode?C({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]}):y()}function b(){o(a.fetchJson()).then(C).otherwise(S)}o(e.url).then((function(e){var t=w.createIfNeeded(e);t.appendForwardSlash(),a=(n=t).getDerivedResource({url:"layer.json"}),l._tileCredits=t.credits,b()})).otherwise((function(e){i.reject(e)}))}var M=1,R=2,D=4;function N(e){return d(e)&&0!==e.length?{Accept:"application/vnd.quantized-mesh;extensions="+e.join("-")+",application/octet-stream;q=0.9,*/*;q=0.01"}:{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"}}function F(e,t,i,r,c,u){if(!d(c))return o.reject(new x("Terrain tile doesn't exist"));var h=c.tileUrlTemplates;if(0!==h.length){var m;if(e._scheme&&"tms"!==e._scheme)m=i;else m=e._tilingScheme.getNumberOfYTilesAtLevel(r)-i-1;var g,v,S=[];e._requestVertexNormals&&c.hasVertexNormals&&S.push(c.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),e._requestWaterMask&&c.hasWaterMask&&S.push("watermask"),e._requestMetadata&&c.hasMetadata&&S.push("metadata");var b=h[(t+m+r)%h.length],w=c.resource;d(w._ionEndpoint)&&!d(w._ionEndpoint.externalType)?(0!==S.length&&(v={extensions:S.join("-")}),g=N(void 0)):g=N(S);var E=w.getDerivedResource({url:b,templateValues:{version:c.version,z:r,x:t,y:m},queryParameters:v,headers:g,request:u});if(E.request.state!==n.ISSUED&&E.request.state!==n.ACTIVE){var T=E.fetchArrayBuffer();if(d(T))return T.then((function(n){return d(e._heightmapStructure)?function(e,t,i,r,n){var o=new Uint16Array(t,0,e._heightmapWidth*e._heightmapWidth);return new p({buffer:o,childTileMask:new Uint8Array(t,o.byteLength,1)[0],waterMask:new Uint8Array(t,o.byteLength+1,t.byteLength-o.byteLength-1),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure,credits:e._tileCredits})}(e,n):function(e,t,i,r,n,o){var c=o.littleEndianExtensionSize,u=0,h=3*Float64Array.BYTES_PER_ELEMENT,m=4*Float64Array.BYTES_PER_ELEMENT,g=3*Uint16Array.BYTES_PER_ELEMENT,p=Uint16Array.BYTES_PER_ELEMENT,v=3*p,S=new DataView(t),b=new l(S.getFloat64(u,!0),S.getFloat64(u+8,!0),S.getFloat64(u+16,!0));u+=h;var w=S.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var x=S.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var E=new s(new l(S.getFloat64(u,!0),S.getFloat64(u+8,!0),S.getFloat64(u+16,!0)),S.getFloat64(u+h,!0));u+=m;var T=new l(S.getFloat64(u,!0),S.getFloat64(u+8,!0),S.getFloat64(u+16,!0));u+=h;var P=S.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var L=new Uint16Array(t,u,3*P);u+=P*g,P>65536&&(v=3*(p=Uint32Array.BYTES_PER_ELEMENT));var A=L.subarray(0,P),N=L.subarray(P,2*P),F=L.subarray(2*P,3*P);a.zigZagDeltaDecode(A,N,F),u%p!=0&&(u+=p-u%p);var O=S.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var I=_.createTypedArrayFromArrayBuffer(P,t,u,3*O);u+=O*v;for(var k=0,z=I.length,U=0;U<z;++U){var G=I[U];I[U]=k-G,0===G&&++k}var B=S.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var H=_.createTypedArrayFromArrayBuffer(P,t,u,B);u+=B*p;var W=S.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var j=_.createTypedArrayFromArrayBuffer(P,t,u,W);u+=W*p;var V=S.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var q=_.createTypedArrayFromArrayBuffer(P,t,u,V);u+=V*p;var Y=S.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var X,J,Z=_.createTypedArrayFromArrayBuffer(P,t,u,Y);for(u+=Y*p;u<S.byteLength;){var $=S.getUint8(u,!0);u+=Uint8Array.BYTES_PER_ELEMENT;var Q=S.getUint32(u,c);if(u+=Uint32Array.BYTES_PER_ELEMENT,$===M&&e._requestVertexNormals)X=new Uint8Array(t,u,2*P);else if($===R&&e._requestWaterMask)J=new Uint8Array(t,u,Q);else if($===D&&e._requestMetadata){var K=S.getUint32(u,!0);if(K>0){var ee=f(new Uint8Array(t),u+Uint32Array.BYTES_PER_ELEMENT,K).available;if(d(ee))for(var te=0;te<ee.length;++te)for(var ie=i+te+1,re=ee[te],ne=e._tilingScheme.getNumberOfYTilesAtLevel(ie),oe=0;oe<re.length;++oe){var ae=re[oe],se=ne-ae.endY-1,le=ne-ae.startY-1;e.availability.addAvailableTileRange(ie,ae.startX,se,ae.endX,le),o.availability.addAvailableTileRange(ie,ae.startX,se,ae.endX,le)}}o.availabilityTilesLoaded.addAvailableTileRange(i,r,n,r,n)}u+=Q}var ce=5*e.getLevelMaximumGeometricError(i),ue=e._tilingScheme.tileXYToRectangle(r,n,i),de=y.fromRectangle(ue,w,x,e._tilingScheme.ellipsoid);return new C({center:b,minimumHeight:w,maximumHeight:x,boundingSphere:E,orientedBoundingBox:de,horizonOcclusionPoint:T,quantizedVertices:L,encodedNormals:X,indices:I,westIndices:H,southIndices:j,eastIndices:q,northIndices:Z,westSkirtHeight:ce,southSkirtHeight:ce,eastSkirtHeight:ce,northSkirtHeight:ce,childTileMask:e.availability.computeChildMaskForTile(i,r,n),waterMask:J,credits:e._tileCredits})}(e,n,r,t,i,c)}))}}}function O(e,t,i,r){if(0!==r){var n=e.availabilityLevels,o=r%n==0?r-n:(r/n|0)*n,a=1<<r-o;return{level:o,x:t/a|0,y:i/a|0}}}function I(e,t,i,r,n,o){if(!d(n.availabilityLevels))return{result:!1};for(var a,s=function(){delete n.availabilityPromiseCache[a]},l=n.availabilityTilesLoaded,c=n.availability,u=O(n,t,i,r);d(u);){if(c.isTileAvailable(u.level,u.x,u.y)&&!l.isTileAvailable(u.level,u.x,u.y)){var h;if(!o&&(a=u.level+"-"+u.x+"-"+u.y,h=n.availabilityPromiseCache[a],!d(h))){var m=new S({throttle:!1,throttleByServer:!1,type:b.TERRAIN});h=F(e,u.x,u.y,u.level,n,m),d(h)&&(n.availabilityPromiseCache[a]=h,h.then(s))}return{result:!0,promise:h}}u=O(n,u.x,u.y,u.level)}return{result:!1}}function k(e,t){return null!=e?e:t}function z(e){return null!=e}A.prototype.requestTileGeometry=function(e,t,i,r){var n,o=this._layers,a=o.length;if(1===a)n=o[0];else for(var s=0;s<a;++s){var l=o[s];if(!d(l.availability)||l.availability.isTileAvailable(i,e,t)){n=l;break}}return F(this,e,t,i,n,r)},Object.defineProperties(A.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){return this._availability}}}),A.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},A.prototype.getTileDataAvailable=function(e,t,i){if(d(this._availability)){if(i>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(i,e,t))return!0;if(!this._hasMetadata)return!1;for(var r=this._layers,n=r.length,o=0;o<n;++o){if(I(this,e,t,i,r[o],0===o).result)return}return!1}},A.prototype.loadTileDataAvailability=function(e,t,i){if(!(!d(this._availability)||i>this._availability._maximumLevel||this._availability.isTileAvailable(i,e,t))&&this._hasMetadata)for(var r=this._layers,n=r.length,o=0;o<n;++o){var a=I(this,e,t,i,r[o],0===o);if(d(a.promise))return a.promise}},A._getAvailabilityTile=O;const U=/((?:.*\/)|^)CesiumPro\.js(?:\?|#|$)/;let G,B,H;function W(e){return"undefined"==typeof document?e:(z(G)||(G=document.createElement("a")),G.href=e,G.href=G.href,G.href)}function j(e){return W(`../${e}`)}function V(){if(z(B))return B;let e;if(e="undefined"!=typeof CESIUMPRO_BASE_URL?CESIUMPRO_BASE_URL:"object"==typeof window.define&&z(window.define.amd)&&!window.define.amd.toUrlUndefined?Cesium.getAbsoluteUri("..","core/Url.js"):function(){const e=document.getElementsByTagName("script");for(let t=0,i=e.length;t<i;++t){const i=e[t].getAttribute("src"),r=U.exec(i);if(null!==r)return r[1]}}(),!z(e))throw new t("Unable to determine CesiumPro base URL automatically, try defining a global variable called CESIUMPRO_BASE_URL.");return z(e)||(e=""),B=new Cesium.Resource({url:W(e)}),B.appendForwardSlash(),B}function q(e){return V().getDerivedResource({url:e}).url}function Y(e){z(H)||(H="object"==typeof window.define&&z(window.define.amd)&&!window.define.amd.toUrlUndefined?j:q);return H(e)}const X={join:function(...e){const t=[];for(let i of e)i.startsWith("/")&&(i=i.substring(1)),i.endsWith("/")&&(i=i.substring(0,i.length-1)),t.push(i);return t.join("/")},buildModuleUrl:function(e){return Y(e)}};X.getCesiumProBaseUrl=V;const{FeatureDetection:J,isCrossOriginUrl:Z}=Cesium;let $;function Q(){return z($)||($=function(e){let t=Cesium.buildModuleUrl(e);if(Z(t)){const e='importScripts("'+t+'");';let i;try{i=new Blob([e],{type:"application/javascript"})}catch(t){let r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);r.append(e),i=r.getBlob("application/javascript")}t=(window.URL||window.webkitURL).createObjectURL(i)}return t}("Workers/cesiumWorkerBootstrapper.js")),$}function K(e){const t=new Worker(Q());t.postMessage=k(t.webkitPostMessage,t.postMessage);const i={loaderConfig:{paths:{Workers:Y("workers")},baseUrl:V().url},workerModule:e._workerPath};return t.postMessage(i),t.onmessage=function(t){!function(e,t){console.log(e,t,"------complete-----")}(e,t.data)},t.postMessage(e._options),t}const{kdbush:ee,Cartesian3:te,Cartographic:ie,PointPrimitive:re,BoundingRectangle:ne,SceneMode:oe,EllipsoidalOccluder:ae}=Cesium;function se(e){return e.__pixel.x}function le(e){return e.__pixel.y}function ce(e,t){const i=new ne;return re.getScreenSpaceBoundingBox(e,t,i),function(e,t){e.x-=t,e.y-=t,e.width+=2*t,e.height+=2*t}(i,this.pixelRange),i}let ue;function de(e){if(!e.scene.globe)return;const t=Cesium.getTimestamp(),i=e.scene;if(z(ue)&&t-ue<250)return;ue=t;const r=i.canvas.clientWidth,n=i.canvas.clientHeight,o=i.camera.getPickRay(new Cesium.Cartesian2(r/2,n/2)),a=i.camera.getPickRay(new Cesium.Cartesian2(r/2+1,n/2)),s=i.globe.pick(o,i),l=i.globe.pick(a,i);if(!z(s)||!z(l))return;return new Cesium.EllipsoidGeodesic(i.globe.ellipsoid.cartesianToCartographic(s),i.globe.ellipsoid.cartesianToCartographic(l)).surfaceDistance}class he{constructor(e,i,r){if(!z(e))throw new t("longitude is required.");if(!z(i))throw new t("latitude is required.");this.lon=e,this.lat=i,this.alt=k(r,0)}toPixel(e){return he.toPixel(this,e)}toCartesian(){return he.toCartesian(this)}toCartographic(){return he.toCartographic(this)}getRadias(){return{lon:Cesium.Math.toRadians(this.lon),lat:Cesium.Math.toRadians(this.lat),alt:alt}}isVisible(e){return he.isVisible(this,e)}toString(){return`{lon: ${this.lon}, lat: ${this.lat}, alt: ${this.alt}}`}toJson(){return{lon:this.lon,lat:this.lat,alt:this.alt}}toArray(){return[this.lon,this.lat,this.alt]}static isVisible(e,i){if(i instanceof Cesium.Viewer)throw new t("viewer不是一个有效的Cesium.Viewer对象");if(!z(e))throw new t("point is not defined.");const r=he.toCartesian(e);if(i.scene.mode===Cesium.SceneMode.SCENE3D){if(!new Cesium.EllipsoidalOccluder(Cesium.Ellipsoid.WGS84,i.camera.position).isPointVisible(r))return!1;const t=he.toPixel(e,i.scene);if(!z(t))return!1;const n=i.canvas.width||i.canvas.clientWidth,o=i.canvas.height||i.canvas.clientHeight;return t.x>0&&t.x<n&&t.y>0&&t.y<o}if(i.scene.mode===Cesium.SceneMode.SCENE2D){const e=i.scene.camera.frustum,{positionWC:t,directionWC:n,upWC:o}=i.scene.camera,a=e.computeCullingVolume(t,n,o),s=Cesium.BoundingSphere.projectTo2D(new BoundingSphere(r,1)),l=a.computeVisibility(s);return l===Cesium.Intersect.INSIDE||l===Cesium.Intersect.INERSECTING}}static toPixel(e,i){if(!z(i))throw new t("scene未定义。");if(!z(e))throw new t("point is not defined.");const r=he.toCartesian(e);if(z(r))return Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,r)}static toCartographic(e){if(!z(e))throw new t("point is not defined.");return Cesium.Cartographic.fromDegrees(e.lon,e.lat,e.alt)}static toCartesian(e,i){if(!z(e))throw new t("point is not defined.");if(e instanceof Cesium.Cartesian3)return e;if(e instanceof Cesium.Cartographic)return Cesium.Cartographic.toCartesian(e);if(e instanceof he)return Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt);if(e instanceof Cesium.Cartesian2){if(!i)return;const t=i.scene.camera.getPickRay(e);return i.scene.globe.pick(t,i.scene)}}static fromCartesian(e){if(!z(e))throw new t("cartesian is not defined.");const i=Cesium.Cartographic.fromCartesian(e);if(z(i))return he.fromCartographic(i)}static fromCartographic(e){if(!z(e))throw new t("cartographic is not defined.");return new he(Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height)}static fromPixel(e,i){if(!i.scene.globe)return;if(!z(e))throw new t("pixel is not defined.");if(i instanceof Cesium.Viewer==!1)throw new t("viewer不是一个有效的Cesium.Viewer对象");const r=i.scene.camera.getPickRay(e),n=i.scene.globe.pick(r,i.scene);return z(n)?he.fromCartesian(n):void 0}static fromDegrees(e,t,i){return new he(e,t,i)}static fromRadians(e,t,i){return new he(Cesium.Math.toDegrees(e),Cesium.Math.toDegrees(t),i)}static inChina(...e){if(1!==e.length){const t=+e[0],i=+e[1];return t>73.66&&t<135.05&&i>3.86&&i<53.55}{const t=e[0];if(e[0]instanceof he)return he.inChina(t.lon,t.lat)}}static fromArray(e){return new he(...e)}static fromJson(e){return new he(e.lon,e.lat,e.alt)}static isValid(e){return e instanceof he!=!1&&(!!z(e.lon)&&(!!z(e.lat)&&!!z(e.alt)))}}function me(e){const t=e.canvas.getBoundingClientRect(),i=new Cesium.Cartesian2(t.width/2,t.height/2);return he.fromPixel(i,e)}function ge(e){if(!e.scene.globe)return{};if(e.scene.mode===Cesium.SceneMode.SCENE3D){const t=e.camera.computeViewRectangle();if(!z(t))return;return{west:Cesium.Math.toDegrees(t.west),south:Cesium.Math.toDegrees(t.south),east:Cesium.Math.toDegrees(t.east),north:Cesium.Math.toDegrees(t.north)}}const t=e.canvas.getBoundingClientRect(),i=he.fromPixel(new Cesium.Cartesian2(0,t.height/2),e)||{lon:-180},r=he.fromPixel(new Cesium.Cartesian2(t.width,t.height/2),e)||{lon:180},n=he.fromPixel(new Cesium.Cartesian2(t.width/2,0),e)||{lat:90},o=he.fromPixel(new Cesium.Cartesian2(t.width/2,t.height),e)||{lat:-90};return{west:i.lon,south:o.lat,east:r.lon,north:n.lat}}function fe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function pe(e,t){let i;const r={"y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()},n=Object.keys(r);for(const t of n)i=new RegExp(`(${t})`).exec(e),i&&(e=e.replace(i[1],1===i[1].length?r[t]:r[t].padStart(i[1].length,"0")));return e}window.Date.prototype.format=function(e){pe(e,this)};class _e{constructor(e){this._options=e,this._id=k(e.id,fe()),this._primitive=null,this._oldPrimitive=null,this._definedChanged=new r,this._clampToGround=k(!!e.clampToGround,!1),this._show=k(!!e.show,!0),this._removed=!1}get id(){return this._id}get clampToGround(){return this._clampToGround}set clampToGround(e){if(e!==this._clampToGround){this.oldPrimitive=this.primitive;const t=Object.assign({},this._options,{clampToGround:e,asynchronous:!1});this._primitive=new this.constructor(t).primitive}this._clampToGround=e}get show(){return this._show}set show(e){e!==this._show&&(this.definedChanged.raise("show",v,this._show),this._show=e,this.primitive&&(this.primitive.show=e))}get primitive(){return this._primitive}get definedChanged(){return this._definedChanged}toJson(){z(this.primitive)}updateAttribute(e,t){if(!this.primitive)return;const i=this.primitive.appearance.material;if(!i)return;const r=i.uniforms;r&&(r[e]=t)}addTo(e){z(this.primitive)&&(this._viewer=e,e.graphicGroup.add(this))}remove(){if(z(this.primitive))return this._viewer?(this.group.remove(this),this):void 0}}const{AssociativeArray:ve}=Cesium;class ye{constructor(e){this.values=new ve,this.id=fe(),this.viewer=e}add(e){e instanceof ye&&this.values.set(e.id,e),e instanceof _e&&(this.values.set(e.id,e),e.primitive&&this.viewer.primitives.add(e.primitive),e._viewer=this.viewer,e.group=this)}remove(e){this.values.remove(e.id),e instanceof ye&&e.clear(),e.primitive&&this.viewer.primitives.remove(e.primitive)}removeById(e){const t=this.values.get(e);this.remove(t)}has(e){return this.values.contains(e)}update(){const e=this.values._array;for(let t of e)t instanceof ye&&t.update(),z(t.oldPrimitive)&&(this.viewer.primitives.remove(t.oldPrimitive),this.viewer.primitives.add(t.primitive),t.oldPrimitive=null)}clear(){const e=this.values._array;this.values.removeAll();for(let t of e)t.primitive&&this.viewer.primitives.remove(t.primitive)}}const Ce="uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  ",Se="attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",{defaultValue:be,destroyObject:we,Matrix4:xe,DrawCommand:Ee,BoxGeometry:Te,Cartesian3:Pe,defined:Le,GeometryPipeline:Ae,Transforms:Me,VertexFormat:Re,BufferUsage:De,CubeMap:Ne,loadCubeMap:Fe,RenderState:Oe,VertexArray:Ie,BlendingState:ke,SceneMode:ze,ShaderProgram:Ue,ShaderSource:Ge,Matrix3:Be}=Cesium;const He=Object.freeze({LEFT:-1,RIGHT:1,NONE:0,TOP:-10,BOTTOM:10}),{Cartesian2:We,Rectangle:je,GeographicProjection:Ve,Ellipsoid:qe}=Cesium,Ye=Cesium.Math;function Xe(e){e=k(e,k.EMPTY_OBJECT),this._ellipsoid=k(e.ellipsoid,qe.WGS84),this._rectangle=k(e.rectangle,je.MAX_VALUE),this._projection=new Ve(this._ellipsoid),this._numberOfLevelZeroTilesX=36,this._numberOfLevelZeroTilesY=18,this._intervalOfZeorLevel=k(e.intervalOfZeorLevel,16)}Object.defineProperties(Xe.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),Xe.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},Xe.prototype.modifyLevel=function(e){return e<3?0:e<6?1:void 0},Xe.prototype.getDelatXY=function(e){const t=this._intervalOfZeorLevel;return{dx:t/2**e,dy:t/2**e}},Xe.prototype.getLonLatValuee=function(e,t,i){const r=this.getDelatXY(e);return{lon:r.dx*t-180,lat:90-r.dy*i}},Xe.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},Xe.prototype.rectangleToNativeRectangle=function(e,t){const i=Ye.toDegrees(e.west),r=Ye.toDegrees(e.south),n=Ye.toDegrees(e.east),o=Ye.toDegrees(e.north);return z(t)?(t.west=i,t.south=r,t.east=n,t.north=o,t):new je(i,r,n,o)},Xe.prototype.tileXYToNativeRectangle=function(e,t,i,r){const n=this.tileXYToRectangle(e,t,i,r);return n.west=Ye.toDegrees(n.west),n.south=Ye.toDegrees(n.south),n.east=Ye.toDegrees(n.east),n.north=Ye.toDegrees(n.north),n},Xe.prototype.tileXYToRectangle=function(e,t,i,r){var n=this._rectangle,o=this.getNumberOfXTilesAtLevel(i),a=this.getNumberOfYTilesAtLevel(i),s=n.width/o,l=e*s+n.west,c=(e+1)*s+n.west,u=n.height/a,d=n.north-t*u,h=n.north-(t+1)*u;return z(r)||(r=new je(l,h,c,d)),r.west=l,r.south=h,r.east=c,r.north=d,r},Xe.prototype.positionToTileXY=function(e,t,i){var r=this._rectangle;if(je.contains(r,e)){var n=this.getNumberOfXTilesAtLevel(t),o=this.getNumberOfYTilesAtLevel(t),a=r.width/n,s=r.height/o,l=e.longitude;r.east<r.west&&(l+=Ye.TWO_PI);var c=(l-r.west)/a|0;c>=n&&(c=n-1);var u=(r.north-e.latitude)/s|0;return u>=o&&(u=o-1),z(i)?(i.x=c,i.y=u,i):new We(c,u)}};const{CesiumTerrainProvider:Je,when:Ze,TerrainProvider:$e,Resource:Qe,CustomDataSource:Ke,Cartesian3:et,Entity:tt,Color:it,Rectangle:rt}=Cesium;function nt(e){let t=[];const i=[e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north];return"EPSG:4326"===e.projection.toUpperCase()&&(t=[i[0],i[1],i[0],i[3],i[2],i[3],i[2],i[1],i[0],i[1]]),new tt({polyline:{positions:et.fromRadiansArray(t),material:it.fromRandom({alpha:1}),width:3,clampToGround:!0}})}function ot(e,t){const i=Qe.createIfNeeded(t);i.appendForwardSlash();const r=i.getDerivedResource({url:"layer.json"});return new Promise(((t,i)=>{Ze(r.fetchJson()).then((i=>{e.projection=i.projection,e.bounds=rt.fromDegrees(...i.valid_bounds),t(!0)}))}))}const at=52.35987755982988,st=3.141592653589793,lt=6378245,ct=.006693421622965943;function ut(e,t){let i=this.transformLng(e-105,t-35),r=this.transformLat(e-105,t-35);const n=t/180*st;let o=Math.sin(n);o=1-ct*o*o;const a=Math.sqrt(o);return i=180*i/(lt/a*Math.cos(n)*st),r=180*r/(lt*(1-ct)/(o*a)*st),[i,r]}const dt={get:function(e="EPSG:3857",i){const r=e.toUpperCase();if("EPSG:3857"===r)return new Cesium.WebMercatorTilingScheme(i);if("EPSG:4326"===r)return new Cesium.GeographicTilingScheme(i);throw new t("未知的坐标系.")},BD09ToGCJ02:function(e,t){const i=+e-.0065,r=+t-.006,n=Math.sqrt(i*i+r*r)-2e-5*Math.sin(r*at),o=Math.atan2(r,i)-3e-6*Math.cos(i*at);return[n*Math.cos(o),n*Math.sin(o)]},GCJ02ToBD09:function(e,t){t=+t,e=+e;const i=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*at),r=Math.atan2(t,e)+3e-6*Math.cos(e*at);return[i*Math.cos(r)+.0065,i*Math.sin(r)+.006]},WGS84ToGCJ02:function(e,t){if(t=+t,e=+e,he.inChina(e,t)){const i=ut(e,t);return[e+i[0],t+i[1]]}return[e,t]},GCJ02ToWGS84:function(e,t){if(t=+t,e=+e,he.inChina(e,t)){const i=ut(e,t);return[2*e-(e+i[0]),2*t-(t+i[1])]}return[e,t]}},{Color:ht}=Cesium;class mt{constructor(){}static pointColor=ht.AQUA;static fillColor=ht.AQUA;static strokeColor=ht.AQUA}class gt extends Cesium.UrlTemplateImageryProvider{constructor(e){"string"==typeof e&&(e={url:e}),e.getFeatureInfoFormats=k(e.getFeatureInfoFormats,gt.defaultFeatureInfoFormats),super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get rectangle(){return super.rectangle}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}function ft(){return new gt({url:X.buildModuleUrl("assets/tiles/{z}/{x}/{y}.png"),maximumLevel:4})}gt.defaultFeatureInfoFormats=Object.freeze([Object.freeze(new Cesium.GetFeatureInfoFormat("json","application/json")),Object.freeze(new Cesium.GetFeatureInfoFormat("xml","text/xml")),Object.freeze(new Cesium.GetFeatureInfoFormat("text","text/html"))]);const{defined:pt,defaultValue:_t,ColorMaterialProperty:vt,ConstantPositionProperty:yt,ConstantProperty:Ct,DataSource:St,PolygonGraphics:bt,PolylineGraphics:wt,EntityCluster:xt,PinBuilder:Et,createGuid:Tt,Cartesian3:Pt,PointGraphics:Lt,ArcType:At,PolygonHierarchy:Mt,Color:Rt,EntityCollection:Dt,HeightReference:Nt,when:Ft,Resource:Ot,describe:It,Event:kt}=Cesium,zt={small:24,medium:48,large:64},Ut={},Gt={},Bt={"urn:ogc:def:crs:OGC:1.3:CRS84":si,"EPSG:4326":si,"urn:ogc:def:crs:EPSG::4326":si},Ht=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"],Wt={Feature:Yt,FeatureCollection:function(e,t,i,r,n){for(var o=t.features,a=0,s=o.length;a<s;a++)Yt(e,o[a],void 0,r,n)},GeometryCollection:Xt,LineString:ei,MultiLineString:ti,MultiPoint:$t,MultiPolygon:ni,Point:Zt,Polygon:ri,Topology:oi},jt={GeometryCollection:Xt,LineString:ei,MultiLineString:ti,MultiPoint:$t,MultiPolygon:ni,Point:Zt,Polygon:ri,Topology:oi};function Vt(e,t){for(var i=new Array(e.length),r=0;r<e.length;r++)i[r]=t(e[r]);return i}function qt(e,t,i){var r=e.id;if(pt(r)&&"Feature"===e.type){for(var n=2,o=r;pt(t.getById(o));)o=r+"_"+n,n++;r=o}else r=Tt();var a=t.getOrCreateEntity(r),s=e.properties;if(pt(s)){var l;a.properties=s;var c=s.title;if(pt(c))a.name=c,l="title";else{var u=Number.MAX_VALUE;for(var d in s)if(s.hasOwnProperty(d)&&s[d]){var h=d.toLowerCase();if(u>1&&"title"===h){u=1,l=d;break}u>2&&"name"===h?(u=2,l=d):u>3&&/title/i.test(d)?(u=3,l=d):u>4&&/name/i.test(d)&&(u=4,l=d)}pt(l)&&(a.name=s[l])}var m=s.description;null!==m&&(a.description=pt(m)?new Ct(m):i(s,l))}return a}function Yt(e,i,r,n,o){if(null!==i.geometry){if(!pt(i.geometry))throw new t("feature.geometry is required.");var a=i.geometry.type,s=jt[a];if(!pt(s))throw new t("Unknown geometry type: "+a);s(e,i,i.geometry,n,o)}else qt(i,e._entityCollection,o.describe)}function Xt(e,i,r,n,o){for(var a=r.geometries,s=0,l=a.length;s<l;s++){var c=a[s],u=c.type,d=jt[u];if(!pt(d))throw new t("Unknown geometry type: "+u);d(e,i,c,n,o)}}function Jt(e,t,i,r,n){let o=n.pointSize,a=n.pointColor;const s=t.properties;if(pt(s)){const e=s["point-color"];pt(e)&&(a=Rt.fromCssColorString(e)),o=_t(zt[s["point-size"]],o)}const l=new Lt;2===r.length&&n.clampToGround&&(l.heightReference=Nt.CLAMP_TO_GROUND);const c=qt(t,e._entityCollection,n.describe);c.point=l,c.point.color=a,c.point.pixelSize=o,c.position=new yt(i(r))}function Zt(e,t,i,r,n){Jt(e,t,r,i.coordinates,n)}function $t(e,t,i,r,n){for(var o=i.coordinates,a=0;a<o.length;a++)Jt(e,t,r,o[a],n)}function Qt(e,t,i,r,n){const o=n.lineColor,a=n.lineWidth,s=t.properties;if(pt(s)){const e=s["stroke-width"];let t;pt(e)&&(a=new Ct(e));let i=s.stroke;pt(i)&&(t=Rt.fromCssColorString(i));let r=s["stroke-opacity"];pt(r)&&1!==r&&(pt(t)||(t=o.color.clone()),t.alpha=r),pt(t)&&(o=new vt(t))}const l=qt(t,e._entityCollection,n.describe),c=new wt;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=a,c.positions=new Ct(Vt(r,i)),c.arcType=At.RHUMB}function Kt(e,t){var i="";for(var r in e)if(e.hasOwnProperty(r)){if(r===t||-1!==Ht.indexOf(r))continue;var n=e[r];pt(n)&&(i+="object"==typeof n?"<tr><th>"+r+"</th><td>"+Kt(n)+"</td></tr>":"<tr><th>"+r+"</th><td>"+n+"</td></tr>")}return i.length>0&&(i='<table class="cesium-infoBox-defaultTable"><tbody>'+i+"</tbody></table>"),i}function ei(e,t,i,r,n){Qt(e,t,r,i.coordinates,n)}function ti(e,t,i,r,n){for(var o=i.coordinates,a=0;a<o.length;a++)Qt(e,t,r,o[a],n)}function ii(e,t,i,r,n){if(0===r.length||0===r[0].length)return;let o=n.outlineColor.color,a=n.fill,s=n.outlineWidth;const l=t.properties;if(pt(l)){const e=l["stroke-width"];let t;pt(e)&&(s=new Ct(e));const i=l.stroke;pt(i)&&(t=Rt.fromCssColorString(i));let r,c=l["stroke-opacity"];pt(c)&&1!==c&&(pt(t)||(t=n.outlineColor.color.clone()),t.alpha=c),pt(t)&&(o=new Ct(t));const u=l.fill;pt(u)&&(r=Rt.fromCssColorString(u),r.alpha=a.color.alpha),c=l["fill-opacity"],pt(c)&&c!==a.color.alpha&&(pt(r)||(r=a.color.clone()),r.alpha=c),pt(r)&&(a=new vt(r))}const c=new bt;c.outline=new Ct(n.outline),c.outlineColor=o,c.outlineWidth=s,c.material=a,c.arcType=At.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let i of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(i);pt(e)&&pt(e[1])&&(t=t.replace(i,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const d=[];for(var h=1,m=r.length;h<m;h++)d.push(new Mt(Vt(r[h],i)));const g=r[0];c.hierarchy=new Ct(new Mt(Vt(g,i),d)),g[0].length>2?c.perPositionHeight=new Ct(!0):n.clampToGround||(c.height=0);qt(t,e._entityCollection,n.describe).polygon=c}function ri(e,t,i,r,n){ii(e,t,r,i.coordinates,n)}function ni(e,t,i,r,n){for(var o=i.coordinates,a=0;a<o.length;a++)ii(e,t,r,o[a],n)}function oi(e,t,i,r,n){for(var o in i.objects)if(i.objects.hasOwnProperty(o)){var a=topojson.feature(i,i.objects[o]);(0,Wt[a.type])(e,a,a,r,n)}}function ai(e,t){return new Cesium.CallbackProperty(function(e,t,i){var r;return function(n,o){return pt(r)||(r=e(t,i)),r}}(Kt,e,t),!0)}function si(e){return Pt.fromDegrees(e[0],e[1],e[2])}class li{constructor(e){this._name=e,this._changed=new kt,this._error=new kt,this._isLoading=!1,this._loading=new kt,this._entityCollection=new Dt(this),this._promises=[],this._pinBuilder=new Et,this._entityCluster=new xt,this._credit=void 0,this._resourceCredits=[]}static pointSize=5;static pointColor=Rt.ROYALBLUE;static lineColor=Rt.YELLOW;static fill=Rt.fromBytes(255,255,0,100);static outline=!0;static outlineColor=Rt.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return Bt}static crsLinkHrefs(){return Ut}static crsLinkTypes(){return Gt}get entities(){return this._entityCollection}get name(){return this._name}set name(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}get clock(){}get isLoading(){return this._isLoading}get changedEvent(){return this._changed}get errorEvent(){return this._error}get loadingEvent(){return this._loading}get show(){return this._entityCollection.show}set show(e){this._entityCollection.show=e}get clustering(){return this._entityCluster}set clustering(e){this._entityCluster=e}get credit(){return this._credit}load(e,i){St.setLoading(this,!0);let r=(i=_t(i,{})).credit;"string"==typeof r&&(r=new Credit(r)),this._credit=r;let n=e,o=i.sourceUri;if("string"==typeof e||e instanceof Ot){n=(e=Ot.createIfNeeded(e)).fetchJson(),o=_t(o,e.getUrlComponent());const t=this._resourceCredits,i=e.credits;if(pt(i)){const e=i.length;for(const r=0;r<e;r++)t.push(i[r])}}i={describe:_t(i.describe,ai),pointSize:_t(i.pointSize,li.pointSize),pointColor:_t(i.pointColor,li.pointColor),lineWidth:new Ct(_t(i.lineWidth,li.lineWidth)),outlineColor:new vt(_t(i.outlineColor,li.outlineColor)),lineColor:new vt(_t(i.lineColor,li.lineColor)),outlineWidth:_t(i.outlineWidth,li.outlineWidth),fill:new vt(_t(i.fill,li.fill)),outline:_t(i.outline,li.outline),clampToGround:_t(i.clampToGround,li.clampToGround),extrudedHeight:i.extrudedHeight};const a=this;return Ft(n,(function(e){return function(e,i,r,n){let o;pt(n)&&(o=Cesium.getFilenameFromUri(n)),pt(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const a=Wt[i.type];if(!pt(a))throw new t("Unsupported GeoJSON object type: "+i.type);const s=i.crs;let l=null!==s?si:null;if(pt(s)){if(!pt(s.properties))throw new t("crs.properties is undefined.");const e=s.properties;if("name"===s.type){if(l=Bt[e.name],!pt(l))throw new t("Unknown crs name: "+e.name)}else if("link"===s.type){var c=Ut[e.href];if(pt(c)||(c=Gt[e.type]),!pt(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==s.type)throw new t("Unknown crs type: "+s.type);if(l=Bt["EPSG:"+e.code],!pt(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&a(e,i,i,t,r),Cesium.when.all(e._promises,(function(){return e._promises.length=0,St.setLoading(e,!1),e}))}))}(a,e,i,o)})).otherwise((function(e){return St.setLoading(a,!1),a._error.raiseEvent(a,e),console.log(e),Ft.reject(e)}))}update(){return!0}}li.load=function(e,t){return(new li).load(e,t)};const ci={};function ui(e){return new di(e instanceof Uint8Array?e:new Uint8Array(e))}function di(e){this._array=e}di.prototype.read=function(){var e=this._array;return this._array=null,Promise.resolve(e?{done:!1,value:e}:{done:!0,value:void 0})},di.prototype.cancel=function(){return this._array=null,Promise.resolve()};var hi=function(e){return fetch(e).then((function(e){return e.body&&e.body.getReader?e.body.getReader():e.arrayBuffer().then(ui)}))},mi=function(e){return new Promise((function(t,i){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onload=function(){t(ui(r.response))},r.onerror=i,r.ontimeout=i,r.open("GET",e,!0),r.send()}))};function gi(e){return("function"==typeof fetch?hi:mi)(e)}function fi(e){return"function"==typeof e.read?e:e.getReader()}var pi=new Uint8Array(0);function _i(e,t){if(!e.length)return t;if(!t.length)return e;var i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function vi(e){return"function"==typeof e.slice?e:new yi("function"==typeof e.read?e:e.getReader())}function yi(e){this._source=e,this._array=pi,this._index=0}yi.prototype.read=function(){var e=this,t=e._array.subarray(e._index);return e._source.read().then((function(i){return e._array=pi,e._index=0,i.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:_i(t,i.value)}}))},yi.prototype.slice=function(e){if((e|=0)<0)throw new Error("invalid length");var t=this,i=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var r=new Uint8Array(e);return r.set(this._array.subarray(this._index)),function n(){return t._source.read().then((function(o){return o.done?(t._array=pi,t._index=0,i>0?r.subarray(0,i):null):i+o.value.length>=e?(t._array=o.value,t._index=e-i,r.set(o.value.subarray(0,e-i),i),r):(r.set(o.value,i),i+=o.value.length,n())}))}()},yi.prototype.cancel=function(){return this._source.cancel()};var Ci=function(e){return!(e=e.trim())||isNaN(e=+e)?null:e},Si={B:Ci,C:function(e){return e.trim()||null},D:function(e){return new Date(+e.substring(0,4),e.substring(4,6)-1,+e.substring(6,8))},F:Ci,L:function(e){return!/^[nf]$/i.test(e)&&(!!/^[yt]$/i.test(e)||null)},M:Ci,N:Ci},bi=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},wi=function(e,t){return(e=vi(e)).slice(32).then((function(i){var r=bi(i);return e.slice(r.getUint16(8,!0)-32).then((function(i){return new xi(e,t,r,bi(i))}))}))};function xi(e,t,i,r){this._source=e,this._decode=t.decode.bind(t),this._recordLength=i.getUint16(10,!0),this._fields=[];for(var n=0;13!==r.getUint8(n);n+=32){for(var o=0;o<11&&0!==r.getUint8(n+o);++o);this._fields.push({name:this._decode(new Uint8Array(r.buffer,r.byteOffset+n,o)),type:String.fromCharCode(r.getUint8(n+11)),length:r.getUint8(n+16)})}}var Ei=xi.prototype;Ei.read=function(){var e=this,t=1;return e._source.slice(e._recordLength).then((function(i){return i&&26!==i[0]?{done:!1,value:e._fields.reduce((function(r,n){return r[n.name]=Si[n.type](e._decode(i.subarray(t,t+=n.length))),r}),{})}:{done:!0,value:void 0}}))},Ei.cancel=function(){return this._source.cancel()};var Ti=function(e){var t,i=40,r=e.getInt32(36,!0),n=new Array(r);for(t=0;t<r;++t,i+=16)n[t]=[e.getFloat64(i,!0),e.getFloat64(i+8,!0)];return{type:"MultiPoint",coordinates:n}},Pi=function(e){return{type:"Point",coordinates:[e.getFloat64(4,!0),e.getFloat64(12,!0)]}},Li=function(e){var t,i=44,r=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(r),a=new Array(n),s=[],l=[];for(t=0;t<r;++t,i+=4)o[t]=e.getInt32(i,!0);for(t=0;t<n;++t,i+=16)a[t]=[e.getFloat64(i,!0),e.getFloat64(i+8,!0)];return o.forEach((function(e,t){var i=a.slice(e,o[t+1]);!function(e){if((t=e.length)<4)return!1;var t,i=0,r=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];for(;++i<t;)r+=e[i-1][1]*e[i][0]-e[i-1][0]*e[i][1];return r>=0}(i)?l.push(i):s.push([i])})),l.forEach((function(e){s.some((function(t){if(function(e,t){var i,r=-1,n=t.length;for(;++r<n;)if(i=Ai(e,t[r]))return i>0;return!1}(t[0],e))return t.push(e),!0}))||s.push([e])})),1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}};function Ai(e,t){for(var i=t[0],r=t[1],n=-1,o=0,a=e.length,s=a-1;o<a;s=o++){var l=e[o],c=l[0],u=l[1],d=e[s],h=d[0],m=d[1];if(Mi(l,d,t))return 0;u>r!=m>r&&i<(h-c)*(r-u)/(m-u)+c&&(n=-n)}return n}function Mi(e,t,i){var r=i[0]-e[0],n=i[1]-e[1];if(0===r&&0===n)return!0;var o=t[0]-e[0],a=t[1]-e[1];if(0===o&&0===a)return!1;var s=(r*o+n*a)/(o*o+a*a);return!(s<0||s>1)&&(0===s||1===s||s*o===r&&s*a===n)}var Ri=function(e){var t,i=44,r=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(r),a=new Array(n);for(t=0;t<r;++t,i+=4)o[t]=e.getInt32(i,!0);for(t=0;t<n;++t,i+=16)a[t]=[e.getFloat64(i,!0),e.getFloat64(i+8,!0)];return 1===r?{type:"LineString",coordinates:a}:{type:"MultiLineString",coordinates:o.map((function(e,t){return a.slice(e,o[t+1])}))}},Di=function(e,t){var i=new Uint8Array(e.length+t.length);return i.set(e,0),i.set(t,e.length),i},Ni={0:function(){return null},1:Pi,3:Ri,5:Li,8:Ti,11:Pi,13:Ri,15:Li,18:Ti,21:Pi,23:Ri,25:Li,28:Ti},Fi=function(e){return(e=vi(e)).slice(100).then((function(t){return new Oi(e,bi(t))}))};function Oi(e,t){var i=t.getInt32(32,!0);if(!(i in Ni))throw new Error("unsupported shape type: "+i);this._source=e,this._type=i,this._index=0,this._parse=Ni[i],this.bbox=[t.getFloat64(36,!0),t.getFloat64(44,!0),t.getFloat64(52,!0),t.getFloat64(60,!0)]}var Ii=Oi.prototype;function ki(){}Ii.read=function(){var e=this;return++e._index,e._source.slice(12).then((function(t){if(null==t)return{done:!0,value:void 0};var i=bi(t);function r(){return e._source.slice(4).then((function(o){return null==o?{done:!0,value:void 0}:(i=bi(t=Di(t.slice(4),o))).getInt32(0,!1)!==e._index?r():n()}))}function n(){var n=2*i.getInt32(4,!1)-4,o=i.getInt32(8,!0);return n<0||o&&o!==e._type?r():e._source.slice(n).then((function(i){return{done:!1,value:o?e._parse(bi(Di(t.slice(8),i))):null}}))}return n()}))},Ii.cancel=function(){return this._source.cancel()};function zi(e,t){this._shp=e,this._dbf=t,this.bbox=e.bbox}var Ui=zi.prototype;function Gi(e,t,i){return"string"==typeof t?(/\.dbf$/.test(t)||(t+=".dbf"),t=gi(t)):t instanceof ArrayBuffer||t instanceof Uint8Array?t=ui(t):null!=t&&(t=fi(t)),"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),void 0===t&&(t=gi(e.substring(0,e.length-4)+".dbf").catch((function(){}))),e=gi(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?ui(e):fi(e),Promise.all([e,t]).then((function(e){var t,r,n,o=e[0],a=e[1],s="windows-1252";return i&&null!=i.encoding&&(s=i.encoding),t=o,r=a,n=a&&new TextDecoder(s),Promise.all([Fi(t),r&&wi(r,n)]).then((function(e){return new zi(e[0],e[1])}))}))}Ui.read=function(){var e=this;return Promise.all([e._dbf?e._dbf.read():{value:{}},e._shp.read()]).then((function(e){var t=e[0],i=e[1];return i.done?i:{done:!1,value:{type:"Feature",properties:t.value,geometry:i.value}}}))},Ui.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(ki)},ci.open=Gi,ci.openShp=function(e,t){return"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),e=gi(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?ui(e):fi(e),Promise.resolve(e).then(Fi)},ci.openDbf=function(e,t){var i="windows-1252";return t&&null!=t.encoding&&(i=t.encoding),i=new TextDecoder(i),"string"==typeof e?(/\.dbf$/.test(e)||(e+=".dbf"),e=gi(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?ui(e):fi(e),Promise.resolve(e).then((function(e){return wi(e,i)}))},ci.read=function(e,t,i){return Gi(e,t,i).then((function(e){var t=[],i={type:"FeatureCollection",features:t,bbox:e.bbox};return e.read().then((function r(n){return n.done?i:(t.push(n.value),e.read().then(r))}))}))},Object.defineProperty(ci,"__esModule",{value:!0});const{defined:Bi,defaultValue:Hi,ColorMaterialProperty:Wi,ConstantPositionProperty:ji,ConstantProperty:Vi,DataSource:qi,PolygonGraphics:Yi,PolylineGraphics:Xi,createGuid:Ji,Cartesian3:Zi,PointGraphics:$i,ArcType:Qi,PolygonHierarchy:Ki,Color:er,HeightReference:tr,Resource:ir}=Cesium,rr={small:24,medium:48,large:64},nr={},or={},ar={"urn:ogc:def:crs:OGC:1.3:CRS84":Tr,"EPSG:4326":Tr,"urn:ogc:def:crs:EPSG::4326":Tr},sr={Feature:dr,FeatureCollection:function(e,t,i,r,n){for(var o=t.features,a=0,s=o.length;a<s;a++)dr(e,o[a],void 0,r,n)},GeometryCollection:hr,LineString:_r,MultiLineString:vr,MultiPoint:fr,MultiPolygon:Sr,Point:gr,Polygon:Cr,Topology:br},lr={GeometryCollection:hr,LineString:_r,MultiLineString:vr,MultiPoint:fr,MultiPolygon:Sr,Point:gr,Polygon:Cr,Topology:br};function cr(e,t){for(var i=new Array(e.length),r=0;r<e.length;r++)i[r]=t(e[r]);return i}function ur(e,t,i){var r=e.id;if(Bi(r)&&"Feature"===e.type){for(var n=2,o=r;Bi(t.getById(o));)o=r+"_"+n,n++;r=o}else r=Ji();var a=t.getOrCreateEntity(r),s=e.properties;if(Bi(s)){var l;a.properties=s;var c=s.title;if(Bi(c))a.name=c,l="title";else{var u=Number.MAX_VALUE;for(var d in s)if(s.hasOwnProperty(d)&&s[d]){var h=d.toLowerCase();if(u>1&&"title"===h){u=1,l=d;break}u>2&&"name"===h?(u=2,l=d):u>3&&/title/i.test(d)?(u=3,l=d):u>4&&/name/i.test(d)&&(u=4,l=d)}Bi(l)&&(a.name=s[l])}var m=s.description;null!==m&&(a.description=Bi(m)?new Vi(m):i(s,l))}return a}function dr(e,i,r,n,o){if(null!==i.geometry){if(!Bi(i.geometry))throw new t("feature.geometry is required.");var a=i.geometry.type,s=lr[a];if(!Bi(s))throw new t("Unknown geometry type: "+a);s(e,i,i.geometry,n,o)}else ur(i,e._entityCollection,o.describe)}function hr(e,i,r,n,o){for(var a=r.geometries,s=0,l=a.length;s<l;s++){var c=a[s],u=c.type,d=lr[u];if(!Bi(d))throw new t("Unknown geometry type: "+u);d(e,i,c,n,o)}}function mr(e,t,i,r,n){let o=n.pointSize,a=n.pointColor;const s=t.properties;if(Bi(s)){const e=s["point-color"];Bi(e)&&(a=er.fromCssColorString(e)),o=Hi(rr[s["point-size"]],o)}const l=new $i;2===r.length&&n.clampToGround&&(l.heightReference=tr.CLAMP_TO_GROUND);const c=ur(t,e._entityCollection,n.describe);c.point=l,c.point.color=a,c.point.pixelSize=o,c.position=new ji(i(r))}function gr(e,t,i,r,n){mr(e,t,r,i.coordinates,n)}function fr(e,t,i,r,n){for(var o=i.coordinates,a=0;a<o.length;a++)mr(e,t,r,o[a],n)}function pr(e,t,i,r,n){const o=n.lineColor,a=n.lineWidth,s=t.properties;if(Bi(s)){const e=s["stroke-width"];let t;Bi(e)&&(a=new Vi(e));let i=s.stroke;Bi(i)&&(t=er.fromCssColorString(i));let r=s["stroke-opacity"];Bi(r)&&1!==r&&(Bi(t)||(t=o.color.clone()),t.alpha=r),Bi(t)&&(o=new Wi(t))}const l=ur(t,e._entityCollection,n.describe),c=new Xi;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=a,c.positions=new Vi(cr(r,i)),c.arcType=Qi.RHUMB}function _r(e,t,i,r,n){pr(e,t,r,i.coordinates,n)}function vr(e,t,i,r,n){for(var o=i.coordinates,a=0;a<o.length;a++)pr(e,t,r,o[a],n)}function yr(e,t,i,r,n){if(0===r.length||0===r[0].length)return;let o=n.outlineColor.color,a=n.fill,s=n.outlineWidth;const l=t.properties;if(Bi(l)){const e=l["stroke-width"];let t;Bi(e)&&(s=new Vi(e));const i=l.stroke;Bi(i)&&(t=er.fromCssColorString(i));let r,c=l["stroke-opacity"];Bi(c)&&1!==c&&(Bi(t)||(t=n.outlineColor.color.clone()),t.alpha=c),Bi(t)&&(o=new Vi(t));const u=l.fill;Bi(u)&&(r=er.fromCssColorString(u),r.alpha=a.color.alpha),c=l["fill-opacity"],Bi(c)&&c!==a.color.alpha&&(Bi(r)||(r=a.color.clone()),r.alpha=c),Bi(r)&&(a=new Wi(r))}const c=new Yi;c.outline=new Vi(n.outline),c.outlineColor=o,c.outlineWidth=s,c.material=a,c.arcType=Qi.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let i of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(i);Bi(e)&&Bi(e[1])&&(t=t.replace(i,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const d=[];for(var h=1,m=r.length;h<m;h++)d.push(new Ki(cr(r[h],i)));const g=r[0];c.hierarchy=new Vi(new Ki(cr(g,i),d)),g[0].length>2?c.perPositionHeight=new Vi(!0):n.clampToGround||(c.height=0);ur(t,e._entityCollection,n.describe).polygon=c}function Cr(e,t,i,r,n){yr(e,t,r,i.coordinates,n)}function Sr(e,t,i,r,n){for(var o=i.coordinates,a=0;a<o.length;a++)yr(e,t,r,o[a],n)}function br(e,t,i,r,n){for(var o in i.objects)if(i.objects.hasOwnProperty(o)){var a=topojson.feature(i,i.objects[o]);(0,sr[a.type])(e,a,a,r,n)}}function wr(e,t){var i="";for(var r in e)if(e.hasOwnProperty(r)){if(r===t||-1!==xr.indexOf(r))continue;var n=e[r];Bi(n)&&(i+="object"==typeof n?"<tr><th>"+r+"</th><td>"+wr(n)+"</td></tr>":"<tr><th>"+r+"</th><td>"+n+"</td></tr>")}return i.length>0&&(i='<table class="cesium-infoBox-defaultTable"><tbody>'+i+"</tbody></table>"),i}const xr=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"];function Er(e,t){return new Cesium.CallbackProperty(function(e,t,i){var r;return function(n,o){return Bi(r)||(r=e(t,i)),r}}(wr,e,t),!0)}function Tr(e){return Zi.fromDegrees(e[0],e[1],e[2])}class Pr extends li{constructor(e){super(e),this._geoJson=void 0}get geoJson(){return this._geoJson}set geoJson(e){this._geoJson?this._geoJson.features.push(e):this._geoJson={type:"FeatureCollection",features:[e]}}static pointSize=5;static pointColor=er.ROYALBLUE;static lineColor=er.YELLOW;static fill=er.fromBytes(255,255,0,100);static outline=!0;static outlineColor=er.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return ar}static crsLinkHrefs(){return nr}static crsLinkTypes(){return or}load(e,i={encoding:"utf-8"}){if(!Bi(e))throw new t("data is required.");Cesium.DataSource.setLoading(this,!0);const r=i.credit;"string"==typeof r&&(r=new Cesium.Credit(r)),this._credit=r;const n=this;let o=e,a=i.sourceUri;if("string"==typeof e||e instanceof ir){o=new Promise(((t,r)=>{ci.open(e,void 0,{encoding:i.encoding}).then((e=>e.read().then((function i(r){if(!r.done)return n.geoJson=r.value,e.read().then(i);t(n.geoJson)})))).catch((e=>r(e.stack)))})),a=Hi(a,"");var s=this._resourceCredits,l=e.credits;if(Bi(l))for(var c=l.length,u=0;u<c;u++)s.push(l[u])}return i={describe:Hi(i.describe,Er),pointSize:Hi(i.pointSize,Pr.pointSize),pointColor:Hi(i.pointColor,Pr.pointColor),lineWidth:new Vi(Hi(i.lineWidth,Pr.lineWidth)),outlineColor:new Wi(Hi(i.outlineColor,Pr.outlineColor)),lineColor:new Wi(Hi(i.lineColor,Pr.lineColor)),outlineWidth:Hi(i.outlineWidth,Pr.outlineWidth),fill:new Wi(Hi(i.fill,Pr.fill)),outline:Hi(i.outline,Pr.outline),clampToGround:Hi(i.clampToGround,Pr.clampToGround),extrudedHeight:i.extrudedHeight},Cesium.when(o,(function(e){return function(e,i,r,n){let o;Bi(n)&&(o=Cesium.getFilenameFromUri(n)),Bi(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const a=sr[i.type];if(!Bi(a))throw new t("Unsupported GeoJSON object type: "+i.type);const s=i.crs;let l=null!==s?Tr:null;if(Bi(s)){if(!Bi(s.properties))throw new t("crs.properties is undefined.");const e=s.properties;if("name"===s.type){if(l=ar[e.name],!Bi(l))throw new t("Unknown crs name: "+e.name)}else if("link"===s.type){var c=nr[e.href];if(Bi(c)||(c=or[e.type]),!Bi(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==s.type)throw new t("Unknown crs type: "+s.type);if(l=ar["EPSG:"+e.code],!Bi(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&a(e,i,i,t,r),Cesium.when.all(e._promises,(function(){return e._promises.length=0,qi.setLoading(e,!1),e}))}))}(n,e,i,a)})).otherwise((function(e){return Cesium.DataSource.setLoading(n,!1),n._error.raiseEvent(n,e),console.log(e),Cesium.when.reject(e)}))}}Pr.load=function(e,t){return(new Pr).load(e,t)};const{buildModuleUrl:Lr,Color:Ar,defined:Mr,destroyObject:Rr,knockout:Dr,getElement:Nr,subscribeAndEvaluate:Fr,InfoBoxViewModel:Or}=Cesium;class Ir{constructor(e){e=Nr(e);var t=document.createElement("div");t.className="cesium-infoBox",t.setAttribute("data-bind",'      css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }'),e.appendChild(t);var i=document.createElement("div");i.className="cesium-infoBox-title",i.setAttribute("data-bind","text: titleText"),t.appendChild(i);var r=document.createElement("button");r.type="button",r.className="cesium-infoBox-close",r.setAttribute("data-bind","      click: function () { closeClicked.raiseEvent(this); }"),r.innerHTML="&times;",t.appendChild(r);var n=document.createElement("iframe");n.className="cesium-infoBox-iframe",n.setAttribute("sandbox","allow-same-origin allow-popups allow-forms"),n.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }"),n.setAttribute("allowfullscreen",!0),t.appendChild(n);var o=new Or;Dr.applyBindings(o,t),this._container=e,this._element=t,this._frame=n,this._viewModel=o,this._descriptionSubscription=void 0;var a=this;n.addEventListener("load",(function(){var e=n.contentDocument,i=e.createElement("link");i.href=Lr("Widgets/InfoBox/InfoBoxDescription.css"),i.rel="stylesheet",i.type="text/css";var r=e.createElement("div");r.className="cesium-infoBox-description",e.head.appendChild(i),e.body.appendChild(r),a._descriptionSubscription=Fr(o,"description",(function(e){n.style.height="5px",r.innerHTML=e;var i=null,o=r.firstElementChild;if(null!==o&&1===r.childNodes.length){var a=window.getComputedStyle(o);if(null!==a){var s=a["background-color"],l=Ar.fromCssColorString(s);Mr(l)&&0!==l.alpha&&(i=a["background-color"])}}t.style["background-color"]=i;var c=r.getBoundingClientRect().height;n.style.height=c+"px"}))})),n.setAttribute("src","about:blank")}get container(){return this._container}get viewModel(){return this._viewModel}get frame(){return this._frame}isDestroyed(){return!1}destroy(){var e=this._container;return Dr.cleanNode(this._element),e.removeChild(this._element),Mr(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),Rr(this)}}const{Transforms:kr,Cartesian3:zr}=Cesium;class Ur{constructor(e={}){if(!z(e.modelMatrix)&&z(e.position)){let t;e.position instanceof zr?t=e.position:e.position instanceof he&&(t=e.position.toCartesian()),t&&(e.modelMatrix=kr.eastNorthUpToFixedFrame(t))}if(z(e.gltf))this.delegate=new Cesium.Model(e);else{if(!z(e.url))throw new t("one of parameters url or gltf must be provided.");this.delegate=Cesium.Model.fromGltf(e)}this._readyPromise=this.delegate._readyPromise,this._ready=this.delegate._ready}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get activeAnimations(){return this.delegate.activeAnimations}set activeAnimations(e){this.delegate.activeAnimations=e}get allowPicking(){return this.delegate.allowPicking}get asynchronous(){return this.delegate.asynchronous}get backFaceCulling(){return this.delegate.backFaceCulling}get basePath(){return this.delegate.basePath}get boundingSphere(){return this.delegate.boundingSphere}get clippingPlanes(){return this.delegate.clippingPlanes}set clippingPlanes(e){this.delegate.clippingPlanes=e}get color(){return this.delegate.color}set color(e){this.delegate.color=e}get colorBlendMode(){return this.delegate.colorBlendMode}set colorBlendMode(e){this.delegate.colorBlendMode=e}get colorBlendAmount(){return this.delegate.colorBlendAmount}set colorBlendAmount(e){this.delegate.colorBlendAmount=e}get credit(){return this.delegate.credit}set credit(e){this.delegate.credit=e}get debugShowBoundingVolume(){return this.delegate.debugShowBoundingVolume}set debugShowBoundingVolume(e){this.delegate.debugShowBoundingVolume=e}get debugWireframe(){return this.delegate.debugWireframe}set debugWireframe(e){this.delegate.debugWireframe=e}get distanceDisplayCondition(){return this.delegate.distanceDisplayCondition}set distanceDisplayCondition(e){this.delegate.distanceDisplayCondition=e}get gltf(){return this.delegate.gltf}get id(){return this.delegate.id}set id(e){this.delegate.id=e}get maximumScale(){return this.delegate.maximumScale}set maximumScale(e){this.delegate.maximumScale=e}get minimumPixelSize(){return this.delegate.minimumPixelSize}set minimumPixelSize(e){this.delegate.minimumPixelSize=e}get modelMatrix(){return this.delegate.modelMatrix}set modelMatrix(e){this.delegate.modelMatrix=e}get scale(){return this.delegate.scale}set scale(e){this.delegate.scale=e}get shadows(){return this.delegate.shadows}set shadows(e){this.delegate.shadows=e}get show(){return this.delegate.show}set show(e){this.delegate.show=e}get showOutline(){return this.delegate.showOutline}get silhouetteColor(){return this.delegate.silhouetteColor}set silhouetteColor(e){this.delegate.silhouetteColor=e}get silhouetteSize(){return this.delegate.silhouetteSize}set silhouetteSize(e){this.delegate.silhouetteSize=e}static silhouetteSupported(e){return Cesium.Model.silhouetteSupported(e.scene)}destroy(){this.delegate.destroy()}isDestroyed(){this.delegate.isDestroyed()}getMaterial(e){return this.delegate.getMaterial(e)}getMesh(e){return this.delegate.getMesh(e)}getNode(e){return this.delegate.getNode(e)}get rootNodes(){return this.delegate._runtime.rootNodes}get nodes(){return this.delegate._runtime.nodesByName}get materials(){return this.delegate._runtime.materialsByName}get meshs(){return this.delegate._runtime.meshesByName}}function Gr(e,t){const{center:i}=e.boundingSphere,r=he.fromCartesian(i),n=Cesium.Cartesian3.fromDegrees(r.lon,r.lat,0),o=Cesium.Cartesian3.fromDegrees(r.lon,r.lat,t),a=Cesium.Cartesian3.subtract(o,n,new Cesium.Cartesian3);e.modelMatrix=Cesium.Matrix4.multiply(e.modelMatrix,Cesium.Matrix4.fromTranslation(a),e.modelMatrix)}class Br{constructor(e={},t={}){this._params={height:0,position:new Cesium.Cartesian3(0,0,0),rotation:0};let{transform:i,position:r,height:n,rotationZ:o,debug:a}=e;const s=new Cesium.Cesium3DTileset(e);s.readyPromise.then((e=>{if(viewer.scene.primitives.add(e),Cesium.defined(r)&&function(e,t,i,r){if(t)e.root.transform=t;else{const t=Cesium.Transforms.eastNorthUpToFixedFrame(i),n=Cesium.Matrix3.fromRotationZ(r);Cesium.Matrix4.multiplyByMatrix3(t,n,t),Cesium.Matrix4.multiply(e.root.transform,t,e.root.transform)}}(e,i,r,o),Cesium.defined(n)&&Gr(e,n),a){let t=0,i=new Cesium.Cartesian3,r=0;parent.onkeypress=function(n){n.keyCode==="Q".charCodeAt()||n.keyCode==="q".charCodeAt()?t=1:n.keyCode==="E".charCodeAt()||n.keyCode==="e".charCodeAt()?t=-1:n.keyCode==="A".charCodeAt()||n.keyCode==="a".charCodeAt()?i=new Cesium.Cartesian3(-2,0,0):n.keyCode==="D".charCodeAt()||n.keyCode==="d".charCodeAt()?i=new Cesium.Cartesian3(2,0,0):n.keyCode==="W".charCodeAt()||n.keyCode==="w".charCodeAt()?i=new Cesium.Cartesian3(0,-2,0):n.keyCode==="S".charCodeAt()||n.keyCode==="s".charCodeAt()?i=new Cesium.Cartesian3(0,2,0):n.keyCode==="Z".charCodeAt()||n.keyCode==="z".charCodeAt()?r=-1:n.keyCode!=="X".charCodeAt()&&n.keyCode!=="x".charCodeAt()||(r=1),function(e,t){const i=new Cesium.Matrix4;Cesium.Matrix4.fromTranslation(t,i),Cesium.Matrix4.multiply(e.modelMatrix,i,e.modelMatrix)}(e,i),function(e,t){const i=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(t));Cesium.Matrix4.multiplyByMatrix3(e.root.transform,i,e.root.transform)}(e,r),Gr(e,t),r=0,i=new Cesium.Cartesian3,t=0}}})),this.delegate=s}get allTilesLoaded(){return this.delegate.allTilesLoaded}get readyPromise(){return this.delegate.readyPromise}get boundingSphere(){return this.delegate.boundingSphere}get colorBlendAmount(){return this.delegate.colorBlendAmount}set colorBlendAmount(e){this.delegate.colorBlendAmount=e}get colorBlendMode(){return this.delegate.colorBlendMode}set colorBlendMode(e){this.delegate.colorBlendMode=e}get style(){return this.delegate.style}set style(e){this.delegate.style=e}get customShader(){return this.delegate.customShader}set customShader(e){this.delegate.customShader=e}get debugColorizeTiles(){return this.delegate.debugColorizeTiles}set debugColorizeTiles(e){this.delegate.debugColorizeTiles=e}get debugFreezeFrame(){return this.delegate.debugFreezeFrame}set debugFreezeFrame(e){this.delegate.debugFreezeFrame=e}get debugShowBoundingVolume(){return this.delegate.debugShowBoundingVolume}set debugShowBoundingVolume(e){this.delegate.debugShowBoundingVolume=e}get debugShowContentBoundingVolume(){return this.delegate.debugShowContentBoundingVolume}set debugShowContentBoundingVolume(e){this.delegate.debugShowContentBoundingVolume=e}get debugShowGeometricError(){return this.delegate.debugShowGeometricError}set debugShowGeometricError(e){this.delegate.debugShowGeometricError=e}get debugShowMemoryUsage(){return this.delegate.debugShowMemoryUsage}set debugShowMemoryUsage(e){this.delegate.debugShowMemoryUsage=e}get debugShowRenderingStatistics(){return this.delegate.debugShowRenderingStatistics}set debugShowRenderingStatistics(e){this.delegate.debugShowRenderingStatistics=e}get debugShowUrl(){return this.delegate.debugShowUrl}set debugShowUrl(e){this.delegate.debugShowUrl=e}get debugWireframe(){return this.delegate.debugWireframe}set debugWireframe(e){this.delegate.debugWireframe=e}get dynamicScreenSpaceError(){return this.delegate.dynamicScreenSpaceError}set dynamicScreenSpaceError(e){this.delegate.dynamicScreenSpaceError=e}get dynamicScreenSpaceErrorFactor(){return this.delegate.dynamicScreenSpaceErrorFactor}set dynamicScreenSpaceErrorFactor(e){this.delegate.dynamicScreenSpaceErrorFactor=e}get extensions(){return this.delegate.extensions}get extras(){return this.delegate.extras}get dynamicScreenSpaceErrorDensity(){return this.delegate.dynamicScreenSpaceErrorDensity}set dynamicScreenSpaceErrorDensity(e){this.delegate.dynamicScreenSpaceErrorDensity=e}get foveatedScreenSpaceError(){return this.delegate.foveatedScreenSpaceError}set foveatedScreenSpaceError(e){this.delegate.foveatedScreenSpaceError=e}get foveatedConeSize(){return this.delegate.foveatedConeSize}set foveatedConeSize(e){this.delegate.foveatedConeSize=e}get foveatedInterpolationCallback(){return this.delegate.foveatedInterpolationCallback}set foveatedInterpolationCallback(e){this.delegate.foveatedInterpolationCallback=e}get foveatedMinimumScreenSpaceErrorRelaxation(){return this.delegate.foveatedMinimumScreenSpaceErrorRelaxation}set foveatedMinimumScreenSpaceErrorRelaxation(e){this.delegate.foveatedMinimumScreenSpaceErrorRelaxation=e}get foveatedTimeDelay(){return this.delegate.foveatedTimeDelay}set foveatedTimeDelay(e){this.delegate.foveatedTimeDelay=e}get imageBasedLightingFactor(){return this.delegate.imageBasedLightingFactor}set imageBasedLightingFactor(e){this.delegate.imageBasedLightingFactor=e}get immediateLoadDesiredLevelOfDetail(){return this.delegate.immediateLoadDesiredLevelOfDetail}set immediateLoadDesiredLevelOfDetail(e){this.delegate.immediateLoadDesiredLevelOfDetail=e}get initialTilesLoaded(){return this.delegate.initialTilesLoaded}get lightColor(){return this.delegate.lightColor}set lightColor(e){this.delegate.lightColor=e}get loadProgress(){return this.delegate.loadProgress}get loadSiblings(){return this.delegate.loadSiblings}get maximumMemoryUsage(){return this.delegate.maximumMemoryUsage}set maximumMemoryUsage(e){this.delegate.maximumMemoryUsage=e}get maximumScreenSpaceError(){return this.delegate.maximumScreenSpaceError}set maximumScreenSpaceError(e){this.delegate.maximumScreenSpaceError=e}get modelMatrix(){return this.delegate.modelMatrix}set modelMatrix(e){this.delegate.modelMatrix=e}get pointCloudShading(){return this.delegate.pointCloudShading}set pointCloudShading(e){this.delegate.pointCloudShading}get preferLeaves(){return this.delegate.preferLeaves}set preferLeaves(e){this.delegate.preferLeaves=e}get preloadFlightDestinations(){return this.delegate.preloadFlightDestinations}set preloadFlightDestinations(e){this.delegate.preloadFlightDestinations}get preloadWhenHidden(){return this.delegate.preloadWhenHidden}set preloadWhenHidden(e){this.delegate.preloadWhenHidden}get progressResolutionHeightFraction(){return this.delegate.progressResolutionHeightFraction}set progressResolutionHeightFraction(e){this.delegate.progressResolutionHeightFraction=e}get properties(){return this.delegate.properties}get resource(){return this.delegate.resource}get root(){return this.delegate.root}get shadows(){return this.delegate.shadows}set shadows(e){this.delegate.shadows=e}get showOutline(){return this.delegate.showOutline}get skipLevelOfDetail(){return this.delegate.skipLevelOfDetail}set skipLevelOfDetail(e){this.delegate.skipLevelOfDetail}get skipLevels(){return this.delegate.skipLevels}set skipLevels(e){this.delegate.skipLevels=e}get skipScreenSpaceErrorFactor(){return this.delegate.skipScreenSpaceErrorFactor}set skipScreenSpaceErrorFactor(e){this.delegate.skipScreenSpaceErrorFactor=e}get clippingPlanes(){return this.delegate.clippingPlanes}set clippingPlanes(e){this.delegate.clippingPlanes=e}get specularEnvironmentMaps(){return this.delegate.specularEnvironmentMaps}set specularEnvironmentMaps(e){this.delegate.specularEnvironmentMaps=e}get tileFailed(){return this.delegate.tileFailed}get tileLoad(){return this.delegate.tileLoad}set tileLoad(e){this.delegate.tileLoad=e}get tileUnload(){return this.delegate.tileUnload}set tileUnload(e){this.delegate.tileUnload=e}get tilesLoaded(){return this.delegate.tilesLoaded}get tileVisible(){return this.delegate.tileVisible}set tileVisible(e){this.delegate.tileVisible=e}get timeSinceLoad(){return this.delegate.timeSinceLoad}get totalMemoryUsageInBytes(){return this.delegate.totalMemoryUsageInBytes}get classificationType(){return this.delegate.classificationType}set classificationType(e){this.delegate.classificationType=e}get baseScreenSpaceError(){return this.delegate.baseScreenSpaceError}set baseScreenSpaceError(e){this.delegate.baseScreenSpaceError=e}destroy(){this.delegate.destroy()}hasExtension(e){return this.delegate.hasExtension(e)}isDestroyed(){return this.delegate.isDestroyed()}makeStyleDirty(){return this.delegate.makeStyleDirty()}trimLoadedTiles(){this.delegate.trimLoadedTiles()}static loadJson(e){return Cesium3DTileset.loadJson(e)}}class Hr{constructor(e={}){this._id=k(e.id,fe()),this._maxClusterLevel=k(e.maxClusterLevel,12),this._minLoadLevel=k(e.minLoadLevel,12),this._objects=void 0}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects}set objects(e){this._objects=e}updateCluster(e){t.throwInstantiationError()}beginUpdate(e){t.throwInstantiationError()}endUpdate(e){t.throwInstantiationError()}initialize(e,i){t.throwInstantiationError()}createGeometry(e,i,r){t.throwInstantiationError()}removeGeometry(e,t){}removeAll(){t.throwInstantiationError()}isDestroyed(){return!1}destroy(){t.throwInstantiationError()}}const{AssociativeArray:Wr}=Cesium;class jr{constructor(){this._layers=new Wr}get layer(){return this._layers}get length(){return this._layers.length}get values(){return this._layers.values}get(e){return this._layers.get(e)}add(e){e instanceof Hr&&this._layers.set(e.id,e)}has(e){return e instanceof Hr?this._layers.contains(e):"string"==typeof e&&this._layers.contains(this.get(e))}remove(e){if(e instanceof Hr)return e.destroy(),this._layers.remove(e.id);if("string"==typeof e){const t=this._layers.get(e);return t&&t.destroy(),this._layers.remove(e)}return!1}removeAll(){return this._layers.removeAll()}}const{GeographicTilingScheme:Vr,GlobeSurfaceTileProvider:qr,when:Yr,Event:Xr,GlobeSurfaceTile:Jr,TerrainState:Zr,RequestType:$r,Request:Qr,Rectangle:Kr,QuadtreeTileLoadState:en,Visibility:tn,AssociativeArray:rn,Cartesian3:nn,Cartographic:on,getTimestamp:an}=Cesium;const sn={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function ln(e,t,i,r,n){const o=e.data;o.terrainState===Zr.UNLOADED&&function(e,t,i){let r=e.data;function n(e){r.terrainData=e,r.terrainState=Zr.RECEIVED,r.request=void 0}function o(e){if(r.request.state===RequestState.CANCELLED)return r.terrainData=void 0,r.terrainState=Zr.UNLOADED,void(r.request=void 0);r.terrainState=Zr.FAILED,r.request=void 0}!function(){const t=new Qr({throttle:!1,throttleByServer:!0,type:$r.TERRAIN});r.request=t;const a=i.requestTileGeometry(e.x,e.y,e.level,t);z(a)?(r.terrainState=Zr.RECEIVING,Yr(a,n,o)):(r.terrainState=Zr.UNLOADED,r.request=void 0)}()}(e,0,i),o.terrainState===Zr.RECEIVED&&function(e,t,i,r,n,o){const a=i.tilingScheme,s=sn;s.tilingScheme=a,s.x=r,s.y=n,s.level=o,s.exaggeration=t.terrainExaggeration,s.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,s.throttle=!0;const l=e.terrainData.createMesh(s);z(l)&&(e.terrainState=Zr.TRANSFORMING,Yr(l,(function(t){e.mesh=t,e.terrainState=Zr.TRANSFORMED}),(function(){e.terrainState=Zr.FAILED})))}(o,t,i,e.x,e.y,e.level),o.terrainState===Zr.TRANSFORMED&&(e.renderable=!0)}function cn(e,t){const i=[];for(let r of e)z(r)&&(z(r.id)||(r.id=fe()),z(r)&&z(r.position)&&(r.position instanceof nn?r.cartesian=r.position:r.position instanceof on?(r.cartesian=on.toCartesian(r.position),r.catographic=r.position):r.position instanceof he?(r.cartesian=r.position.toCartesian(),r.cartographic=r.position.toCartoGraphic()):r.cartesian=r.position,r.cartographic||(r.cartographic=on.fromCartesian(r.cartesian)),Kr.contains(t.rectangle,r.cartographic)&&i.push(r)));return i}class un{constructor(){this.boundingVolumeSourceTile=void 0,this.terrainState=Cesium.TerrainState.UNLOADED,this.mesh=void 0,this.terrainData=void 0,this.objects=void 0,this._geometryOfTile=new rn,this._objectsOfTile=new rn,this._needRenderObjects=new rn}static processStateMachine(e,t,i,r,n){un.initialize(e,i),e.state===en.LOADING&&ln(e,t,i)}static initialize(e,t){let i=e.data;z(i)||(i=e.data=new un),e.state===en.START&&(e.state=en.LOADING)}}function dn(e,t,i,r,n){let o=i.data._geometryOfTile.get(t.id),a=e._hasRenderCached.get(t.id);a||(a={},e._hasRenderCached.set(t.id,a)),o||(o=[]);for(let e of n){if(a[e.id])return;const n=t.createGeometry(i,r,e);n&&(a[e.id]=!0,o.push({id:e.id,geometry:n}))}i.data._geometryOfTile.set(t.id,o)}function hn(e,t,i,r,n){const o=e._hasRenderCached.get(t.id);for(let e of n){const{id:i,geometry:n}=e;t.removeGeometry(r,n),delete o[i]}i.data._geometryOfTile.remove(t.id)}class mn{constructor(e={}){this._ready=!0,this._scene=e.scene,this._tilingSceheme=new Vr,this._readyPromise=Yr.defer(),this._readyPromise.resolve(!0),this._errorEvent=new Xr,this._terrainProvider=e.terrainProvider,this._show=!0,this.cartographicLimitRectangle=Kr.clone(Kr.MAX_VALUE),this.tree=void 0,this._layers=new jr,this._lastTilesToRender=[],this._hasRenderCached=new rn,this._tilesCahced=[]}get terrainProvider(){return this._terrainProvider}get show(){return this._show}set show(e){this._show=e}get ready(){return this._ready}get tilingScheme(){return this._tilingSceheme}get readyPromise(){return this._readyPromise}get quadtree(){return this._quadtree}set quadtree(e){z(e)&&(this._quadtree=e)}initialize(e){for(let t of this._layers.values)t.initialize(e,this._scene)}beginUpdate(e){const t=this._layers.values;for(let i of t)i.beginUpdate(e);this._frameNumber++}showTileThisFrame(e,t){const i=e.data;if(!z(i))return;this._tilesCahced.includes(e)||this._tilesCahced.push(e);const r=this._layers.values;an();for(let n of r){if(!z(n.objects)||!Array.isArray(n.objects))continue;const r=n.id;if(i._geometryOfTile.get(r)&&!n._needReclass)return;let o=i._objectsOfTile.get(r);z(o)&&!n._needReclass||(o=cn(n.objects,e),i._objectsOfTile.set(r,o)),dn(this,n,e,t,o)}}endUpdate(e){const t=this._quadtree;if(!t)return;const i=this._lastTilesToRender,r=t._tilesToRender,n=this._layers.values;for(let t of i)if(!r.includes(t))for(let i of n){const r=t.data._geometryOfTile.get(i.id)||[];hn(this,i,t,e,r)}for(let t of n){t.endUpdate(e)&&r.forEach((i=>{const r=i.data._geometryOfTile.get(t.id)||[];hn(this,t,i,e,r)}))}this._lastTilesToRender=[...r]}loadTile(e,t){let i,r=!0;t.data&&(i=t.data.terrainState,r=t.data.boundingVolumeSourceTile!==t),un.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree);const n=t.data;r&&i!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==tn.NONE&&n.boundingVolumeSourceTile===t&&un.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree)}getLevelMaximumGeometricError(e){return this._terrainProvider.getLevelMaximumGeometricError(e)}canRefine(e){return qr.prototype.canRefine.call(this,e)}computeTileVisibility(e,t,i){return z(e.data)||(e.data=new un),qr.prototype.computeTileVisibility.call(this,e,t,i)}computeDistanceToTile(e,t){return e.data||(e.data=new un),qr.prototype.computeDistanceToTile.call(this,e,t)}clearTile(e){const t=this._tilesCahced;for(let i of t)i.data._geometryOfTile.remove(e),i.data._objectsOfTile.remove(e);this._hasRenderCached.remove(e)}isDestroyed(){return!1}destroy(){this._removeEventListener();const e=this._layers.values;for(let t of e)t.destroy()}computeTileLoadPriority(e,t){return qr.prototype.computeTileLoadPriority(e,t)}_onLayerAdded(e,t){}_onLayerRemoved(e,t){}_onLayerShownOrHidden(e,t,i){i?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)}}var gn="uniform vec4 u_initialColor;\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_DAY_NIGHT_ALPHA\nuniform float u_dayTextureNightAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureDayAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SPLIT\nuniform float czm_p_imagerySplitPosition;\nuniform float czm_p_drawingBufferHeight;\nuniform float czm_p_drawingBufferWidth;\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\n\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\nuniform highp sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n\n#ifdef TRANSLUCENT\nuniform vec4 u_frontFaceAlphaByDistance;\nuniform vec4 u_backFaceAlphaByDistance;\nuniform vec4 u_translucencyRectangle;\n#endif\n\n#ifdef UNDERGROUND_COLOR\nuniform vec4 u_undergroundColor;\nuniform vec4 u_undergroundColorAlphaByDistance;\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nfloat interpolateByDistance(vec4 nearFarScalar, float distance)\n{\n    float startDistance = nearFarScalar.x;\n    float startValue = nearFarScalar.y;\n    float endDistance = nearFarScalar.z;\n    float endValue = nearFarScalar.w;\n    float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);\n    return mix(startValue, endValue, t);\n}\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT) || defined(APPLY_MATERIAL)\nvec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)\n{\n    return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);\n}\n#endif\n\n#ifdef TRANSLUCENT\nbool inTranslucencyRectangle()\n{\n    return\n        v_textureCoordinates.x > u_translucencyRectangle.x &&\n        v_textureCoordinates.x < u_translucencyRectangle.z &&\n        v_textureCoordinates.y > u_translucencyRectangle.y &&\n        v_textureCoordinates.y < u_translucencyRectangle.w;\n}\n#endif\n\nvec4 sampleAndBlend(\n    vec4 previousColor,\n    sampler2D textureToSample,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateRectangle,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureNightAlpha,\n    float textureDayAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureHue,\n    float textureSaturation,\n    float textureOneOverGamma,\n    float split,\n    vec4 colorToAlpha,\n    float nightBlend)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\n    // In other words, the alpha is zero if the fragment is outside the rectangle\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    textureAlpha *= mix(textureDayAlpha, textureNightAlpha, nightBlend);\n#endif\n\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 value = texture2D(textureToSample, textureCoordinates);\n    vec3 color = value.rgb;\n    float alpha = value.a;\n\n#ifdef APPLY_COLOR_TO_ALPHA\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n\n#if !defined(APPLY_GAMMA)\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\n    color = tempColor.rgb;\n    alpha = tempColor.a;\n#else\n    color = pow(color, vec3(textureOneOverGamma));\n#endif\n\n#ifdef APPLY_SPLIT\n    float splitPosition = czm_p_imagerySplitPosition * czm_p_drawingBufferWidth;\n    // 垂直分割 \n    if(split < -2.0 || split > 2.0) {\n        splitPosition = (1.0 - czm_p_imagerySplitPosition) * czm_p_drawingBufferHeight;\n    }\n    if(split < -2.0 && gl_FragCoord.y < splitPosition) {\n        alpha = 0.0;\n    }\n    else if (split > 2.0 && gl_FragCoord.y > splitPosition) {\n        alpha = 0.0;\n    }\n    // Split to the left\n    else if (split > -2.0 && split < 0.0 && gl_FragCoord.x > splitPosition) {\n       alpha = 0.0;\n    }\n    // Split to the right\n    else if (split < 2.0 && split > 0.0 && gl_FragCoord.x < splitPosition) {\n       alpha = 0.0;\n    }\n#endif\n\n#ifdef APPLY_BRIGHTNESS\n    color = mix(vec3(0.0), color, textureBrightness);\n#endif\n\n#ifdef APPLY_CONTRAST\n    color = mix(vec3(0.5), color, textureContrast);\n#endif\n\n#ifdef APPLY_HUE\n    color = czm_hue(color, textureHue);\n#endif\n\n#ifdef APPLY_SATURATION\n    color = czm_saturation(color, textureSaturation);\n#endif\n\n    float sourceAlpha = alpha * textureAlpha;\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n    outAlpha += sign(outAlpha) - 1.0;\n\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n\n    // When rendering imagery for a tile in multiple passes,\n    // some GPU/WebGL implementation combinations will not blend fragments in\n    // additional passes correctly if their computation includes an unmasked\n    // divide-by-zero operation,\n    // even if it's not in the output or if the output has alpha zero.\n    //\n    // For example, without sanitization for outAlpha,\n    // this renders without artifacts:\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\n    //\n    // but using czm_branchFreeTernary will cause portions of the tile that are\n    // alpha-zero in the additional pass to render as black instead of blending\n    // with the previous pass:\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\n    //\n    // So instead, sanitize against divide-by-zero,\n    // store this state on the sign of outAlpha, and correct on return.\n\n    return vec4(outColor, max(outAlpha, 0.0));\n}\n\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n}\n\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist);\n#endif\n\nconst float fExposure = 2.0;\n\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n        {\n            discard;\n        }\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\n#endif\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    float nightBlend = 1.0 - clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0, 0.0, 1.0);\n#else\n    float nightBlend = 0.0;\n#endif\n\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0), nightBlend);\n\n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\n    float cameraDist;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n    }\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\n    {\n        cameraDist = -czm_view[3].z;\n    }\n    else\n    {\n        cameraDist = length(czm_view[3]);\n    }\n    float fadeOutDist = u_lightingFadeDistance.x;\n    float fadeInDist = u_lightingFadeDistance.y;\n    if (czm_sceneMode != czm_sceneMode3D) {\n        vec3 radii = czm_ellipsoidRadii;\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\n        fadeOutDist -= maxRadii;\n        fadeInDist -= maxRadii;\n    }\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\n    float fade = 0.0;\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\n\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\n\n    if (mask > 0.0)\n    {\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\n\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\n\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n    }\n#endif\n\n#ifdef APPLY_MATERIAL\n    czm_materialInput materialInput;\n    materialInput.st = v_textureCoordinates.st;\n    materialInput.normalEC = normalize(v_normalEC);\n    materialInput.positionToEyeEC = -v_positionEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalize(v_normalEC));     \n    materialInput.slope = v_slope;\n    materialInput.height = v_height;\n    materialInput.aspect = v_aspect;\n    czm_material material = czm_getMaterial(materialInput);\n    vec4 materialColor = vec4(material.diffuse, material.alpha);\n    color = alphaBlend(materialColor, color);\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\n    vec4 finalColor = color;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\n\n    if (clipDistance < clippingPlanesEdgeWidth)\n    {\n        finalColor = clippingPlanesEdgeColor;\n    }\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n\n#ifdef FOG\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\n    fogColor *= darken;\n#endif\n\n#ifdef HDR\n    const float modifier = 0.15;\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n\n#ifdef GROUND_ATMOSPHERE\n    if (!czm_backFacing())\n    {\n        vec3 groundAtmosphereColor = computeGroundAtmosphereColor(fogColor, finalColor, atmosphereLightDirection, cameraDist);\n        finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n    }\n#endif\n\n#ifdef UNDERGROUND_COLOR\n    if (czm_backFacing())\n    {\n        float distanceFromEllipsoid = max(czm_eyeHeight, 0.0);\n        float distance = max(v_distance - distanceFromEllipsoid, 0.0);\n        float blendAmount = interpolateByDistance(u_undergroundColorAlphaByDistance, distance);\n        vec4 undergroundColor = vec4(u_undergroundColor.rgb, u_undergroundColor.a * blendAmount);\n        finalColor = alphaBlend(undergroundColor, finalColor);\n    }\n#endif\n\n#ifdef TRANSLUCENT\n    if (inTranslucencyRectangle())\n    {\n      vec4 alphaByDistance = gl_FrontFacing ? u_frontFaceAlphaByDistance : u_backFaceAlphaByDistance;\n      finalColor.a *= interpolateByDistance(alphaByDistance, v_distance);\n    }\n#endif\n\n    gl_FragColor = finalColor;\n}\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist)\n{\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n    xy *= czm_viewport.zw * mpp * 0.5;\n\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\n\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\n\n    float fadeInDist = u_nightFadeDistance.x;\n    float fadeOutDist = u_nightFadeDistance.y;\n\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\n\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\n    vec3 groundAtmosphereColor = fogColor;\n#endif\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\n#endif\n\n    return groundAtmosphereColor;\n}\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n\nfloat waveFade(float edge0, float edge1, float x)\n{\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return pow(1.0 - y, 5.0);\n}\n\nfloat linearFade(float edge0, float edge1, float x)\n{\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\n// Based on water rendering by Jonas Wagner:\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\n// low altitude wave settings\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\n\n// high altitude wave settings\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\n\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\n    vec3 positionToEyeEC = -positionEyeCoordinates;\n    float positionToEyeECLength = length(positionToEyeEC);\n\n    // The double normalize below works around a bug in Firefox on Android devices.\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\n\n    // Fade out the waves as the camera moves far from the surface.\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n\n#ifdef SHOW_OCEAN_WAVES\n    // high altitude waves\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\n\n    // low altitude waves\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\n\n    // blend the 2 wave layers based on distance to surface\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\n    vec3 normalTangentSpace =\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // fade out the normal perturbation as we move farther from the water surface\n    normalTangentSpace.xy *= waveIntensity;\n    normalTangentSpace = normalize(normalTangentSpace);\n#else\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 normalEC = enuToEye * normalTangentSpace;\n\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\n\n    // Use diffuse light to highlight the waves\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n\n#ifdef SHOW_OCEAN_WAVES\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\n    // the wave bumpiness and no particular light direction.\n    float tsPerturbationRatio = normalTangentSpace.z;\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\n    vec3 nonDiffuseHighlight = vec3(0.0);\n#endif\n\n    // Add specular highlights in 3D, and in all modes when zoomed in.\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\n    float specular = specularIntensity * surfaceReflectance;\n\n#ifdef HDR\n    specular *= 1.4;\n\n    float e = 0.2;\n    float d = 3.3;\n    float c = 1.7;\n\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\n\n    return vec4(color, imageryColor.a);\n}\n\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n";const{BoundingSphere:fn,buildModuleUrl:pn,Cartesian3:_n,Cartographic:vn,Color:yn,defaultValue:Cn,defined:Sn,destroyObject:bn,DeveloperError:wn,Ellipsoid:xn,EllipsoidTerrainProvider:En,Event:Tn,IntersectionTests:Pn,NearFarScalar:Ln,Ray:An,Rectangle:Mn,Resource:Rn,ShaderSource:Dn,Texture:Nn,when:Fn,GlobeSurfaceShaderSet:On,GlobeSurfaceTileProvider:In,GlobeTranslucency:kn,ImageryLayerCollection:zn,QuadtreePrimitive:Un,SceneMode:Gn,ShadowMode:Bn}=Cesium,Hn=Cesium._shadersGlobeVS,Wn=Cesium._shadersGroundAtmosphere;function jn(e){e=Cn(e,xn.WGS84);var t=new En({ellipsoid:e}),i=new zn;this._ellipsoid=e,this._from="cesiumpro-globe",this._imageryLayerCollection=i,this._surfaceShaderSet=new On,this._material=void 0,this._surface=new Un({tileProvider:new In({terrainProvider:t,imageryLayers:i,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new Tn,this._undergroundColor=yn.clone(yn.BLACK),this._undergroundColorAlphaByDistance=new Ln(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new kn,Vn(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new Rn({url:pn("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=Bn.RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function Vn(e){var t=[],i=Sn(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),r=[Wn];!Sn(e._material)||i&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.materialUniformMap=void 0:(r.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms),r.push(gn),e._surfaceShaderSet.baseVertexShaderSource=new Dn({sources:[Wn,Hn],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new Dn({sources:r,defines:t}),e._surfaceShaderSet.material=e._material}Object.defineProperties(jn.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!Sn(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){Sn(e)||(e=Mn.clone(Mn.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),Sn(this._material)&&Vn(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,Vn(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=yn.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=Ln.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});var qn=[],Yn={start:0,stop:0};jn.prototype.pickWorldCoordinates=function(e,t,i,r){i=Cn(i,!0);var n=t.mode,o=t.mapProjection,a=qn;a.length=0;var s,l,c,u,d=this._surface._tilesToRender,h=d.length;for(l=0;l<h;++l){var m=(s=d[l]).data;if(Sn(m)){var g=m.pickBoundingSphere;if(n!==Gn.SCENE3D)m.pickBoundingSphere=g=fn.fromRectangleWithHeights2D(s.rectangle,o,m.tileBoundingRegion.minimumHeight,m.tileBoundingRegion.maximumHeight,g),_n.fromElements(g.center.z,g.center.x,g.center.y,g.center);else{if(!Sn(m.renderedMesh))continue;fn.clone(m.tileBoundingRegion.boundingSphere,g)}var f=Pn.raySphere(e,g,Yn);Sn(f)&&a.push(m)}}for(a.sort((c=e.origin,function(e,t){return fn.distanceSquaredTo(e.pickBoundingSphere,c)-fn.distanceSquaredTo(t.pickBoundingSphere,c)})),h=a.length,l=0;l<h&&(u=a[l].pick(e,t.mode,t.mapProjection,i,r),!Sn(u));++l);return u};var Xn=new vn;jn.prototype.pick=function(e,t,i){if(i=this.pickWorldCoordinates(e,t,!0,i),Sn(i)&&t.mode!==Gn.SCENE3D){i=_n.fromElements(i.y,i.z,i.x,i);var r=t.mapProjection.unproject(i,Xn);i=t.globe.ellipsoid.cartographicToCartesian(r,i)}return i};var Jn=new _n,Zn=new _n,$n=new vn,Qn=new An;function Kn(e,t){return Sn(e)&&Mn.contains(e.rectangle,t)?e:void 0}jn.prototype.getHeight=function(e){var t=this._surface._levelZeroTiles;if(Sn(t)){var i,r,n=t.length;for(r=0;r<n&&(i=t[r],!Mn.contains(i.rectangle,e));++r);if(!(r>=n)){for(var o=i;Sn(i);)i=Kn(i._southwestChild,e)||Kn(i._southeastChild,e)||Kn(i._northwestChild,e)||i._northeastChild,Sn(i)&&Sn(i.data)&&Sn(i.data.renderedMesh)&&(o=i);if(Sn(i=o)&&Sn(i.data)&&Sn(i.data.renderedMesh)){var a=this._surface._tileProvider.tilingScheme.projection,s=this._surface._tileProvider.tilingScheme.ellipsoid,l=_n.fromRadians(e.longitude,e.latitude,0,s,Jn),c=Qn,u=s.geodeticSurfaceNormal(l,c.direction),d=s.getSurfaceNormalIntersectionWithZAxis(l,11500,c.origin);if(!Sn(d)){var h;Sn(i.data.tileBoundingRegion)&&(h=i.data.tileBoundingRegion.minimumHeight);var m=Math.min(Cn(h,0),-11500),g=_n.multiplyByScalar(u,Math.abs(m)+1,Zn);_n.subtract(l,g,c.origin)}var f=i.data.pick(c,void 0,a,!1,Zn);if(Sn(f))return s.cartesianToCartographic(f,$n).height}}}},jn.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},jn.prototype.beginFrame=function(e){var t=this._surface,i=t.tileProvider,r=this.terrainProvider,n=this.showWaterEffect&&r.ready&&r.hasWaterMask;if(n&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;var o=this._oceanNormalMapResource,a=o.url;if(Sn(a)){var s=this;Fn(o.fetchImage(),(function(t){a===s._oceanNormalMapResource.url&&(s._oceanNormalMap=s._oceanNormalMap&&s._oceanNormalMap.destroy(),s._oceanNormalMap=new Nn({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}var l=e.passes,c=e.mode;l.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,i.terrainProvider=this.terrainProvider,i.lightingFadeOutDistance=this.lightingFadeOutDistance,i.lightingFadeInDistance=this.lightingFadeInDistance,i.nightFadeOutDistance=this.nightFadeOutDistance,i.nightFadeInDistance=this.nightFadeInDistance,i.zoomedOutOceanSpecularIntensity=c===Gn.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,i.hasWaterMask=n,i.oceanNormalMap=this._oceanNormalMap,i.enableLighting=this.enableLighting,i.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,i.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,i.showGroundAtmosphere=this.showGroundAtmosphere,i.shadows=this.shadows,i.hueShift=this.atmosphereHueShift,i.saturationShift=this.atmosphereSaturationShift,i.brightnessShift=this.atmosphereBrightnessShift,i.fillHighlightColor=this.fillHighlightColor,i.showSkirts=this.showSkirts,i.backFaceCulling=this.backFaceCulling,i.undergroundColor=this._undergroundColor,i.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,t.beginFrame(e))},jn.prototype.render=function(e){this.show&&(Sn(this._material)&&this._material.update(e.context),this._surface.render(e))},jn.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},jn.prototype.isDestroyed=function(){return!1},jn.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),bn(this)};const{ShaderProgram:eo,RuntimeError:to,createUniform:io,defined:ro,createUniformArray:no,WebGLConstants:oo}=Cesium;function ao(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}const so=Cesium.AutomaticUniforms,lo="[Cesium WebGL] ",co={...so,czm_p_drawingBufferWidth:new ao({size:1,datatype:oo.FLOAT,getValue:function(e){return e._frameState.context.drawingBufferWidth}}),czm_p_drawingBufferHeight:new ao({size:1,datatype:oo.FLOAT,getValue:function(e){return e._frameState.context.drawingBufferHeight}}),czm_p_imagerySplitPosition:new ao({size:1,datatype:oo.FLOAT,getValue:function(e){return e._frameState.imagerySplitPosition}})};function uo(e){ro(e._program)||ho(e)}function ho(e){var t=e._program,i=e._gl,r=function(e,t){var i=t._vertexShaderText,r=t._fragmentShaderText,n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,i),e.compileShader(n);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o);var a=e.createProgram();e.attachShader(a,n),e.attachShader(a,o),e.deleteShader(n),e.deleteShader(o);var s,l=t._attributeLocations;if(ro(l))for(var c in l)l.hasOwnProperty(c)&&e.bindAttribLocation(a,l[c],c);if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var u=t._debugShaders;if(!e.getShaderParameter(o,e.COMPILE_STATUS)){if(s=e.getShaderInfoLog(o),console.error(lo+"Fragment shader compile log: "+s),ro(u)){var d=u.getTranslatedShaderSource(o);""!==d?console.error(lo+"Translated fragment shader source:\n"+d):console.error(lo+"Fragment shader translation failed.")}throw e.deleteProgram(a),new to("Fragment shader failed to compile.  Compile log: "+s)}if(!e.getShaderParameter(n,e.COMPILE_STATUS)){if(s=e.getShaderInfoLog(n),console.error(lo+"Vertex shader compile log: "+s),ro(u)){var h=u.getTranslatedShaderSource(n);""!==h?console.error(lo+"Translated vertex shader source:\n"+h):console.error(lo+"Vertex shader translation failed.")}throw e.deleteProgram(a),new to("Vertex shader failed to compile.  Compile log: "+s)}throw s=e.getProgramInfoLog(a),console.error(lo+"Shader program link log: "+s),ro(u)&&(console.error(lo+"Translated vertex shader source:\n"+u.getTranslatedShaderSource(n)),console.error(lo+"Translated fragment shader source:\n"+u.getTranslatedShaderSource(o))),e.deleteProgram(a),new to("Program failed to link.  Link log: "+s)}var m=t._logShaderCompilation;return m&&(s=e.getShaderInfoLog(n),ro(s)&&s.length>0&&console.log(lo+"Vertex shader compile log: "+s)),m&&(s=e.getShaderInfoLog(o),ro(s)&&s.length>0&&console.log(lo+"Fragment shader compile log: "+s)),m&&(s=e.getProgramInfoLog(a),ro(s)&&s.length>0&&console.log(lo+"Shader program link log: "+s)),a}(i,e,e._debugShaders),n=i.getProgramParameter(r,i.ACTIVE_ATTRIBUTES),o=function(e,t){for(var i={},r=[],n=[],o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<o;++a){var s=e.getActiveUniform(t,a),l=-1!==s.name.indexOf("[0]",s.name.length-"[0]".length)?s.name.slice(0,s.name.length-3):s.name;if(0!==l.indexOf("gl_"))if(s.name.indexOf("[")<0){var c=e.getUniformLocation(t,l);if(null!==c){var u=io(e,s,l,c);i[l]=u,r.push(u),u._setSampler&&n.push(u)}}else{var d,h,m,g,f=l.indexOf("[");if(f>=0){if(d=i[l.slice(0,f)],!ro(d))continue;(h=d._locations).length<=1&&(m=d.value,null!==(g=e.getUniformLocation(t,l))&&(h.push(g),m.push(e.getUniform(t,g))))}else{h=[];for(var p=0;p<s.size;++p)null!==(g=e.getUniformLocation(t,l+"["+p+"]"))&&h.push(g);d=no(e,s,l,h),i[l]=d,r.push(d),d._setSampler&&n.push(d)}}}return{uniformsByName:i,uniforms:r,samplerUniforms:n}}(i,r),a=function(e,t){var i=[],r=[];for(var n in t)if(t.hasOwnProperty(n)){var o=t[n],a=n,s=e._duplicateUniformNames[a];ro(s)&&(o.name=s,a=s);var l=co[a];ro(l)?i.push({uniform:o,automaticUniform:l}):r.push(o)}return{automaticUniforms:i,manualUniforms:r}}(e,o.uniformsByName);e._program=r,e._numberOfVertexAttributes=n,e._vertexAttributes=function(e,t,i){for(var r={},n=0;n<i;++n){var o=e.getActiveAttrib(t,n),a=e.getAttribLocation(t,o.name);r[o.name]={name:o.name,type:o.type,index:a}}return r}(i,r,n),e._uniformsByName=o.uniformsByName,e._uniforms=o.uniforms,e._automaticUniforms=a.automaticUniforms,e._manualUniforms=a.manualUniforms,e.maximumTextureUnitIndex=function(e,t,i){e.useProgram(t);for(var r=0,n=i.length,o=0;o<n;++o)r=i[o]._setSampler(r);return e.useProgram(null),r}(i,r,o.samplerUniforms),t&&e._gl.deleteProgram(t),"undefined"!=typeof spector&&(e._program.__SPECTOR_rebuildProgram=function(t,i,r,n){var o=e._vertexShaderText,a=e._fragmentShaderText,s=/ ! = /g;e._vertexShaderText=t.replace(s," != "),e._fragmentShaderText=i.replace(s," != ");try{ho(e),r(e._program)}catch(t){e._vertexShaderText=o,e._fragmentShaderText=a;var l=/(?:Compile|Link) error: ([^]*)/.exec(t.message);n(l?l[1]:t.message)}})}function mo(){const e=eo.prototype;eo.prototype={},eo.prototype._bind=function(){uo(this),this._gl.useProgram(this._program)},eo.prototype.destroy=e.destroy,eo.prototype._setUniforms=function(t,i,r){e._setUniforms.call(this,t,i,r)},eo.prototype.isDestroyed=e.isDestroyed,eo.prototype.finalDestroy=e.finalDestroy,Object.defineProperties(eo.prototype,{vertexAttributes:{get:function(){return uo(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return uo(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return uo(this),this._uniformsByName}},vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}}})}const go=Cesium.Scene,{JulianDate:fo,defined:po,RequestScheduler:_o,PerformanceDisplay:vo,Cesium3DTilePassState:yo,Cesium3DTilePass:Co,defaultValue:So,Color:bo,BoundingRectangle:wo,Pass:xo,SunLight:Eo,Cartesian3:To}=Cesium,Po=new yo({pass:Co.PRELOAD}),Lo=new yo({pass:Co.PRELOAD_FLIGHT}),Ao=new yo({pass:Co.REQUEST_RENDER_MODE_DEFER_CHECK});function Mo(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function Ro(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),po(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Do(e){return e._picking.updateMostDetailedRayPicks(e)}function No(e){var t=e._frameState;Po.camera=t.camera,Po.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,Po)}function Fo(e){var t=e._frameState;t.camera.canPreloadFlight()&&(Lo.camera=e.preloadFlightCamera,Lo.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,Lo))}const Oo=new yo({pass:Co.RENDER});function Io(e){e.primitives.updateForPass(e._frameState,Ao)}function ko(e){var t=e._frameState;e.primitives.postPassesUpdate(t),_o.update()}function zo(e){var t=e._frameState,i=e.context,r=i.uniformState,n=e._defaultView;e._view=n,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Oo;var o=So(e.backgroundColor,bo.BLACK);e._hdr&&((o=bo.clone(o,scratchBackgroundColor)).red=Math.pow(o.red,e.gamma),o.green=Math.pow(o.green,e.gamma),o.blue=Math.pow(o.blue,e.gamma)),t.backgroundColor=o,e.fog.update(t),r.update(t);var a=e.shadowMap;po(a)&&a.enabled&&(!po(e.light)||e.light instanceof Eo?To.negate(r.sunDirectionWC,e._shadowMapCamera.direction):To.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(a)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var s=n.viewport;s.x=0,s.y=0,s.width=i.drawingBufferWidth,s.height=i.drawingBufferHeight;var l=n.passState;l.framebuffer=void 0,l.blendingEnabled=void 0,l.scissorTest=void 0,l.viewport=wo.clone(s,l.viewport),po(e.globe)&&(e.globe.beginFrame(t),e._LodGraphic.beginFrame(t)),e.updateEnvironment(),e.updateAndExecuteCommands(l,o),e.globe&&e._LodGraphic.render(t),e.resolveFramebuffers(l),l.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(xo.OVERLAY);for(var i=e.context,r=e._overlayCommandList,n=r.length,o=0;o<n;++o)r[o].execute(i,t)}(e,l),po(e.globe)&&(e.globe.endFrame(t),e._LodGraphic.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function Uo(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,po(e)||(e=fo.now());var i=this._view.checkForCameraUpdates(this),r=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===SceneMode.MORPHING;if(!r&&po(this.maximumRenderTimeChange)&&po(this._lastRenderTime)){var n=Math.abs(fo.secondsDifference(this._lastRenderTime,e));r=r||n>this.maximumRenderTimeChange}r&&(this._lastRenderTime=fo.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,function(e,t,i){var r=e._frameState;r.frameNumber=t,r.time=fo.clone(i,r.time)}(this,Cesium.Math.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);Mo(this,Ro),this.primitives.show&&(Mo(this,Do),Mo(this,No),Mo(this,Fo),r||Mo(this,Io)),this._postUpdate.raiseEvent(this,e),r&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Mo(this,zo)),function(e,t){if(e.debugShowFramesPerSecond){if(!po(e._performanceDisplay)){var i=document.createElement("div");i.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(i);var r=new vo({container:i});e._performanceDisplay=r,e._performanceContainer=i}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else po(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,r),Mo(this,ko),function(e){for(var t=e._frameState.afterRender,i=0,r=t.length;i<r;++i)t[i](),e.requestRender();t.length=0}(this),r&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())}function Go(){(class{static overrideRenderFunction(){go.prototype.render=Uo}}).overrideRenderFunction()}const{Primitive:Bo,ShaderProgram:Ho,defined:Wo,DeveloperError:jo,defaultValue:Vo,ShaderSource:qo}=Cesium,Yo=Bo.prototype.update;function Xo(e){return qo.replaceMain(e,"czm_non_pick_main")+"\nvarying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor = czm_batchTable_pickColor(batchId); \n}"}function Jo(e,t){if(!e.compressVertices)return t;var i=-1!==t.search(/attribute\s+vec3\s+normal;/g),r=-1!==t.search(/attribute\s+vec2\s+st;/g);if(!i&&!r)return t;var n=-1!==t.search(/attribute\s+vec3\s+tangent;/g),o=-1!==t.search(/attribute\s+vec3\s+bitangent;/g),a=r&&i?2:1,s="compressedAttributes",l="attribute "+((a+=n||o?1:0)>1?"vec"+a:"float")+" "+s+";",c="",u="";r&&(c+="vec2 st;\n",u+="    st = czm_decompressTextureCoordinates("+(a>1?s+".x":s)+");\n");i&&n&&o?(c+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",u+="    czm_octDecode("+s+"."+(r?"yz":"xy")+", normal, tangent, bitangent);\n"):(i&&(c+="vec3 normal;\n",u+="    normal = czm_octDecode("+s+(a>1?"."+(r?"y":"x"):"")+");\n"),n&&(c+="vec3 tangent;\n",u+="    tangent = czm_octDecode("+s+"."+(r&&i?"z":"y")+");\n"),o&&(c+="vec3 bitangent;\n",u+="    bitangent = czm_octDecode("+s+"."+(r&&i?"z":"y")+");\n"));var d=t;return d=(d=(d=(d=d.replace(/attribute\s+vec3\s+normal;/g,"")).replace(/attribute\s+vec2\s+st;/g,"")).replace(/attribute\s+vec3\s+tangent;/g,"")).replace(/attribute\s+vec3\s+bitangent;/g,""),[l,c,d=qo.replaceMain(d,"czm_non_compressed_main"),"void main() \n{ \n"+u+"    czm_non_compressed_main(); \n}"].join("\n")}function Zo(e){return"varying vec4 v_pickColor;\n"+e}function $o(e,t){e.vertexAttributes}function Qo(e,t,i){const r=t.context,n=e._attributeLocations;let o=e._batchTable.getVertexShaderCallback()(i.vertexShaderSource);o=Bo._appendOffsetToShader(e,o),o=Bo._appendShowToShader(e,o),o=Bo._appendDistanceDisplayConditionToShader(e,o,t.scene3DOnly),o=Xo(o),o=Bo._updateColorAttribute(e,o,!1),o=Jo(e,o),o=Bo._modifyShaderPosition(e,o,t.scene3DOnly);var a,s,l=i.getFragmentShaderSource();l=Zo(l),e._sp=Ho.replaceCache({context:r,shaderProgram:e._sp,vertexShaderSource:o,fragmentShaderSource:l,attributeLocations:n}),$o(e._sp),Wo(e._depthFailAppearance)&&(o=e._batchTable.getVertexShaderCallback()(e._depthFailAppearance.vertexShaderSource),o=Bo._appendShowToShader(e,o),o=Bo._appendDistanceDisplayConditionToShader(e,o,t.scene3DOnly),o=Xo(o),o=Bo._updateColorAttribute(e,o,!0),o=Jo(e,o),o=Bo._modifyShaderPosition(e,o,t.scene3DOnly),s=o,o=qo.replaceMain(s,"czm_non_depth_clamp_main")+"void main() {\n    czm_non_depth_clamp_main();\n    gl_Position = czm_depthClamp(gl_Position);}\n",l=Zo(l=e._depthFailAppearance.getFragmentShaderSource()),a=l,l="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n"+qo.replaceMain(a,"czm_non_depth_clamp_main")+"void main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth)\n    #if defined(LOG_DEPTH)\n        czm_writeLogDepth();\n    #else\n        czm_writeDepthClamp();\n    #endif\n#endif\n}\n",e._spDepthFail=Ho.replaceCache({context:r,shaderProgram:e._spDepthFail,vertexShaderSource:o,fragmentShaderSource:l,attributeLocations:n}),$o(e._spDepthFail))}function Ko(){Go(),mo()}const{Matrix4:ea,BoundingSphere:ta}=Cesium;function ia(e,t,i){e.camera.flyToBoundingSphere(t,{duration:i.duration,maximumHeight:i.maximumHeight,endTransform:i.endTransform,offset:i.offset,complete:function(){e._zoomPromise.resolve(!0)},cancel:function(){e._zoomPromise.resolve(!1)},offset:i.offset})}let ra,na,oa=0,aa=0,sa="N/A",la="N/A";function ca(e){return null!=e&&"object"==typeof e&&"function"==typeof e.then}function ua(e,t,i,r){const n=Cesium.Cartesian3.fromDegrees(t,i,r),o=e.camera,a=o.heading,s=o.pitch,l=function(e,t,i){t=Cesium.Math.clamp(t,-Cesium.Math.PI_OVER_TWO,Cesium.Math.PI_OVER_TWO),e=Cesium.Math.zeroToTwoPi(e)-Cesium.Math.PI_OVER_TWO;const r=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,-t),n=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-e),o=Cesium.Quaternion.multiply(n,r,n),a=Cesium.Matrix3.fromQuaternion(o),s=Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_X);return Cesium.Matrix3.multiplyByVector(a,s,s),Cesium.Cartesian3.negate(s,s),Cesium.Cartesian3.multiplyByScalar(s,i,s),s}(a,s,2*r),c=Cesium.Transforms.eastNorthUpToFixedFrame(n);Cesium.Matrix4.multiplyByPoint(c,l,n),o.setView({destination:n,orientation:{heading:a,pitch:s},easingFunction:Cesium.EasingFunction.QUADRATIC_OUT})}function da(e,t){e.infoBox&&(t._infoBox=function(e){const t=document.createElement("div");t.className="cesium-viewer-infoBoxContainer",e.container.appendChild(t);const i=new Ir(t),r=i.viewModel;return e._eventHelper.add(r.cameraClicked,ma.prototype._onInfoBoxCameraClicked,e),e._eventHelper.add(r.closeClicked,ma.prototype._onInfoBoxClockClicked,e),e._enableInfoOrSelection=!0,i}(t))}function ha(e,t,i){const r=e._zoomPromise=Cesium.when.defer();return t.readyPromise.then((()=>{if(t._boundingSpheres)ia(e,ta.fromBoundingSpheres(t._boundingSpheres),i);else if(t.boundingSphere){let r=t.boundingSphere;r=ta.clone(r),t.modelMatrix&&ea.multiplyByPoint(t.modelMatrix,r.center,r.center),ia(e,r,i)}})),r}class ma extends Cesium.Viewer{constructor(e,t={}){t=Object.assign({animation:!1,timeline:!1,geocoder:!1,homeButton:!1,navigationHelpButton:!1,baseLayerPicker:!1,fullscreenElement:"cesiumContainer",fullscreenButton:!1,shouldAnimate:!1,infoBox:!1,selectionIndicator:!1,sceneModePicker:!1,shadows:!1,imageryProvider:ft(),contextOptions:{webgl:{alpha:!0,depth:!1,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0},allowTextureFilterAnisotropic:!0}},t),Cesium.Camera.DEFAULT_VIEW_RECTANGLE=Cesium.Rectangle.fromDegrees(70,5,130,60),!1===t.globe&&(t.imageryProvider=void 0);const i=Object.assign({},t,{infoBox:!1});i.globe?i.globe=new jn(i.globe._ellipsoid):!1!==i.globe&&(i.globe=new jn),super(e,i);const r=document.querySelector(".cesium-credit-logoContainer");if(r&&r.parentElement.removeChild(r),da(t,this),this._options=t,this.scene.postRender.addEventListener(this.update,this),this._distancePerPixel=void 0,this._extent=void 0,this._center=void 0,this._autoRotation=!1,this.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.scene.globe){const e=new mn({terrainProvider:this.terrainProvider,scene:this.scene}),t=new Cesium.QuadtreePrimitive({tileProvider:e});this.scene._LodGraphic=t}this.scene.dataSources=this.dataSources,this._graphicGroup=new ye(this)}get graphicGroup(){return this._graphicGroup}get massiveGraphicLayers(){return this.scene._LodGraphic.tileProvider._layers}get entities(){return super.entities}get primitives(){return this.scene.primitives}get enableLighting(){if(z(this.globe))return this.scene.globe.enableLighting}set enableLighting(e){z(this.globe)&&(this.scene.globe.enableLighting=e)}get autoRotation(){return this._autoRotation}set autoRotation(e){this._autoRotation=e}get fxaa(){return this.scene.postProcessStages.fxaa.enabled}set fxaa(e){this.scene.postProcessStages.fxaa.enabled=e}get distancePerPixel(){return this._distancePerPixel}get extent(){return this._extent}get center(){return this._center}get container(){return this._container}get layers(){return this.scene.imageryLayers}get dataSources(){return super.dataSources}get globe(){return this.scene.globe}get ellipsoid(){if(this.globe)return this.globe.ellipsoid}get terrain(){return this.terrainProvider}set terrain(e){z(e)&&!1!==e||(this.terrainProvider=new Cesium.EllipsoidTerrainProvider),e!==this.terrainProvider&&(this.terrainProvider=e)}get terrainChanged(){return this.scene.terrainProviderChanged}get terrainExaggeration(){if(this.globe)return this.globe.terrainExaggeration}set terrainExaggeration(e){e<0&&(e=0),this.globe&&(this.globe.terrainExaggeration=e)}get showFps(){return this.scene.debugShowFramesPerSecond}set showFps(e){this.scene.debugShowFramesPerSecond=e}get fps(){return this._fps+"FPS"}get ms(){return this._ms+"MS"}get heading(){return Cesium.Math.toDegrees(this.camera.heading)}get pitch(){return Cesium.Math.toDegrees(this.camera.pitch)}get roll(){return Cesium.Math.toDegrees(this.camera.roll)}get depthTest(){return this.scene.globe.depthTestAgainstTerrain}set depthTest(e){this.scene.globe.depthTestAgainstTerrain=e}addModel(e){this.primitives.add(e.delegate)}removeModel(e){this.primitives.remove(e.delegate)}setView(e){let t;e instanceof Cesium.Cartographic?t=he.fromCartographic(e):e instanceof Cesium.Cartesian3?t=he.fromCartesian(e):e instanceof he&&(t=e),t&&ua(this,t.lon,t.lat,t.alt)}stepFlyTo(e={}){let t;e.destination instanceof Cesium.Cartesian3?t=he.fromCartesian(e.destination):e.destination instanceof Cesium.Cartographic?t=he.fromCartographic(e.destination):e.destination instanceof he&&(t=e.destination),t&&(e.destination=t,function(e,t={}){const{camera:i}=e,r=k(t.step1Duration,3),n=k(t.step2Duration,3),o=k(t.step3Duration,3),a=t.destination,s=e.camera._positionCartographic.height,l=Cesium.Cartesian3.fromDegrees(a.lon,a.lat,s),c=t.destination.toCartesian();new Promise((e=>{i.flyTo({destination:l,duration:r,complete(){i.flyTo({destination:c,duration:n,complete(){i.flyTo({destination:c,orientation:t.orientation,duration:o,complete(){e()}})}})}})}))}(this,e))}linkView(e){if(!z(e))throw new t("viewer不是一个有效的Cesium.Viewer对象");return function(e,t){let i,r;return r=function r(n,o){return n.scene.postRender.addEventListener((()=>{const a=n.camera.positionWC,s=n.camera.heading,l=n.camera.pitch,c=n.camera.roll;i&&(i(),i=void 0),o.camera.flyTo({destination:a,orientation:{heading:s,pitch:l,roll:c},duration:0,complete:function(){i=r(t,e)},cancel:function(){i=r(t,e)}})}))}(e,t),function(){r&&r(),i&&i()}}(this,e)}flyTo(e,t={}){if(e instanceof he){const i=e.toCartesian();return this.flyTo(i,t)}if(e instanceof Cesium.Cartesian3){const i=viewer._zoomPromise=Cesium.when.defer(),r=k(t.radius,1e3);delete t.radius;return ia(this,new Cesium.BoundingSphere(e,r),t),i}return e instanceof Cesium.Primitive||e instanceof Cesium.Model?ha(this,e,t):e instanceof Ur?ha(this,e.delegate,t):e instanceof Br?super.flyTo(e.delegate,t):super.flyTo(e,t)}rotateAroundPoint(e,t={}){const i=this;let r;if(e instanceof Cesium.Cartesian3)r=e;else if(e instanceof Cesium.Cartographic)r=Cesium.Cartographic.toCartesian(e);else{if(!(e instanceof he))return;r=e.toCartesian()}const n=k(t.multiplier,1),o=k(t.offset,{});return this._cancelRotateAroundPoint&&(this._cancelRotateAroundPoint(),this._cancelRotateAroundPoint=void 0),this._cancelRotateAroundPoint=this.scene.postRender.addEventListener((function(){const e=Cesium.Math.toRadians(k(o.heading,i.heading)+1*n),t=Cesium.Math.toRadians(k(o.pitch,-20)),a=k(o.range,1e4);i.flyTo(r,{duration:0,offset:new Cesium.HeadingPitchRange(e,t,a)})})),this._cancelRotateAroundPoint}addLayer(e){return e instanceof Cesium.GeoJsonDataSource||e instanceof Cesium.KmlDataSource||e instanceof Cesium.CzmlDataSource||e instanceof Cesium.CustomDataSource||e instanceof li||e instanceof Pr||ca(e)?this.dataSources.add(e):this.layers.addImageryProvider(e)}removeLayer(e){if(ca(e))e.then((e=>{this.removeLayer(e)}));else{this.layers.remove(e)||this.dataSources.remove(e)}}pickLayer(e){const t=this.scene,i=t.camera.getPickRay(e);return this.layers.pickImageryLayerFeatures(i,t)}render(){super.render()}update(){const e=function(){z(ra)||(ra=Cesium.getTimestamp()),z(na)||(na=Cesium.getTimestamp()),oa++;const e=Cesium.getTimestamp();let t=(e-ra)/1e3;return t>1&&(sa=oa/t||0,ra=e,oa=0,sa=sa.toFixed(0)),aa++,t=e-na,t>100&&(la=t/aa,na=e,aa=0,la=la.toFixed(2)),{ms:la,fps:sa}}();this._fps=e.fps,this._ms=e.ms;const t=de(this);t&&(this._distancePerPixel=t),this._extent=ge(this),this._center=me(this),this._autoRotation&&function(e){if(!e||e.scene.mode!==Cesium.SceneMode.SCENE3D)return;const t=Cesium.Transforms.computeIcrfToFixedMatrix(e.clock.currentTime);if(z(t)){const i=e.camera,r=Cesium.Cartesian3.clone(i.position),n=Cesium.Matrix4.fromRotationTranslation(t);i.lookAtTransform(n,r)}}(this),this.graphicGroup.update()}resize(){super.resize()}forceResize(){super.forceResize()}destroy(){super.destroy()}isDestroyed(){return super.isDestroyed()}}Ko();const{Color:ga,MaterialAppearance:fa,CircleGeometry:pa,GroundPrimitive:_a,Primitive:va,GeometryInstance:ya,Material:Ca}=Cesium;class Sa extends _e{constructor(e){if(!z(e))throw new t("options must be provided.");if(!1===he.isValid(e.position))throw new t("options.position parameter is invalid.");if(isNaN(e.radius)&&e.radius<=0)throw new t("options.radius parameter must be a number greater than 0.");super(e),this._color=k(e.color,ga.WHITE),"string"==typeof this._color&&(this._color=ga.fromCssColorString(this._color)),this._position=e.position,this._radius=e.radius,this._stRotation=Cesium.Math.toRadians(k(e.stRotation,0)),this._height=k(e.height,0),this._extrudedHeight=k(e.extrudedHeight,0),this._asynchronous=k(e.asynchronous,!0),this._clampToGround?this.createGroundPrimitive():this.createPrimitive()}createPrimitive(){const e=new pa({center:he.toCartesian(this._position),radius:this._radius,stRotation:this._stRotation,extrudedHeight:this._extrudedHeight,height:this._height});this._primitive=new va({geometryInstances:new ya({geometry:e}),appearance:this.createAppearance(),asynchronous:this._asynchronous})}createGroundPrimitive(){const e=new pa({center:he.toCartesian(this._position),radius:this._radius,stRotation:this._stRotation,extrudedHeight:this._extrudedHeight,height:this._height});this._primitive=new _a({geometryInstances:new ya({geometry:e}),appearance:this.createAppearance(),asynchronous:this._asynchronous})}createAppearance(){return z(this._appearance)||(this._appearance=new fa({material:Ca.fromType("Color",{color:this._color})})),this._appearance}get position(){return this._position}set position(e){he.isValid(e)&&(this.definedChanged.raise("position",e,this._position),this._position=e,this.updatePrimitive())}get radius(){return this._radius}set radius(e){!e!==this._radius&&(this.definedChanged.raise("radius",e,this._radius),this._radius=e,this.updatePrimitive())}get color(){if(z(this._color))return this._color.toCssColorString()}set color(e){this.definedChanged.raise("color",e,this._color),this._color="string"==typeof e?Cesium.Color.fromCssColorString(e):e,this.updateAttribute("color",this._color)}toJson(){return{position:this._position.toArray(),radius:this.radius,clampToGround:this.clampToGround}}updatePrimitive(){if(!this._viewer)return;const e=this.primitive,t=Object.assign(this.toJson(),{asynchronous:!1});t.position=he.fromArray(t.position),this._primitive=new this.constructor(t).primitive,this._viewer.primitives.add(this._primitive),this._viewer.primitives.remove(e)}}const ba="\n    czm_material czm_getMaterial(czm_materialInput materialInput) {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = materialInput.st;\n        float imageColor = texture2D(image, st);\n        material.alpha = 1.0;\n        return material;\n    }\n",{MaterialAppearance:wa,Material:xa}=Cesium;const Ea=33746824,Ta=33554054;const{BingMapsImageryProvider:Pa,BingMapsStyle:La}=Cesium;class Aa extends Pa{constructor(e={}){e.url="https://dev.virtualearth.net",e.mapStyle=k(e.mapStyle,Aa.mapStyle.AERIAL),e.key=k(e.key,"AqMhBWJKbBPBtoWEvtGdUii6XSkDCJ3vWFpOVWzplD-Q0J-ECUF6i8MGXpew8bkc"),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}static tileXYToQuadKey(e,t,i){return Pa.tileXYToQuadKey(e,t,i)}static quadKeyToTileXY(e){return Pa.quadKeyToTileXY(e)}static mapStyle=La}class Ma extends gt{constructor(e){e=k(e,{});const t=k(e.layer,"img"),{scl:i,style:r}=Ma.getParametersByLayer(t),n=k(e.lang,"zh_cn");e.url=`https://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=${n}&size=1&scl=${i}&style=${r}`,e.subdomains="1234",super(e)}static layers=[{layer:"img",desc:"影像地图"},{layer:"vec",desc:"矢量地图"},{layer:"vei",desc:"矢量地图（含注记）"},{layer:"roa",desc:"路网地图"},{layer:"roi",desc:"路网地图（含注记）"}];static getParametersByLayer(e){let t={scl:1,style:6};switch(e){case"img":break;case"vec":t.scl=2,t.style=7;break;case"vei":t.scl=1,t.style=7;break;case"roa":t.scl=2,t.style=8;break;case"roi":t.scl=1,t.style=8}return t}}const{WebMapTileServiceImageryProvider:Ra}=Cesium;class Da extends Ra{constructor(e={}){super(e)}get dimensions(){return super.dimensions}set dimensions(e){super.dimensions=e}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}const Na={map:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=1&version=297",road:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=2&version=297",img:"https://p{s}.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{reverseY}.jpg?version=229"};const{when:Fa,Rectangle:Oa}=Cesium;class Ia extends Cesium.TileMapServiceImageryProvider{constructor(e){super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}const{Resource:ka}=Cesium;class za extends Cesium.WebMapServiceImageryProvider{constructor(e={}){z(e.parameters)||(e.parameters=za.DefaultParameters),z(e.GetFeatureInfoDefaultParameters),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,i,r,n){return super.pickFeatures(e,t,i,r,n)}requestImage(e,t,i,r){return super.requestImage(e,t,i,r)}}za.DefaultParameters=Object.assign({transparent:!0},Cesium.WebMapServiceImageryProvider.DefaultParameters,{format:"image/png"}),za.GetFeatureInfoDefaultParameters=Cesium.WebMapServiceImageryProvider.GetFeatureInfoDefaultParameters;const{AssociativeArray:Ua,destroyObject:Ga,CustomDataSource:Ba,Event:Ha}=Cesium,Wa=function(){},ja=[31638318];for(let e=1;e<20;e++)ja.push(ja[e-1]/2);function Va(e){let t=0;for(let i of ja){if(e>i)break;t++}return t}class qa extends Hr{constructor(e={}){super(e),this._id=k(e.id,fe()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new Ha,this._maxClusterLevel=k(e.maxClusterLevel,12),this._minLoadLevel=k(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={}}get id(){return this._id}get dataSource(){return this._dataSource}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=Va(e),i=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,i)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){Va(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=Va(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){this._dataSource||(this._scene=t,this._dataSource=new Ba("massive-layer"+fe()),this._scene.dataSources.add(this._dataSource))}createGeometry(e,t,i){if(e.level<this._minLoadLevel)return;const r=k(this._createGeometryFunction,Wa)(i),n=Object.keys(i);for(let e of n)"position"!==e&&"id"!==e&&"cartesian"!==e&&"cartographic"!==e&&"label"!==e&&"billboard"!==e&&"__pixel"!==e&&(r[e]=i[e]);return this.add(r),r}removeGeometry(e,t){if(!t)return;const i=this._dataSource.entities.remove(t);return Ga(t),i}add(e){this._dataSource&&e&&this._dataSource.entities.add(e)}removeAll(){this._dataSource.entities.removeAll()}isDestroyed(){return!1}destroy(){this._dataSource.removeAll(),Ga(this)}}const{QuadtreeTileProvider:Ya,GeographicTilingScheme:Xa,when:Ja,Event:Za,Cartographic:$a,Color:Qa,Entity:Ka}=Cesium;const{destroyObject:es,Event:ts,Transforms:is}=Cesium,rs=function(e,t){const i={};if(e.modelMatrix)i.modelMatrix=e.modelMatrix;else if(e.position){let t=e.position;if(e.position instanceof he&&(t=e.position.toCartesian()),!t)return;i.modelMatrix=is.eastNorthUpToFixedFrame(t),e.modelMatrix=i.modelMatrix}return i.minimumPixelSize=k(e.minimumPixelSize,t.minimumPixelSize),i.maximumScale=k(e.maximumScale,t.maximumScale),i.scale=k(e.scale,t.scale),i.allowPicking=k(e.allowPicking,t.allowPicking),i.shadows=k(e.shadows,t.shadows),i.id=e._id,i.url=k(e.url,t.url),Cesium.Model.fromGltf(i)},ns=[31638318];for(let e=1;e<20;e++)ns.push(ns[e-1]/2);function os(e){let t=0;for(let i of ns){if(e>i)break;t++}return t}const{QuadtreeTileProvider:as,GeographicTilingScheme:ss,when:ls,Event:cs,Cartographic:us,Color:ds,Entity:hs}=Cesium;const{ShaderSource:ms}=Cesium;e.BaiDuLayer=class extends gt{constructor(e){(e=k(e,{})).url=k(e.url,"http://maponline{s}.bdimg.com/tile/?qt=vtile&styles=pl&scaler=1&udt=20200102"),e.customid&&(e.url=`https://api.map.baidu.com/customimage/tile?customid=${e.customid}`);const t=new Cesium.Cartesian2(-Ta,-Ea),i=new Cesium.Cartesian2(Ta,Ea);e.tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:i}),e.subdomains="123",super(e),this._rectangle=this._tilingScheme.rectangle}requestImage(e,t,i){const r=function(e,t,i,r){let n=e.url+"&x={x}&y={y}&z={z}";const o=e._tilingScheme.getNumberOfXTilesAtLevel(r),a=e._tilingScheme.getNumberOfYTilesAtLevel(r),s=4*Math.random()|0;return n=n.replace("{s}",s).replace("{x}",t-o/2).replace("{y}",a/2-i-1).replace("{z}",r),n}(this,e,t,i);return Cesium.ImageryProvider.loadImage(this,r)}},e.BingLayer=Aa,e.CesiumProError=t,e.CesiumProTerrainProvider=A,e.Cluster=class{constructor(e,t={}){this._objects=k(t.objects,[]),this._getScreenBoundingBox=k(t.getScreenBoundingBox,ce),this._scene=e,this.clusterSize=3,this.pixelRange=50,this._clusterObjects=[]}get objects(){return this._objects}set objects(e){this._objects=e}_clearCluster(){this._objects.map((e=>e.cluster=!1)),this._clusterObjects=[]}update(){const e=this._objects;this._clearCluster();const t=function(e,t){const i=[],r=new ae(t.globe.ellipsoid,t.camera.positionWC);for(let n of e)n.position&&(t.mode!==oe.SCENE3D||r.isPointVisible(n.position))&&(n.__pixel=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,n.position),n.__pixel&&i.push(n));return i}(e,this._scene),i=new ee(t,se,le,64,Int32Array);for(let e of t){if(e.cluster)continue;const r=this._getScreenBoundingBox(e,e.__pixel),n=ne.clone(r,new ne);e.cluster=!0;const o=i.range(r.x,r.y,r.x+r.width,r.y+r.height),a=o.length,s=te.clone(e.position);let l,c=1;const u=[];for(let e=0;e<a;e++){const i=t[o[e]];if(i.cluster)continue;u.push(i.id),i.cluster=!0;const r=this._getScreenBoundingBox(i,i.__pixel);te.add(i.position,s,s),ne.union(n,r,n),c++,l=i}c>=this.clusterSize?(te.multiplyByScalar(s,1/c,s),this._clusterObjects.push({position:new te(s.x,s.y,s.z),number:c,ids:u,id:l.id+c})):this._clusterObjects.push(e)}}},e.Event=r,e.GaoDeLayer=Ma,e.GeoJsonDataSource=li,e.Globe=jn,e.Graphic=_e,e.GraphicGroup=ye,e.GroundSkyBox=class{constructor(e={}){this.sources=be(e.sources,{positiveX:X.buildModuleUrl("./assets/skybox/px.png"),negativeX:X.buildModuleUrl("./assets/skybox/nx.png"),positiveY:X.buildModuleUrl("./assets/skybox/py.png"),negativeY:X.buildModuleUrl("./assets/skybox/ny.png"),positiveZ:X.buildModuleUrl("./assets/skybox/pz.png"),negativeZ:X.buildModuleUrl("./assets/skybox/nz.png")}),this._sources=void 0,this.show=be(e.show,!0),this._command=new Ee({modelMatrix:xe.clone(xe.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0,this._isDestroyed=!1}update(e,i){const r=new Be,n=this;if(!this.show)return;if(e.mode!==ze.SCENE3D&&e.mode!==ze.MORPHING)return;if(!e.passes.render)return;const{context:o}=e;if(this._sources!==this.sources){this._sources=this.sources;const{sources:e}=this;if(!(Le(e.positiveX)&&Le(e.negativeX)&&Le(e.positiveY)&&Le(e.negativeY)&&Le(e.positiveZ)&&Le(e.negativeZ)))throw new t("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof e.positiveX!=typeof e.negativeX||typeof e.positiveX!=typeof e.positiveY||typeof e.positiveX!=typeof e.negativeY||typeof e.positiveX!=typeof e.positiveZ||typeof e.positiveX!=typeof e.negativeZ)throw new t("this.sources properties must all be the same type.");"string"==typeof e.positiveX?Fe(o,this._sources).then((e=>{n._cubeMap=n._cubeMap&&n._cubeMap.destroy(),n._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Ne({context:o,source:e}))}const a=this._command;if(a.modelMatrix=Me.eastNorthUpToFixedFrame(e.camera._positionWC),!Le(a.vertexArray)){a.uniformMap={u_cubeMap:()=>n._cubeMap,u_rotateMatrix:()=>"function"==typeof xe.getRotation?xe.getRotation(a.modelMatrix,r):xe.getMatrix3(a.modelMatrix,r)};const e=Te.createGeometry(Te.fromDimensions({dimensions:new Pe(2,2,2),vertexFormat:Re.POSITION_ONLY})),t=this._attributeLocations=Ae.createAttributeLocations(e);a.vertexArray=Ie.fromGeometry({context:o,geometry:e,attributeLocations:t,bufferUsage:De._DRAW}),a.renderState=Oe.fromCache({blending:ke.ALPHA_BLEND})}if(!Le(a.shaderProgram)||this._useHdr!==i){const e=new Ge({defines:[i?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  "]});a.shaderProgram=Ue.fromCache({context:o,vertexShaderSource:"attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",fragmentShaderSource:e,attributeLocations:this._attributeLocations}),this._useHdr=i}return Le(this._cubeMap)?a:void 0}isDestroyed(){return this._isDestroyed}destroy(){const e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),we(this)}},e.ImagerySplitDirection=He,e.InfoBox=Ir,e.LonLat=he,e.LonLatNetLayer=class{constructor(e={}){const t=new Xe({rectangle:Cesium.Rectangle.MAX_VALUE,intervalOfZeorLevel:e.intervalOfZeorLevel});this._hasAlphaChannel=k(e.hasAlphaChannel,!0),this._tilingScheme=t,this._image=void 0,this._texture=void 0,this._errorEvent=new r,this._ready=!0,this._readyPromise=Cesium.when.defer(),this._readyPromise.resolve(!0),this._font=k(e.font,"bold 24px sans-serif"),this._color=k(e.color,"white"),this._borderColor=k(e.borderColor,"gold"),this._borderWidth=k(e.borderWidth,2),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=256,this.canvas.height=256,this.ctx.textBaseline="middle"}get hasAlphaChannel(){return this._hasAlphaChannel}get tileHeight(){return 256}get tileWidth(){return 256}get minimumLevel(){return 0}get maximumLevel(){return 4}get rectangle(){return Cesium.Rectangle.MAX_VALUE}get errorEvent(){return this._errorEvent}get tileDiscardPolicy(){}get readyPromise(){return this._readyPromise}get ready(){return!0}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}_resetStyle(){this.ctx.font=this.font,this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.borderColor,this.ctx.lineWidth=this.borderWidth}_clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getOffset(e,t,i){const r=this.tilingScheme.getDelatXY(i),n=Math.floor(e),o=Math.floor(t);if(n===e&&o===t)return[0,0,n,o];const a=e-n,s=t-o;let l=0,c=0;return a&&(l=this.tileWidth/r.dx*a),s&&(c=this.tileHeight/r.dy*s),[l,c,n,o]}requestImage(e,t,i,r){this._clearCanvas(),this._resetStyle();const{canvas:n,ctx:o}=this,a=this.tilingScheme.getLonLatValuee(i,e,t);return this.tilingScheme.tileXYToNativeRectangle(e,t,i),this.ctx.textAlign="left",o.fillText(a.lon,10,n.height/2),this.ctx.textAlign="center",o.fillText(a.lat,n.width/2,20),o.strokeRect(0,0,n.width,n.height),n}},e.LonlatTilingScheme=Xe,e.MassiveBillboardLayer=class extends qa{constructor(e={}){e.objects=k(e.objects,[]),e.pixelSize=k(e.pixelSize,5),e.color=k(e.color,Qa.fromRandom),e.createGeometryFunction=k(e.createGeometryFunction,function(e){return function(t){const i={id:t.id,position:t.position,point:{pixelSize:k(t.pixelSize,e.pixelSize),color:k(t.color,e.color)}};return t.label&&(i.label={text:t.label}),new Ka(i)}}(e)),super(e)}},e.MassiveEntityLayer=qa,e.MassiveGraphicLayer=Hr,e.MassiveGraphicLayerCollection=jr,e.MassiveModelLayer=class extends Hr{constructor(e={}){e.objects.forEach((e=>{e._id=e.id,delete e.id})),super(e),this._id=k(e.id,fe()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new ts,this._maxClusterLevel=k(e.maxClusterLevel,12),this._minLoadLevel=k(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={},this._options=e}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=os(e),i=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=i!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,i)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){os(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=os(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){if(!this._collection){this._scene=t;const e=new Cesium.PrimitiveCollection;t.primitives.add(e),this._collection=e}}createGeometry(e,t,i){if(e.level<this._minLoadLevel)return;const r=k(this._createGeometryFunction,rs)(i,this._options);return this.add(r),r}removeGeometry(e,t){if(!t)return;return this._collection.remove(t)}add(e){this._collection&&e&&this._collection.add(e)}removeAll(){this._collection.removeAll()}isDestroyed(){return!1}destroy(){this._collection.removeAll(),es(this)}},e.MassivePointLayer=class extends qa{constructor(e={}){e.objects=k(e.objects,[]),e.pixelSize=k(e.pixelSize,5),e.color=k(e.color,ds.fromRandom),e.createGeometryFunction=k(e.createGeometryFunction,function(e){return function(t){const i={id:t.id,position:t.position,point:{pixelSize:k(t.pixelSize,e.pixelSize),color:k(t.color,e.color)}};return t.label&&(i.label={text:t.label}),new hs(i)}}(e)),super(e)}},e.Model=Ur,e.MultipleTerrainProvider=class{constructor(e,t={}){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=t.ellipsoid,this._requestVertexNormals=k(t.requestVertexNormals,!1),this._requestWaterMask=k(t.requestWaterMask,!1),this._requestMetadata=k(t.requestMetadata,!0),this._errorEvent=new r,this._terrainProviders=[];const i=[];for(let r of e){r.requestVertexNormals=r.requestVertexNormals||t.requestVertexNormals,r.requestWaterMask=r.requestWaterMask||t.requestWaterMask,r.requestMetadata=r.requestMetadata||t.requestMetadata;const e=new A(r);e.zIndex=r.zIndex||-1,this._terrainProviders.push(e),i.push(ot(e,r.url))}this._ready=!1,this._readyPromise=Ze.defer(),this._terrainList=e,Promise.all([...this._terrainProviders.map((e=>e.readyPromise)),...i]).then((e=>{this._ready=!0,this._readyPromise.resolve(!0),this._tilingScheme=this._terrainProviders[0]._tilingScheme,this._levelZeroMaximumGeometricError=$e.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0))})),this._validProvider=void 0}get tilingScheme(){return this._tilingScheme}get ready(){return this._ready}get readyPromise(){return this._readyPromise}createBoundingRectangle(e){const t=new Ke("multiple-terrain-provider");for(let e of this._terrainProviders)t.entities.add(nt(e));return e.addLayer(t),function(){const t=e.dataSources.getByName("multiple-terrain-provider");e.dataSources.remove(t[0])}}getLevelMaximumGeometricError(e){return this._validProvider?this._validProvider.getLevelMaximumGeometricError(e):this._levelZeroMaximumGeometricError/(1<<e)}getTileDataAvailable(e,t,i){const r=this._terrainProviders.filter((r=>r.getTileDataAvailable(e,t,i))).sort(((e,t)=>t.zIndex-e.zIndex));return this._validProvider=r[0],!!this._validProvider}requestTileGeometry(e,t,i,r){for(let r of this._terrainProviders)r!==this._validProvider&&r.getTileDataAvailable(e,t,i)&&r.requestTileGeometry(e,t,i);if(this._validProvider)return this._validProvider.requestTileGeometry(e,t,i)}},e.PbfDataSource=function(){},e.PointBaseGraphic=Sa,e.Primitive=function(){Object.defineProperty(Bo.prototype,"needUpdate",{get(){return!!this._needUpdate},set(e){this._needUpdate=e}}),Bo.prototype.update=function(e){if(Yo.call(this,e),this.needUpdate){var t=Vo(this._createShaderProgramFunction,Qo);console.log("update shader"),t(this,e,appearance),this.needUpdate=!1}}},e.QuadTreeProvider=mn,e.RadarScanGraphic=class extends Sa{constructor(e){super(e),this.speed=k(e.speed,1e3)}createAppearance(){return this._appearance||(this._appearance=new wa({material:new xa({fabric:{uniforms:{image:X.buildModuleUrl("./assets/img/radarScan.png")}},source:ba})})),this._appearance}},e.Scene=Go,e.Selection=mt,e.ShaderProgram=mo,e.ShapefileDataSource=Pr,e.TDTLayer=class extends Da{constructor(e){const t=(e=k(e,{})).key;t||(console.warn("未定义key，地图服务将不可用"),console.warn("请前往http://lbs.tianditu.gov.cn/server/MapService.html获取地图key"));const i=k(e.tilingScheme,new Cesium.WebMercatorTilingScheme);let r="w",n="w",o=e.tileMatrixLabels;i instanceof Cesium.GeographicTilingScheme&&(r="c",n="c",z(o)||(o=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]));const a=k(e.layer,"img"),s=`http://t{s}.tianditu.com/${a}_${r}/wmts?service=wmts&tileMatrixSet=${n}&request=GetTile&version=1.0.0&LAYER=${a}&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=${t}`;return new Cesium.WebMapTileServiceImageryProvider({url:s,layer:a,style:e.style||"default",format:e.format||"tiles",tileMatrixSetID:"GoogleMapsCompatible",credit:e.credit?new Cesium.Credit(e.credit||""):null,tilingScheme:e.tilingScheme,maximumLevel:e.maximumLevel||19,minimumLevel:e.minimumLevel||0,tileMatrixLabels:o,subdomains:"01234567"})}static layers=[{layer:"vec",desc:"矢量底图"},{layer:"cva",desc:"矢量注记"},{layer:"img",desc:"影像底图"},{layer:"cia",desc:"影像注记"},{layer:"ter",desc:"地形晕渲"},{layer:"cta",desc:"地形注记"},{layer:"ibo",desc:"全球境界"},{layer:"eva",desc:"矢量英文注记"},{layer:"eia",desc:"影像英文注记"}]},e.TMSLayer=Ia,e.TaskProcessor=class{constructor(e,t={}){this._workers=[],this._workerPath="workers/"+e,this._options=t,Math.max(J.hardwareConcurrency-1,1),this._worker=K(this)}},e.TecentLayer=class extends gt{constructor(e={}){e.layer=k(e.layer,"img"),e.subdomains="123",e.url=Na[e.layer],e.customTags={sx:function(e,t,i,r){return t>>4},sy:function(e,t,i,r){return(1<<r)-i>>4}},super(e)}},e.TileDebugLayer=class{constructor(e={}){e.tileWidth=k(e.tileWidth,256),e.tileHeight=k(e.tileHeight,256),this._tilingScheme=z(e.tilingScheme)?e.tilingScheme:dt.get("EPSG:4326",{ellipsoid:e.ellipsoid}),this._errorEvent=new r,this._tileWidth=k(e.tileWidth,256),this._tileHeight=k(e.tileHeight,256),this._readyPromise=Cesium.when.resolve(!0),this._font=k(e.font,"bold 24px sans-serif"),this._color=k(e.color,new Cesium.Color(1,1,1,1)),this._borderColor=k(e.borderColor,Cesium.Color.GOLD),this._borderWidth=k(e.borderWidth,2)}get ready(){return!0}get readyPromise(){return this._readyPromise}get hasAlphaChannel(){return!0}get errorEvent(){return this._errorEvent}get rectangle(){return this._tilingScheme.rectangle}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}createCanvas(){const e=document.createElement("canvas");e.width=this.tileWidth,e.height=this.tileHeight;const t=e.getContext("2d");return t.textBaseline="middle",t.textAlign="center",t.font=this.font,t.fillStyle=this.color.toCssColorString(),t.strokeStyle=this.borderColor.toCssColorString(),t.lineWidth=this.borderWidth,{canvas:e,ctx:t}}requestImage(e,t,i,r){const{canvas:n,ctx:o}=this.createCanvas(),a=function(e,t,i,r){let n=[];return n[0]="L: "+r,n[1]="X: "+t,e.reverseY?n[2]="Y: "+e.tilingScheme.getNumberOfYTilesAtLevel(r)-i-1:n[2]="Y: "+i,n}(this,e,t,i);return o.fillText(a[0],n.width/2,n.height/4*1),o.fillText(a[1],n.width/2,n.height/4*2),o.fillText(a[2],n.width/2,n.height/4*3),o.strokeRect(0,0,n.width,n.height),n}},e.TileLayer=class{constructor(e={}){this._errorEvent=new r,this._tilingScheme=dt.get("EPSG:4326"),this._readyPromise=Fa.defer(),this._ready=!1,this._ready=!0,this._minimumLevel=k(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._tileWidth=k(e.tileWidth,256),this._tileHeight=k(e.tileHeight,256),this._rectangle=k(e.rectangle,Oa.MAX_VALUE),this._readyPromise.resolve(!0),this._errorEvent.addEventListener(((e,t,i)=>{}))}get minimumLevel(){return this._minimumLevel}get maximumLevel(){return this._maximumLevel}get errorEvent(){return this._errorEvent}get rectangle(){return this._rectangle}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get tilingScheme(){return this._tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}get tileHeight(){return this._tileHeight}get tileWidth(){return this._tileWidth}pickFeatures(e,t,i,r,n){}requestImage(e,t,i,r){return this.requestGeometry(e,t,i),Promise.reject(!1)}requestGeometry(e,t,i){}},e.Tileset=Br,e.Url=X,e.VERSION="1.0.3",e.Viewer=ma,e.WFSLayer=class{constructor(e={}){if(this._url=e.url,this._typeName=e.typeName,this._style=e.style,!z(this._url))throw new t("parameter url must be provided.");if(!z(this._typeName))throw new t("parameter typeName must be provided.");const i=new ka({url:e.url,queryParameters:{service:"WFS",version:"1.0.0",request:"GetFeature",typeName:e.typeName,maxFeatures:50,outputFormat:"application/json"}});return li.load(i,this._style)}get rectangle(){return this._rectangle||this.tilingScheme.rectangle}get tilingScheme(){return dt.get("EPSG:4326")}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get ready(){return this._ready}get readyPromise(){return this._readyPromise}},e.WMSLayer=za,e.WMTSLayer=Da,e.XYZLayer=gt,e._shaderBuildUniforms=function(e,t){ms._czmBuiltinsAndUniforms[e]=t},e._shaderGlobeFS=gn,e._shaderGroundSkyBoxFS=Ce,e._shaderGroundSkyBoxVS=Se,e._shaderLine=function(){},e._shaderRadarScan=ba,e.computeDistancePerPixel=de,e.computeSceneCenterPoint=me,e.computeSceneExtent=ge,e.createDefaultLayer=ft,e.createGuid=fe,e.dateFormat=pe,e.defaultValue=k,e.defined=z,e.index=Ko,e.proj=dt,Object.defineProperty(e,"__esModule",{value:!0})}));
