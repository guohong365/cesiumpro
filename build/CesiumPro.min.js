!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CesiumPro={})}(this,(function(e){"use strict";class t extends Error{constructor(e){super(e),this.name="CesiumProError"}}function r(e,t){return t-e}t.throwNoInstance=function(){throw new t("它的定义了一个接口，不能被以直接调用.")};class i{constructor(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}get numberOfListeners(){return this._listeners.length-this._toRemove.length}addEventListener(e,r){if("function"!=typeof e)throw new t("侦听器应该是一个函数");this._listeners.push(e),this._scopes.push(r);const i=this;return function(){i.removeEventListener(e,r)}}removeEventListener(e,r){if("function"!=typeof e)throw new t("侦听器应该是一个函数");const i=this._listeners,n=this._scopes;let o=-1;for(let t=0;t<i.length;t++)if(i[t]===e&&n[t]===r){o=t;break}return-1!==o&&(this._insideRaiseEvent?(this._toRemove.push(o),i[o]=void 0,n[o]=void 0):(i.splice(o,1),n.splice(o,1)),!0)}raise(){let e;this._insideRaiseEvent=!0;const t=this._listeners,i=this._scopes;let{length:n}=t;for(e=0;e<n;e++){const r=t[e];Cesium.defined(r)&&t[e].apply(i[e],arguments)}const o=this._toRemove;if(n=o.length,n>0){for(o.sort(r),e=0;e<n;e++){const r=o[e];t.splice(r,1),i.splice(r,1)}o.length=0}this._insideRaiseEvent=!1}}const{RequestState:n,when:o,AttributeCompression:s,BoundingSphere:a,Cartesian3:l,Credit:c,defaultValue:u,defined:h,DeveloperError:d,GeographicTilingScheme:m,WebMercatorTilingScheme:g,getJsonFromTypedArray:f,HeightmapTerrainData:p,IndexDatatype:v,OrientedBoundingBox:y,QuantizedMeshTerrainData:_,Request:C,RequestType:w,Resource:b,RuntimeError:S,TerrainProvider:x,TileAvailability:P,TileProviderError:E}=Cesium;function T(e){this.resource=e.resource,this.version=e.version,this.isHeightmap=e.isHeightmap,this.tileUrlTemplates=e.tileUrlTemplates,this.availability=e.availability,this.hasVertexNormals=e.hasVertexNormals,this.hasWaterMask=e.hasWaterMask,this.hasMetadata=e.hasMetadata,this.availabilityLevels=e.availabilityLevels,this.availabilityTilesLoaded=e.availabilityTilesLoaded,this.littleEndianExtensionSize=e.littleEndianExtensionSize,this.availabilityPromiseCache={}}function L(e){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=e.ellipsoid,this._requestVertexNormals=u(e.requestVertexNormals,!1),this._requestWaterMask=u(e.requestWaterMask,!1),this._requestMetadata=u(e.requestMetadata,!0),this._errorEvent=new i;var t=e.credit;"string"==typeof t&&(t=new c(t)),this._credit=t,this._availability=void 0;var r=o.defer();this._ready=!1,this._readyPromise=r,this._tileCredits=void 0;var n,s,a,l=this,d=this._layers=[],f="",p=[],v=0;function y(e){var t;if(!e.format)return t="The tile format is not specified in the layer.json file.",void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,S));if(!e.tiles||0===e.tiles.length)return t="The layer.json file does not specify any tile URL templates.",void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,S));var r=!1,i=!1,c=!1,u=!0,C=!1;if("heightmap-1.0"===e.format)C=!0,h(l._heightmapStructure)||(l._heightmapStructure={heightScale:.2,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),i=!0,l._requestWaterMask=!0;else if(0!==e.format.indexOf("quantized-mesh-1."))return t='The tile format "'+e.format+'" is invalid or not supported.',void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,S));var w,b=e.tiles,L=e.maxzoom;if(v=Math.max(v,L),e.projection&&"EPSG:4326"!==e.projection){if("EPSG:3857"!==e.projection)return t='The projection "'+e.projection+'" is invalid or not supported.',void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,S));l._tilingScheme=new g({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid})}else l._tilingScheme=new m({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid});if(l._levelZeroMaximumGeometricError=x.getEstimatedLevelZeroGeometricErrorForAHeightmap(l._tilingScheme.ellipsoid,l._heightmapWidth,l._tilingScheme.getNumberOfXTilesAtLevel(0)),e.scheme&&"tms"!==e.scheme&&"slippyMap"!==e.scheme)return t='The scheme "'+e.scheme+'" is invalid or not supported.',void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,S));l._scheme=e.scheme,h(e.extensions)&&-1!==e.extensions.indexOf("octvertexnormals")?r=!0:h(e.extensions)&&-1!==e.extensions.indexOf("vertexnormals")&&(r=!0,u=!1),h(e.extensions)&&-1!==e.extensions.indexOf("watermask")&&(i=!0),h(e.extensions)&&-1!==e.extensions.indexOf("metadata")&&(c=!0);var M,A=e.metadataAvailability,R=e.available;if(h(R)&&!h(A)){M=new P(l._tilingScheme,R.length);for(var k=0;k<R.length;++k){var D=R[k],F=l._tilingScheme.getNumberOfYTilesAtLevel(k);h(p[k])||(p[k]=[]);for(var B=0;B<D.length;++B){var U=D[B],O=F-U.endY-1,N=F-U.startY-1;p[k].push([U.startX,O,U.endX,N]),M.addAvailableTileRange(k,U.startX,O,U.endX,N)}}}else h(A)&&(w=new P(l._tilingScheme,L),M=new P(l._tilingScheme,L),p[0]=[[0,0,1,0]],M.addAvailableTileRange(0,0,0,1,0));l._hasWaterMask=l._hasWaterMask||i,l._hasVertexNormals=l._hasVertexNormals||r,l._hasMetadata=l._hasMetadata||c,h(e.attribution)&&(f.length>0&&(f+=" "),f+=e.attribution),d.push(new T({resource:n,version:e.version,isHeightmap:C,tileUrlTemplates:b,availability:M,hasVertexNormals:r,hasWaterMask:i,hasMetadata:c,availabilityLevels:A,availabilityTilesLoaded:w,littleEndianExtensionSize:u}));var G=e.parentUrl;if(h(G)){if(!h(M))return console.log("A layer.json can't have a parentUrl if it does't have an available array."),o.resolve();(n=n.getDerivedResource({url:G})).appendForwardSlash();var W=(s=n.getDerivedResource({url:"layer.json"})).fetchJson();return o(W,y,_)}return o.resolve()}function _(e){var t="An error occurred while accessing "+s.url+".";a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,S)}function C(e){y(e).then((function(){if(!h(a)){var e=p.length;if(e>0)for(var t=l._availability=new P(l._tilingScheme,v),r=0;r<e;++r)for(var i=p[r],n=0;n<i.length;++n){var o=i[n];t.addAvailableTileRange(r,o[0],o[1],o[2],o[3])}if(f.length>0){var s=new c(f);h(l._tileCredits)?l._tileCredits.push(s):l._tileCredits=[s]}l._ready=!0,l._readyPromise.resolve(!0)}}))}function w(e){h(e)&&404===e.statusCode?C({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]}):_()}function S(){o(s.fetchJson()).then(C).otherwise(w)}o(e.url).then((function(e){var t=b.createIfNeeded(e);t.appendForwardSlash(),s=(n=t).getDerivedResource({url:"layer.json"}),l._tileCredits=t.credits,S()})).otherwise((function(e){r.reject(e)}))}var M=1,A=2,R=4;function k(e){return h(e)&&0!==e.length?{Accept:"application/vnd.quantized-mesh;extensions="+e.join("-")+",application/octet-stream;q=0.9,*/*;q=0.01"}:{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"}}function D(e,t,r,i,c,u){if(!h(c))return o.reject(new S("Terrain tile doesn't exist"));var d=c.tileUrlTemplates;if(0!==d.length){var m;if(e._scheme&&"tms"!==e._scheme)m=r;else m=e._tilingScheme.getNumberOfYTilesAtLevel(i)-r-1;var g,C,w=[];e._requestVertexNormals&&c.hasVertexNormals&&w.push(c.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),e._requestWaterMask&&c.hasWaterMask&&w.push("watermask"),e._requestMetadata&&c.hasMetadata&&w.push("metadata");var b=d[(t+m+i)%d.length],x=c.resource;h(x._ionEndpoint)&&!h(x._ionEndpoint.externalType)?(0!==w.length&&(C={extensions:w.join("-")}),g=k(void 0)):g=k(w);var P=x.getDerivedResource({url:b,templateValues:{version:c.version,z:i,x:t,y:m},queryParameters:C,headers:g,request:u});if(P.request.state!==n.ISSUED&&P.request.state!==n.ACTIVE){var E=P.fetchArrayBuffer();if(h(E))return E.then((function(n){return h(e._heightmapStructure)?function(e,t,r,i,n){var o=new Uint16Array(t,0,e._heightmapWidth*e._heightmapWidth);return new p({buffer:o,childTileMask:new Uint8Array(t,o.byteLength,1)[0],waterMask:new Uint8Array(t,o.byteLength+1,t.byteLength-o.byteLength-1),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure,credits:e._tileCredits})}(e,n):function(e,t,r,i,n,o){var c=o.littleEndianExtensionSize,u=0,d=3*Float64Array.BYTES_PER_ELEMENT,m=4*Float64Array.BYTES_PER_ELEMENT,g=3*Uint16Array.BYTES_PER_ELEMENT,p=Uint16Array.BYTES_PER_ELEMENT,C=3*p,w=new DataView(t),b=new l(w.getFloat64(u,!0),w.getFloat64(u+8,!0),w.getFloat64(u+16,!0));u+=d;var S=w.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var x=w.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var P=new a(new l(w.getFloat64(u,!0),w.getFloat64(u+8,!0),w.getFloat64(u+16,!0)),w.getFloat64(u+d,!0));u+=m;var E=new l(w.getFloat64(u,!0),w.getFloat64(u+8,!0),w.getFloat64(u+16,!0));u+=d;var T=w.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var L=new Uint16Array(t,u,3*T);u+=T*g,T>65536&&(C=3*(p=Uint32Array.BYTES_PER_ELEMENT));var k=L.subarray(0,T),D=L.subarray(T,2*T),F=L.subarray(2*T,3*T);s.zigZagDeltaDecode(k,D,F),u%p!=0&&(u+=p-u%p);var B=w.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var U=v.createTypedArrayFromArrayBuffer(T,t,u,3*B);u+=B*C;for(var O=0,N=U.length,G=0;G<N;++G){var W=U[G];U[G]=O-W,0===W&&++O}var q=w.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var I=v.createTypedArrayFromArrayBuffer(T,t,u,q);u+=q*p;var j=w.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var V=v.createTypedArrayFromArrayBuffer(T,t,u,j);u+=j*p;var z=w.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var H=v.createTypedArrayFromArrayBuffer(T,t,u,z);u+=z*p;var Y=w.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var X,J,$=v.createTypedArrayFromArrayBuffer(T,t,u,Y);for(u+=Y*p;u<w.byteLength;){var Z=w.getUint8(u,!0);u+=Uint8Array.BYTES_PER_ELEMENT;var Q=w.getUint32(u,c);if(u+=Uint32Array.BYTES_PER_ELEMENT,Z===M&&e._requestVertexNormals)X=new Uint8Array(t,u,2*T);else if(Z===A&&e._requestWaterMask)J=new Uint8Array(t,u,Q);else if(Z===R&&e._requestMetadata){var K=w.getUint32(u,!0);if(K>0){var ee=f(new Uint8Array(t),u+Uint32Array.BYTES_PER_ELEMENT,K).available;if(h(ee))for(var te=0;te<ee.length;++te)for(var re=r+te+1,ie=ee[te],ne=e._tilingScheme.getNumberOfYTilesAtLevel(re),oe=0;oe<ie.length;++oe){var se=ie[oe],ae=ne-se.endY-1,le=ne-se.startY-1;e.availability.addAvailableTileRange(re,se.startX,ae,se.endX,le),o.availability.addAvailableTileRange(re,se.startX,ae,se.endX,le)}}o.availabilityTilesLoaded.addAvailableTileRange(r,i,n,i,n)}u+=Q}var ce=5*e.getLevelMaximumGeometricError(r),ue=e._tilingScheme.tileXYToRectangle(i,n,r),he=y.fromRectangle(ue,S,x,e._tilingScheme.ellipsoid);return new _({center:b,minimumHeight:S,maximumHeight:x,boundingSphere:P,orientedBoundingBox:he,horizonOcclusionPoint:E,quantizedVertices:L,encodedNormals:X,indices:U,westIndices:I,southIndices:V,eastIndices:H,northIndices:$,westSkirtHeight:ce,southSkirtHeight:ce,eastSkirtHeight:ce,northSkirtHeight:ce,childTileMask:e.availability.computeChildMaskForTile(r,i,n),waterMask:J,credits:e._tileCredits})}(e,n,i,t,r,c)}))}}}function F(e,t,r,i){if(0!==i){var n=e.availabilityLevels,o=i%n==0?i-n:(i/n|0)*n,s=1<<i-o;return{level:o,x:t/s|0,y:r/s|0}}}function B(e,t,r,i,n,o){if(!h(n.availabilityLevels))return{result:!1};for(var s,a=function(){delete n.availabilityPromiseCache[s]},l=n.availabilityTilesLoaded,c=n.availability,u=F(n,t,r,i);h(u);){if(c.isTileAvailable(u.level,u.x,u.y)&&!l.isTileAvailable(u.level,u.x,u.y)){var d;if(!o&&(s=u.level+"-"+u.x+"-"+u.y,d=n.availabilityPromiseCache[s],!h(d))){var m=new C({throttle:!1,throttleByServer:!1,type:w.TERRAIN});d=D(e,u.x,u.y,u.level,n,m),h(d)&&(n.availabilityPromiseCache[s]=d,d.then(a))}return{result:!0,promise:d}}u=F(n,u.x,u.y,u.level)}return{result:!1}}function U(e,t){return null!=e?e:t}function O(e){return null!=e}L.prototype.requestTileGeometry=function(e,t,r,i){var n,o=this._layers,s=o.length;if(1===s)n=o[0];else for(var a=0;a<s;++a){var l=o[a];if(!h(l.availability)||l.availability.isTileAvailable(r,e,t)){n=l;break}}return D(this,e,t,r,n,i)},Object.defineProperties(L.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){return this._availability}}}),L.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},L.prototype.getTileDataAvailable=function(e,t,r){if(h(this._availability)){if(r>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(r,e,t))return!0;if(!this._hasMetadata)return!1;for(var i=this._layers,n=i.length,o=0;o<n;++o){if(B(this,e,t,r,i[o],0===o).result)return}return!1}},L.prototype.loadTileDataAvailability=function(e,t,r){if(!(!h(this._availability)||r>this._availability._maximumLevel||this._availability.isTileAvailable(r,e,t))&&this._hasMetadata)for(var i=this._layers,n=i.length,o=0;o<n;++o){var s=B(this,e,t,r,i[o],0===o);if(h(s.promise))return s.promise}},L._getAvailabilityTile=F;const N=/((?:.*\/)|^)CesiumPro\.js(?:\?|#|$)/;let G,W,q;function I(e){return"undefined"==typeof document?e:(O(G)||(G=document.createElement("a")),G.href=e,G.href=G.href,G.href)}function j(e){return I(`../${e}`)}function V(){if(O(W))return W;let e;if(e="undefined"!=typeof CESIUMPRO_BASE_URL?CESIUMPRO_BASE_URL:"object"==typeof window.define&&O(window.define.amd)&&!window.define.amd.toUrlUndefined?Cesium.getAbsoluteUri("..","core/Url.js"):function(){const e=document.getElementsByTagName("script");for(let t=0,r=e.length;t<r;++t){const r=e[t].getAttribute("src"),i=N.exec(r);if(null!==i)return i[1]}}(),!O(e))throw new t("Unable to determine CesiumPro base URL automatically, try defining a global variable called CESIUMPRO_BASE_URL.");return O(e)||(e=""),W=new Cesium.Resource({url:I(e)}),W.appendForwardSlash(),W}function z(e){return V().getDerivedResource({url:e}).url}function H(e){O(q)||(q="object"==typeof window.define&&O(window.define.amd)&&!window.define.amd.toUrlUndefined?j:z);return q(e)}const Y={join:function(...e){const t=[];for(let r of e)r.startsWith("/")&&(r=r.substring(1)),r.endsWith("/")&&(r=r.substring(0,r.length-1)),t.push(r);return t.join("/")},buildModuleUrl:function(e){return H(e)}};Y.getCesiumProBaseUrl=V;const{FeatureDetection:X,isCrossOriginUrl:J}=Cesium;let $;function Z(){return O($)||($=function(e){let t=Cesium.buildModuleUrl(e);if(J(t)){const e='importScripts("'+t+'");';let r;try{r=new Blob([e],{type:"application/javascript"})}catch(t){let i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(e),r=i.getBlob("application/javascript")}t=(window.URL||window.webkitURL).createObjectURL(r)}return t}("Workers/cesiumWorkerBootstrapper.js")),$}function Q(e){const t=new Worker(Z());t.postMessage=U(t.webkitPostMessage,t.postMessage);const r={loaderConfig:{paths:{Workers:H("workers")},baseUrl:V().url},workerModule:e._workerPath};return t.postMessage(r),t.onmessage=function(t){!function(e,t){console.log(e,t,"------complete-----")}(e,t.data)},t.postMessage(e._options),t}const{kdbush:K,Cartesian3:ee,Cartographic:te,PointPrimitive:re,BoundingRectangle:ie,SceneMode:ne,EllipsoidalOccluder:oe}=Cesium;function se(e){return e.__pixel.x}function ae(e){return e.__pixel.y}function le(e,t){const r=new ie;return re.getScreenSpaceBoundingBox(e,t,r),function(e,t){e.x-=t,e.y-=t,e.width+=2*t,e.height+=2*t}(r,this.pixelRange),r}class ce{constructor(e,t={}){this._objects=U(t.objects,[]),this._getScreenBoundingBox=U(t.getScreenBoundingBox,le),this._scene=e,this.clusterSize=3,this.pixelRange=50,this._clusterObjects=[]}get objects(){return this._objects}set objects(e){this._objects=e}_clearCluster(){this._objects.map((e=>e.cluster=!1)),this._clusterObjects=[]}update(){const e=this._objects;this._clearCluster();const t=function(e,t){const r=[],i=new oe(t.globe.ellipsoid,t.camera.positionWC);for(let n of e)n.position&&(t.mode!==ne.SCENE3D||i.isPointVisible(n.position))&&(n.__pixel=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,n.position),n.__pixel&&r.push(n));return r}(e,this._scene),r=new K(t,se,ae,64,Int32Array);for(let e of t){if(e.cluster)continue;const i=this._getScreenBoundingBox(e,e.__pixel),n=ie.clone(i,new ie);e.cluster=!0;const o=r.range(i.x,i.y,i.x+i.width,i.y+i.height),s=o.length,a=ee.clone(e.position);let l,c=1;const u=[];for(let e=0;e<s;e++){const r=t[o[e]];if(r.cluster)continue;u.push(r.id),r.cluster=!0;const i=this._getScreenBoundingBox(r,r.__pixel);ee.add(r.position,a,a),ie.union(n,i,n),c++,l=r}c>=this.clusterSize?(ee.multiplyByScalar(a,1/c,a),this._clusterObjects.push({position:new ee(a.x,a.y,a.z),number:c,ids:u,id:l.id+c})):this._clusterObjects.push(e)}}}let ue;function he(e){if(!e.scene.globe)return;const t=Cesium.getTimestamp(),r=e.scene;if(O(ue)&&t-ue<250)return;ue=t;const i=r.canvas.clientWidth,n=r.canvas.clientHeight,o=r.camera.getPickRay(new Cesium.Cartesian2(i/2,n/2)),s=r.camera.getPickRay(new Cesium.Cartesian2(i/2+1,n/2)),a=r.globe.pick(o,r),l=r.globe.pick(s,r);if(!O(a)||!O(l))return;return new Cesium.EllipsoidGeodesic(r.globe.ellipsoid.cartesianToCartographic(a),r.globe.ellipsoid.cartesianToCartographic(l)).surfaceDistance}class de{constructor(e,r,i){if(!O(e))throw new t("longitude is required.");if(!O(r))throw new t("latitude is required.");this.lon=e,this.lat=r,this.alt=U(i,0)}toPixel(e){return de.toPixel(this,e)}toCartesian(){return de.toCartesian(this)}toCartographic(){return de.toCartographic(this)}getRadias(){return{lon:Cesium.Math.toRadians(this.lon),lat:Cesium.Math.toRadians(this.lat),alt:alt}}isVisible(e){return de.isVisible(this,e)}toString(){return`{lon: ${this.lon}, lat: ${this.lat}, alt: ${this.alt}}`}toJson(){return{lon:this.lon,lat:this.lat,alt:this.alt}}static isVisible(e,r){if(r instanceof Cesium.Viewer)throw new t("viewer不是一个有效的Cesium.Viewer对象");if(!O(e))throw new t("point is not defined.");const i=de.toCartesian(e);if(r.scene.mode===Cesium.SceneMode.SCENE3D){if(!new Cesium.EllipsoidalOccluder(Cesium.Ellipsoid.WGS84,r.camera.position).isPointVisible(i))return!1;const t=de.toPixel(e,r.scene);if(!O(t))return!1;const n=r.canvas.width||r.canvas.clientWidth,o=r.canvas.height||r.canvas.clientHeight;return t.x>0&&t.x<n&&t.y>0&&t.y<o}if(r.scene.mode===Cesium.SceneMode.SCENE2D){const e=r.scene.camera.frustum,{positionWC:t,directionWC:n,upWC:o}=r.scene.camera,s=e.computeCullingVolume(t,n,o),a=Cesium.BoundingSphere.projectTo2D(new BoundingSphere(i,1)),l=s.computeVisibility(a);return l===Cesium.Intersect.INSIDE||l===Cesium.Intersect.INERSECTING}}static toPixel(e,r){if(!O(r))throw new t("scene未定义。");if(!O(e))throw new t("point is not defined.");const i=de.toCartesian(e);if(O(i))return Cesium.SceneTransforms.wgs84ToWindowCoordinates(r,i)}static toCartographic(e){if(!O(e))throw new t("point is not defined.");return Cesium.Cartographic.fromDegrees(e.lon,e.lat,e.alt)}static toCartesian(e,r){if(!O(e))throw new t("point is not defined.");if(e instanceof Cesium.Cartesian3)return e;if(e instanceof Cesium.Cartographic)return Cesium.Cartographic.toCartesian(e);if(e instanceof de)return Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt);if(e instanceof Cesium.Cartesian2){if(!r)return;const e=r.scene.camera.getPickRay(pixel);return r.scene.globe.pick(e,r.scene)}}static fromCartesian(e){if(!O(e))throw new t("cartesian is not defined.");const r=Cesium.Cartographic.fromCartesian(e);if(O(r))return de.fromCartographic(r)}static fromCartographic(e){if(!O(e))throw new t("cartographic is not defined.");return new de(Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height)}static fromPixel(e,r){if(!r.scene.globe)return;if(!O(e))throw new t("pixel is not defined.");if(r instanceof Cesium.Viewer==!1)throw new t("viewer不是一个有效的Cesium.Viewer对象");const i=r.scene.camera.getPickRay(e),n=r.scene.globe.pick(i,r.scene);return O(n)?de.fromCartesian(n):void 0}static fromDegrees(e,t,r){return new de(e,t,r)}static inChina(...e){if(1!==e.length){const t=+e[0],r=+e[1];return t>73.66&&t<135.05&&r>3.86&&r<53.55}{const t=e[0];if(e[0]instanceof de)return de.inChina(t.lon,t.lat)}}static fromLonlat(e){return new de(...e)}}function me(e){const t=e.canvas.getBoundingClientRect(),r=new Cesium.Cartesian2(t.width/2,t.height/2);return de.fromPixel(r,e)}function ge(e){if(!e.scene.globe)return{};if(e.scene.mode===Cesium.SceneMode.SCENE3D){const t=e.camera.computeViewRectangle();if(!O(t))return;return{west:Cesium.Math.toDegrees(t.west),south:Cesium.Math.toDegrees(t.south),east:Cesium.Math.toDegrees(t.east),north:Cesium.Math.toDegrees(t.north)}}const t=e.canvas.getBoundingClientRect(),r=de.fromPixel(new Cesium.Cartesian2(0,t.height/2),e)||{lon:-180},i=de.fromPixel(new Cesium.Cartesian2(t.width,t.height/2),e)||{lon:180},n=de.fromPixel(new Cesium.Cartesian2(t.width/2,0),e)||{lat:90},o=de.fromPixel(new Cesium.Cartesian2(t.width/2,t.height),e)||{lat:-90};return{west:r.lon,south:o.lat,east:i.lon,north:n.lat}}function fe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function pe(e,t){let r;const i={"y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()},n=Object.keys(i);for(const t of n)r=new RegExp(`(${t})`).exec(e),r&&(e=e.replace(r[1],1===r[1].length?i[t]:i[t].padStart(r[1].length,"0")));return e}window.Date.prototype.format=function(e){pe(e,this)};const{Cartesian2:ve,Rectangle:ye,GeographicProjection:_e,Ellipsoid:Ce}=Cesium,we=Cesium.Math;function be(e){e=U(e,U.EMPTY_OBJECT),this._ellipsoid=U(e.ellipsoid,Ce.WGS84),this._rectangle=U(e.rectangle,ye.MAX_VALUE),this._projection=new _e(this._ellipsoid),this._numberOfLevelZeroTilesX=36,this._numberOfLevelZeroTilesY=18,this._intervalOfZeorLevel=U(e.intervalOfZeorLevel,16)}Object.defineProperties(be.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),be.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},be.prototype.modifyLevel=function(e){return e<3?0:e<6?1:void 0},be.prototype.getDelatXY=function(e){const t=this._intervalOfZeorLevel;return{dx:t/2**e,dy:t/2**e}},be.prototype.getLonLatValuee=function(e,t,r){const i=this.getDelatXY(e);return{lon:i.dx*t-180,lat:90-i.dy*r}},be.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},be.prototype.rectangleToNativeRectangle=function(e,t){const r=we.toDegrees(e.west),i=we.toDegrees(e.south),n=we.toDegrees(e.east),o=we.toDegrees(e.north);return O(t)?(t.west=r,t.south=i,t.east=n,t.north=o,t):new ye(r,i,n,o)},be.prototype.tileXYToNativeRectangle=function(e,t,r,i){const n=this.tileXYToRectangle(e,t,r,i);return n.west=we.toDegrees(n.west),n.south=we.toDegrees(n.south),n.east=we.toDegrees(n.east),n.north=we.toDegrees(n.north),n},be.prototype.tileXYToRectangle=function(e,t,r,i){var n=this._rectangle,o=this.getNumberOfXTilesAtLevel(r),s=this.getNumberOfYTilesAtLevel(r),a=n.width/o,l=e*a+n.west,c=(e+1)*a+n.west,u=n.height/s,h=n.north-t*u,d=n.north-(t+1)*u;return O(i)||(i=new ye(l,d,c,h)),i.west=l,i.south=d,i.east=c,i.north=h,i},be.prototype.positionToTileXY=function(e,t,r){var i=this._rectangle;if(ye.contains(i,e)){var n=this.getNumberOfXTilesAtLevel(t),o=this.getNumberOfYTilesAtLevel(t),s=i.width/n,a=i.height/o,l=e.longitude;i.east<i.west&&(l+=we.TWO_PI);var c=(l-i.west)/s|0;c>=n&&(c=n-1);var u=(i.north-e.latitude)/a|0;return u>=o&&(u=o-1),O(r)?(r.x=c,r.y=u,r):new ve(c,u)}};const{CesiumTerrainProvider:Se,when:xe,TerrainProvider:Pe,Resource:Ee,CustomDataSource:Te,Cartesian3:Le,Entity:Me,Color:Ae,Rectangle:Re}=Cesium;function ke(e){let t=[];const r=[e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north];return"EPSG:4326"===e.projection.toUpperCase()&&(t=[r[0],r[1],r[0],r[3],r[2],r[3],r[2],r[1],r[0],r[1]]),new Me({polyline:{positions:Le.fromRadiansArray(t),material:Ae.fromRandom({alpha:1}),width:3,clampToGround:!0}})}function De(e,t){const r=Ee.createIfNeeded(t);r.appendForwardSlash();const i=r.getDerivedResource({url:"layer.json"});return new Promise(((t,r)=>{xe(i.fetchJson()).then((r=>{e.projection=r.projection,e.bounds=Re.fromDegrees(...r.valid_bounds),t(!0)}))}))}const Fe=52.35987755982988,Be=3.141592653589793,Ue=6378245,Oe=.006693421622965943;function Ne(e,t){let r=this.transformLng(e-105,t-35),i=this.transformLat(e-105,t-35);const n=t/180*Be;let o=Math.sin(n);o=1-Oe*o*o;const s=Math.sqrt(o);return r=180*r/(Ue/s*Math.cos(n)*Be),i=180*i/(Ue*(1-Oe)/(o*s)*Be),[r,i]}const Ge={get:function(e="EPSG:3857",r){const i=e.toUpperCase();if("EPSG:3857"===i)return new Cesium.WebMercatorTilingScheme(r);if("EPSG:4326"===i)return new Cesium.GeographicTilingScheme(r);throw new t("未知的坐标系.")},BD09ToGCJ02:function(e,t){const r=+e-.0065,i=+t-.006,n=Math.sqrt(r*r+i*i)-2e-5*Math.sin(i*Fe),o=Math.atan2(i,r)-3e-6*Math.cos(r*Fe);return[n*Math.cos(o),n*Math.sin(o)]},GCJ02ToBD09:function(e,t){t=+t,e=+e;const r=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*Fe),i=Math.atan2(t,e)+3e-6*Math.cos(e*Fe);return[r*Math.cos(i)+.0065,r*Math.sin(i)+.006]},WGS84ToGCJ02:function(e,t){if(t=+t,e=+e,de.inChina(e,t)){const r=Ne(e,t);return[e+r[0],t+r[1]]}return[e,t]},GCJ02ToWGS84:function(e,t){if(t=+t,e=+e,de.inChina(e,t)){const r=Ne(e,t);return[2*e-(e+r[0]),2*t-(t+r[1])]}return[e,t]}},{Color:We}=Cesium;class qe{constructor(){}static pointColor=We.AQUA;static fillColor=We.AQUA;static strokeColor=We.AQUA}class Ie extends Cesium.UrlTemplateImageryProvider{constructor(e){"string"==typeof e&&(e={url:e}),e.getFeatureInfoFormats=U(e.getFeatureInfoFormats,Ie.defaultFeatureInfoFormats),super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get rectangle(){return super.rectangle}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}function je(){return new Ie({url:Y.buildModuleUrl("assets/tiles/{z}/{x}/{y}.png"),maximumLevel:4})}Ie.defaultFeatureInfoFormats=Object.freeze([Object.freeze(new Cesium.GetFeatureInfoFormat("json","application/json")),Object.freeze(new Cesium.GetFeatureInfoFormat("xml","text/xml")),Object.freeze(new Cesium.GetFeatureInfoFormat("text","text/html"))]);const{defined:Ve,defaultValue:ze,ColorMaterialProperty:He,ConstantPositionProperty:Ye,ConstantProperty:Xe,DataSource:Je,PolygonGraphics:$e,PolylineGraphics:Ze,EntityCluster:Qe,PinBuilder:Ke,createGuid:et,Cartesian3:tt,PointGraphics:rt,ArcType:it,PolygonHierarchy:nt,Color:ot,EntityCollection:st,HeightReference:at,when:lt,Resource:ct,describe:ut,Event:ht}=Cesium,dt={small:24,medium:48,large:64},mt={},gt={},ft={"urn:ogc:def:crs:OGC:1.3:CRS84":Bt,"EPSG:4326":Bt,"urn:ogc:def:crs:EPSG::4326":Bt},pt=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"],vt={Feature:wt,FeatureCollection:function(e,t,r,i,n){for(var o=t.features,s=0,a=o.length;s<a;s++)wt(e,o[s],void 0,i,n)},GeometryCollection:bt,LineString:Lt,MultiLineString:Mt,MultiPoint:Pt,MultiPolygon:kt,Point:xt,Polygon:Rt,Topology:Dt},yt={GeometryCollection:bt,LineString:Lt,MultiLineString:Mt,MultiPoint:Pt,MultiPolygon:kt,Point:xt,Polygon:Rt,Topology:Dt};function _t(e,t){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function Ct(e,t,r){var i=e.id;if(Ve(i)&&"Feature"===e.type){for(var n=2,o=i;Ve(t.getById(o));)o=i+"_"+n,n++;i=o}else i=et();var s=t.getOrCreateEntity(i),a=e.properties;if(Ve(a)){var l;s.properties=a;var c=a.title;if(Ve(c))s.name=c,l="title";else{var u=Number.MAX_VALUE;for(var h in a)if(a.hasOwnProperty(h)&&a[h]){var d=h.toLowerCase();if(u>1&&"title"===d){u=1,l=h;break}u>2&&"name"===d?(u=2,l=h):u>3&&/title/i.test(h)?(u=3,l=h):u>4&&/name/i.test(h)&&(u=4,l=h)}Ve(l)&&(s.name=a[l])}var m=a.description;null!==m&&(s.description=Ve(m)?new Xe(m):r(a,l))}return s}function wt(e,r,i,n,o){if(null!==r.geometry){if(!Ve(r.geometry))throw new t("feature.geometry is required.");var s=r.geometry.type,a=yt[s];if(!Ve(a))throw new t("Unknown geometry type: "+s);a(e,r,r.geometry,n,o)}else Ct(r,e._entityCollection,o.describe)}function bt(e,r,i,n,o){for(var s=i.geometries,a=0,l=s.length;a<l;a++){var c=s[a],u=c.type,h=yt[u];if(!Ve(h))throw new t("Unknown geometry type: "+u);h(e,r,c,n,o)}}function St(e,t,r,i,n){let o=n.pointSize,s=n.pointColor;const a=t.properties;if(Ve(a)){const e=a["point-color"];Ve(e)&&(s=ot.fromCssColorString(e)),o=ze(dt[a["point-size"]],o)}const l=new rt;2===i.length&&n.clampToGround&&(l.heightReference=at.CLAMP_TO_GROUND);const c=Ct(t,e._entityCollection,n.describe);c.point=l,c.point.color=s,c.point.pixelSize=o,c.position=new Ye(r(i))}function xt(e,t,r,i,n){St(e,t,i,r.coordinates,n)}function Pt(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)St(e,t,i,o[s],n)}function Et(e,t,r,i,n){const o=n.lineColor,s=n.lineWidth,a=t.properties;if(Ve(a)){const e=a["stroke-width"];let t;Ve(e)&&(s=new Xe(e));let r=a.stroke;Ve(r)&&(t=ot.fromCssColorString(r));let i=a["stroke-opacity"];Ve(i)&&1!==i&&(Ve(t)||(t=o.color.clone()),t.alpha=i),Ve(t)&&(o=new He(t))}const l=Ct(t,e._entityCollection,n.describe),c=new Ze;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=s,c.positions=new Xe(_t(i,r)),c.arcType=it.RHUMB}function Tt(e,t){var r="";for(var i in e)if(e.hasOwnProperty(i)){if(i===t||-1!==pt.indexOf(i))continue;var n=e[i];Ve(n)&&(r+="object"==typeof n?"<tr><th>"+i+"</th><td>"+Tt(n)+"</td></tr>":"<tr><th>"+i+"</th><td>"+n+"</td></tr>")}return r.length>0&&(r='<table class="cesium-infoBox-defaultTable"><tbody>'+r+"</tbody></table>"),r}function Lt(e,t,r,i,n){Et(e,t,i,r.coordinates,n)}function Mt(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)Et(e,t,i,o[s],n)}function At(e,t,r,i,n){if(0===i.length||0===i[0].length)return;let o=n.outlineColor.color,s=n.fill,a=n.outlineWidth;const l=t.properties;if(Ve(l)){const e=l["stroke-width"];let t;Ve(e)&&(a=new Xe(e));const r=l.stroke;Ve(r)&&(t=ot.fromCssColorString(r));let i,c=l["stroke-opacity"];Ve(c)&&1!==c&&(Ve(t)||(t=n.outlineColor.color.clone()),t.alpha=c),Ve(t)&&(o=new Xe(t));const u=l.fill;Ve(u)&&(i=ot.fromCssColorString(u),i.alpha=s.color.alpha),c=l["fill-opacity"],Ve(c)&&c!==s.color.alpha&&(Ve(i)||(i=s.color.clone()),i.alpha=c),Ve(i)&&(s=new He(i))}const c=new $e;c.outline=new Xe(n.outline),c.outlineColor=o,c.outlineWidth=a,c.material=s,c.arcType=it.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let r of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(r);Ve(e)&&Ve(e[1])&&(t=t.replace(r,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const h=[];for(var d=1,m=i.length;d<m;d++)h.push(new nt(_t(i[d],r)));const g=i[0];c.hierarchy=new Xe(new nt(_t(g,r),h)),g[0].length>2?c.perPositionHeight=new Xe(!0):n.clampToGround||(c.height=0);Ct(t,e._entityCollection,n.describe).polygon=c}function Rt(e,t,r,i,n){At(e,t,i,r.coordinates,n)}function kt(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)At(e,t,i,o[s],n)}function Dt(e,t,r,i,n){for(var o in r.objects)if(r.objects.hasOwnProperty(o)){var s=topojson.feature(r,r.objects[o]);(0,vt[s.type])(e,s,s,i,n)}}function Ft(e,t){return new Cesium.CallbackProperty(function(e,t,r){var i;return function(n,o){return Ve(i)||(i=e(t,r)),i}}(Tt,e,t),!0)}function Bt(e){return tt.fromDegrees(e[0],e[1],e[2])}class Ut{constructor(e){this._name=e,this._changed=new ht,this._error=new ht,this._isLoading=!1,this._loading=new ht,this._entityCollection=new st(this),this._promises=[],this._pinBuilder=new Ke,this._entityCluster=new Qe,this._credit=void 0,this._resourceCredits=[]}static pointSize=5;static pointColor=ot.ROYALBLUE;static lineColor=ot.YELLOW;static fill=ot.fromBytes(255,255,0,100);static outline=!0;static outlineColor=ot.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return ft}static crsLinkHrefs(){return mt}static crsLinkTypes(){return gt}get entities(){return this._entityCollection}get name(){return this._name}set name(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}get clock(){}get isLoading(){return this._isLoading}get changedEvent(){return this._changed}get errorEvent(){return this._error}get loadingEvent(){return this._loading}get show(){return this._entityCollection.show}set show(e){this._entityCollection.show=e}get clustering(){return this._entityCluster}set clustering(e){this._entityCluster=e}get credit(){return this._credit}load(e,r){Je.setLoading(this,!0);let i=(r=ze(r,{})).credit;"string"==typeof i&&(i=new Credit(i)),this._credit=i;let n=e,o=r.sourceUri;if("string"==typeof e||e instanceof ct){n=(e=ct.createIfNeeded(e)).fetchJson(),o=ze(o,e.getUrlComponent());const t=this._resourceCredits,r=e.credits;if(Ve(r)){const e=r.length;for(const i=0;i<e;i++)t.push(r[i])}}r={describe:ze(r.describe,Ft),pointSize:ze(r.pointSize,Ut.pointSize),pointColor:ze(r.pointColor,Ut.pointColor),lineWidth:new Xe(ze(r.lineWidth,Ut.lineWidth)),outlineColor:new He(ze(r.outlineColor,Ut.outlineColor)),lineColor:new He(ze(r.lineColor,Ut.lineColor)),outlineWidth:ze(r.outlineWidth,Ut.outlineWidth),fill:new He(ze(r.fill,Ut.fill)),outline:ze(r.outline,Ut.outline),clampToGround:ze(r.clampToGround,Ut.clampToGround),extrudedHeight:r.extrudedHeight};const s=this;return lt(n,(function(e){return function(e,r,i,n){let o;Ve(n)&&(o=Cesium.getFilenameFromUri(n)),Ve(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const s=vt[r.type];if(!Ve(s))throw new t("Unsupported GeoJSON object type: "+r.type);const a=r.crs;let l=null!==a?Bt:null;if(Ve(a)){if(!Ve(a.properties))throw new t("crs.properties is undefined.");const e=a.properties;if("name"===a.type){if(l=ft[e.name],!Ve(l))throw new t("Unknown crs name: "+e.name)}else if("link"===a.type){var c=mt[e.href];if(Ve(c)||(c=gt[e.type]),!Ve(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==a.type)throw new t("Unknown crs type: "+a.type);if(l=ft["EPSG:"+e.code],!Ve(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&s(e,r,r,t,i),Cesium.when.all(e._promises,(function(){return e._promises.length=0,Je.setLoading(e,!1),e}))}))}(s,e,r,o)})).otherwise((function(e){return Je.setLoading(s,!1),s._error.raiseEvent(s,e),console.log(e),lt.reject(e)}))}update(){return!0}}Ut.load=function(e,t){return(new Ut).load(e,t)};const Ot={};function Nt(e){return new Gt(e instanceof Uint8Array?e:new Uint8Array(e))}function Gt(e){this._array=e}Gt.prototype.read=function(){var e=this._array;return this._array=null,Promise.resolve(e?{done:!1,value:e}:{done:!0,value:void 0})},Gt.prototype.cancel=function(){return this._array=null,Promise.resolve()};var Wt=function(e){return fetch(e).then((function(e){return e.body&&e.body.getReader?e.body.getReader():e.arrayBuffer().then(Nt)}))},qt=function(e){return new Promise((function(t,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onload=function(){t(Nt(i.response))},i.onerror=r,i.ontimeout=r,i.open("GET",e,!0),i.send()}))};function It(e){return("function"==typeof fetch?Wt:qt)(e)}function jt(e){return"function"==typeof e.read?e:e.getReader()}var Vt=new Uint8Array(0);function zt(e,t){if(!e.length)return t;if(!t.length)return e;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Ht(e){return"function"==typeof e.slice?e:new Yt("function"==typeof e.read?e:e.getReader())}function Yt(e){this._source=e,this._array=Vt,this._index=0}Yt.prototype.read=function(){var e=this,t=e._array.subarray(e._index);return e._source.read().then((function(r){return e._array=Vt,e._index=0,r.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:zt(t,r.value)}}))},Yt.prototype.slice=function(e){if((e|=0)<0)throw new Error("invalid length");var t=this,r=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var i=new Uint8Array(e);return i.set(this._array.subarray(this._index)),function n(){return t._source.read().then((function(o){return o.done?(t._array=Vt,t._index=0,r>0?i.subarray(0,r):null):r+o.value.length>=e?(t._array=o.value,t._index=e-r,i.set(o.value.subarray(0,e-r),r),i):(i.set(o.value,r),r+=o.value.length,n())}))}()},Yt.prototype.cancel=function(){return this._source.cancel()};var Xt=function(e){return!(e=e.trim())||isNaN(e=+e)?null:e},Jt={B:Xt,C:function(e){return e.trim()||null},D:function(e){return new Date(+e.substring(0,4),e.substring(4,6)-1,+e.substring(6,8))},F:Xt,L:function(e){return!/^[nf]$/i.test(e)&&(!!/^[yt]$/i.test(e)||null)},M:Xt,N:Xt},$t=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},Zt=function(e,t){return(e=Ht(e)).slice(32).then((function(r){var i=$t(r);return e.slice(i.getUint16(8,!0)-32).then((function(r){return new Qt(e,t,i,$t(r))}))}))};function Qt(e,t,r,i){this._source=e,this._decode=t.decode.bind(t),this._recordLength=r.getUint16(10,!0),this._fields=[];for(var n=0;13!==i.getUint8(n);n+=32){for(var o=0;o<11&&0!==i.getUint8(n+o);++o);this._fields.push({name:this._decode(new Uint8Array(i.buffer,i.byteOffset+n,o)),type:String.fromCharCode(i.getUint8(n+11)),length:i.getUint8(n+16)})}}var Kt=Qt.prototype;Kt.read=function(){var e=this,t=1;return e._source.slice(e._recordLength).then((function(r){return r&&26!==r[0]?{done:!1,value:e._fields.reduce((function(i,n){return i[n.name]=Jt[n.type](e._decode(r.subarray(t,t+=n.length))),i}),{})}:{done:!0,value:void 0}}))},Kt.cancel=function(){return this._source.cancel()};var er=function(e){var t,r=40,i=e.getInt32(36,!0),n=new Array(i);for(t=0;t<i;++t,r+=16)n[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return{type:"MultiPoint",coordinates:n}},tr=function(e){return{type:"Point",coordinates:[e.getFloat64(4,!0),e.getFloat64(12,!0)]}},rr=function(e){var t,r=44,i=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(i),s=new Array(n),a=[],l=[];for(t=0;t<i;++t,r+=4)o[t]=e.getInt32(r,!0);for(t=0;t<n;++t,r+=16)s[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return o.forEach((function(e,t){var r=s.slice(e,o[t+1]);!function(e){if((t=e.length)<4)return!1;var t,r=0,i=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];for(;++r<t;)i+=e[r-1][1]*e[r][0]-e[r-1][0]*e[r][1];return i>=0}(r)?l.push(r):a.push([r])})),l.forEach((function(e){a.some((function(t){if(function(e,t){var r,i=-1,n=t.length;for(;++i<n;)if(r=ir(e,t[i]))return r>0;return!1}(t[0],e))return t.push(e),!0}))||a.push([e])})),1===a.length?{type:"Polygon",coordinates:a[0]}:{type:"MultiPolygon",coordinates:a}};function ir(e,t){for(var r=t[0],i=t[1],n=-1,o=0,s=e.length,a=s-1;o<s;a=o++){var l=e[o],c=l[0],u=l[1],h=e[a],d=h[0],m=h[1];if(nr(l,h,t))return 0;u>i!=m>i&&r<(d-c)*(i-u)/(m-u)+c&&(n=-n)}return n}function nr(e,t,r){var i=r[0]-e[0],n=r[1]-e[1];if(0===i&&0===n)return!0;var o=t[0]-e[0],s=t[1]-e[1];if(0===o&&0===s)return!1;var a=(i*o+n*s)/(o*o+s*s);return!(a<0||a>1)&&(0===a||1===a||a*o===i&&a*s===n)}var or=function(e){var t,r=44,i=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(i),s=new Array(n);for(t=0;t<i;++t,r+=4)o[t]=e.getInt32(r,!0);for(t=0;t<n;++t,r+=16)s[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return 1===i?{type:"LineString",coordinates:s}:{type:"MultiLineString",coordinates:o.map((function(e,t){return s.slice(e,o[t+1])}))}},sr=function(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},ar={0:function(){return null},1:tr,3:or,5:rr,8:er,11:tr,13:or,15:rr,18:er,21:tr,23:or,25:rr,28:er},lr=function(e){return(e=Ht(e)).slice(100).then((function(t){return new cr(e,$t(t))}))};function cr(e,t){var r=t.getInt32(32,!0);if(!(r in ar))throw new Error("unsupported shape type: "+r);this._source=e,this._type=r,this._index=0,this._parse=ar[r],this.bbox=[t.getFloat64(36,!0),t.getFloat64(44,!0),t.getFloat64(52,!0),t.getFloat64(60,!0)]}var ur=cr.prototype;function hr(){}ur.read=function(){var e=this;return++e._index,e._source.slice(12).then((function(t){if(null==t)return{done:!0,value:void 0};var r=$t(t);function i(){return e._source.slice(4).then((function(o){return null==o?{done:!0,value:void 0}:(r=$t(t=sr(t.slice(4),o))).getInt32(0,!1)!==e._index?i():n()}))}function n(){var n=2*r.getInt32(4,!1)-4,o=r.getInt32(8,!0);return n<0||o&&o!==e._type?i():e._source.slice(n).then((function(r){return{done:!1,value:o?e._parse($t(sr(t.slice(8),r))):null}}))}return n()}))},ur.cancel=function(){return this._source.cancel()};function dr(e,t){this._shp=e,this._dbf=t,this.bbox=e.bbox}var mr=dr.prototype;function gr(e,t,r){return"string"==typeof t?(/\.dbf$/.test(t)||(t+=".dbf"),t=It(t)):t instanceof ArrayBuffer||t instanceof Uint8Array?t=Nt(t):null!=t&&(t=jt(t)),"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),void 0===t&&(t=It(e.substring(0,e.length-4)+".dbf").catch((function(){}))),e=It(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?Nt(e):jt(e),Promise.all([e,t]).then((function(e){var t,i,n,o=e[0],s=e[1],a="windows-1252";return r&&null!=r.encoding&&(a=r.encoding),t=o,i=s,n=s&&new TextDecoder(a),Promise.all([lr(t),i&&Zt(i,n)]).then((function(e){return new dr(e[0],e[1])}))}))}mr.read=function(){var e=this;return Promise.all([e._dbf?e._dbf.read():{value:{}},e._shp.read()]).then((function(e){var t=e[0],r=e[1];return r.done?r:{done:!1,value:{type:"Feature",properties:t.value,geometry:r.value}}}))},mr.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(hr)},Ot.open=gr,Ot.openShp=function(e,t){return"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),e=It(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?Nt(e):jt(e),Promise.resolve(e).then(lr)},Ot.openDbf=function(e,t){var r="windows-1252";return t&&null!=t.encoding&&(r=t.encoding),r=new TextDecoder(r),"string"==typeof e?(/\.dbf$/.test(e)||(e+=".dbf"),e=It(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?Nt(e):jt(e),Promise.resolve(e).then((function(e){return Zt(e,r)}))},Ot.read=function(e,t,r){return gr(e,t,r).then((function(e){var t=[],r={type:"FeatureCollection",features:t,bbox:e.bbox};return e.read().then((function i(n){return n.done?r:(t.push(n.value),e.read().then(i))}))}))},Object.defineProperty(Ot,"__esModule",{value:!0});const{defined:fr,defaultValue:pr,ColorMaterialProperty:vr,ConstantPositionProperty:yr,ConstantProperty:_r,DataSource:Cr,PolygonGraphics:wr,PolylineGraphics:br,createGuid:Sr,Cartesian3:xr,PointGraphics:Pr,ArcType:Er,PolygonHierarchy:Tr,Color:Lr,HeightReference:Mr,Resource:Ar}=Cesium,Rr={small:24,medium:48,large:64},kr={},Dr={},Fr={"urn:ogc:def:crs:OGC:1.3:CRS84":ei,"EPSG:4326":ei,"urn:ogc:def:crs:EPSG::4326":ei},Br={Feature:Gr,FeatureCollection:function(e,t,r,i,n){for(var o=t.features,s=0,a=o.length;s<a;s++)Gr(e,o[s],void 0,i,n)},GeometryCollection:Wr,LineString:zr,MultiLineString:Hr,MultiPoint:jr,MultiPolygon:Jr,Point:Ir,Polygon:Xr,Topology:$r},Ur={GeometryCollection:Wr,LineString:zr,MultiLineString:Hr,MultiPoint:jr,MultiPolygon:Jr,Point:Ir,Polygon:Xr,Topology:$r};function Or(e,t){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function Nr(e,t,r){var i=e.id;if(fr(i)&&"Feature"===e.type){for(var n=2,o=i;fr(t.getById(o));)o=i+"_"+n,n++;i=o}else i=Sr();var s=t.getOrCreateEntity(i),a=e.properties;if(fr(a)){var l;s.properties=a;var c=a.title;if(fr(c))s.name=c,l="title";else{var u=Number.MAX_VALUE;for(var h in a)if(a.hasOwnProperty(h)&&a[h]){var d=h.toLowerCase();if(u>1&&"title"===d){u=1,l=h;break}u>2&&"name"===d?(u=2,l=h):u>3&&/title/i.test(h)?(u=3,l=h):u>4&&/name/i.test(h)&&(u=4,l=h)}fr(l)&&(s.name=a[l])}var m=a.description;null!==m&&(s.description=fr(m)?new _r(m):r(a,l))}return s}function Gr(e,r,i,n,o){if(null!==r.geometry){if(!fr(r.geometry))throw new t("feature.geometry is required.");var s=r.geometry.type,a=Ur[s];if(!fr(a))throw new t("Unknown geometry type: "+s);a(e,r,r.geometry,n,o)}else Nr(r,e._entityCollection,o.describe)}function Wr(e,r,i,n,o){for(var s=i.geometries,a=0,l=s.length;a<l;a++){var c=s[a],u=c.type,h=Ur[u];if(!fr(h))throw new t("Unknown geometry type: "+u);h(e,r,c,n,o)}}function qr(e,t,r,i,n){let o=n.pointSize,s=n.pointColor;const a=t.properties;if(fr(a)){const e=a["point-color"];fr(e)&&(s=Lr.fromCssColorString(e)),o=pr(Rr[a["point-size"]],o)}const l=new Pr;2===i.length&&n.clampToGround&&(l.heightReference=Mr.CLAMP_TO_GROUND);const c=Nr(t,e._entityCollection,n.describe);c.point=l,c.point.color=s,c.point.pixelSize=o,c.position=new yr(r(i))}function Ir(e,t,r,i,n){qr(e,t,i,r.coordinates,n)}function jr(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)qr(e,t,i,o[s],n)}function Vr(e,t,r,i,n){const o=n.lineColor,s=n.lineWidth,a=t.properties;if(fr(a)){const e=a["stroke-width"];let t;fr(e)&&(s=new _r(e));let r=a.stroke;fr(r)&&(t=Lr.fromCssColorString(r));let i=a["stroke-opacity"];fr(i)&&1!==i&&(fr(t)||(t=o.color.clone()),t.alpha=i),fr(t)&&(o=new vr(t))}const l=Nr(t,e._entityCollection,n.describe),c=new br;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=s,c.positions=new _r(Or(i,r)),c.arcType=Er.RHUMB}function zr(e,t,r,i,n){Vr(e,t,i,r.coordinates,n)}function Hr(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)Vr(e,t,i,o[s],n)}function Yr(e,t,r,i,n){if(0===i.length||0===i[0].length)return;let o=n.outlineColor.color,s=n.fill,a=n.outlineWidth;const l=t.properties;if(fr(l)){const e=l["stroke-width"];let t;fr(e)&&(a=new _r(e));const r=l.stroke;fr(r)&&(t=Lr.fromCssColorString(r));let i,c=l["stroke-opacity"];fr(c)&&1!==c&&(fr(t)||(t=n.outlineColor.color.clone()),t.alpha=c),fr(t)&&(o=new _r(t));const u=l.fill;fr(u)&&(i=Lr.fromCssColorString(u),i.alpha=s.color.alpha),c=l["fill-opacity"],fr(c)&&c!==s.color.alpha&&(fr(i)||(i=s.color.clone()),i.alpha=c),fr(i)&&(s=new vr(i))}const c=new wr;c.outline=new _r(n.outline),c.outlineColor=o,c.outlineWidth=a,c.material=s,c.arcType=Er.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let r of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(r);fr(e)&&fr(e[1])&&(t=t.replace(r,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const h=[];for(var d=1,m=i.length;d<m;d++)h.push(new Tr(Or(i[d],r)));const g=i[0];c.hierarchy=new _r(new Tr(Or(g,r),h)),g[0].length>2?c.perPositionHeight=new _r(!0):n.clampToGround||(c.height=0);Nr(t,e._entityCollection,n.describe).polygon=c}function Xr(e,t,r,i,n){Yr(e,t,i,r.coordinates,n)}function Jr(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)Yr(e,t,i,o[s],n)}function $r(e,t,r,i,n){for(var o in r.objects)if(r.objects.hasOwnProperty(o)){var s=topojson.feature(r,r.objects[o]);(0,Br[s.type])(e,s,s,i,n)}}function Zr(e,t){var r="";for(var i in e)if(e.hasOwnProperty(i)){if(i===t||-1!==Qr.indexOf(i))continue;var n=e[i];fr(n)&&(r+="object"==typeof n?"<tr><th>"+i+"</th><td>"+Zr(n)+"</td></tr>":"<tr><th>"+i+"</th><td>"+n+"</td></tr>")}return r.length>0&&(r='<table class="cesium-infoBox-defaultTable"><tbody>'+r+"</tbody></table>"),r}const Qr=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"];function Kr(e,t){return new Cesium.CallbackProperty(function(e,t,r){var i;return function(n,o){return fr(i)||(i=e(t,r)),i}}(Zr,e,t),!0)}function ei(e){return xr.fromDegrees(e[0],e[1],e[2])}class ti extends Ut{constructor(e){super(e),this._geoJson=void 0}get geoJson(){return this._geoJson}set geoJson(e){this._geoJson?this._geoJson.features.push(e):this._geoJson={type:"FeatureCollection",features:[e]}}static pointSize=5;static pointColor=Lr.ROYALBLUE;static lineColor=Lr.YELLOW;static fill=Lr.fromBytes(255,255,0,100);static outline=!0;static outlineColor=Lr.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return Fr}static crsLinkHrefs(){return kr}static crsLinkTypes(){return Dr}load(e,r={encoding:"utf-8"}){if(!fr(e))throw new t("data is required.");Cesium.DataSource.setLoading(this,!0);const i=r.credit;"string"==typeof i&&(i=new Cesium.Credit(i)),this._credit=i;const n=this;let o=e,s=r.sourceUri;if("string"==typeof e||e instanceof Ar){o=new Promise(((t,i)=>{Ot.open(e,void 0,{encoding:r.encoding}).then((e=>e.read().then((function r(i){if(!i.done)return n.geoJson=i.value,e.read().then(r);t(n.geoJson)})))).catch((e=>i(e.stack)))})),s=pr(s,"");var a=this._resourceCredits,l=e.credits;if(fr(l))for(var c=l.length,u=0;u<c;u++)a.push(l[u])}return r={describe:pr(r.describe,Kr),pointSize:pr(r.pointSize,ti.pointSize),pointColor:pr(r.pointColor,ti.pointColor),lineWidth:new _r(pr(r.lineWidth,ti.lineWidth)),outlineColor:new vr(pr(r.outlineColor,ti.outlineColor)),lineColor:new vr(pr(r.lineColor,ti.lineColor)),outlineWidth:pr(r.outlineWidth,ti.outlineWidth),fill:new vr(pr(r.fill,ti.fill)),outline:pr(r.outline,ti.outline),clampToGround:pr(r.clampToGround,ti.clampToGround),extrudedHeight:r.extrudedHeight},Cesium.when(o,(function(e){return function(e,r,i,n){let o;fr(n)&&(o=Cesium.getFilenameFromUri(n)),fr(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const s=Br[r.type];if(!fr(s))throw new t("Unsupported GeoJSON object type: "+r.type);const a=r.crs;let l=null!==a?ei:null;if(fr(a)){if(!fr(a.properties))throw new t("crs.properties is undefined.");const e=a.properties;if("name"===a.type){if(l=Fr[e.name],!fr(l))throw new t("Unknown crs name: "+e.name)}else if("link"===a.type){var c=kr[e.href];if(fr(c)||(c=Dr[e.type]),!fr(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==a.type)throw new t("Unknown crs type: "+a.type);if(l=Fr["EPSG:"+e.code],!fr(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&s(e,r,r,t,i),Cesium.when.all(e._promises,(function(){return e._promises.length=0,Cr.setLoading(e,!1),e}))}))}(n,e,r,s)})).otherwise((function(e){return Cesium.DataSource.setLoading(n,!1),n._error.raiseEvent(n,e),console.log(e),Cesium.when.reject(e)}))}}ti.load=function(e,t){return(new ti).load(e,t)};const{buildModuleUrl:ri,Color:ii,defined:ni,destroyObject:oi,knockout:si,getElement:ai,subscribeAndEvaluate:li,InfoBoxViewModel:ci}=Cesium;class ui{constructor(e){e=ai(e);var t=document.createElement("div");t.className="cesium-infoBox",t.setAttribute("data-bind",'      css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }'),e.appendChild(t);var r=document.createElement("div");r.className="cesium-infoBox-title",r.setAttribute("data-bind","text: titleText"),t.appendChild(r);var i=document.createElement("button");i.type="button",i.className="cesium-infoBox-close",i.setAttribute("data-bind","      click: function () { closeClicked.raiseEvent(this); }"),i.innerHTML="&times;",t.appendChild(i);var n=document.createElement("iframe");n.className="cesium-infoBox-iframe",n.setAttribute("sandbox","allow-same-origin allow-popups allow-forms"),n.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }"),n.setAttribute("allowfullscreen",!0),t.appendChild(n);var o=new ci;si.applyBindings(o,t),this._container=e,this._element=t,this._frame=n,this._viewModel=o,this._descriptionSubscription=void 0;var s=this;n.addEventListener("load",(function(){var e=n.contentDocument,r=e.createElement("link");r.href=ri("Widgets/InfoBox/InfoBoxDescription.css"),r.rel="stylesheet",r.type="text/css";var i=e.createElement("div");i.className="cesium-infoBox-description",e.head.appendChild(r),e.body.appendChild(i),s._descriptionSubscription=li(o,"description",(function(e){n.style.height="5px",i.innerHTML=e;var r=null,o=i.firstElementChild;if(null!==o&&1===i.childNodes.length){var s=window.getComputedStyle(o);if(null!==s){var a=s["background-color"],l=ii.fromCssColorString(a);ni(l)&&0!==l.alpha&&(r=s["background-color"])}}t.style["background-color"]=r;var c=i.getBoundingClientRect().height;n.style.height=c+"px"}))})),n.setAttribute("src","about:blank")}get container(){return this._container}get viewModel(){return this._viewModel}get frame(){return this._frame}isDestroyed(){return!1}destroy(){var e=this._container;return si.cleanNode(this._element),e.removeChild(this._element),ni(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),oi(this)}}const{Transforms:hi,Cartesian3:di}=Cesium;class mi{constructor(e={}){if(!O(e.modelMatrix)&&O(e.position)){let t;e.position instanceof di?t=e.position:e.position instanceof GeoPoint&&(t=e.position.toCartesian()),t&&(e.modelMatrix=hi.eastNorthUpToFixedFrame(t))}if(O(e.gltf))this.delegate=new Cesium.Model(e);else{if(!O(e.url))throw new t("one of parameters url or gltf must be provided.");this.delegate=Cesium.Model.fromGltf(e)}this._readyPromise=this.delegate._readyPromise,this._ready=this.delegate._ready}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get activeAnimations(){return this.delegate.activeAnimations}set activeAnimations(e){this.delegate.activeAnimations=e}get allowPicking(){return this.delegate.allowPicking}get asynchronous(){return this.delegate.asynchronous}get backFaceCulling(){return this.delegate.backFaceCulling}get basePath(){return this.delegate.basePath}get boundingSphere(){return this.delegate.boundingSphere}get clippingPlanes(){return this.delegate.clippingPlanes}set clippingPlanes(e){this.delegate.clippingPlanes=e}get color(){return this.delegate.color}set color(e){this.delegate.color=e}get colorBlendMode(){return this.delegate.colorBlendMode}set colorBlendMode(e){this.delegate.colorBlendMode=e}get colorBlendAmount(){return this.delegate.colorBlendAmount}set colorBlendAmount(e){this.delegate.colorBlendAmount=e}get credit(){return this.delegate.credit}set credit(e){this.delegate.credit=e}get debugShowBoundingVolume(){return this.delegate.debugShowBoundingVolume}set debugShowBoundingVolume(e){this.delegate.debugShowBoundingVolume=e}get debugWireframe(){return this.delegate.debugWireframe}set debugWireframe(e){this.delegate.debugWireframe=e}get distanceDisplayCondition(){return this.delegate.distanceDisplayCondition}set distanceDisplayCondition(e){this.delegate.distanceDisplayCondition=e}get gltf(){return this.delegate.gltf}get id(){return this.delegate.id}set id(e){this.delegate.id=e}get maximumScale(){return this.delegate.maximumScale}set maximumScale(e){this.delegate.maximumScale=e}get minimumPixelSize(){return this.delegate.minimumPixelSize}set minimumPixelSize(e){this.delegate.minimumPixelSize=e}get modelMatrix(){return this.delegate.modelMatrix}set modelMatrix(e){this.delegate.modelMatrix=e}get scale(){return this.delegate.scale}set scale(e){this.delegate.scale=e}get shadows(){return this.delegate.shadows}set shadows(e){this.delegate.shadows=e}get show(){return this.delegate.show}set show(e){this.delegate.show=e}get showOutline(){return this.delegate.showOutline}get silhouetteColor(){return this.delegate.silhouetteColor}set silhouetteColor(e){this.delegate.silhouetteColor=e}get silhouetteSize(){return this.delegate.silhouetteSize}set silhouetteSize(e){this.delegate.silhouetteSize=e}static silhouetteSupported(e){return Cesium.Model.silhouetteSupported(e.scene)}destroy(){this.delegate.destroy()}isDestroyed(){this.delegate.isDestroyed()}getMaterial(e){return this.delegate.getMaterial(e)}getMesh(e){return this.delegate.getMesh(e)}getNode(e){return this.delegate.getNode(e)}}const gi=Cesium.Scene,{JulianDate:fi,defined:pi,RequestScheduler:vi,PerformanceDisplay:yi,Cesium3DTilePassState:_i,Cesium3DTilePass:Ci,defaultValue:wi,Color:bi,BoundingRectangle:Si,Pass:xi}=Cesium,Pi=new _i({pass:Ci.PRELOAD}),Ei=new _i({pass:Ci.PRELOAD_FLIGHT}),Ti=new _i({pass:Ci.REQUEST_RENDER_MODE_DEFER_CHECK});function Li(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function Mi(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),pi(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Ai(e){return e._picking.updateMostDetailedRayPicks(e)}function Ri(e){var t=e._frameState;Pi.camera=t.camera,Pi.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,Pi)}function ki(e){var t=e._frameState;t.camera.canPreloadFlight()&&(Ei.camera=e.preloadFlightCamera,Ei.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,Ei))}const Di=new _i({pass:Ci.RENDER});function Fi(e){e.primitives.updateForPass(e._frameState,Ti)}function Bi(e){var t=e._frameState;e.primitives.postPassesUpdate(t),vi.update()}function Ui(e){var t=e._frameState,r=e.context,i=r.uniformState,n=e._defaultView;e._view=n,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Di;var o=wi(e.backgroundColor,bi.BLACK);e._hdr&&((o=bi.clone(o,scratchBackgroundColor)).red=Math.pow(o.red,e.gamma),o.green=Math.pow(o.green,e.gamma),o.blue=Math.pow(o.blue,e.gamma)),t.backgroundColor=o,e.fog.update(t),i.update(t);var s=e.shadowMap;pi(s)&&s.enabled&&(!pi(e.light)||e.light instanceof SunLight?Cartesian3.negate(i.sunDirectionWC,e._shadowMapCamera.direction):Cartesian3.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(s)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var a=n.viewport;a.x=0,a.y=0,a.width=r.drawingBufferWidth,a.height=r.drawingBufferHeight;var l=n.passState;l.framebuffer=void 0,l.blendingEnabled=void 0,l.scissorTest=void 0,l.viewport=Si.clone(a,l.viewport),pi(e.globe)&&(e.globe.beginFrame(t),e._LodGraphic.beginFrame(t)),e.updateEnvironment(),e.updateAndExecuteCommands(l,o),e.globe&&e._LodGraphic.render(t),e.resolveFramebuffers(l),l.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(xi.OVERLAY);for(var r=e.context,i=e._overlayCommandList,n=i.length,o=0;o<n;++o)i[o].execute(r,t)}(e,l),pi(e.globe)&&(e.globe.endFrame(t),e._LodGraphic.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),r.endFrame()}function Oi(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,pi(e)||(e=fi.now());var r=this._view.checkForCameraUpdates(this),i=!this.requestRenderMode||this._renderRequested||r||this._logDepthBufferDirty||this._hdrDirty||this.mode===SceneMode.MORPHING;if(!i&&pi(this.maximumRenderTimeChange)&&pi(this._lastRenderTime)){var n=Math.abs(fi.secondsDifference(this._lastRenderTime,e));i=i||n>this.maximumRenderTimeChange}i&&(this._lastRenderTime=fi.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,function(e,t,r){var i=e._frameState;i.frameNumber=t,i.time=fi.clone(r,i.time)}(this,Cesium.Math.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);Li(this,Mi),this.primitives.show&&(Li(this,Ai),Li(this,Ri),Li(this,ki),i||Li(this,Fi)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Li(this,Ui)),function(e,t){if(e.debugShowFramesPerSecond){if(!pi(e._performanceDisplay)){var r=document.createElement("div");r.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(r);var i=new yi({container:r});e._performanceDisplay=i,e._performanceContainer=r}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else pi(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,i),Li(this,Bi),function(e){for(var t=e._frameState.afterRender,r=0,i=t.length;r<i;++r)t[r](),e.requestRender();t.length=0}(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())}class Ni{static overrideRenderFunction(){gi.prototype.render=Oi}}const{AssociativeArray:Gi,destroyObject:Wi,CustomDataSource:qi,Event:Ii}=Cesium,ji=function(){},Vi=[31638318];for(let e=1;e<20;e++)Vi.push(Vi[e-1]/2);class zi{constructor(e={}){this._scene=e._scene,this._id=U(e.id,fe()),this._removedValue=new Gi,this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new Ii,this._maxClusterLevel=U(e.maxClusterLevel,12),this._geometryCached={},this._objectsCached={}}get id(){return this._id}get objects(){return this._objects}updateCluster(e){const t=function(e){let t=0;for(let r of Vi){if(e>r)break;t++}return t}(e),r=this._objects;return this._objects=this._data,t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=r!==this._objects,this._needReclass):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=r!==this._objects,this._needReclass):this._cluster?(this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,!0):void 0}beginUpdate(){}endUpdate(){this._needReclass=!1}initialize(e,t){this._cluster||(this._cluster=new ce(t,{objects:[...this._data]}),this.updateCluster()),this._dataSource||(this._scene=t,this._dataSource=new qi("massive-layer"+fe()),this._scene.dataSources.add(this._dataSource))}createGeometry(e,t,r){const i=U(this._createGeometryFunction,ji)(r),n=Object.keys(r);for(let e of n)"position"!==e&&"id"!==e&&"cartesian"!==e&&"cartographic"!==e&&"__pixel"!==e&&(i[e]=r[e]);return this.add(i),i}removeGeometry(e,t){if(!t)return;const r=this._dataSource.entities.remove(t);return Wi(t),r}add(e){this._dataSource&&e&&this._dataSource.entities.add(e)}removeAll(){this._dataSource.entities.removeAll()}isDestroyed(){return!1}destroy(){this._dataSource.removeAll(),Wi(this)}}const{AssociativeArray:Hi}=Cesium;class Yi{constructor(){this._layers=new Hi}get layer(){return this._layers}get length(){return this._layers.length}get values(){return this._layers.values}get(e){return this._layers.get(e)}add(e){e instanceof zi&&this._layers.set(e.id,e)}has(e){return e instanceof zi?this._layers.contains(e):"string"==typeof e&&this._layers.contains(this.get(e))}remove(e){return e instanceof zi?this._layers.remove(e.id):"string"==typeof e&&this._layers.remove(e)}removeAll(){return this._layers.removeAll()}}const{GeographicTilingScheme:Xi,GlobeSurfaceTileProvider:Ji,when:$i,Event:Zi,GlobeSurfaceTile:Qi,TerrainState:Ki,RequestType:en,Request:tn,Rectangle:rn,QuadtreeTileLoadState:nn,Visibility:on,AssociativeArray:sn,Cartesian3:an,Cartographic:ln}=Cesium;const cn={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function un(e,t,r,i,n){const o=e.data;o.terrainState===Ki.UNLOADED&&function(e,t,r){let i=e.data;function n(e){i.terrainData=e,i.terrainState=Ki.RECEIVED,i.request=void 0}function o(e){if(i.request.state===RequestState.CANCELLED)return i.terrainData=void 0,i.terrainState=Ki.UNLOADED,void(i.request=void 0);i.terrainState=Ki.FAILED,i.request=void 0}!function(){const t=new tn({throttle:!1,throttleByServer:!0,type:en.TERRAIN});i.request=t;const s=r.requestTileGeometry(e.x,e.y,e.level,t);O(s)?(i.terrainState=Ki.RECEIVING,$i(s,n,o)):(i.terrainState=Ki.UNLOADED,i.request=void 0)}()}(e,0,r),o.terrainState===Ki.RECEIVED&&function(e,t,r,i,n,o){const s=r.tilingScheme,a=cn;a.tilingScheme=s,a.x=i,a.y=n,a.level=o,a.exaggeration=t.terrainExaggeration,a.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,a.throttle=!0;const l=e.terrainData.createMesh(a);O(l)&&(e.terrainState=Ki.TRANSFORMING,$i(l,(function(t){e.mesh=t,e.terrainState=Ki.TRANSFORMED}),(function(){e.terrainState=Ki.FAILED})))}(o,t,r,e.x,e.y,e.level),o.terrainState===Ki.TRANSFORMED&&(e.renderable=!0)}function hn(e,t){const r=[];for(let i of e)O(i)&&(O(i.id)||(i.id=fe()),O(i)&&O(i.position)&&(i.position instanceof an?i.cartesian=i.position:i.position instanceof ln?(i.cartesian=ln.toCartesian(i.position),i.catographic=i.position):i.position instanceof de?(i.cartesian=i.position.toCartesian(),i.cartographic=i.position.toCartoGraphic()):i.cartesian=i.position,i.cartographic||(i.cartographic=ln.fromCartesian(i.cartesian)),rn.contains(t.rectangle,i.cartographic)&&r.push(i)));return r}class dn{constructor(){this.boundingVolumeSourceTile=void 0,this.terrainState=Cesium.TerrainState.UNLOADED,this.mesh=void 0,this.terrainData=void 0,this.objects=void 0,this._geometryOfTile=new sn,this._objectsOfTile=new sn,this._needRenderObjects=new sn}static processStateMachine(e,t,r,i,n){dn.initialize(e,r),e.state===nn.LOADING&&un(e,t,r)}static initialize(e,t){let r=e.data;O(r)||(r=e.data=new dn),e.state===nn.START&&(e.state=nn.LOADING)}}function mn(e,t,r,i,n){let o=r.data._geometryOfTile.get(t.id),s=e._hasRenderCached.get(t.id);s||(s={},e._hasRenderCached.set(t.id,s)),o||(o=[]);for(let e of n){if(s[e.id])return;const n=t.createGeometry(r,i,e);s[e.id]=!0,o.push({id:e.id,geometry:n})}r.data._geometryOfTile.set(t.id,o)}function gn(e,t,r,i,n){const o=e._hasRenderCached.get(t.id);for(let e of n){const{id:r,geometry:n}=e;t.removeGeometry(i,n),delete o[r]}r.data._geometryOfTile.remove(t.id)}class fn{constructor(e={}){this._ready=!0,this._scene=e.scene,this._tilingSceheme=new Xi,this._readyPromise=$i.defer(),this._readyPromise.resolve(!0),this._errorEvent=new Zi,this._terrainProvider=e.terrainProvider,this._show=!0,this.cartographicLimitRectangle=rn.clone(rn.MAX_VALUE),this.tree=void 0,this._layers=new Yi,this._lastTilesToRender=[],this._hasRenderCached=new sn,this._tilesCahced=[],this._removeEventListener=this._scene.camera.changed.addEventListener((()=>{const e=this._layers.values;for(let t of e){t.updateCluster(this._scene.camera.positionCartographic.height)&&(this.clearTile(t.id),t.removeAll())}}))}get terrainProvider(){return this._terrainProvider}get show(){return this._show}set show(e){this._show=e}get ready(){return this._ready}get tilingScheme(){return this._tilingSceheme}get readyPromise(){return this._readyPromise}get quadtree(){return this._quadtree}set quadtree(e){O(e)&&(this._quadtree=e)}initialize(e){for(let t of this._layers.values)t.initialize(e,this._scene)}beginUpdate(e){const t=this._layers.values;for(let e of t)e.beginUpdate();this._frameNumber++}showTileThisFrame(e,t){const r=e.data;if(!O(r))return;this._tilesCahced.includes(e)||this._tilesCahced.push(e);const i=this._layers.values;for(let n of i){if(!O(n.objects)||!Array.isArray(n.objects))continue;const i=n.id;if(r._geometryOfTile.get(i)&&!n._needReclass)return;let o=r._objectsOfTile.get(i);O(o)&&!n._needReclass||(o=hn(n.objects,e),r._objectsOfTile.set(i,o)),mn(this,n,e,t,o)}}endUpdate(e){const t=this._quadtree;if(!t)return;const r=this._lastTilesToRender,i=t._tilesToRender,n=this._layers.values;for(let t of r)if(!i.includes(t))for(let r of n){const i=t.data._geometryOfTile.get(r.id)||[];gn(this,r,t,e,i)}for(let e of n)e.endUpdate();this._lastTilesToRender=[...i]}loadTile(e,t){let r,i=!0;t.data&&(r=t.data.terrainState,i=t.data.boundingVolumeSourceTile!==t),dn.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree);const n=t.data;i&&r!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==on.NONE&&n.boundingVolumeSourceTile===t&&dn.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree)}getLevelMaximumGeometricError(e){return this._terrainProvider.getLevelMaximumGeometricError(e)}canRefine(e){return Ji.prototype.canRefine.call(this,e)}computeTileVisibility(e,t,r){return O(e.data)||(e.data=new dn),Ji.prototype.computeTileVisibility.call(this,e,t,r)}computeDistanceToTile(e,t){return e.data||(e.data=new dn),Ji.prototype.computeDistanceToTile.call(this,e,t)}clearTile(e){const t=this._tilesCahced;for(let r of t)r.data._geometryOfTile.remove(e),r.data._objectsOfTile.remove(e);this._hasRenderCached.remove(e)}isDestroyed(){return!1}destroy(){this._removeEventListener();const e=this._layers.values;for(let t of e)t.destroy()}computeTileLoadPriority(e,t){return Ji.prototype.computeTileLoadPriority(e,t)}_onLayerAdded(e,t){}_onLayerRemoved(e,t){}_onLayerShownOrHidden(e,t,r){r?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)}}const{Matrix4:pn,BoundingSphere:vn}=Cesium;function yn(e,t,r){e.camera.flyToBoundingSphere(t,{duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){e._zoomPromise.resolve(!0)},cancel:function(){e._zoomPromise.resolve(!1)},offset:r.offset})}let _n,Cn,wn=0,bn=0,Sn="N/A",xn="N/A";function Pn(e){return null!=e&&"object"==typeof e&&"function"==typeof e.then}function En(e,t,r,i){const n=Cesium.Cartesian3.fromDegrees(t,r,i),o=e.camera,s=o.heading,a=o.pitch,l=function(e,t,r){t=Cesium.Math.clamp(t,-Cesium.Math.PI_OVER_TWO,Cesium.Math.PI_OVER_TWO),e=Cesium.Math.zeroToTwoPi(e)-Cesium.Math.PI_OVER_TWO;const i=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,-t),n=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-e),o=Cesium.Quaternion.multiply(n,i,n),s=Cesium.Matrix3.fromQuaternion(o),a=Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_X);return Cesium.Matrix3.multiplyByVector(s,a,a),Cesium.Cartesian3.negate(a,a),Cesium.Cartesian3.multiplyByScalar(a,r,a),a}(s,a,2*i),c=Cesium.Transforms.eastNorthUpToFixedFrame(n);Cesium.Matrix4.multiplyByPoint(c,l,n),o.setView({destination:n,orientation:{heading:s,pitch:a},easingFunction:Cesium.EasingFunction.QUADRATIC_OUT})}function Tn(e,t){e.infoBox&&(t._infoBox=function(e){const t=document.createElement("div");t.className="cesium-viewer-infoBoxContainer",e.container.appendChild(t);const r=new ui(t),i=r.viewModel;return e._eventHelper.add(i.cameraClicked,Mn.prototype._onInfoBoxCameraClicked,e),e._eventHelper.add(i.closeClicked,Mn.prototype._onInfoBoxClockClicked,e),e._enableInfoOrSelection=!0,r}(t))}function Ln(e,t,r){const i=e._zoomPromise=Cesium.when.defer();return t.readyPromise.then((()=>{if(t._boundingSpheres)yn(e,vn.fromBoundingSpheres(t._boundingSpheres),r);else if(t.boundingSphere){let i=t.boundingSphere;i=vn.clone(i),t.modelMatrix&&pn.multiplyByPoint(t.modelMatrix,i.center,i.center),yn(e,i,r)}})),i}class Mn extends Cesium.Viewer{constructor(e,t={}){t=Object.assign({animation:!1,timeline:!1,geocoder:!1,homeButton:!1,navigationHelpButton:!1,baseLayerPicker:!1,fullscreenElement:"cesiumContainer",fullscreenButton:!1,shouldAnimate:!1,infoBox:!1,selectionIndicator:!1,sceneModePicker:!1,shadows:!1,imageryProvider:je(),contextOptions:{webgl:{alpha:!0,depth:!1,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0},allowTextureFilterAnisotropic:!0}},t),Cesium.Camera.DEFAULT_VIEW_RECTANGLE=Cesium.Rectangle.fromDegrees(70,5,130,60),!1===t.globe&&(t.imageryProvider=void 0);const r=Object.assign({},t,{infoBox:!1});Ni.overrideRenderFunction(),super(e,r);const i=document.querySelector(".cesium-credit-logoContainer");if(i&&i.parentElement.removeChild(i),Tn(t,this),this._options=t,this.scene.preRender.addEventListener(this.update,this),this._distancePerPixel=void 0,this._extent=void 0,this._center=void 0,this._autoRotation=!1,this.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.scene.globe){const e=new fn({terrainProvider:this.terrainProvider,scene:this.scene}),t=new Cesium.QuadtreePrimitive({tileProvider:e});this.scene._LodGraphic=t}this.scene.dataSources=this.dataSources}get massiveGraphicLayers(){return this.scene._LodGraphic.tileProvider._layers}get entities(){return super.entities}get primitives(){return this.scene.primitives}get enableLighting(){if(O(this.globe))return this.scene.globe.enableLighting}set enableLighting(e){O(this.globe)&&(this.scene.globe.enableLighting=e)}get autoRotation(){return this._autoRotation}set autoRotation(e){this._autoRotation=e}get fxaa(){return this.scene.postProcessStages.fxaa.enabled}set fxaa(e){this.scene.postProcessStages.fxaa.enabled=e}get distancePerPixel(){return this._distancePerPixel}get extent(){return this._extent}get center(){return this._center}get container(){return this._container}get layers(){return this.scene.imageryLayers}get dataSources(){return super.dataSources}get globe(){return this.scene.globe}get ellipsoid(){if(this.globe)return this.globe.ellipsoid}get terrain(){return this.terrainProvider}set terrain(e){O(e)&&!1!==e||(this.terrainProvider=new Cesium.EllipsoidTerrainProvider),e!==this.terrainProvider&&(this.terrainProvider=e)}get terrainChanged(){return this.scene.terrainProviderChanged}get terrainExaggeration(){if(this.globe)return this.globe.terrainExaggeration}set terrainExaggeration(e){e<0&&(e=0),this.globe&&(this.globe.terrainExaggeration=e)}get showFps(){return this.scene.debugShowFramesPerSecond}set showFps(e){this.scene.debugShowFramesPerSecond=e}get fps(){return this._fps+"FPS"}get ms(){return this._ms+"MS"}get heading(){return Cesium.Math.toDegrees(this.camera.heading)}get pitch(){return Cesium.Math.toDegrees(this.camera.pitch)}get roll(){return Cesium.Math.toDegrees(this.camera.roll)}get depthTest(){return this.scene.globe.depthTestAgainstTerrain}set depthTest(e){this.scene.globe.depthTestAgainstTerrain=e}addModel(e){this.primitives.add(e.delegate)}removeModel(e){this.primitives.remove(e.delegate)}setView(e){let t;e instanceof Cesium.Cartographic?t=de.fromCartographic(e):e instanceof Cesium.Cartesian3?t=de.fromCartesian(e):e instanceof de&&(t=e),t&&En(this,t.lon,t.lat,t.alt)}stepFlyTo(e={}){let t;e.destination instanceof Cesium.Cartesian3?t=de.fromCartesian(e.destination):e.destination instanceof Cesium.Cartographic?t=de.fromCartographic(e.destination):e.destination instanceof de&&(t=e.destination),t&&(e.destination=t,function(e,t={}){const{camera:r}=e,i=U(t.step1Duration,3),n=U(t.step2Duration,3),o=U(t.step3Duration,3),s=t.destination,a=e.camera._positionCartographic.height,l=Cesium.Cartesian3.fromDegrees(s.lon,s.lat,a),c=t.destination.toCartesian();new Promise((e=>{r.flyTo({destination:l,duration:i,complete(){r.flyTo({destination:c,duration:n,complete(){r.flyTo({destination:c,orientation:t.orientation,duration:o,complete(){e()}})}})}})}))}(this,e))}linkView(e){if(!O(e))throw new t("viewer不是一个有效的Cesium.Viewer对象");return function(e,t){let r,i;return i=function i(n,o){return n.scene.postRender.addEventListener((()=>{const s=n.camera.positionWC,a=n.camera.heading,l=n.camera.pitch,c=n.camera.roll;r&&(r(),r=void 0),o.camera.flyTo({destination:s,orientation:{heading:a,pitch:l,roll:c},duration:0,complete:function(){r=i(t,e)},cancel:function(){r=i(t,e)}})}))}(e,t),function(){i&&i(),r&&r()}}(this,e)}flyTo(e,t={}){if(e instanceof de){const r=e.toCartesian();return this.flyTo(r,t)}if(e instanceof Cesium.Cartesian3){const r=viewer._zoomPromise=Cesium.when.defer(),i=U(t.radius,1e3);delete t.radius;return yn(this,new Cesium.BoundingSphere(e,i),t),r}return e instanceof Cesium.Primitive||e instanceof Cesium.Model||e instanceof mi?Ln(this,e,t):super.flyTo(e,t)}rotateAroundPoint(e,t={}){const r=this;let i;if(e instanceof Cesium.Cartesian3)i=e;else if(e instanceof Cesium.Cartographic)i=Cesium.Cartographic.toCartesian(e);else{if(!(e instanceof de))return;i=e.toCartesian()}const n=U(t.multiplier,1),o=U(t.offset,{});return this._cancelRotateAroundPoint&&(this._cancelRotateAroundPoint(),this._cancelRotateAroundPoint=void 0),this._cancelRotateAroundPoint=this.scene.postRender.addEventListener((function(){const e=Cesium.Math.toRadians(U(o.heading,r.heading)+1*n),t=Cesium.Math.toRadians(U(o.pitch,-20)),s=U(o.range,1e4);r.flyTo(i,{duration:0,offset:new Cesium.HeadingPitchRange(e,t,s)})})),this._cancelRotateAroundPoint}addLayer(e){return e instanceof Cesium.GeoJsonDataSource||e instanceof Cesium.KmlDataSource||e instanceof Cesium.CzmlDataSource||e instanceof Cesium.CustomDataSource||e instanceof Ut||e instanceof ti||Pn(e)?this.dataSources.add(e):this.layers.addImageryProvider(e)}removeLayer(e){if(Pn(e))e.then((e=>{this.removeLayer(e)}));else{this.layers.remove(e)||this.dataSources.remove(e)}}pickLayer(e){const t=this.scene,r=t.camera.getPickRay(e);return this.layers.pickImageryLayerFeatures(r,t)}render(){super.render()}update(){const e=function(){O(_n)||(_n=Cesium.getTimestamp()),O(Cn)||(Cn=Cesium.getTimestamp()),wn++;const e=Cesium.getTimestamp();let t=(e-_n)/1e3;return t>1&&(Sn=wn/t||0,_n=e,wn=0,Sn=Sn.toFixed(0)),bn++,t=e-Cn,t>100&&(xn=t/bn,Cn=e,bn=0,xn=xn.toFixed(2)),{ms:xn,fps:Sn}}();this._fps=e.fps,this._ms=e.ms;const t=he(viewer);t&&(this._distancePerPixel=t),this._extent=ge(this),this._center=me(viewer),this._autoRotation&&function(e){if(!e||e.scene.mode!==Cesium.SceneMode.SCENE3D)return;const t=Cesium.Transforms.computeIcrfToFixedMatrix(e.clock.currentTime);if(O(t)){const r=e.camera,i=Cesium.Cartesian3.clone(r.position),n=Cesium.Matrix4.fromRotationTranslation(t);r.lookAtTransform(n,i)}}(this)}resize(){super.resize()}forceResize(){super.forceResize()}destroy(){super.destroy()}isDestroyed(){return super.isDestroyed()}}const An=33746824,Rn=33554054;const{BingMapsImageryProvider:kn,BingMapsStyle:Dn}=Cesium;class Fn extends kn{constructor(e={}){e.url="https://dev.virtualearth.net",e.mapStyle=U(e.mapStyle,Fn.mapStyle.AERIAL),e.key=U(e.key,"AqMhBWJKbBPBtoWEvtGdUii6XSkDCJ3vWFpOVWzplD-Q0J-ECUF6i8MGXpew8bkc"),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}static tileXYToQuadKey(e,t,r){return kn.tileXYToQuadKey(e,t,r)}static quadKeyToTileXY(e){return kn.quadKeyToTileXY(e)}static mapStyle=Dn}class Bn extends Ie{constructor(e){e=U(e,{});const t=U(e.layer,"img"),{scl:r,style:i}=Bn.getParametersByLayer(t),n=U(e.lang,"zh_cn");e.url=`https://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=${n}&size=1&scl=${r}&style=${i}`,e.subdomains="1234",super(e)}static layers=[{layer:"img",desc:"影像地图"},{layer:"vec",desc:"矢量地图"},{layer:"vei",desc:"矢量地图（含注记）"},{layer:"roa",desc:"路网地图"},{layer:"roi",desc:"路网地图（含注记）"}];static getParametersByLayer(e){let t={scl:1,style:6};switch(e){case"img":break;case"vec":t.scl=2,t.style=7;break;case"vei":t.scl=1,t.style=7;break;case"roa":t.scl=2,t.style=8;break;case"roi":t.scl=1,t.style=8}return t}}const{WebMapTileServiceImageryProvider:Un}=Cesium;class On extends Un{constructor(e={}){super(e)}get dimensions(){return super.dimensions}set dimensions(e){super.dimensions=e}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}const Nn={map:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=1&version=297",road:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=2&version=297",img:"https://p{s}.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{reverseY}.jpg?version=229"};const{when:Gn,Rectangle:Wn}=Cesium;class qn extends Cesium.TileMapServiceImageryProvider{constructor(e){super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}const{Resource:In}=Cesium;class jn extends Cesium.WebMapServiceImageryProvider{constructor(e={}){O(e.parameters)||(e.parameters=jn.DefaultParameters),O(e.GetFeatureInfoDefaultParameters),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}jn.DefaultParameters=Object.assign({transparent:!0},Cesium.WebMapServiceImageryProvider.DefaultParameters,{format:"image/png"}),jn.GetFeatureInfoDefaultParameters=Cesium.WebMapServiceImageryProvider.GetFeatureInfoDefaultParameters;const{QuadtreeTileProvider:Vn,GeographicTilingScheme:zn,when:Hn,Event:Yn,Cartographic:Xn,Color:Jn,Entity:$n}=Cesium;e.BaiDuLayer=class extends Ie{constructor(e){(e=U(e,{})).url=U(e.url,"http://maponline{s}.bdimg.com/tile/?qt=vtile&styles=pl&scaler=1&udt=20200102"),e.customid&&(e.url=`https://api.map.baidu.com/customimage/tile?customid=${e.customid}`);const t=new Cesium.Cartesian2(-Rn,-An),r=new Cesium.Cartesian2(Rn,An);e.tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:r}),e.subdomains="123",super(e),this._rectangle=this._tilingScheme.rectangle}requestImage(e,t,r){const i=function(e,t,r,i){let n=e.url+"&x={x}&y={y}&z={z}";const o=e._tilingScheme.getNumberOfXTilesAtLevel(i),s=e._tilingScheme.getNumberOfYTilesAtLevel(i),a=4*Math.random()|0;return n=n.replace("{s}",a).replace("{x}",t-o/2).replace("{y}",s/2-r-1).replace("{z}",i),n}(this,e,t,r);return Cesium.ImageryProvider.loadImage(this,i)}},e.BingLayer=Fn,e.CesiumProError=t,e.CesiumProTerrainProvider=L,e.Cluster=ce,e.Event=i,e.GaoDeLayer=Bn,e.GeoJsonDataSource=Ut,e.GeoPoint=de,e.InfoBox=ui,e.LonLatNetLayer=class{constructor(e={}){const t=new be({rectangle:Cesium.Rectangle.MAX_VALUE,intervalOfZeorLevel:e.intervalOfZeorLevel});this._hasAlphaChannel=U(e.hasAlphaChannel,!0),this._tilingScheme=t,this._image=void 0,this._texture=void 0,this._errorEvent=new i,this._ready=!0,this._readyPromise=Cesium.when.defer(),this._readyPromise.resolve(!0),this._font=U(e.font,"bold 24px sans-serif"),this._color=U(e.color,"white"),this._borderColor=U(e.borderColor,"gold"),this._borderWidth=U(e.borderWidth,2),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=256,this.canvas.height=256,this.ctx.textBaseline="middle"}get hasAlphaChannel(){return this._hasAlphaChannel}get tileHeight(){return 256}get tileWidth(){return 256}get minimumLevel(){return 0}get maximumLevel(){return 4}get rectangle(){return Cesium.Rectangle.MAX_VALUE}get errorEvent(){return this._errorEvent}get tileDiscardPolicy(){}get readyPromise(){return this._readyPromise}get ready(){return!0}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}_resetStyle(){this.ctx.font=this.font,this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.borderColor,this.ctx.lineWidth=this.borderWidth}_clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getOffset(e,t,r){const i=this.tilingScheme.getDelatXY(r),n=Math.floor(e),o=Math.floor(t);if(n===e&&o===t)return[0,0,n,o];const s=e-n,a=t-o;let l=0,c=0;return s&&(l=this.tileWidth/i.dx*s),a&&(c=this.tileHeight/i.dy*a),[l,c,n,o]}requestImage(e,t,r,i){this._clearCanvas(),this._resetStyle();const{canvas:n,ctx:o}=this,s=this.tilingScheme.getLonLatValuee(r,e,t);return this.tilingScheme.tileXYToNativeRectangle(e,t,r),this.ctx.textAlign="left",o.fillText(s.lon,10,n.height/2),this.ctx.textAlign="center",o.fillText(s.lat,n.width/2,20),o.strokeRect(0,0,n.width,n.height),n}},e.LonlatTilingScheme=be,e.MassiveGraphicLayer=zi,e.MassiveGraphicLayerCollection=Yi,e.MassivePointLayer=class extends zi{constructor(e={}){e.objects=U(e.objects,[]),e.pixelSize=U(e.pixelSize,5),e.color=U(e.color,Jn.fromRandom),e.createGeometryFunction=function(t){return new $n({id:t.id,position:t.position,point:{pixelSize:U(t.pixelSize,e.pixelSize),color:U(t.color,e.color)}})},super(e)}},e.Model=mi,e.MultipleTerrainProvider=class{constructor(e,t={}){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=t.ellipsoid,this._requestVertexNormals=U(t.requestVertexNormals,!1),this._requestWaterMask=U(t.requestWaterMask,!1),this._requestMetadata=U(t.requestMetadata,!0),this._errorEvent=new i,this._terrainProviders=[];const r=[];for(let i of e){i.requestVertexNormals=i.requestVertexNormals||t.requestVertexNormals,i.requestWaterMask=i.requestWaterMask||t.requestWaterMask,i.requestMetadata=i.requestMetadata||t.requestMetadata;const e=new L(i);e.zIndex=i.zIndex||-1,this._terrainProviders.push(e),r.push(De(e,i.url))}this._ready=!1,this._readyPromise=xe.defer(),this._terrainList=e,Promise.all([...this._terrainProviders.map((e=>e.readyPromise)),...r]).then((e=>{this._ready=!0,this._readyPromise.resolve(!0),this._tilingScheme=this._terrainProviders[0]._tilingScheme,this._levelZeroMaximumGeometricError=Pe.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0))})),this._validProvider=void 0}get tilingScheme(){return this._tilingScheme}get ready(){return this._ready}get readyPromise(){return this._readyPromise}createBoundingRectangle(e){const t=new Te("multiple-terrain-provider");for(let e of this._terrainProviders)t.entities.add(ke(e));return e.addLayer(t),function(){const t=e.dataSources.getByName("multiple-terrain-provider");e.dataSources.remove(t[0])}}getLevelMaximumGeometricError(e){return this._validProvider?this._validProvider.getLevelMaximumGeometricError(e):this._levelZeroMaximumGeometricError/(1<<e)}getTileDataAvailable(e,t,r){const i=this._terrainProviders.filter((i=>i.getTileDataAvailable(e,t,r))).sort(((e,t)=>t.zIndex-e.zIndex));return this._validProvider=i[0],!!this._validProvider}requestTileGeometry(e,t,r,i){for(let i of this._terrainProviders)i!==this._validProvider&&i.getTileDataAvailable(e,t,r)&&i.requestTileGeometry(e,t,r);if(this._validProvider)return this._validProvider.requestTileGeometry(e,t,r)}},e.PbfDataSource=function(){},e.QuadTreeProvider=fn,e.Scene=Ni,e.Selection=qe,e.ShapefileDataSource=ti,e.TDTLayer=class extends On{constructor(e){const t=(e=U(e,{})).key;t||(console.warn("未定义key，地图服务将不可用"),console.warn("请前往http://lbs.tianditu.gov.cn/server/MapService.html获取地图key"));const r=U(e.tilingScheme,new Cesium.WebMercatorTilingScheme);let i="w",n="w",o=e.tileMatrixLabels;r instanceof Cesium.GeographicTilingScheme&&(i="c",n="c",O(o)||(o=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]));const s=U(e.layer,"img"),a=`http://t{s}.tianditu.com/${s}_${i}/wmts?service=wmts&tileMatrixSet=${n}&request=GetTile&version=1.0.0&LAYER=${s}&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=${t}`;return new Cesium.WebMapTileServiceImageryProvider({url:a,layer:s,style:e.style||"default",format:e.format||"tiles",tileMatrixSetID:"GoogleMapsCompatible",credit:e.credit?new Cesium.Credit(e.credit||""):null,tilingScheme:e.tilingScheme,maximumLevel:e.maximumLevel||19,minimumLevel:e.minimumLevel||0,tileMatrixLabels:o,subdomains:"01234567"})}static layers=[{layer:"vec",desc:"矢量底图"},{layer:"cva",desc:"矢量注记"},{layer:"img",desc:"影像底图"},{layer:"cia",desc:"影像注记"},{layer:"ter",desc:"地形晕渲"},{layer:"cta",desc:"地形注记"},{layer:"ibo",desc:"全球境界"},{layer:"eva",desc:"矢量英文注记"},{layer:"eia",desc:"影像英文注记"}]},e.TMSLayer=qn,e.TaskProcessor=class{constructor(e,t={}){this._workers=[],this._workerPath="workers/"+e,this._options=t,Math.max(X.hardwareConcurrency-1,1),this._worker=Q(this)}},e.TecentLayer=class extends Ie{constructor(e={}){e.layer=U(e.layer,"img"),e.subdomains="123",e.url=Nn[e.layer],e.customTags={sx:function(e,t,r,i){return t>>4},sy:function(e,t,r,i){return(1<<i)-r>>4}},super(e)}},e.TileDebugLayer=class{constructor(e={}){e.tileWidth=U(e.tileWidth,256),e.tileHeight=U(e.tileHeight,256),this._tilingScheme=O(e.tilingScheme)?e.tilingScheme:Ge.get("EPSG:4326",{ellipsoid:e.ellipsoid}),this._errorEvent=new i,this._tileWidth=U(e.tileWidth,256),this._tileHeight=U(e.tileHeight,256),this._readyPromise=Cesium.when.resolve(!0),this._font=U(e.font,"bold 24px sans-serif"),this._color=U(e.color,new Cesium.Color(1,1,1,1)),this._borderColor=U(e.borderColor,Cesium.Color.GOLD),this._borderWidth=U(e.borderWidth,2)}get ready(){return!0}get readyPromise(){return this._readyPromise}get hasAlphaChannel(){return!0}get errorEvent(){return this._errorEvent}get rectangle(){return this._tilingScheme.rectangle}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}createCanvas(){const e=document.createElement("canvas");e.width=this.tileWidth,e.height=this.tileHeight;const t=e.getContext("2d");return t.textBaseline="middle",t.textAlign="center",t.font=this.font,t.fillStyle=this.color.toCssColorString(),t.strokeStyle=this.borderColor.toCssColorString(),t.lineWidth=this.borderWidth,{canvas:e,ctx:t}}requestImage(e,t,r,i){const{canvas:n,ctx:o}=this.createCanvas(),s=function(e,t,r,i){let n=[];return n[0]="L: "+i,n[1]="X: "+t,e.reverseY?n[2]="Y: "+e.tilingScheme.getNumberOfYTilesAtLevel(i)-r-1:n[2]="Y: "+r,n}(this,e,t,r);return o.fillText(s[0],n.width/2,n.height/4*1),o.fillText(s[1],n.width/2,n.height/4*2),o.fillText(s[2],n.width/2,n.height/4*3),o.strokeRect(0,0,n.width,n.height),n}},e.TileLayer=class{constructor(e={}){this._errorEvent=new i,this._tilingScheme=Ge.get("EPSG:4326"),this._readyPromise=Gn.defer(),this._ready=!1,this._ready=!0,this._minimumLevel=U(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._tileWidth=U(e.tileWidth,256),this._tileHeight=U(e.tileHeight,256),this._rectangle=U(e.rectangle,Wn.MAX_VALUE),this._readyPromise.resolve(!0),this._errorEvent.addEventListener(((e,t,r)=>{}))}get minimumLevel(){return this._minimumLevel}get maximumLevel(){return this._maximumLevel}get errorEvent(){return this._errorEvent}get rectangle(){return this._rectangle}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get tilingScheme(){return this._tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}get tileHeight(){return this._tileHeight}get tileWidth(){return this._tileWidth}pickFeatures(e,t,r,i,n){}requestImage(e,t,r,i){return this.requestGeometry(e,t,r),Promise.reject(!1)}requestGeometry(e,t,r){}},e.Url=Y,e.VERSION="1.0.3",e.Viewer=Mn,e.WFSLayer=class{constructor(e={}){if(this._url=e.url,this._typeName=e.typeName,this._style=e.style,!O(this._url))throw new t("parameter url must be provided.");if(!O(this._typeName))throw new t("parameter typeName must be provided.");const r=new In({url:e.url,queryParameters:{service:"WFS",version:"1.0.0",request:"GetFeature",typeName:e.typeName,maxFeatures:50,outputFormat:"application/json"}});return Ut.load(r,this._style)}get rectangle(){return this._rectangle||this.tilingScheme.rectangle}get tilingScheme(){return Ge.get("EPSG:4326")}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get ready(){return this._ready}get readyPromise(){return this._readyPromise}},e.WMSLayer=jn,e.WMTSLayer=On,e.XYZLayer=Ie,e._shaderLine=function(){},e.computeDistancePerPixel=he,e.computeSceneCenterPoint=me,e.computeSceneExtent=ge,e.createDefaultLayer=je,e.createGuid=fe,e.dateFormat=pe,e.defaultValue=U,e.defined=O,e.proj=Ge,Object.defineProperty(e,"__esModule",{value:!0})}));
