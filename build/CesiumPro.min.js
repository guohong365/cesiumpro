!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CesiumPro={})}(this,(function(e){"use strict";class t extends Error{constructor(e){super(e),this.name="CesiumProError"}}function r(e,t){return t-e}t.throwInstantiationError=function(){throw new DeveloperError("This function defines an interface and should not be called directly.")},t.throwNoInstance=function(){throw new t("它的定义了一个接口，不能被以直接调用.")};class i{constructor(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}get numberOfListeners(){return this._listeners.length-this._toRemove.length}addEventListener(e,r){if("function"!=typeof e)throw new t("侦听器应该是一个函数");this._listeners.push(e),this._scopes.push(r);const i=this;return function(){i.removeEventListener(e,r)}}removeEventListener(e,r){if("function"!=typeof e)throw new t("侦听器应该是一个函数");const i=this._listeners,n=this._scopes;let o=-1;for(let t=0;t<i.length;t++)if(i[t]===e&&n[t]===r){o=t;break}return-1!==o&&(this._insideRaiseEvent?(this._toRemove.push(o),i[o]=void 0,n[o]=void 0):(i.splice(o,1),n.splice(o,1)),!0)}raise(){let e;this._insideRaiseEvent=!0;const t=this._listeners,i=this._scopes;let{length:n}=t;for(e=0;e<n;e++){const r=t[e];Cesium.defined(r)&&t[e].apply(i[e],arguments)}const o=this._toRemove;if(n=o.length,n>0){for(o.sort(r),e=0;e<n;e++){const r=o[e];t.splice(r,1),i.splice(r,1)}o.length=0}this._insideRaiseEvent=!1}}const{RequestState:n,when:o,AttributeCompression:s,BoundingSphere:a,Cartesian3:l,Credit:c,defaultValue:u,defined:h,DeveloperError:d,GeographicTilingScheme:m,WebMercatorTilingScheme:g,getJsonFromTypedArray:f,HeightmapTerrainData:p,IndexDatatype:v,OrientedBoundingBox:_,QuantizedMeshTerrainData:y,Request:C,RequestType:b,Resource:w,RuntimeError:x,TerrainProvider:S,TileAvailability:P,TileProviderError:E}=Cesium;function T(e){this.resource=e.resource,this.version=e.version,this.isHeightmap=e.isHeightmap,this.tileUrlTemplates=e.tileUrlTemplates,this.availability=e.availability,this.hasVertexNormals=e.hasVertexNormals,this.hasWaterMask=e.hasWaterMask,this.hasMetadata=e.hasMetadata,this.availabilityLevels=e.availabilityLevels,this.availabilityTilesLoaded=e.availabilityTilesLoaded,this.littleEndianExtensionSize=e.littleEndianExtensionSize,this.availabilityPromiseCache={}}function L(e){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=e.ellipsoid,this._requestVertexNormals=u(e.requestVertexNormals,!1),this._requestWaterMask=u(e.requestWaterMask,!1),this._requestMetadata=u(e.requestMetadata,!0),this._errorEvent=new i;var t=e.credit;"string"==typeof t&&(t=new c(t)),this._credit=t,this._availability=void 0;var r=o.defer();this._ready=!1,this._readyPromise=r,this._tileCredits=void 0;var n,s,a,l=this,d=this._layers=[],f="",p=[],v=0;function _(e){var t;if(!e.format)return t="The tile format is not specified in the layer.json file.",void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,x));if(!e.tiles||0===e.tiles.length)return t="The layer.json file does not specify any tile URL templates.",void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,x));var r=!1,i=!1,c=!1,u=!0,C=!1;if("heightmap-1.0"===e.format)C=!0,h(l._heightmapStructure)||(l._heightmapStructure={heightScale:.2,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),i=!0,l._requestWaterMask=!0;else if(0!==e.format.indexOf("quantized-mesh-1."))return t='The tile format "'+e.format+'" is invalid or not supported.',void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,x));var b,w=e.tiles,L=e.maxzoom;if(v=Math.max(v,L),e.projection&&"EPSG:4326"!==e.projection){if("EPSG:3857"!==e.projection)return t='The projection "'+e.projection+'" is invalid or not supported.',void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,x));l._tilingScheme=new g({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid})}else l._tilingScheme=new m({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid});if(l._levelZeroMaximumGeometricError=S.getEstimatedLevelZeroGeometricErrorForAHeightmap(l._tilingScheme.ellipsoid,l._heightmapWidth,l._tilingScheme.getNumberOfXTilesAtLevel(0)),e.scheme&&"tms"!==e.scheme&&"slippyMap"!==e.scheme)return t='The scheme "'+e.scheme+'" is invalid or not supported.',void(a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,x));l._scheme=e.scheme,h(e.extensions)&&-1!==e.extensions.indexOf("octvertexnormals")?r=!0:h(e.extensions)&&-1!==e.extensions.indexOf("vertexnormals")&&(r=!0,u=!1),h(e.extensions)&&-1!==e.extensions.indexOf("watermask")&&(i=!0),h(e.extensions)&&-1!==e.extensions.indexOf("metadata")&&(c=!0);var M,R=e.metadataAvailability,A=e.available;if(h(A)&&!h(R)){M=new P(l._tilingScheme,A.length);for(var k=0;k<A.length;++k){var F=A[k],D=l._tilingScheme.getNumberOfYTilesAtLevel(k);h(p[k])||(p[k]=[]);for(var B=0;B<F.length;++B){var U=F[B],G=D-U.endY-1,N=D-U.startY-1;p[k].push([U.startX,G,U.endX,N]),M.addAvailableTileRange(k,U.startX,G,U.endX,N)}}}else h(R)&&(b=new P(l._tilingScheme,L),M=new P(l._tilingScheme,L),p[0]=[[0,0,1,0]],M.addAvailableTileRange(0,0,0,1,0));l._hasWaterMask=l._hasWaterMask||i,l._hasVertexNormals=l._hasVertexNormals||r,l._hasMetadata=l._hasMetadata||c,h(e.attribution)&&(f.length>0&&(f+=" "),f+=e.attribution),d.push(new T({resource:n,version:e.version,isHeightmap:C,tileUrlTemplates:w,availability:M,hasVertexNormals:r,hasWaterMask:i,hasMetadata:c,availabilityLevels:R,availabilityTilesLoaded:b,littleEndianExtensionSize:u}));var O=e.parentUrl;if(h(O)){if(!h(M))return console.log("A layer.json can't have a parentUrl if it does't have an available array."),o.resolve();(n=n.getDerivedResource({url:O})).appendForwardSlash();var j=(s=n.getDerivedResource({url:"layer.json"})).fetchJson();return o(j,_,y)}return o.resolve()}function y(e){var t="An error occurred while accessing "+s.url+".";a=E.handleError(a,l,l._errorEvent,t,void 0,void 0,void 0,x)}function C(e){_(e).then((function(){if(!h(a)){var e=p.length;if(e>0)for(var t=l._availability=new P(l._tilingScheme,v),r=0;r<e;++r)for(var i=p[r],n=0;n<i.length;++n){var o=i[n];t.addAvailableTileRange(r,o[0],o[1],o[2],o[3])}if(f.length>0){var s=new c(f);h(l._tileCredits)?l._tileCredits.push(s):l._tileCredits=[s]}l._ready=!0,l._readyPromise.resolve(!0)}}))}function b(e){h(e)&&404===e.statusCode?C({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]}):y()}function x(){o(s.fetchJson()).then(C).otherwise(b)}o(e.url).then((function(e){var t=w.createIfNeeded(e);t.appendForwardSlash(),s=(n=t).getDerivedResource({url:"layer.json"}),l._tileCredits=t.credits,x()})).otherwise((function(e){r.reject(e)}))}var M=1,R=2,A=4;function k(e){return h(e)&&0!==e.length?{Accept:"application/vnd.quantized-mesh;extensions="+e.join("-")+",application/octet-stream;q=0.9,*/*;q=0.01"}:{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"}}function F(e,t,r,i,c,u){if(!h(c))return o.reject(new x("Terrain tile doesn't exist"));var d=c.tileUrlTemplates;if(0!==d.length){var m;if(e._scheme&&"tms"!==e._scheme)m=r;else m=e._tilingScheme.getNumberOfYTilesAtLevel(i)-r-1;var g,C,b=[];e._requestVertexNormals&&c.hasVertexNormals&&b.push(c.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),e._requestWaterMask&&c.hasWaterMask&&b.push("watermask"),e._requestMetadata&&c.hasMetadata&&b.push("metadata");var w=d[(t+m+i)%d.length],S=c.resource;h(S._ionEndpoint)&&!h(S._ionEndpoint.externalType)?(0!==b.length&&(C={extensions:b.join("-")}),g=k(void 0)):g=k(b);var P=S.getDerivedResource({url:w,templateValues:{version:c.version,z:i,x:t,y:m},queryParameters:C,headers:g,request:u});if(P.request.state!==n.ISSUED&&P.request.state!==n.ACTIVE){var E=P.fetchArrayBuffer();if(h(E))return E.then((function(n){return h(e._heightmapStructure)?function(e,t,r,i,n){var o=new Uint16Array(t,0,e._heightmapWidth*e._heightmapWidth);return new p({buffer:o,childTileMask:new Uint8Array(t,o.byteLength,1)[0],waterMask:new Uint8Array(t,o.byteLength+1,t.byteLength-o.byteLength-1),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure,credits:e._tileCredits})}(e,n):function(e,t,r,i,n,o){var c=o.littleEndianExtensionSize,u=0,d=3*Float64Array.BYTES_PER_ELEMENT,m=4*Float64Array.BYTES_PER_ELEMENT,g=3*Uint16Array.BYTES_PER_ELEMENT,p=Uint16Array.BYTES_PER_ELEMENT,C=3*p,b=new DataView(t),w=new l(b.getFloat64(u,!0),b.getFloat64(u+8,!0),b.getFloat64(u+16,!0));u+=d;var x=b.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var S=b.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var P=new a(new l(b.getFloat64(u,!0),b.getFloat64(u+8,!0),b.getFloat64(u+16,!0)),b.getFloat64(u+d,!0));u+=m;var E=new l(b.getFloat64(u,!0),b.getFloat64(u+8,!0),b.getFloat64(u+16,!0));u+=d;var T=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var L=new Uint16Array(t,u,3*T);u+=T*g,T>65536&&(C=3*(p=Uint32Array.BYTES_PER_ELEMENT));var k=L.subarray(0,T),F=L.subarray(T,2*T),D=L.subarray(2*T,3*T);s.zigZagDeltaDecode(k,F,D),u%p!=0&&(u+=p-u%p);var B=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var U=v.createTypedArrayFromArrayBuffer(T,t,u,3*B);u+=B*C;for(var G=0,N=U.length,O=0;O<N;++O){var j=U[O];U[O]=G-j,0===j&&++G}var W=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var I=v.createTypedArrayFromArrayBuffer(T,t,u,W);u+=W*p;var q=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var z=v.createTypedArrayFromArrayBuffer(T,t,u,q);u+=q*p;var V=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var H=v.createTypedArrayFromArrayBuffer(T,t,u,V);u+=V*p;var Y=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var X,J,Z=v.createTypedArrayFromArrayBuffer(T,t,u,Y);for(u+=Y*p;u<b.byteLength;){var $=b.getUint8(u,!0);u+=Uint8Array.BYTES_PER_ELEMENT;var Q=b.getUint32(u,c);if(u+=Uint32Array.BYTES_PER_ELEMENT,$===M&&e._requestVertexNormals)X=new Uint8Array(t,u,2*T);else if($===R&&e._requestWaterMask)J=new Uint8Array(t,u,Q);else if($===A&&e._requestMetadata){var K=b.getUint32(u,!0);if(K>0){var ee=f(new Uint8Array(t),u+Uint32Array.BYTES_PER_ELEMENT,K).available;if(h(ee))for(var te=0;te<ee.length;++te)for(var re=r+te+1,ie=ee[te],ne=e._tilingScheme.getNumberOfYTilesAtLevel(re),oe=0;oe<ie.length;++oe){var se=ie[oe],ae=ne-se.endY-1,le=ne-se.startY-1;e.availability.addAvailableTileRange(re,se.startX,ae,se.endX,le),o.availability.addAvailableTileRange(re,se.startX,ae,se.endX,le)}}o.availabilityTilesLoaded.addAvailableTileRange(r,i,n,i,n)}u+=Q}var ce=5*e.getLevelMaximumGeometricError(r),ue=e._tilingScheme.tileXYToRectangle(i,n,r),he=_.fromRectangle(ue,x,S,e._tilingScheme.ellipsoid);return new y({center:w,minimumHeight:x,maximumHeight:S,boundingSphere:P,orientedBoundingBox:he,horizonOcclusionPoint:E,quantizedVertices:L,encodedNormals:X,indices:U,westIndices:I,southIndices:z,eastIndices:H,northIndices:Z,westSkirtHeight:ce,southSkirtHeight:ce,eastSkirtHeight:ce,northSkirtHeight:ce,childTileMask:e.availability.computeChildMaskForTile(r,i,n),waterMask:J,credits:e._tileCredits})}(e,n,i,t,r,c)}))}}}function D(e,t,r,i){if(0!==i){var n=e.availabilityLevels,o=i%n==0?i-n:(i/n|0)*n,s=1<<i-o;return{level:o,x:t/s|0,y:r/s|0}}}function B(e,t,r,i,n,o){if(!h(n.availabilityLevels))return{result:!1};for(var s,a=function(){delete n.availabilityPromiseCache[s]},l=n.availabilityTilesLoaded,c=n.availability,u=D(n,t,r,i);h(u);){if(c.isTileAvailable(u.level,u.x,u.y)&&!l.isTileAvailable(u.level,u.x,u.y)){var d;if(!o&&(s=u.level+"-"+u.x+"-"+u.y,d=n.availabilityPromiseCache[s],!h(d))){var m=new C({throttle:!1,throttleByServer:!1,type:b.TERRAIN});d=F(e,u.x,u.y,u.level,n,m),h(d)&&(n.availabilityPromiseCache[s]=d,d.then(a))}return{result:!0,promise:d}}u=D(n,u.x,u.y,u.level)}return{result:!1}}function U(e,t){return null!=e?e:t}function G(e){return null!=e}L.prototype.requestTileGeometry=function(e,t,r,i){var n,o=this._layers,s=o.length;if(1===s)n=o[0];else for(var a=0;a<s;++a){var l=o[a];if(!h(l.availability)||l.availability.isTileAvailable(r,e,t)){n=l;break}}return F(this,e,t,r,n,i)},Object.defineProperties(L.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){return this._availability}}}),L.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},L.prototype.getTileDataAvailable=function(e,t,r){if(h(this._availability)){if(r>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(r,e,t))return!0;if(!this._hasMetadata)return!1;for(var i=this._layers,n=i.length,o=0;o<n;++o){if(B(this,e,t,r,i[o],0===o).result)return}return!1}},L.prototype.loadTileDataAvailability=function(e,t,r){if(!(!h(this._availability)||r>this._availability._maximumLevel||this._availability.isTileAvailable(r,e,t))&&this._hasMetadata)for(var i=this._layers,n=i.length,o=0;o<n;++o){var s=B(this,e,t,r,i[o],0===o);if(h(s.promise))return s.promise}},L._getAvailabilityTile=D;const N=/((?:.*\/)|^)CesiumPro\.js(?:\?|#|$)/;let O,j,W;function I(e){return"undefined"==typeof document?e:(G(O)||(O=document.createElement("a")),O.href=e,O.href=O.href,O.href)}function q(e){return I(`../${e}`)}function z(){if(G(j))return j;let e;if(e="undefined"!=typeof CESIUMPRO_BASE_URL?CESIUMPRO_BASE_URL:"object"==typeof window.define&&G(window.define.amd)&&!window.define.amd.toUrlUndefined?Cesium.getAbsoluteUri("..","core/Url.js"):function(){const e=document.getElementsByTagName("script");for(let t=0,r=e.length;t<r;++t){const r=e[t].getAttribute("src"),i=N.exec(r);if(null!==i)return i[1]}}(),!G(e))throw new t("Unable to determine CesiumPro base URL automatically, try defining a global variable called CESIUMPRO_BASE_URL.");return G(e)||(e=""),j=new Cesium.Resource({url:I(e)}),j.appendForwardSlash(),j}function V(e){return z().getDerivedResource({url:e}).url}function H(e){G(W)||(W="object"==typeof window.define&&G(window.define.amd)&&!window.define.amd.toUrlUndefined?q:V);return W(e)}const Y={join:function(...e){const t=[];for(let r of e)r.startsWith("/")&&(r=r.substring(1)),r.endsWith("/")&&(r=r.substring(0,r.length-1)),t.push(r);return t.join("/")},buildModuleUrl:function(e){return H(e)}};Y.getCesiumProBaseUrl=z;const{FeatureDetection:X,isCrossOriginUrl:J}=Cesium;let Z;function $(){return G(Z)||(Z=function(e){let t=Cesium.buildModuleUrl(e);if(J(t)){const e='importScripts("'+t+'");';let r;try{r=new Blob([e],{type:"application/javascript"})}catch(t){let i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(e),r=i.getBlob("application/javascript")}t=(window.URL||window.webkitURL).createObjectURL(r)}return t}("Workers/cesiumWorkerBootstrapper.js")),Z}function Q(e){const t=new Worker($());t.postMessage=U(t.webkitPostMessage,t.postMessage);const r={loaderConfig:{paths:{Workers:H("workers")},baseUrl:z().url},workerModule:e._workerPath};return t.postMessage(r),t.onmessage=function(t){!function(e,t){console.log(e,t,"------complete-----")}(e,t.data)},t.postMessage(e._options),t}const{kdbush:K,Cartesian3:ee,Cartographic:te,PointPrimitive:re,BoundingRectangle:ie,SceneMode:ne,EllipsoidalOccluder:oe}=Cesium;function se(e){return e.__pixel.x}function ae(e){return e.__pixel.y}function le(e,t){const r=new ie;return re.getScreenSpaceBoundingBox(e,t,r),function(e,t){e.x-=t,e.y-=t,e.width+=2*t,e.height+=2*t}(r,this.pixelRange),r}let ce;function ue(e){if(!e.scene.globe)return;const t=Cesium.getTimestamp(),r=e.scene;if(G(ce)&&t-ce<250)return;ce=t;const i=r.canvas.clientWidth,n=r.canvas.clientHeight,o=r.camera.getPickRay(new Cesium.Cartesian2(i/2,n/2)),s=r.camera.getPickRay(new Cesium.Cartesian2(i/2+1,n/2)),a=r.globe.pick(o,r),l=r.globe.pick(s,r);if(!G(a)||!G(l))return;return new Cesium.EllipsoidGeodesic(r.globe.ellipsoid.cartesianToCartographic(a),r.globe.ellipsoid.cartesianToCartographic(l)).surfaceDistance}class he{constructor(e,r,i){if(!G(e))throw new t("longitude is required.");if(!G(r))throw new t("latitude is required.");this.lon=e,this.lat=r,this.alt=U(i,0)}toPixel(e){return he.toPixel(this,e)}toCartesian(){return he.toCartesian(this)}toCartographic(){return he.toCartographic(this)}getRadias(){return{lon:Cesium.Math.toRadians(this.lon),lat:Cesium.Math.toRadians(this.lat),alt:alt}}isVisible(e){return he.isVisible(this,e)}toString(){return`{lon: ${this.lon}, lat: ${this.lat}, alt: ${this.alt}}`}toJson(){return{lon:this.lon,lat:this.lat,alt:this.alt}}static isVisible(e,r){if(r instanceof Cesium.Viewer)throw new t("viewer不是一个有效的Cesium.Viewer对象");if(!G(e))throw new t("point is not defined.");const i=he.toCartesian(e);if(r.scene.mode===Cesium.SceneMode.SCENE3D){if(!new Cesium.EllipsoidalOccluder(Cesium.Ellipsoid.WGS84,r.camera.position).isPointVisible(i))return!1;const t=he.toPixel(e,r.scene);if(!G(t))return!1;const n=r.canvas.width||r.canvas.clientWidth,o=r.canvas.height||r.canvas.clientHeight;return t.x>0&&t.x<n&&t.y>0&&t.y<o}if(r.scene.mode===Cesium.SceneMode.SCENE2D){const e=r.scene.camera.frustum,{positionWC:t,directionWC:n,upWC:o}=r.scene.camera,s=e.computeCullingVolume(t,n,o),a=Cesium.BoundingSphere.projectTo2D(new BoundingSphere(i,1)),l=s.computeVisibility(a);return l===Cesium.Intersect.INSIDE||l===Cesium.Intersect.INERSECTING}}static toPixel(e,r){if(!G(r))throw new t("scene未定义。");if(!G(e))throw new t("point is not defined.");const i=he.toCartesian(e);if(G(i))return Cesium.SceneTransforms.wgs84ToWindowCoordinates(r,i)}static toCartographic(e){if(!G(e))throw new t("point is not defined.");return Cesium.Cartographic.fromDegrees(e.lon,e.lat,e.alt)}static toCartesian(e,r){if(!G(e))throw new t("point is not defined.");if(e instanceof Cesium.Cartesian3)return e;if(e instanceof Cesium.Cartographic)return Cesium.Cartographic.toCartesian(e);if(e instanceof he)return Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt);if(e instanceof Cesium.Cartesian2){if(!r)return;const e=r.scene.camera.getPickRay(pixel);return r.scene.globe.pick(e,r.scene)}}static fromCartesian(e){if(!G(e))throw new t("cartesian is not defined.");const r=Cesium.Cartographic.fromCartesian(e);if(G(r))return he.fromCartographic(r)}static fromCartographic(e){if(!G(e))throw new t("cartographic is not defined.");return new he(Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height)}static fromPixel(e,r){if(!r.scene.globe)return;if(!G(e))throw new t("pixel is not defined.");if(r instanceof Cesium.Viewer==!1)throw new t("viewer不是一个有效的Cesium.Viewer对象");const i=r.scene.camera.getPickRay(e),n=r.scene.globe.pick(i,r.scene);return G(n)?he.fromCartesian(n):void 0}static fromDegrees(e,t,r){return new he(e,t,r)}static fromRadians(e,t,r){return new he(Cesium.Math.toDegrees(e),Cesium.Math.toDegrees(t),r)}static inChina(...e){if(1!==e.length){const t=+e[0],r=+e[1];return t>73.66&&t<135.05&&r>3.86&&r<53.55}{const t=e[0];if(e[0]instanceof he)return he.inChina(t.lon,t.lat)}}static fromLonlat(e){return new he(...e)}}function de(e){const t=e.canvas.getBoundingClientRect(),r=new Cesium.Cartesian2(t.width/2,t.height/2);return he.fromPixel(r,e)}function me(e){if(!e.scene.globe)return{};if(e.scene.mode===Cesium.SceneMode.SCENE3D){const t=e.camera.computeViewRectangle();if(!G(t))return;return{west:Cesium.Math.toDegrees(t.west),south:Cesium.Math.toDegrees(t.south),east:Cesium.Math.toDegrees(t.east),north:Cesium.Math.toDegrees(t.north)}}const t=e.canvas.getBoundingClientRect(),r=he.fromPixel(new Cesium.Cartesian2(0,t.height/2),e)||{lon:-180},i=he.fromPixel(new Cesium.Cartesian2(t.width,t.height/2),e)||{lon:180},n=he.fromPixel(new Cesium.Cartesian2(t.width/2,0),e)||{lat:90},o=he.fromPixel(new Cesium.Cartesian2(t.width/2,t.height),e)||{lat:-90};return{west:r.lon,south:o.lat,east:i.lon,north:n.lat}}function ge(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function fe(e,t){let r;const i={"y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()},n=Object.keys(i);for(const t of n)r=new RegExp(`(${t})`).exec(e),r&&(e=e.replace(r[1],1===r[1].length?i[t]:i[t].padStart(r[1].length,"0")));return e}window.Date.prototype.format=function(e){fe(e,this)};const pe="uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  ",ve="attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",{defaultValue:_e,destroyObject:ye,Matrix4:Ce,DrawCommand:be,BoxGeometry:we,Cartesian3:xe,defined:Se,GeometryPipeline:Pe,Transforms:Ee,VertexFormat:Te,BufferUsage:Le,CubeMap:Me,loadCubeMap:Re,RenderState:Ae,VertexArray:ke,BlendingState:Fe,SceneMode:De,ShaderProgram:Be,ShaderSource:Ue,Matrix3:Ge}=Cesium;const{Cartesian2:Ne,Rectangle:Oe,GeographicProjection:je,Ellipsoid:We}=Cesium,Ie=Cesium.Math;function qe(e){e=U(e,U.EMPTY_OBJECT),this._ellipsoid=U(e.ellipsoid,We.WGS84),this._rectangle=U(e.rectangle,Oe.MAX_VALUE),this._projection=new je(this._ellipsoid),this._numberOfLevelZeroTilesX=36,this._numberOfLevelZeroTilesY=18,this._intervalOfZeorLevel=U(e.intervalOfZeorLevel,16)}Object.defineProperties(qe.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),qe.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},qe.prototype.modifyLevel=function(e){return e<3?0:e<6?1:void 0},qe.prototype.getDelatXY=function(e){const t=this._intervalOfZeorLevel;return{dx:t/2**e,dy:t/2**e}},qe.prototype.getLonLatValuee=function(e,t,r){const i=this.getDelatXY(e);return{lon:i.dx*t-180,lat:90-i.dy*r}},qe.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},qe.prototype.rectangleToNativeRectangle=function(e,t){const r=Ie.toDegrees(e.west),i=Ie.toDegrees(e.south),n=Ie.toDegrees(e.east),o=Ie.toDegrees(e.north);return G(t)?(t.west=r,t.south=i,t.east=n,t.north=o,t):new Oe(r,i,n,o)},qe.prototype.tileXYToNativeRectangle=function(e,t,r,i){const n=this.tileXYToRectangle(e,t,r,i);return n.west=Ie.toDegrees(n.west),n.south=Ie.toDegrees(n.south),n.east=Ie.toDegrees(n.east),n.north=Ie.toDegrees(n.north),n},qe.prototype.tileXYToRectangle=function(e,t,r,i){var n=this._rectangle,o=this.getNumberOfXTilesAtLevel(r),s=this.getNumberOfYTilesAtLevel(r),a=n.width/o,l=e*a+n.west,c=(e+1)*a+n.west,u=n.height/s,h=n.north-t*u,d=n.north-(t+1)*u;return G(i)||(i=new Oe(l,d,c,h)),i.west=l,i.south=d,i.east=c,i.north=h,i},qe.prototype.positionToTileXY=function(e,t,r){var i=this._rectangle;if(Oe.contains(i,e)){var n=this.getNumberOfXTilesAtLevel(t),o=this.getNumberOfYTilesAtLevel(t),s=i.width/n,a=i.height/o,l=e.longitude;i.east<i.west&&(l+=Ie.TWO_PI);var c=(l-i.west)/s|0;c>=n&&(c=n-1);var u=(i.north-e.latitude)/a|0;return u>=o&&(u=o-1),G(r)?(r.x=c,r.y=u,r):new Ne(c,u)}};const{CesiumTerrainProvider:ze,when:Ve,TerrainProvider:He,Resource:Ye,CustomDataSource:Xe,Cartesian3:Je,Entity:Ze,Color:$e,Rectangle:Qe}=Cesium;function Ke(e){let t=[];const r=[e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north];return"EPSG:4326"===e.projection.toUpperCase()&&(t=[r[0],r[1],r[0],r[3],r[2],r[3],r[2],r[1],r[0],r[1]]),new Ze({polyline:{positions:Je.fromRadiansArray(t),material:$e.fromRandom({alpha:1}),width:3,clampToGround:!0}})}function et(e,t){const r=Ye.createIfNeeded(t);r.appendForwardSlash();const i=r.getDerivedResource({url:"layer.json"});return new Promise(((t,r)=>{Ve(i.fetchJson()).then((r=>{e.projection=r.projection,e.bounds=Qe.fromDegrees(...r.valid_bounds),t(!0)}))}))}const tt=52.35987755982988,rt=3.141592653589793,it=6378245,nt=.006693421622965943;function ot(e,t){let r=this.transformLng(e-105,t-35),i=this.transformLat(e-105,t-35);const n=t/180*rt;let o=Math.sin(n);o=1-nt*o*o;const s=Math.sqrt(o);return r=180*r/(it/s*Math.cos(n)*rt),i=180*i/(it*(1-nt)/(o*s)*rt),[r,i]}const st={get:function(e="EPSG:3857",r){const i=e.toUpperCase();if("EPSG:3857"===i)return new Cesium.WebMercatorTilingScheme(r);if("EPSG:4326"===i)return new Cesium.GeographicTilingScheme(r);throw new t("未知的坐标系.")},BD09ToGCJ02:function(e,t){const r=+e-.0065,i=+t-.006,n=Math.sqrt(r*r+i*i)-2e-5*Math.sin(i*tt),o=Math.atan2(i,r)-3e-6*Math.cos(r*tt);return[n*Math.cos(o),n*Math.sin(o)]},GCJ02ToBD09:function(e,t){t=+t,e=+e;const r=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*tt),i=Math.atan2(t,e)+3e-6*Math.cos(e*tt);return[r*Math.cos(i)+.0065,r*Math.sin(i)+.006]},WGS84ToGCJ02:function(e,t){if(t=+t,e=+e,he.inChina(e,t)){const r=ot(e,t);return[e+r[0],t+r[1]]}return[e,t]},GCJ02ToWGS84:function(e,t){if(t=+t,e=+e,he.inChina(e,t)){const r=ot(e,t);return[2*e-(e+r[0]),2*t-(t+r[1])]}return[e,t]}},{Color:at}=Cesium;class lt{constructor(){}static pointColor=at.AQUA;static fillColor=at.AQUA;static strokeColor=at.AQUA}class ct extends Cesium.UrlTemplateImageryProvider{constructor(e){"string"==typeof e&&(e={url:e}),e.getFeatureInfoFormats=U(e.getFeatureInfoFormats,ct.defaultFeatureInfoFormats),super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get rectangle(){return super.rectangle}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}function ut(){return new ct({url:Y.buildModuleUrl("assets/tiles/{z}/{x}/{y}.png"),maximumLevel:4})}ct.defaultFeatureInfoFormats=Object.freeze([Object.freeze(new Cesium.GetFeatureInfoFormat("json","application/json")),Object.freeze(new Cesium.GetFeatureInfoFormat("xml","text/xml")),Object.freeze(new Cesium.GetFeatureInfoFormat("text","text/html"))]);const{defined:ht,defaultValue:dt,ColorMaterialProperty:mt,ConstantPositionProperty:gt,ConstantProperty:ft,DataSource:pt,PolygonGraphics:vt,PolylineGraphics:_t,EntityCluster:yt,PinBuilder:Ct,createGuid:bt,Cartesian3:wt,PointGraphics:xt,ArcType:St,PolygonHierarchy:Pt,Color:Et,EntityCollection:Tt,HeightReference:Lt,when:Mt,Resource:Rt,describe:At,Event:kt}=Cesium,Ft={small:24,medium:48,large:64},Dt={},Bt={},Ut={"urn:ogc:def:crs:OGC:1.3:CRS84":rr,"EPSG:4326":rr,"urn:ogc:def:crs:EPSG::4326":rr},Gt=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"],Nt={Feature:It,FeatureCollection:function(e,t,r,i,n){for(var o=t.features,s=0,a=o.length;s<a;s++)It(e,o[s],void 0,i,n)},GeometryCollection:qt,LineString:Jt,MultiLineString:Zt,MultiPoint:Ht,MultiPolygon:Kt,Point:Vt,Polygon:Qt,Topology:er},Ot={GeometryCollection:qt,LineString:Jt,MultiLineString:Zt,MultiPoint:Ht,MultiPolygon:Kt,Point:Vt,Polygon:Qt,Topology:er};function jt(e,t){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function Wt(e,t,r){var i=e.id;if(ht(i)&&"Feature"===e.type){for(var n=2,o=i;ht(t.getById(o));)o=i+"_"+n,n++;i=o}else i=bt();var s=t.getOrCreateEntity(i),a=e.properties;if(ht(a)){var l;s.properties=a;var c=a.title;if(ht(c))s.name=c,l="title";else{var u=Number.MAX_VALUE;for(var h in a)if(a.hasOwnProperty(h)&&a[h]){var d=h.toLowerCase();if(u>1&&"title"===d){u=1,l=h;break}u>2&&"name"===d?(u=2,l=h):u>3&&/title/i.test(h)?(u=3,l=h):u>4&&/name/i.test(h)&&(u=4,l=h)}ht(l)&&(s.name=a[l])}var m=a.description;null!==m&&(s.description=ht(m)?new ft(m):r(a,l))}return s}function It(e,r,i,n,o){if(null!==r.geometry){if(!ht(r.geometry))throw new t("feature.geometry is required.");var s=r.geometry.type,a=Ot[s];if(!ht(a))throw new t("Unknown geometry type: "+s);a(e,r,r.geometry,n,o)}else Wt(r,e._entityCollection,o.describe)}function qt(e,r,i,n,o){for(var s=i.geometries,a=0,l=s.length;a<l;a++){var c=s[a],u=c.type,h=Ot[u];if(!ht(h))throw new t("Unknown geometry type: "+u);h(e,r,c,n,o)}}function zt(e,t,r,i,n){let o=n.pointSize,s=n.pointColor;const a=t.properties;if(ht(a)){const e=a["point-color"];ht(e)&&(s=Et.fromCssColorString(e)),o=dt(Ft[a["point-size"]],o)}const l=new xt;2===i.length&&n.clampToGround&&(l.heightReference=Lt.CLAMP_TO_GROUND);const c=Wt(t,e._entityCollection,n.describe);c.point=l,c.point.color=s,c.point.pixelSize=o,c.position=new gt(r(i))}function Vt(e,t,r,i,n){zt(e,t,i,r.coordinates,n)}function Ht(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)zt(e,t,i,o[s],n)}function Yt(e,t,r,i,n){const o=n.lineColor,s=n.lineWidth,a=t.properties;if(ht(a)){const e=a["stroke-width"];let t;ht(e)&&(s=new ft(e));let r=a.stroke;ht(r)&&(t=Et.fromCssColorString(r));let i=a["stroke-opacity"];ht(i)&&1!==i&&(ht(t)||(t=o.color.clone()),t.alpha=i),ht(t)&&(o=new mt(t))}const l=Wt(t,e._entityCollection,n.describe),c=new _t;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=s,c.positions=new ft(jt(i,r)),c.arcType=St.RHUMB}function Xt(e,t){var r="";for(var i in e)if(e.hasOwnProperty(i)){if(i===t||-1!==Gt.indexOf(i))continue;var n=e[i];ht(n)&&(r+="object"==typeof n?"<tr><th>"+i+"</th><td>"+Xt(n)+"</td></tr>":"<tr><th>"+i+"</th><td>"+n+"</td></tr>")}return r.length>0&&(r='<table class="cesium-infoBox-defaultTable"><tbody>'+r+"</tbody></table>"),r}function Jt(e,t,r,i,n){Yt(e,t,i,r.coordinates,n)}function Zt(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)Yt(e,t,i,o[s],n)}function $t(e,t,r,i,n){if(0===i.length||0===i[0].length)return;let o=n.outlineColor.color,s=n.fill,a=n.outlineWidth;const l=t.properties;if(ht(l)){const e=l["stroke-width"];let t;ht(e)&&(a=new ft(e));const r=l.stroke;ht(r)&&(t=Et.fromCssColorString(r));let i,c=l["stroke-opacity"];ht(c)&&1!==c&&(ht(t)||(t=n.outlineColor.color.clone()),t.alpha=c),ht(t)&&(o=new ft(t));const u=l.fill;ht(u)&&(i=Et.fromCssColorString(u),i.alpha=s.color.alpha),c=l["fill-opacity"],ht(c)&&c!==s.color.alpha&&(ht(i)||(i=s.color.clone()),i.alpha=c),ht(i)&&(s=new mt(i))}const c=new vt;c.outline=new ft(n.outline),c.outlineColor=o,c.outlineWidth=a,c.material=s,c.arcType=St.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let r of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(r);ht(e)&&ht(e[1])&&(t=t.replace(r,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const h=[];for(var d=1,m=i.length;d<m;d++)h.push(new Pt(jt(i[d],r)));const g=i[0];c.hierarchy=new ft(new Pt(jt(g,r),h)),g[0].length>2?c.perPositionHeight=new ft(!0):n.clampToGround||(c.height=0);Wt(t,e._entityCollection,n.describe).polygon=c}function Qt(e,t,r,i,n){$t(e,t,i,r.coordinates,n)}function Kt(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)$t(e,t,i,o[s],n)}function er(e,t,r,i,n){for(var o in r.objects)if(r.objects.hasOwnProperty(o)){var s=topojson.feature(r,r.objects[o]);(0,Nt[s.type])(e,s,s,i,n)}}function tr(e,t){return new Cesium.CallbackProperty(function(e,t,r){var i;return function(n,o){return ht(i)||(i=e(t,r)),i}}(Xt,e,t),!0)}function rr(e){return wt.fromDegrees(e[0],e[1],e[2])}class ir{constructor(e){this._name=e,this._changed=new kt,this._error=new kt,this._isLoading=!1,this._loading=new kt,this._entityCollection=new Tt(this),this._promises=[],this._pinBuilder=new Ct,this._entityCluster=new yt,this._credit=void 0,this._resourceCredits=[]}static pointSize=5;static pointColor=Et.ROYALBLUE;static lineColor=Et.YELLOW;static fill=Et.fromBytes(255,255,0,100);static outline=!0;static outlineColor=Et.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return Ut}static crsLinkHrefs(){return Dt}static crsLinkTypes(){return Bt}get entities(){return this._entityCollection}get name(){return this._name}set name(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}get clock(){}get isLoading(){return this._isLoading}get changedEvent(){return this._changed}get errorEvent(){return this._error}get loadingEvent(){return this._loading}get show(){return this._entityCollection.show}set show(e){this._entityCollection.show=e}get clustering(){return this._entityCluster}set clustering(e){this._entityCluster=e}get credit(){return this._credit}load(e,r){pt.setLoading(this,!0);let i=(r=dt(r,{})).credit;"string"==typeof i&&(i=new Credit(i)),this._credit=i;let n=e,o=r.sourceUri;if("string"==typeof e||e instanceof Rt){n=(e=Rt.createIfNeeded(e)).fetchJson(),o=dt(o,e.getUrlComponent());const t=this._resourceCredits,r=e.credits;if(ht(r)){const e=r.length;for(const i=0;i<e;i++)t.push(r[i])}}r={describe:dt(r.describe,tr),pointSize:dt(r.pointSize,ir.pointSize),pointColor:dt(r.pointColor,ir.pointColor),lineWidth:new ft(dt(r.lineWidth,ir.lineWidth)),outlineColor:new mt(dt(r.outlineColor,ir.outlineColor)),lineColor:new mt(dt(r.lineColor,ir.lineColor)),outlineWidth:dt(r.outlineWidth,ir.outlineWidth),fill:new mt(dt(r.fill,ir.fill)),outline:dt(r.outline,ir.outline),clampToGround:dt(r.clampToGround,ir.clampToGround),extrudedHeight:r.extrudedHeight};const s=this;return Mt(n,(function(e){return function(e,r,i,n){let o;ht(n)&&(o=Cesium.getFilenameFromUri(n)),ht(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const s=Nt[r.type];if(!ht(s))throw new t("Unsupported GeoJSON object type: "+r.type);const a=r.crs;let l=null!==a?rr:null;if(ht(a)){if(!ht(a.properties))throw new t("crs.properties is undefined.");const e=a.properties;if("name"===a.type){if(l=Ut[e.name],!ht(l))throw new t("Unknown crs name: "+e.name)}else if("link"===a.type){var c=Dt[e.href];if(ht(c)||(c=Bt[e.type]),!ht(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==a.type)throw new t("Unknown crs type: "+a.type);if(l=Ut["EPSG:"+e.code],!ht(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&s(e,r,r,t,i),Cesium.when.all(e._promises,(function(){return e._promises.length=0,pt.setLoading(e,!1),e}))}))}(s,e,r,o)})).otherwise((function(e){return pt.setLoading(s,!1),s._error.raiseEvent(s,e),console.log(e),Mt.reject(e)}))}update(){return!0}}ir.load=function(e,t){return(new ir).load(e,t)};const nr={};function or(e){return new sr(e instanceof Uint8Array?e:new Uint8Array(e))}function sr(e){this._array=e}sr.prototype.read=function(){var e=this._array;return this._array=null,Promise.resolve(e?{done:!1,value:e}:{done:!0,value:void 0})},sr.prototype.cancel=function(){return this._array=null,Promise.resolve()};var ar=function(e){return fetch(e).then((function(e){return e.body&&e.body.getReader?e.body.getReader():e.arrayBuffer().then(or)}))},lr=function(e){return new Promise((function(t,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onload=function(){t(or(i.response))},i.onerror=r,i.ontimeout=r,i.open("GET",e,!0),i.send()}))};function cr(e){return("function"==typeof fetch?ar:lr)(e)}function ur(e){return"function"==typeof e.read?e:e.getReader()}var hr=new Uint8Array(0);function dr(e,t){if(!e.length)return t;if(!t.length)return e;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function mr(e){return"function"==typeof e.slice?e:new gr("function"==typeof e.read?e:e.getReader())}function gr(e){this._source=e,this._array=hr,this._index=0}gr.prototype.read=function(){var e=this,t=e._array.subarray(e._index);return e._source.read().then((function(r){return e._array=hr,e._index=0,r.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:dr(t,r.value)}}))},gr.prototype.slice=function(e){if((e|=0)<0)throw new Error("invalid length");var t=this,r=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var i=new Uint8Array(e);return i.set(this._array.subarray(this._index)),function n(){return t._source.read().then((function(o){return o.done?(t._array=hr,t._index=0,r>0?i.subarray(0,r):null):r+o.value.length>=e?(t._array=o.value,t._index=e-r,i.set(o.value.subarray(0,e-r),r),i):(i.set(o.value,r),r+=o.value.length,n())}))}()},gr.prototype.cancel=function(){return this._source.cancel()};var fr=function(e){return!(e=e.trim())||isNaN(e=+e)?null:e},pr={B:fr,C:function(e){return e.trim()||null},D:function(e){return new Date(+e.substring(0,4),e.substring(4,6)-1,+e.substring(6,8))},F:fr,L:function(e){return!/^[nf]$/i.test(e)&&(!!/^[yt]$/i.test(e)||null)},M:fr,N:fr},vr=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},_r=function(e,t){return(e=mr(e)).slice(32).then((function(r){var i=vr(r);return e.slice(i.getUint16(8,!0)-32).then((function(r){return new yr(e,t,i,vr(r))}))}))};function yr(e,t,r,i){this._source=e,this._decode=t.decode.bind(t),this._recordLength=r.getUint16(10,!0),this._fields=[];for(var n=0;13!==i.getUint8(n);n+=32){for(var o=0;o<11&&0!==i.getUint8(n+o);++o);this._fields.push({name:this._decode(new Uint8Array(i.buffer,i.byteOffset+n,o)),type:String.fromCharCode(i.getUint8(n+11)),length:i.getUint8(n+16)})}}var Cr=yr.prototype;Cr.read=function(){var e=this,t=1;return e._source.slice(e._recordLength).then((function(r){return r&&26!==r[0]?{done:!1,value:e._fields.reduce((function(i,n){return i[n.name]=pr[n.type](e._decode(r.subarray(t,t+=n.length))),i}),{})}:{done:!0,value:void 0}}))},Cr.cancel=function(){return this._source.cancel()};var br=function(e){var t,r=40,i=e.getInt32(36,!0),n=new Array(i);for(t=0;t<i;++t,r+=16)n[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return{type:"MultiPoint",coordinates:n}},wr=function(e){return{type:"Point",coordinates:[e.getFloat64(4,!0),e.getFloat64(12,!0)]}},xr=function(e){var t,r=44,i=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(i),s=new Array(n),a=[],l=[];for(t=0;t<i;++t,r+=4)o[t]=e.getInt32(r,!0);for(t=0;t<n;++t,r+=16)s[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return o.forEach((function(e,t){var r=s.slice(e,o[t+1]);!function(e){if((t=e.length)<4)return!1;var t,r=0,i=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];for(;++r<t;)i+=e[r-1][1]*e[r][0]-e[r-1][0]*e[r][1];return i>=0}(r)?l.push(r):a.push([r])})),l.forEach((function(e){a.some((function(t){if(function(e,t){var r,i=-1,n=t.length;for(;++i<n;)if(r=Sr(e,t[i]))return r>0;return!1}(t[0],e))return t.push(e),!0}))||a.push([e])})),1===a.length?{type:"Polygon",coordinates:a[0]}:{type:"MultiPolygon",coordinates:a}};function Sr(e,t){for(var r=t[0],i=t[1],n=-1,o=0,s=e.length,a=s-1;o<s;a=o++){var l=e[o],c=l[0],u=l[1],h=e[a],d=h[0],m=h[1];if(Pr(l,h,t))return 0;u>i!=m>i&&r<(d-c)*(i-u)/(m-u)+c&&(n=-n)}return n}function Pr(e,t,r){var i=r[0]-e[0],n=r[1]-e[1];if(0===i&&0===n)return!0;var o=t[0]-e[0],s=t[1]-e[1];if(0===o&&0===s)return!1;var a=(i*o+n*s)/(o*o+s*s);return!(a<0||a>1)&&(0===a||1===a||a*o===i&&a*s===n)}var Er=function(e){var t,r=44,i=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(i),s=new Array(n);for(t=0;t<i;++t,r+=4)o[t]=e.getInt32(r,!0);for(t=0;t<n;++t,r+=16)s[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return 1===i?{type:"LineString",coordinates:s}:{type:"MultiLineString",coordinates:o.map((function(e,t){return s.slice(e,o[t+1])}))}},Tr=function(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},Lr={0:function(){return null},1:wr,3:Er,5:xr,8:br,11:wr,13:Er,15:xr,18:br,21:wr,23:Er,25:xr,28:br},Mr=function(e){return(e=mr(e)).slice(100).then((function(t){return new Rr(e,vr(t))}))};function Rr(e,t){var r=t.getInt32(32,!0);if(!(r in Lr))throw new Error("unsupported shape type: "+r);this._source=e,this._type=r,this._index=0,this._parse=Lr[r],this.bbox=[t.getFloat64(36,!0),t.getFloat64(44,!0),t.getFloat64(52,!0),t.getFloat64(60,!0)]}var Ar=Rr.prototype;function kr(){}Ar.read=function(){var e=this;return++e._index,e._source.slice(12).then((function(t){if(null==t)return{done:!0,value:void 0};var r=vr(t);function i(){return e._source.slice(4).then((function(o){return null==o?{done:!0,value:void 0}:(r=vr(t=Tr(t.slice(4),o))).getInt32(0,!1)!==e._index?i():n()}))}function n(){var n=2*r.getInt32(4,!1)-4,o=r.getInt32(8,!0);return n<0||o&&o!==e._type?i():e._source.slice(n).then((function(r){return{done:!1,value:o?e._parse(vr(Tr(t.slice(8),r))):null}}))}return n()}))},Ar.cancel=function(){return this._source.cancel()};function Fr(e,t){this._shp=e,this._dbf=t,this.bbox=e.bbox}var Dr=Fr.prototype;function Br(e,t,r){return"string"==typeof t?(/\.dbf$/.test(t)||(t+=".dbf"),t=cr(t)):t instanceof ArrayBuffer||t instanceof Uint8Array?t=or(t):null!=t&&(t=ur(t)),"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),void 0===t&&(t=cr(e.substring(0,e.length-4)+".dbf").catch((function(){}))),e=cr(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?or(e):ur(e),Promise.all([e,t]).then((function(e){var t,i,n,o=e[0],s=e[1],a="windows-1252";return r&&null!=r.encoding&&(a=r.encoding),t=o,i=s,n=s&&new TextDecoder(a),Promise.all([Mr(t),i&&_r(i,n)]).then((function(e){return new Fr(e[0],e[1])}))}))}Dr.read=function(){var e=this;return Promise.all([e._dbf?e._dbf.read():{value:{}},e._shp.read()]).then((function(e){var t=e[0],r=e[1];return r.done?r:{done:!1,value:{type:"Feature",properties:t.value,geometry:r.value}}}))},Dr.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(kr)},nr.open=Br,nr.openShp=function(e,t){return"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),e=cr(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?or(e):ur(e),Promise.resolve(e).then(Mr)},nr.openDbf=function(e,t){var r="windows-1252";return t&&null!=t.encoding&&(r=t.encoding),r=new TextDecoder(r),"string"==typeof e?(/\.dbf$/.test(e)||(e+=".dbf"),e=cr(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?or(e):ur(e),Promise.resolve(e).then((function(e){return _r(e,r)}))},nr.read=function(e,t,r){return Br(e,t,r).then((function(e){var t=[],r={type:"FeatureCollection",features:t,bbox:e.bbox};return e.read().then((function i(n){return n.done?r:(t.push(n.value),e.read().then(i))}))}))},Object.defineProperty(nr,"__esModule",{value:!0});const{defined:Ur,defaultValue:Gr,ColorMaterialProperty:Nr,ConstantPositionProperty:Or,ConstantProperty:jr,DataSource:Wr,PolygonGraphics:Ir,PolylineGraphics:qr,createGuid:zr,Cartesian3:Vr,PointGraphics:Hr,ArcType:Yr,PolygonHierarchy:Xr,Color:Jr,HeightReference:Zr,Resource:$r}=Cesium,Qr={small:24,medium:48,large:64},Kr={},ei={},ti={"urn:ogc:def:crs:OGC:1.3:CRS84":bi,"EPSG:4326":bi,"urn:ogc:def:crs:EPSG::4326":bi},ri={Feature:si,FeatureCollection:function(e,t,r,i,n){for(var o=t.features,s=0,a=o.length;s<a;s++)si(e,o[s],void 0,i,n)},GeometryCollection:ai,LineString:di,MultiLineString:mi,MultiPoint:ui,MultiPolygon:pi,Point:ci,Polygon:fi,Topology:vi},ii={GeometryCollection:ai,LineString:di,MultiLineString:mi,MultiPoint:ui,MultiPolygon:pi,Point:ci,Polygon:fi,Topology:vi};function ni(e,t){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function oi(e,t,r){var i=e.id;if(Ur(i)&&"Feature"===e.type){for(var n=2,o=i;Ur(t.getById(o));)o=i+"_"+n,n++;i=o}else i=zr();var s=t.getOrCreateEntity(i),a=e.properties;if(Ur(a)){var l;s.properties=a;var c=a.title;if(Ur(c))s.name=c,l="title";else{var u=Number.MAX_VALUE;for(var h in a)if(a.hasOwnProperty(h)&&a[h]){var d=h.toLowerCase();if(u>1&&"title"===d){u=1,l=h;break}u>2&&"name"===d?(u=2,l=h):u>3&&/title/i.test(h)?(u=3,l=h):u>4&&/name/i.test(h)&&(u=4,l=h)}Ur(l)&&(s.name=a[l])}var m=a.description;null!==m&&(s.description=Ur(m)?new jr(m):r(a,l))}return s}function si(e,r,i,n,o){if(null!==r.geometry){if(!Ur(r.geometry))throw new t("feature.geometry is required.");var s=r.geometry.type,a=ii[s];if(!Ur(a))throw new t("Unknown geometry type: "+s);a(e,r,r.geometry,n,o)}else oi(r,e._entityCollection,o.describe)}function ai(e,r,i,n,o){for(var s=i.geometries,a=0,l=s.length;a<l;a++){var c=s[a],u=c.type,h=ii[u];if(!Ur(h))throw new t("Unknown geometry type: "+u);h(e,r,c,n,o)}}function li(e,t,r,i,n){let o=n.pointSize,s=n.pointColor;const a=t.properties;if(Ur(a)){const e=a["point-color"];Ur(e)&&(s=Jr.fromCssColorString(e)),o=Gr(Qr[a["point-size"]],o)}const l=new Hr;2===i.length&&n.clampToGround&&(l.heightReference=Zr.CLAMP_TO_GROUND);const c=oi(t,e._entityCollection,n.describe);c.point=l,c.point.color=s,c.point.pixelSize=o,c.position=new Or(r(i))}function ci(e,t,r,i,n){li(e,t,i,r.coordinates,n)}function ui(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)li(e,t,i,o[s],n)}function hi(e,t,r,i,n){const o=n.lineColor,s=n.lineWidth,a=t.properties;if(Ur(a)){const e=a["stroke-width"];let t;Ur(e)&&(s=new jr(e));let r=a.stroke;Ur(r)&&(t=Jr.fromCssColorString(r));let i=a["stroke-opacity"];Ur(i)&&1!==i&&(Ur(t)||(t=o.color.clone()),t.alpha=i),Ur(t)&&(o=new Nr(t))}const l=oi(t,e._entityCollection,n.describe),c=new qr;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=s,c.positions=new jr(ni(i,r)),c.arcType=Yr.RHUMB}function di(e,t,r,i,n){hi(e,t,i,r.coordinates,n)}function mi(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)hi(e,t,i,o[s],n)}function gi(e,t,r,i,n){if(0===i.length||0===i[0].length)return;let o=n.outlineColor.color,s=n.fill,a=n.outlineWidth;const l=t.properties;if(Ur(l)){const e=l["stroke-width"];let t;Ur(e)&&(a=new jr(e));const r=l.stroke;Ur(r)&&(t=Jr.fromCssColorString(r));let i,c=l["stroke-opacity"];Ur(c)&&1!==c&&(Ur(t)||(t=n.outlineColor.color.clone()),t.alpha=c),Ur(t)&&(o=new jr(t));const u=l.fill;Ur(u)&&(i=Jr.fromCssColorString(u),i.alpha=s.color.alpha),c=l["fill-opacity"],Ur(c)&&c!==s.color.alpha&&(Ur(i)||(i=s.color.clone()),i.alpha=c),Ur(i)&&(s=new Nr(i))}const c=new Ir;c.outline=new jr(n.outline),c.outlineColor=o,c.outlineWidth=a,c.material=s,c.arcType=Yr.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let r of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(r);Ur(e)&&Ur(e[1])&&(t=t.replace(r,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const h=[];for(var d=1,m=i.length;d<m;d++)h.push(new Xr(ni(i[d],r)));const g=i[0];c.hierarchy=new jr(new Xr(ni(g,r),h)),g[0].length>2?c.perPositionHeight=new jr(!0):n.clampToGround||(c.height=0);oi(t,e._entityCollection,n.describe).polygon=c}function fi(e,t,r,i,n){gi(e,t,i,r.coordinates,n)}function pi(e,t,r,i,n){for(var o=r.coordinates,s=0;s<o.length;s++)gi(e,t,i,o[s],n)}function vi(e,t,r,i,n){for(var o in r.objects)if(r.objects.hasOwnProperty(o)){var s=topojson.feature(r,r.objects[o]);(0,ri[s.type])(e,s,s,i,n)}}function _i(e,t){var r="";for(var i in e)if(e.hasOwnProperty(i)){if(i===t||-1!==yi.indexOf(i))continue;var n=e[i];Ur(n)&&(r+="object"==typeof n?"<tr><th>"+i+"</th><td>"+_i(n)+"</td></tr>":"<tr><th>"+i+"</th><td>"+n+"</td></tr>")}return r.length>0&&(r='<table class="cesium-infoBox-defaultTable"><tbody>'+r+"</tbody></table>"),r}const yi=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"];function Ci(e,t){return new Cesium.CallbackProperty(function(e,t,r){var i;return function(n,o){return Ur(i)||(i=e(t,r)),i}}(_i,e,t),!0)}function bi(e){return Vr.fromDegrees(e[0],e[1],e[2])}class wi extends ir{constructor(e){super(e),this._geoJson=void 0}get geoJson(){return this._geoJson}set geoJson(e){this._geoJson?this._geoJson.features.push(e):this._geoJson={type:"FeatureCollection",features:[e]}}static pointSize=5;static pointColor=Jr.ROYALBLUE;static lineColor=Jr.YELLOW;static fill=Jr.fromBytes(255,255,0,100);static outline=!0;static outlineColor=Jr.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return ti}static crsLinkHrefs(){return Kr}static crsLinkTypes(){return ei}load(e,r={encoding:"utf-8"}){if(!Ur(e))throw new t("data is required.");Cesium.DataSource.setLoading(this,!0);const i=r.credit;"string"==typeof i&&(i=new Cesium.Credit(i)),this._credit=i;const n=this;let o=e,s=r.sourceUri;if("string"==typeof e||e instanceof $r){o=new Promise(((t,i)=>{nr.open(e,void 0,{encoding:r.encoding}).then((e=>e.read().then((function r(i){if(!i.done)return n.geoJson=i.value,e.read().then(r);t(n.geoJson)})))).catch((e=>i(e.stack)))})),s=Gr(s,"");var a=this._resourceCredits,l=e.credits;if(Ur(l))for(var c=l.length,u=0;u<c;u++)a.push(l[u])}return r={describe:Gr(r.describe,Ci),pointSize:Gr(r.pointSize,wi.pointSize),pointColor:Gr(r.pointColor,wi.pointColor),lineWidth:new jr(Gr(r.lineWidth,wi.lineWidth)),outlineColor:new Nr(Gr(r.outlineColor,wi.outlineColor)),lineColor:new Nr(Gr(r.lineColor,wi.lineColor)),outlineWidth:Gr(r.outlineWidth,wi.outlineWidth),fill:new Nr(Gr(r.fill,wi.fill)),outline:Gr(r.outline,wi.outline),clampToGround:Gr(r.clampToGround,wi.clampToGround),extrudedHeight:r.extrudedHeight},Cesium.when(o,(function(e){return function(e,r,i,n){let o;Ur(n)&&(o=Cesium.getFilenameFromUri(n)),Ur(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const s=ri[r.type];if(!Ur(s))throw new t("Unsupported GeoJSON object type: "+r.type);const a=r.crs;let l=null!==a?bi:null;if(Ur(a)){if(!Ur(a.properties))throw new t("crs.properties is undefined.");const e=a.properties;if("name"===a.type){if(l=ti[e.name],!Ur(l))throw new t("Unknown crs name: "+e.name)}else if("link"===a.type){var c=Kr[e.href];if(Ur(c)||(c=ei[e.type]),!Ur(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==a.type)throw new t("Unknown crs type: "+a.type);if(l=ti["EPSG:"+e.code],!Ur(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&s(e,r,r,t,i),Cesium.when.all(e._promises,(function(){return e._promises.length=0,Wr.setLoading(e,!1),e}))}))}(n,e,r,s)})).otherwise((function(e){return Cesium.DataSource.setLoading(n,!1),n._error.raiseEvent(n,e),console.log(e),Cesium.when.reject(e)}))}}wi.load=function(e,t){return(new wi).load(e,t)};const{buildModuleUrl:xi,Color:Si,defined:Pi,destroyObject:Ei,knockout:Ti,getElement:Li,subscribeAndEvaluate:Mi,InfoBoxViewModel:Ri}=Cesium;class Ai{constructor(e){e=Li(e);var t=document.createElement("div");t.className="cesium-infoBox",t.setAttribute("data-bind",'      css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }'),e.appendChild(t);var r=document.createElement("div");r.className="cesium-infoBox-title",r.setAttribute("data-bind","text: titleText"),t.appendChild(r);var i=document.createElement("button");i.type="button",i.className="cesium-infoBox-close",i.setAttribute("data-bind","      click: function () { closeClicked.raiseEvent(this); }"),i.innerHTML="&times;",t.appendChild(i);var n=document.createElement("iframe");n.className="cesium-infoBox-iframe",n.setAttribute("sandbox","allow-same-origin allow-popups allow-forms"),n.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }"),n.setAttribute("allowfullscreen",!0),t.appendChild(n);var o=new Ri;Ti.applyBindings(o,t),this._container=e,this._element=t,this._frame=n,this._viewModel=o,this._descriptionSubscription=void 0;var s=this;n.addEventListener("load",(function(){var e=n.contentDocument,r=e.createElement("link");r.href=xi("Widgets/InfoBox/InfoBoxDescription.css"),r.rel="stylesheet",r.type="text/css";var i=e.createElement("div");i.className="cesium-infoBox-description",e.head.appendChild(r),e.body.appendChild(i),s._descriptionSubscription=Mi(o,"description",(function(e){n.style.height="5px",i.innerHTML=e;var r=null,o=i.firstElementChild;if(null!==o&&1===i.childNodes.length){var s=window.getComputedStyle(o);if(null!==s){var a=s["background-color"],l=Si.fromCssColorString(a);Pi(l)&&0!==l.alpha&&(r=s["background-color"])}}t.style["background-color"]=r;var c=i.getBoundingClientRect().height;n.style.height=c+"px"}))})),n.setAttribute("src","about:blank")}get container(){return this._container}get viewModel(){return this._viewModel}get frame(){return this._frame}isDestroyed(){return!1}destroy(){var e=this._container;return Ti.cleanNode(this._element),e.removeChild(this._element),Pi(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),Ei(this)}}const{Transforms:ki,Cartesian3:Fi}=Cesium;class Di{constructor(e={}){if(!G(e.modelMatrix)&&G(e.position)){let t;e.position instanceof Fi?t=e.position:e.position instanceof he&&(t=e.position.toCartesian()),t&&(e.modelMatrix=ki.eastNorthUpToFixedFrame(t))}if(G(e.gltf))this.delegate=new Cesium.Model(e);else{if(!G(e.url))throw new t("one of parameters url or gltf must be provided.");this.delegate=Cesium.Model.fromGltf(e)}this._readyPromise=this.delegate._readyPromise,this._ready=this.delegate._ready}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get activeAnimations(){return this.delegate.activeAnimations}set activeAnimations(e){this.delegate.activeAnimations=e}get allowPicking(){return this.delegate.allowPicking}get asynchronous(){return this.delegate.asynchronous}get backFaceCulling(){return this.delegate.backFaceCulling}get basePath(){return this.delegate.basePath}get boundingSphere(){return this.delegate.boundingSphere}get clippingPlanes(){return this.delegate.clippingPlanes}set clippingPlanes(e){this.delegate.clippingPlanes=e}get color(){return this.delegate.color}set color(e){this.delegate.color=e}get colorBlendMode(){return this.delegate.colorBlendMode}set colorBlendMode(e){this.delegate.colorBlendMode=e}get colorBlendAmount(){return this.delegate.colorBlendAmount}set colorBlendAmount(e){this.delegate.colorBlendAmount=e}get credit(){return this.delegate.credit}set credit(e){this.delegate.credit=e}get debugShowBoundingVolume(){return this.delegate.debugShowBoundingVolume}set debugShowBoundingVolume(e){this.delegate.debugShowBoundingVolume=e}get debugWireframe(){return this.delegate.debugWireframe}set debugWireframe(e){this.delegate.debugWireframe=e}get distanceDisplayCondition(){return this.delegate.distanceDisplayCondition}set distanceDisplayCondition(e){this.delegate.distanceDisplayCondition=e}get gltf(){return this.delegate.gltf}get id(){return this.delegate.id}set id(e){this.delegate.id=e}get maximumScale(){return this.delegate.maximumScale}set maximumScale(e){this.delegate.maximumScale=e}get minimumPixelSize(){return this.delegate.minimumPixelSize}set minimumPixelSize(e){this.delegate.minimumPixelSize=e}get modelMatrix(){return this.delegate.modelMatrix}set modelMatrix(e){this.delegate.modelMatrix=e}get scale(){return this.delegate.scale}set scale(e){this.delegate.scale=e}get shadows(){return this.delegate.shadows}set shadows(e){this.delegate.shadows=e}get show(){return this.delegate.show}set show(e){this.delegate.show=e}get showOutline(){return this.delegate.showOutline}get silhouetteColor(){return this.delegate.silhouetteColor}set silhouetteColor(e){this.delegate.silhouetteColor=e}get silhouetteSize(){return this.delegate.silhouetteSize}set silhouetteSize(e){this.delegate.silhouetteSize=e}static silhouetteSupported(e){return Cesium.Model.silhouetteSupported(e.scene)}destroy(){this.delegate.destroy()}isDestroyed(){this.delegate.isDestroyed()}getMaterial(e){return this.delegate.getMaterial(e)}getMesh(e){return this.delegate.getMesh(e)}getNode(e){return this.delegate.getNode(e)}get rootNodes(){return this.delegate._runtime.rootNodes}get nodes(){return this.delegate._runtime.nodesByName}get materials(){return this.delegate._runtime.materialsByName}get meshs(){return this.delegate._runtime.meshesByName}}const Bi=Cesium.Scene,{JulianDate:Ui,defined:Gi,RequestScheduler:Ni,PerformanceDisplay:Oi,Cesium3DTilePassState:ji,Cesium3DTilePass:Wi,defaultValue:Ii,Color:qi,BoundingRectangle:zi,Pass:Vi,SunLight:Hi,Cartesian3:Yi}=Cesium,Xi=new ji({pass:Wi.PRELOAD}),Ji=new ji({pass:Wi.PRELOAD_FLIGHT}),Zi=new ji({pass:Wi.REQUEST_RENDER_MODE_DEFER_CHECK});function $i(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function Qi(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),Gi(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Ki(e){return e._picking.updateMostDetailedRayPicks(e)}function en(e){var t=e._frameState;Xi.camera=t.camera,Xi.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,Xi)}function tn(e){var t=e._frameState;t.camera.canPreloadFlight()&&(Ji.camera=e.preloadFlightCamera,Ji.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,Ji))}const rn=new ji({pass:Wi.RENDER});function nn(e){e.primitives.updateForPass(e._frameState,Zi)}function on(e){var t=e._frameState;e.primitives.postPassesUpdate(t),Ni.update()}function sn(e){var t=e._frameState,r=e.context,i=r.uniformState,n=e._defaultView;e._view=n,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=rn;var o=Ii(e.backgroundColor,qi.BLACK);e._hdr&&((o=qi.clone(o,scratchBackgroundColor)).red=Math.pow(o.red,e.gamma),o.green=Math.pow(o.green,e.gamma),o.blue=Math.pow(o.blue,e.gamma)),t.backgroundColor=o,e.fog.update(t),i.update(t);var s=e.shadowMap;Gi(s)&&s.enabled&&(!Gi(e.light)||e.light instanceof Hi?Yi.negate(i.sunDirectionWC,e._shadowMapCamera.direction):Yi.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(s)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var a=n.viewport;a.x=0,a.y=0,a.width=r.drawingBufferWidth,a.height=r.drawingBufferHeight;var l=n.passState;l.framebuffer=void 0,l.blendingEnabled=void 0,l.scissorTest=void 0,l.viewport=zi.clone(a,l.viewport),Gi(e.globe)&&(e.globe.beginFrame(t),e._LodGraphic.beginFrame(t)),e.updateEnvironment(),e.updateAndExecuteCommands(l,o),e.globe&&e._LodGraphic.render(t),e.resolveFramebuffers(l),l.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(Vi.OVERLAY);for(var r=e.context,i=e._overlayCommandList,n=i.length,o=0;o<n;++o)i[o].execute(r,t)}(e,l),Gi(e.globe)&&(e.globe.endFrame(t),e._LodGraphic.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),r.endFrame()}function an(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Gi(e)||(e=Ui.now());var r=this._view.checkForCameraUpdates(this),i=!this.requestRenderMode||this._renderRequested||r||this._logDepthBufferDirty||this._hdrDirty||this.mode===SceneMode.MORPHING;if(!i&&Gi(this.maximumRenderTimeChange)&&Gi(this._lastRenderTime)){var n=Math.abs(Ui.secondsDifference(this._lastRenderTime,e));i=i||n>this.maximumRenderTimeChange}i&&(this._lastRenderTime=Ui.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,function(e,t,r){var i=e._frameState;i.frameNumber=t,i.time=Ui.clone(r,i.time)}(this,Cesium.Math.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);$i(this,Qi),this.primitives.show&&($i(this,Ki),$i(this,en),$i(this,tn),i||$i(this,nn)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),$i(this,sn)),function(e,t){if(e.debugShowFramesPerSecond){if(!Gi(e._performanceDisplay)){var r=document.createElement("div");r.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(r);var i=new Oi({container:r});e._performanceDisplay=i,e._performanceContainer=r}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Gi(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,i),$i(this,on),function(e){for(var t=e._frameState.afterRender,r=0,i=t.length;r<i;++r)t[r](),e.requestRender();t.length=0}(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())}class ln{static overrideRenderFunction(){Bi.prototype.render=an}}class cn{constructor(e={}){this._id=U(e.id,ge()),this._maxClusterLevel=U(e.maxClusterLevel,12),this._minLoadLevel=U(e.minLoadLevel,12),this._objects=void 0}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects}set objects(e){this._objects=e}updateCluster(e){t.throwInstantiationError()}beginUpdate(e){t.throwInstantiationError()}endUpdate(e){t.throwInstantiationError()}initialize(e,r){t.throwInstantiationError()}createGeometry(e,r,i){t.throwInstantiationError()}removeGeometry(e,t){}removeAll(){t.throwInstantiationError()}isDestroyed(){return!1}destroy(){t.throwInstantiationError()}}const{AssociativeArray:un}=Cesium;class hn{constructor(){this._layers=new un}get layer(){return this._layers}get length(){return this._layers.length}get values(){return this._layers.values}get(e){return this._layers.get(e)}add(e){e instanceof cn&&this._layers.set(e.id,e)}has(e){return e instanceof cn?this._layers.contains(e):"string"==typeof e&&this._layers.contains(this.get(e))}remove(e){if(e instanceof cn)return e.destroy(),this._layers.remove(e.id);if("string"==typeof e){const t=this._layers.get(e);return t&&t.destroy(),this._layers.remove(e)}return!1}removeAll(){return this._layers.removeAll()}}const{GeographicTilingScheme:dn,GlobeSurfaceTileProvider:mn,when:gn,Event:fn,GlobeSurfaceTile:pn,TerrainState:vn,RequestType:_n,Request:yn,Rectangle:Cn,QuadtreeTileLoadState:bn,Visibility:wn,AssociativeArray:xn,Cartesian3:Sn,Cartographic:Pn,getTimestamp:En}=Cesium;const Tn={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function Ln(e,t,r,i,n){const o=e.data;o.terrainState===vn.UNLOADED&&function(e,t,r){let i=e.data;function n(e){i.terrainData=e,i.terrainState=vn.RECEIVED,i.request=void 0}function o(e){if(i.request.state===RequestState.CANCELLED)return i.terrainData=void 0,i.terrainState=vn.UNLOADED,void(i.request=void 0);i.terrainState=vn.FAILED,i.request=void 0}!function(){const t=new yn({throttle:!1,throttleByServer:!0,type:_n.TERRAIN});i.request=t;const s=r.requestTileGeometry(e.x,e.y,e.level,t);G(s)?(i.terrainState=vn.RECEIVING,gn(s,n,o)):(i.terrainState=vn.UNLOADED,i.request=void 0)}()}(e,0,r),o.terrainState===vn.RECEIVED&&function(e,t,r,i,n,o){const s=r.tilingScheme,a=Tn;a.tilingScheme=s,a.x=i,a.y=n,a.level=o,a.exaggeration=t.terrainExaggeration,a.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,a.throttle=!0;const l=e.terrainData.createMesh(a);G(l)&&(e.terrainState=vn.TRANSFORMING,gn(l,(function(t){e.mesh=t,e.terrainState=vn.TRANSFORMED}),(function(){e.terrainState=vn.FAILED})))}(o,t,r,e.x,e.y,e.level),o.terrainState===vn.TRANSFORMED&&(e.renderable=!0)}function Mn(e,t){const r=[];for(let i of e)G(i)&&(G(i.id)||(i.id=ge()),G(i)&&G(i.position)&&(i.position instanceof Sn?i.cartesian=i.position:i.position instanceof Pn?(i.cartesian=Pn.toCartesian(i.position),i.catographic=i.position):i.position instanceof he?(i.cartesian=i.position.toCartesian(),i.cartographic=i.position.toCartoGraphic()):i.cartesian=i.position,i.cartographic||(i.cartographic=Pn.fromCartesian(i.cartesian)),Cn.contains(t.rectangle,i.cartographic)&&r.push(i)));return r}class Rn{constructor(){this.boundingVolumeSourceTile=void 0,this.terrainState=Cesium.TerrainState.UNLOADED,this.mesh=void 0,this.terrainData=void 0,this.objects=void 0,this._geometryOfTile=new xn,this._objectsOfTile=new xn,this._needRenderObjects=new xn}static processStateMachine(e,t,r,i,n){Rn.initialize(e,r),e.state===bn.LOADING&&Ln(e,t,r)}static initialize(e,t){let r=e.data;G(r)||(r=e.data=new Rn),e.state===bn.START&&(e.state=bn.LOADING)}}function An(e,t,r,i,n){let o=r.data._geometryOfTile.get(t.id),s=e._hasRenderCached.get(t.id);s||(s={},e._hasRenderCached.set(t.id,s)),o||(o=[]);for(let e of n){if(s[e.id])return;const n=t.createGeometry(r,i,e);n&&(s[e.id]=!0,o.push({id:e.id,geometry:n}))}r.data._geometryOfTile.set(t.id,o)}function kn(e,t,r,i,n){const o=e._hasRenderCached.get(t.id);for(let e of n){const{id:r,geometry:n}=e;t.removeGeometry(i,n),delete o[r]}r.data._geometryOfTile.remove(t.id)}class Fn{constructor(e={}){this._ready=!0,this._scene=e.scene,this._tilingSceheme=new dn,this._readyPromise=gn.defer(),this._readyPromise.resolve(!0),this._errorEvent=new fn,this._terrainProvider=e.terrainProvider,this._show=!0,this.cartographicLimitRectangle=Cn.clone(Cn.MAX_VALUE),this.tree=void 0,this._layers=new hn,this._lastTilesToRender=[],this._hasRenderCached=new xn,this._tilesCahced=[]}get terrainProvider(){return this._terrainProvider}get show(){return this._show}set show(e){this._show=e}get ready(){return this._ready}get tilingScheme(){return this._tilingSceheme}get readyPromise(){return this._readyPromise}get quadtree(){return this._quadtree}set quadtree(e){G(e)&&(this._quadtree=e)}initialize(e){for(let t of this._layers.values)t.initialize(e,this._scene)}beginUpdate(e){const t=this._layers.values;for(let r of t)r.beginUpdate(e);this._frameNumber++}showTileThisFrame(e,t){const r=e.data;if(!G(r))return;this._tilesCahced.includes(e)||this._tilesCahced.push(e);const i=this._layers.values;En();for(let n of i){if(!G(n.objects)||!Array.isArray(n.objects))continue;const i=n.id;if(r._geometryOfTile.get(i)&&!n._needReclass)return;let o=r._objectsOfTile.get(i);G(o)&&!n._needReclass||(o=Mn(n.objects,e),r._objectsOfTile.set(i,o)),An(this,n,e,t,o)}}endUpdate(e){const t=this._quadtree;if(!t)return;const r=this._lastTilesToRender,i=t._tilesToRender,n=this._layers.values;for(let t of r)if(!i.includes(t))for(let r of n){const i=t.data._geometryOfTile.get(r.id)||[];kn(this,r,t,e,i)}for(let t of n){t.endUpdate(e)&&i.forEach((r=>{const i=r.data._geometryOfTile.get(t.id)||[];kn(this,t,r,e,i)}))}this._lastTilesToRender=[...i]}loadTile(e,t){let r,i=!0;t.data&&(r=t.data.terrainState,i=t.data.boundingVolumeSourceTile!==t),Rn.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree);const n=t.data;i&&r!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==wn.NONE&&n.boundingVolumeSourceTile===t&&Rn.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree)}getLevelMaximumGeometricError(e){return this._terrainProvider.getLevelMaximumGeometricError(e)}canRefine(e){return mn.prototype.canRefine.call(this,e)}computeTileVisibility(e,t,r){return G(e.data)||(e.data=new Rn),mn.prototype.computeTileVisibility.call(this,e,t,r)}computeDistanceToTile(e,t){return e.data||(e.data=new Rn),mn.prototype.computeDistanceToTile.call(this,e,t)}clearTile(e){const t=this._tilesCahced;for(let r of t)r.data._geometryOfTile.remove(e),r.data._objectsOfTile.remove(e);this._hasRenderCached.remove(e)}isDestroyed(){return!1}destroy(){this._removeEventListener();const e=this._layers.values;for(let t of e)t.destroy()}computeTileLoadPriority(e,t){return mn.prototype.computeTileLoadPriority(e,t)}_onLayerAdded(e,t){}_onLayerRemoved(e,t){}_onLayerShownOrHidden(e,t,r){r?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)}}const{Matrix4:Dn,BoundingSphere:Bn}=Cesium;function Un(e,t,r){e.camera.flyToBoundingSphere(t,{duration:r.duration,maximumHeight:r.maximumHeight,endTransform:r.endTransform,offset:r.offset,complete:function(){e._zoomPromise.resolve(!0)},cancel:function(){e._zoomPromise.resolve(!1)},offset:r.offset})}let Gn,Nn,On=0,jn=0,Wn="N/A",In="N/A";function qn(e){return null!=e&&"object"==typeof e&&"function"==typeof e.then}function zn(e,t,r,i){const n=Cesium.Cartesian3.fromDegrees(t,r,i),o=e.camera,s=o.heading,a=o.pitch,l=function(e,t,r){t=Cesium.Math.clamp(t,-Cesium.Math.PI_OVER_TWO,Cesium.Math.PI_OVER_TWO),e=Cesium.Math.zeroToTwoPi(e)-Cesium.Math.PI_OVER_TWO;const i=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,-t),n=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-e),o=Cesium.Quaternion.multiply(n,i,n),s=Cesium.Matrix3.fromQuaternion(o),a=Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_X);return Cesium.Matrix3.multiplyByVector(s,a,a),Cesium.Cartesian3.negate(a,a),Cesium.Cartesian3.multiplyByScalar(a,r,a),a}(s,a,2*i),c=Cesium.Transforms.eastNorthUpToFixedFrame(n);Cesium.Matrix4.multiplyByPoint(c,l,n),o.setView({destination:n,orientation:{heading:s,pitch:a},easingFunction:Cesium.EasingFunction.QUADRATIC_OUT})}function Vn(e,t){e.infoBox&&(t._infoBox=function(e){const t=document.createElement("div");t.className="cesium-viewer-infoBoxContainer",e.container.appendChild(t);const r=new Ai(t),i=r.viewModel;return e._eventHelper.add(i.cameraClicked,Yn.prototype._onInfoBoxCameraClicked,e),e._eventHelper.add(i.closeClicked,Yn.prototype._onInfoBoxClockClicked,e),e._enableInfoOrSelection=!0,r}(t))}function Hn(e,t,r){const i=e._zoomPromise=Cesium.when.defer();return t.readyPromise.then((()=>{if(t._boundingSpheres)Un(e,Bn.fromBoundingSpheres(t._boundingSpheres),r);else if(t.boundingSphere){let i=t.boundingSphere;i=Bn.clone(i),t.modelMatrix&&Dn.multiplyByPoint(t.modelMatrix,i.center,i.center),Un(e,i,r)}})),i}class Yn extends Cesium.Viewer{constructor(e,t={}){t=Object.assign({animation:!1,timeline:!1,geocoder:!1,homeButton:!1,navigationHelpButton:!1,baseLayerPicker:!1,fullscreenElement:"cesiumContainer",fullscreenButton:!1,shouldAnimate:!1,infoBox:!1,selectionIndicator:!1,sceneModePicker:!1,shadows:!1,imageryProvider:ut(),contextOptions:{webgl:{alpha:!0,depth:!1,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0},allowTextureFilterAnisotropic:!0}},t),Cesium.Camera.DEFAULT_VIEW_RECTANGLE=Cesium.Rectangle.fromDegrees(70,5,130,60),!1===t.globe&&(t.imageryProvider=void 0);const r=Object.assign({},t,{infoBox:!1});ln.overrideRenderFunction(),super(e,r);const i=document.querySelector(".cesium-credit-logoContainer");if(i&&i.parentElement.removeChild(i),Vn(t,this),this._options=t,this.scene.preRender.addEventListener(this.update,this),this._distancePerPixel=void 0,this._extent=void 0,this._center=void 0,this._autoRotation=!1,this.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.scene.globe){const e=new Fn({terrainProvider:this.terrainProvider,scene:this.scene}),t=new Cesium.QuadtreePrimitive({tileProvider:e});this.scene._LodGraphic=t}this.scene.dataSources=this.dataSources}get massiveGraphicLayers(){return this.scene._LodGraphic.tileProvider._layers}get entities(){return super.entities}get primitives(){return this.scene.primitives}get enableLighting(){if(G(this.globe))return this.scene.globe.enableLighting}set enableLighting(e){G(this.globe)&&(this.scene.globe.enableLighting=e)}get autoRotation(){return this._autoRotation}set autoRotation(e){this._autoRotation=e}get fxaa(){return this.scene.postProcessStages.fxaa.enabled}set fxaa(e){this.scene.postProcessStages.fxaa.enabled=e}get distancePerPixel(){return this._distancePerPixel}get extent(){return this._extent}get center(){return this._center}get container(){return this._container}get layers(){return this.scene.imageryLayers}get dataSources(){return super.dataSources}get globe(){return this.scene.globe}get ellipsoid(){if(this.globe)return this.globe.ellipsoid}get terrain(){return this.terrainProvider}set terrain(e){G(e)&&!1!==e||(this.terrainProvider=new Cesium.EllipsoidTerrainProvider),e!==this.terrainProvider&&(this.terrainProvider=e)}get terrainChanged(){return this.scene.terrainProviderChanged}get terrainExaggeration(){if(this.globe)return this.globe.terrainExaggeration}set terrainExaggeration(e){e<0&&(e=0),this.globe&&(this.globe.terrainExaggeration=e)}get showFps(){return this.scene.debugShowFramesPerSecond}set showFps(e){this.scene.debugShowFramesPerSecond=e}get fps(){return this._fps+"FPS"}get ms(){return this._ms+"MS"}get heading(){return Cesium.Math.toDegrees(this.camera.heading)}get pitch(){return Cesium.Math.toDegrees(this.camera.pitch)}get roll(){return Cesium.Math.toDegrees(this.camera.roll)}get depthTest(){return this.scene.globe.depthTestAgainstTerrain}set depthTest(e){this.scene.globe.depthTestAgainstTerrain=e}addModel(e){this.primitives.add(e.delegate)}removeModel(e){this.primitives.remove(e.delegate)}setView(e){let t;e instanceof Cesium.Cartographic?t=he.fromCartographic(e):e instanceof Cesium.Cartesian3?t=he.fromCartesian(e):e instanceof he&&(t=e),t&&zn(this,t.lon,t.lat,t.alt)}stepFlyTo(e={}){let t;e.destination instanceof Cesium.Cartesian3?t=he.fromCartesian(e.destination):e.destination instanceof Cesium.Cartographic?t=he.fromCartographic(e.destination):e.destination instanceof he&&(t=e.destination),t&&(e.destination=t,function(e,t={}){const{camera:r}=e,i=U(t.step1Duration,3),n=U(t.step2Duration,3),o=U(t.step3Duration,3),s=t.destination,a=e.camera._positionCartographic.height,l=Cesium.Cartesian3.fromDegrees(s.lon,s.lat,a),c=t.destination.toCartesian();new Promise((e=>{r.flyTo({destination:l,duration:i,complete(){r.flyTo({destination:c,duration:n,complete(){r.flyTo({destination:c,orientation:t.orientation,duration:o,complete(){e()}})}})}})}))}(this,e))}linkView(e){if(!G(e))throw new t("viewer不是一个有效的Cesium.Viewer对象");return function(e,t){let r,i;return i=function i(n,o){return n.scene.postRender.addEventListener((()=>{const s=n.camera.positionWC,a=n.camera.heading,l=n.camera.pitch,c=n.camera.roll;r&&(r(),r=void 0),o.camera.flyTo({destination:s,orientation:{heading:a,pitch:l,roll:c},duration:0,complete:function(){r=i(t,e)},cancel:function(){r=i(t,e)}})}))}(e,t),function(){i&&i(),r&&r()}}(this,e)}flyTo(e,t={}){if(e instanceof he){const r=e.toCartesian();return this.flyTo(r,t)}if(e instanceof Cesium.Cartesian3){const r=viewer._zoomPromise=Cesium.when.defer(),i=U(t.radius,1e3);delete t.radius;return Un(this,new Cesium.BoundingSphere(e,i),t),r}return e instanceof Cesium.Primitive||e instanceof Cesium.Model||e instanceof Di?Hn(this,e,t):super.flyTo(e,t)}rotateAroundPoint(e,t={}){const r=this;let i;if(e instanceof Cesium.Cartesian3)i=e;else if(e instanceof Cesium.Cartographic)i=Cesium.Cartographic.toCartesian(e);else{if(!(e instanceof he))return;i=e.toCartesian()}const n=U(t.multiplier,1),o=U(t.offset,{});return this._cancelRotateAroundPoint&&(this._cancelRotateAroundPoint(),this._cancelRotateAroundPoint=void 0),this._cancelRotateAroundPoint=this.scene.postRender.addEventListener((function(){const e=Cesium.Math.toRadians(U(o.heading,r.heading)+1*n),t=Cesium.Math.toRadians(U(o.pitch,-20)),s=U(o.range,1e4);r.flyTo(i,{duration:0,offset:new Cesium.HeadingPitchRange(e,t,s)})})),this._cancelRotateAroundPoint}addLayer(e){return e instanceof Cesium.GeoJsonDataSource||e instanceof Cesium.KmlDataSource||e instanceof Cesium.CzmlDataSource||e instanceof Cesium.CustomDataSource||e instanceof ir||e instanceof wi||qn(e)?this.dataSources.add(e):this.layers.addImageryProvider(e)}removeLayer(e){if(qn(e))e.then((e=>{this.removeLayer(e)}));else{this.layers.remove(e)||this.dataSources.remove(e)}}pickLayer(e){const t=this.scene,r=t.camera.getPickRay(e);return this.layers.pickImageryLayerFeatures(r,t)}render(){super.render()}update(){const e=function(){G(Gn)||(Gn=Cesium.getTimestamp()),G(Nn)||(Nn=Cesium.getTimestamp()),On++;const e=Cesium.getTimestamp();let t=(e-Gn)/1e3;return t>1&&(Wn=On/t||0,Gn=e,On=0,Wn=Wn.toFixed(0)),jn++,t=e-Nn,t>100&&(In=t/jn,Nn=e,jn=0,In=In.toFixed(2)),{ms:In,fps:Wn}}();this._fps=e.fps,this._ms=e.ms;const t=ue(viewer);t&&(this._distancePerPixel=t),this._extent=me(this),this._center=de(viewer),this._autoRotation&&function(e){if(!e||e.scene.mode!==Cesium.SceneMode.SCENE3D)return;const t=Cesium.Transforms.computeIcrfToFixedMatrix(e.clock.currentTime);if(G(t)){const r=e.camera,i=Cesium.Cartesian3.clone(r.position),n=Cesium.Matrix4.fromRotationTranslation(t);r.lookAtTransform(n,i)}}(this)}resize(){super.resize()}forceResize(){super.forceResize()}destroy(){super.destroy()}isDestroyed(){return super.isDestroyed()}}const Xn=33746824,Jn=33554054;const{BingMapsImageryProvider:Zn,BingMapsStyle:$n}=Cesium;class Qn extends Zn{constructor(e={}){e.url="https://dev.virtualearth.net",e.mapStyle=U(e.mapStyle,Qn.mapStyle.AERIAL),e.key=U(e.key,"AqMhBWJKbBPBtoWEvtGdUii6XSkDCJ3vWFpOVWzplD-Q0J-ECUF6i8MGXpew8bkc"),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}static tileXYToQuadKey(e,t,r){return Zn.tileXYToQuadKey(e,t,r)}static quadKeyToTileXY(e){return Zn.quadKeyToTileXY(e)}static mapStyle=$n}class Kn extends ct{constructor(e){e=U(e,{});const t=U(e.layer,"img"),{scl:r,style:i}=Kn.getParametersByLayer(t),n=U(e.lang,"zh_cn");e.url=`https://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=${n}&size=1&scl=${r}&style=${i}`,e.subdomains="1234",super(e)}static layers=[{layer:"img",desc:"影像地图"},{layer:"vec",desc:"矢量地图"},{layer:"vei",desc:"矢量地图（含注记）"},{layer:"roa",desc:"路网地图"},{layer:"roi",desc:"路网地图（含注记）"}];static getParametersByLayer(e){let t={scl:1,style:6};switch(e){case"img":break;case"vec":t.scl=2,t.style=7;break;case"vei":t.scl=1,t.style=7;break;case"roa":t.scl=2,t.style=8;break;case"roi":t.scl=1,t.style=8}return t}}const{WebMapTileServiceImageryProvider:eo}=Cesium;class to extends eo{constructor(e={}){super(e)}get dimensions(){return super.dimensions}set dimensions(e){super.dimensions=e}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}const ro={map:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=1&version=297",road:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=2&version=297",img:"https://p{s}.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{reverseY}.jpg?version=229"};const{when:io,Rectangle:no}=Cesium;class oo extends Cesium.TileMapServiceImageryProvider{constructor(e){super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}const{Resource:so}=Cesium;class ao extends Cesium.WebMapServiceImageryProvider{constructor(e={}){G(e.parameters)||(e.parameters=ao.DefaultParameters),G(e.GetFeatureInfoDefaultParameters),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}ao.DefaultParameters=Object.assign({transparent:!0},Cesium.WebMapServiceImageryProvider.DefaultParameters,{format:"image/png"}),ao.GetFeatureInfoDefaultParameters=Cesium.WebMapServiceImageryProvider.GetFeatureInfoDefaultParameters;const{AssociativeArray:lo,destroyObject:co,CustomDataSource:uo,Event:ho}=Cesium,mo=function(){},go=[31638318];for(let e=1;e<20;e++)go.push(go[e-1]/2);function fo(e){let t=0;for(let r of go){if(e>r)break;t++}return t}class po extends cn{constructor(e={}){super(e),this._id=U(e.id,ge()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new ho,this._maxClusterLevel=U(e.maxClusterLevel,12),this._minLoadLevel=U(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={}}get id(){return this._id}get dataSource(){return this._dataSource}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=fo(e),r=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,r)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){fo(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=fo(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){this._dataSource||(this._scene=t,this._dataSource=new uo("massive-layer"+ge()),this._scene.dataSources.add(this._dataSource))}createGeometry(e,t,r){if(e.level<this._minLoadLevel)return;const i=U(this._createGeometryFunction,mo)(r),n=Object.keys(r);for(let e of n)"position"!==e&&"id"!==e&&"cartesian"!==e&&"cartographic"!==e&&"label"!==e&&"billboard"!==e&&"__pixel"!==e&&(i[e]=r[e]);return this.add(i),i}removeGeometry(e,t){if(!t)return;const r=this._dataSource.entities.remove(t);return co(t),r}add(e){this._dataSource&&e&&this._dataSource.entities.add(e)}removeAll(){this._dataSource.entities.removeAll()}isDestroyed(){return!1}destroy(){this._dataSource.removeAll(),co(this)}}const{QuadtreeTileProvider:vo,GeographicTilingScheme:_o,when:yo,Event:Co,Cartographic:bo,Color:wo,Entity:xo}=Cesium;const{destroyObject:So,Event:Po,Transforms:Eo}=Cesium,To=function(e,t){const r={};if(e.modelMatrix)r.modelMatrix=e.modelMatrix;else if(e.position){let t=e.position;if(e.position instanceof he&&(t=e.position.toCartesian()),!t)return;r.modelMatrix=Eo.eastNorthUpToFixedFrame(t),e.modelMatrix=r.modelMatrix}return r.minimumPixelSize=U(e.minimumPixelSize,t.minimumPixelSize),r.maximumScale=U(e.maximumScale,t.maximumScale),r.scale=U(e.scale,t.scale),r.allowPicking=U(e.allowPicking,t.allowPicking),r.shadows=U(e.shadows,t.shadows),r.id=e._id,r.url=U(e.url,t.url),Cesium.Model.fromGltf(r)},Lo=[31638318];for(let e=1;e<20;e++)Lo.push(Lo[e-1]/2);function Mo(e){let t=0;for(let r of Lo){if(e>r)break;t++}return t}const{QuadtreeTileProvider:Ro,GeographicTilingScheme:Ao,when:ko,Event:Fo,Cartographic:Do,Color:Bo,Entity:Uo}=Cesium;e.BaiDuLayer=class extends ct{constructor(e){(e=U(e,{})).url=U(e.url,"http://maponline{s}.bdimg.com/tile/?qt=vtile&styles=pl&scaler=1&udt=20200102"),e.customid&&(e.url=`https://api.map.baidu.com/customimage/tile?customid=${e.customid}`);const t=new Cesium.Cartesian2(-Jn,-Xn),r=new Cesium.Cartesian2(Jn,Xn);e.tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:r}),e.subdomains="123",super(e),this._rectangle=this._tilingScheme.rectangle}requestImage(e,t,r){const i=function(e,t,r,i){let n=e.url+"&x={x}&y={y}&z={z}";const o=e._tilingScheme.getNumberOfXTilesAtLevel(i),s=e._tilingScheme.getNumberOfYTilesAtLevel(i),a=4*Math.random()|0;return n=n.replace("{s}",a).replace("{x}",t-o/2).replace("{y}",s/2-r-1).replace("{z}",i),n}(this,e,t,r);return Cesium.ImageryProvider.loadImage(this,i)}},e.BingLayer=Qn,e.CesiumProError=t,e.CesiumProTerrainProvider=L,e.Cluster=class{constructor(e,t={}){this._objects=U(t.objects,[]),this._getScreenBoundingBox=U(t.getScreenBoundingBox,le),this._scene=e,this.clusterSize=3,this.pixelRange=50,this._clusterObjects=[]}get objects(){return this._objects}set objects(e){this._objects=e}_clearCluster(){this._objects.map((e=>e.cluster=!1)),this._clusterObjects=[]}update(){const e=this._objects;this._clearCluster();const t=function(e,t){const r=[],i=new oe(t.globe.ellipsoid,t.camera.positionWC);for(let n of e)n.position&&(t.mode!==ne.SCENE3D||i.isPointVisible(n.position))&&(n.__pixel=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,n.position),n.__pixel&&r.push(n));return r}(e,this._scene),r=new K(t,se,ae,64,Int32Array);for(let e of t){if(e.cluster)continue;const i=this._getScreenBoundingBox(e,e.__pixel),n=ie.clone(i,new ie);e.cluster=!0;const o=r.range(i.x,i.y,i.x+i.width,i.y+i.height),s=o.length,a=ee.clone(e.position);let l,c=1;const u=[];for(let e=0;e<s;e++){const r=t[o[e]];if(r.cluster)continue;u.push(r.id),r.cluster=!0;const i=this._getScreenBoundingBox(r,r.__pixel);ee.add(r.position,a,a),ie.union(n,i,n),c++,l=r}c>=this.clusterSize?(ee.multiplyByScalar(a,1/c,a),this._clusterObjects.push({position:new ee(a.x,a.y,a.z),number:c,ids:u,id:l.id+c})):this._clusterObjects.push(e)}}},e.Event=i,e.GaoDeLayer=Kn,e.GeoJsonDataSource=ir,e.GeoPoint=he,e.GroundSkyBox=class{constructor(e={}){this.sources=_e(e.sources,{positiveX:Y.buildModuleUrl("./assets/skybox/px.png"),negativeX:Y.buildModuleUrl("./assets/skybox/nx.png"),positiveY:Y.buildModuleUrl("./assets/skybox/py.png"),negativeY:Y.buildModuleUrl("./assets/skybox/ny.png"),positiveZ:Y.buildModuleUrl("./assets/skybox/pz.png"),negativeZ:Y.buildModuleUrl("./assets/skybox/nz.png")}),this._sources=void 0,this.show=_e(e.show,!0),this._command=new be({modelMatrix:Ce.clone(Ce.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0,this._isDestroyed=!1}update(e,r){const i=new Ge,n=this;if(!this.show)return;if(e.mode!==De.SCENE3D&&e.mode!==De.MORPHING)return;if(!e.passes.render)return;const{context:o}=e;if(this._sources!==this.sources){this._sources=this.sources;const{sources:e}=this;if(!(Se(e.positiveX)&&Se(e.negativeX)&&Se(e.positiveY)&&Se(e.negativeY)&&Se(e.positiveZ)&&Se(e.negativeZ)))throw new t("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof e.positiveX!=typeof e.negativeX||typeof e.positiveX!=typeof e.positiveY||typeof e.positiveX!=typeof e.negativeY||typeof e.positiveX!=typeof e.positiveZ||typeof e.positiveX!=typeof e.negativeZ)throw new t("this.sources properties must all be the same type.");"string"==typeof e.positiveX?Re(o,this._sources).then((e=>{n._cubeMap=n._cubeMap&&n._cubeMap.destroy(),n._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Me({context:o,source:e}))}const s=this._command;if(s.modelMatrix=Ee.eastNorthUpToFixedFrame(e.camera._positionWC),!Se(s.vertexArray)){s.uniformMap={u_cubeMap:()=>n._cubeMap,u_rotateMatrix:()=>"function"==typeof Ce.getRotation?Ce.getRotation(s.modelMatrix,i):Ce.getMatrix3(s.modelMatrix,i)};const e=we.createGeometry(we.fromDimensions({dimensions:new xe(2,2,2),vertexFormat:Te.POSITION_ONLY})),t=this._attributeLocations=Pe.createAttributeLocations(e);s.vertexArray=ke.fromGeometry({context:o,geometry:e,attributeLocations:t,bufferUsage:Le._DRAW}),s.renderState=Ae.fromCache({blending:Fe.ALPHA_BLEND})}if(!Se(s.shaderProgram)||this._useHdr!==r){const e=new Ue({defines:[r?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  "]});s.shaderProgram=Be.fromCache({context:o,vertexShaderSource:"attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",fragmentShaderSource:e,attributeLocations:this._attributeLocations}),this._useHdr=r}return Se(this._cubeMap)?s:void 0}isDestroyed(){return this._isDestroyed}destroy(){const e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),ye(this)}},e.InfoBox=Ai,e.LonLatNetLayer=class{constructor(e={}){const t=new qe({rectangle:Cesium.Rectangle.MAX_VALUE,intervalOfZeorLevel:e.intervalOfZeorLevel});this._hasAlphaChannel=U(e.hasAlphaChannel,!0),this._tilingScheme=t,this._image=void 0,this._texture=void 0,this._errorEvent=new i,this._ready=!0,this._readyPromise=Cesium.when.defer(),this._readyPromise.resolve(!0),this._font=U(e.font,"bold 24px sans-serif"),this._color=U(e.color,"white"),this._borderColor=U(e.borderColor,"gold"),this._borderWidth=U(e.borderWidth,2),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=256,this.canvas.height=256,this.ctx.textBaseline="middle"}get hasAlphaChannel(){return this._hasAlphaChannel}get tileHeight(){return 256}get tileWidth(){return 256}get minimumLevel(){return 0}get maximumLevel(){return 4}get rectangle(){return Cesium.Rectangle.MAX_VALUE}get errorEvent(){return this._errorEvent}get tileDiscardPolicy(){}get readyPromise(){return this._readyPromise}get ready(){return!0}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}_resetStyle(){this.ctx.font=this.font,this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.borderColor,this.ctx.lineWidth=this.borderWidth}_clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getOffset(e,t,r){const i=this.tilingScheme.getDelatXY(r),n=Math.floor(e),o=Math.floor(t);if(n===e&&o===t)return[0,0,n,o];const s=e-n,a=t-o;let l=0,c=0;return s&&(l=this.tileWidth/i.dx*s),a&&(c=this.tileHeight/i.dy*a),[l,c,n,o]}requestImage(e,t,r,i){this._clearCanvas(),this._resetStyle();const{canvas:n,ctx:o}=this,s=this.tilingScheme.getLonLatValuee(r,e,t);return this.tilingScheme.tileXYToNativeRectangle(e,t,r),this.ctx.textAlign="left",o.fillText(s.lon,10,n.height/2),this.ctx.textAlign="center",o.fillText(s.lat,n.width/2,20),o.strokeRect(0,0,n.width,n.height),n}},e.LonlatTilingScheme=qe,e.MassiveBillboardLayer=class extends po{constructor(e={}){e.objects=U(e.objects,[]),e.pixelSize=U(e.pixelSize,5),e.color=U(e.color,wo.fromRandom),e.createGeometryFunction=U(e.createGeometryFunction,function(e){return function(t){const r={id:t.id,position:t.position,point:{pixelSize:U(t.pixelSize,e.pixelSize),color:U(t.color,e.color)}};return t.label&&(r.label={text:t.label}),new xo(r)}}(e)),super(e)}},e.MassiveEntityLayer=po,e.MassiveGraphicLayer=cn,e.MassiveGraphicLayerCollection=hn,e.MassiveModelLayer=class extends cn{constructor(e={}){e.objects.forEach((e=>{e._id=e.id,delete e.id})),super(e),this._id=U(e.id,ge()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new Po,this._maxClusterLevel=U(e.maxClusterLevel,12),this._minLoadLevel=U(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={},this._options=e}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=Mo(e),r=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,r)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){Mo(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=Mo(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){if(!this._collection){this._scene=t;const e=new Cesium.PrimitiveCollection;t.primitives.add(e),this._collection=e}}createGeometry(e,t,r){if(e.level<this._minLoadLevel)return;const i=U(this._createGeometryFunction,To)(r,this._options);return this.add(i),i}removeGeometry(e,t){if(!t)return;return this._collection.remove(t)}add(e){this._collection&&e&&this._collection.add(e)}removeAll(){this._collection.removeAll()}isDestroyed(){return!1}destroy(){this._collection.removeAll(),So(this)}},e.MassivePointLayer=class extends po{constructor(e={}){e.objects=U(e.objects,[]),e.pixelSize=U(e.pixelSize,5),e.color=U(e.color,Bo.fromRandom),e.createGeometryFunction=U(e.createGeometryFunction,function(e){return function(t){const r={id:t.id,position:t.position,point:{pixelSize:U(t.pixelSize,e.pixelSize),color:U(t.color,e.color)}};return t.label&&(r.label={text:t.label}),new Uo(r)}}(e)),super(e)}},e.Model=Di,e.MultipleTerrainProvider=class{constructor(e,t={}){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=t.ellipsoid,this._requestVertexNormals=U(t.requestVertexNormals,!1),this._requestWaterMask=U(t.requestWaterMask,!1),this._requestMetadata=U(t.requestMetadata,!0),this._errorEvent=new i,this._terrainProviders=[];const r=[];for(let i of e){i.requestVertexNormals=i.requestVertexNormals||t.requestVertexNormals,i.requestWaterMask=i.requestWaterMask||t.requestWaterMask,i.requestMetadata=i.requestMetadata||t.requestMetadata;const e=new L(i);e.zIndex=i.zIndex||-1,this._terrainProviders.push(e),r.push(et(e,i.url))}this._ready=!1,this._readyPromise=Ve.defer(),this._terrainList=e,Promise.all([...this._terrainProviders.map((e=>e.readyPromise)),...r]).then((e=>{this._ready=!0,this._readyPromise.resolve(!0),this._tilingScheme=this._terrainProviders[0]._tilingScheme,this._levelZeroMaximumGeometricError=He.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0))})),this._validProvider=void 0}get tilingScheme(){return this._tilingScheme}get ready(){return this._ready}get readyPromise(){return this._readyPromise}createBoundingRectangle(e){const t=new Xe("multiple-terrain-provider");for(let e of this._terrainProviders)t.entities.add(Ke(e));return e.addLayer(t),function(){const t=e.dataSources.getByName("multiple-terrain-provider");e.dataSources.remove(t[0])}}getLevelMaximumGeometricError(e){return this._validProvider?this._validProvider.getLevelMaximumGeometricError(e):this._levelZeroMaximumGeometricError/(1<<e)}getTileDataAvailable(e,t,r){const i=this._terrainProviders.filter((i=>i.getTileDataAvailable(e,t,r))).sort(((e,t)=>t.zIndex-e.zIndex));return this._validProvider=i[0],!!this._validProvider}requestTileGeometry(e,t,r,i){for(let i of this._terrainProviders)i!==this._validProvider&&i.getTileDataAvailable(e,t,r)&&i.requestTileGeometry(e,t,r);if(this._validProvider)return this._validProvider.requestTileGeometry(e,t,r)}},e.PbfDataSource=function(){},e.QuadTreeProvider=Fn,e.Scene=ln,e.Selection=lt,e.ShapefileDataSource=wi,e.TDTLayer=class extends to{constructor(e){const t=(e=U(e,{})).key;t||(console.warn("未定义key，地图服务将不可用"),console.warn("请前往http://lbs.tianditu.gov.cn/server/MapService.html获取地图key"));const r=U(e.tilingScheme,new Cesium.WebMercatorTilingScheme);let i="w",n="w",o=e.tileMatrixLabels;r instanceof Cesium.GeographicTilingScheme&&(i="c",n="c",G(o)||(o=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]));const s=U(e.layer,"img"),a=`http://t{s}.tianditu.com/${s}_${i}/wmts?service=wmts&tileMatrixSet=${n}&request=GetTile&version=1.0.0&LAYER=${s}&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=${t}`;return new Cesium.WebMapTileServiceImageryProvider({url:a,layer:s,style:e.style||"default",format:e.format||"tiles",tileMatrixSetID:"GoogleMapsCompatible",credit:e.credit?new Cesium.Credit(e.credit||""):null,tilingScheme:e.tilingScheme,maximumLevel:e.maximumLevel||19,minimumLevel:e.minimumLevel||0,tileMatrixLabels:o,subdomains:"01234567"})}static layers=[{layer:"vec",desc:"矢量底图"},{layer:"cva",desc:"矢量注记"},{layer:"img",desc:"影像底图"},{layer:"cia",desc:"影像注记"},{layer:"ter",desc:"地形晕渲"},{layer:"cta",desc:"地形注记"},{layer:"ibo",desc:"全球境界"},{layer:"eva",desc:"矢量英文注记"},{layer:"eia",desc:"影像英文注记"}]},e.TMSLayer=oo,e.TaskProcessor=class{constructor(e,t={}){this._workers=[],this._workerPath="workers/"+e,this._options=t,Math.max(X.hardwareConcurrency-1,1),this._worker=Q(this)}},e.TecentLayer=class extends ct{constructor(e={}){e.layer=U(e.layer,"img"),e.subdomains="123",e.url=ro[e.layer],e.customTags={sx:function(e,t,r,i){return t>>4},sy:function(e,t,r,i){return(1<<i)-r>>4}},super(e)}},e.TileDebugLayer=class{constructor(e={}){e.tileWidth=U(e.tileWidth,256),e.tileHeight=U(e.tileHeight,256),this._tilingScheme=G(e.tilingScheme)?e.tilingScheme:st.get("EPSG:4326",{ellipsoid:e.ellipsoid}),this._errorEvent=new i,this._tileWidth=U(e.tileWidth,256),this._tileHeight=U(e.tileHeight,256),this._readyPromise=Cesium.when.resolve(!0),this._font=U(e.font,"bold 24px sans-serif"),this._color=U(e.color,new Cesium.Color(1,1,1,1)),this._borderColor=U(e.borderColor,Cesium.Color.GOLD),this._borderWidth=U(e.borderWidth,2)}get ready(){return!0}get readyPromise(){return this._readyPromise}get hasAlphaChannel(){return!0}get errorEvent(){return this._errorEvent}get rectangle(){return this._tilingScheme.rectangle}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}createCanvas(){const e=document.createElement("canvas");e.width=this.tileWidth,e.height=this.tileHeight;const t=e.getContext("2d");return t.textBaseline="middle",t.textAlign="center",t.font=this.font,t.fillStyle=this.color.toCssColorString(),t.strokeStyle=this.borderColor.toCssColorString(),t.lineWidth=this.borderWidth,{canvas:e,ctx:t}}requestImage(e,t,r,i){const{canvas:n,ctx:o}=this.createCanvas(),s=function(e,t,r,i){let n=[];return n[0]="L: "+i,n[1]="X: "+t,e.reverseY?n[2]="Y: "+e.tilingScheme.getNumberOfYTilesAtLevel(i)-r-1:n[2]="Y: "+r,n}(this,e,t,r);return o.fillText(s[0],n.width/2,n.height/4*1),o.fillText(s[1],n.width/2,n.height/4*2),o.fillText(s[2],n.width/2,n.height/4*3),o.strokeRect(0,0,n.width,n.height),n}},e.TileLayer=class{constructor(e={}){this._errorEvent=new i,this._tilingScheme=st.get("EPSG:4326"),this._readyPromise=io.defer(),this._ready=!1,this._ready=!0,this._minimumLevel=U(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._tileWidth=U(e.tileWidth,256),this._tileHeight=U(e.tileHeight,256),this._rectangle=U(e.rectangle,no.MAX_VALUE),this._readyPromise.resolve(!0),this._errorEvent.addEventListener(((e,t,r)=>{}))}get minimumLevel(){return this._minimumLevel}get maximumLevel(){return this._maximumLevel}get errorEvent(){return this._errorEvent}get rectangle(){return this._rectangle}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get tilingScheme(){return this._tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}get tileHeight(){return this._tileHeight}get tileWidth(){return this._tileWidth}pickFeatures(e,t,r,i,n){}requestImage(e,t,r,i){return this.requestGeometry(e,t,r),Promise.reject(!1)}requestGeometry(e,t,r){}},e.Url=Y,e.VERSION="1.0.3",e.Viewer=Yn,e.WFSLayer=class{constructor(e={}){if(this._url=e.url,this._typeName=e.typeName,this._style=e.style,!G(this._url))throw new t("parameter url must be provided.");if(!G(this._typeName))throw new t("parameter typeName must be provided.");const r=new so({url:e.url,queryParameters:{service:"WFS",version:"1.0.0",request:"GetFeature",typeName:e.typeName,maxFeatures:50,outputFormat:"application/json"}});return ir.load(r,this._style)}get rectangle(){return this._rectangle||this.tilingScheme.rectangle}get tilingScheme(){return st.get("EPSG:4326")}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get ready(){return this._ready}get readyPromise(){return this._readyPromise}},e.WMSLayer=ao,e.WMTSLayer=to,e.XYZLayer=ct,e._shaderGroundSkyBoxFS=pe,e._shaderGroundSkyBoxVS=ve,e._shaderLine=function(){},e.computeDistancePerPixel=ue,e.computeSceneCenterPoint=de,e.computeSceneExtent=me,e.createDefaultLayer=ut,e.createGuid=ge,e.dateFormat=fe,e.defaultValue=U,e.defined=G,e.proj=st,Object.defineProperty(e,"__esModule",{value:!0})}));
