!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CesiumPro={})}(this,(function(e){"use strict";class t extends Error{constructor(e){super(e),this.name="CesiumProError"}}function r(e,t){return t-e}t.throwInstantiationError=function(){throw new DeveloperError("This function defines an interface and should not be called directly.")},t.throwNoInstance=function(){throw new t("它的定义了一个接口，不能被以直接调用.")};class i{constructor(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}get numberOfListeners(){return this._listeners.length-this._toRemove.length}addEventListener(e,r){if("function"!=typeof e)throw new t("侦听器应该是一个函数");this._listeners.push(e),this._scopes.push(r);const i=this;return function(){i.removeEventListener(e,r)}}removeEventListener(e,r){if("function"!=typeof e)throw new t("侦听器应该是一个函数");const i=this._listeners,n=this._scopes;let o=-1;for(let t=0;t<i.length;t++)if(i[t]===e&&n[t]===r){o=t;break}return-1!==o&&(this._insideRaiseEvent?(this._toRemove.push(o),i[o]=void 0,n[o]=void 0):(i.splice(o,1),n.splice(o,1)),!0)}raise(){let e;this._insideRaiseEvent=!0;const t=this._listeners,i=this._scopes;let{length:n}=t;for(e=0;e<n;e++){const r=t[e];Cesium.defined(r)&&t[e].apply(i[e],arguments)}const o=this._toRemove;if(n=o.length,n>0){for(o.sort(r),e=0;e<n;e++){const r=o[e];t.splice(r,1),i.splice(r,1)}o.length=0}this._insideRaiseEvent=!1}}const{RequestState:n,when:o,AttributeCompression:a,BoundingSphere:s,Cartesian3:l,Credit:c,defaultValue:u,defined:d,DeveloperError:h,GeographicTilingScheme:m,WebMercatorTilingScheme:f,getJsonFromTypedArray:g,HeightmapTerrainData:p,IndexDatatype:_,OrientedBoundingBox:v,QuantizedMeshTerrainData:y,Request:C,RequestType:b,Resource:S,RuntimeError:w,TerrainProvider:x,TileAvailability:E,TileProviderError:T}=Cesium;function P(e){this.resource=e.resource,this.version=e.version,this.isHeightmap=e.isHeightmap,this.tileUrlTemplates=e.tileUrlTemplates,this.availability=e.availability,this.hasVertexNormals=e.hasVertexNormals,this.hasWaterMask=e.hasWaterMask,this.hasMetadata=e.hasMetadata,this.availabilityLevels=e.availabilityLevels,this.availabilityTilesLoaded=e.availabilityTilesLoaded,this.littleEndianExtensionSize=e.littleEndianExtensionSize,this.availabilityPromiseCache={}}function A(e){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=e.ellipsoid,this._requestVertexNormals=u(e.requestVertexNormals,!1),this._requestWaterMask=u(e.requestWaterMask,!1),this._requestMetadata=u(e.requestMetadata,!0),this._errorEvent=new i;var t=e.credit;"string"==typeof t&&(t=new c(t)),this._credit=t,this._availability=void 0;var r=o.defer();this._ready=!1,this._readyPromise=r,this._tileCredits=void 0;var n,a,s,l=this,h=this._layers=[],g="",p=[],_=0;function v(e){var t;if(!e.format)return t="The tile format is not specified in the layer.json file.",void(s=T.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,w));if(!e.tiles||0===e.tiles.length)return t="The layer.json file does not specify any tile URL templates.",void(s=T.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,w));var r=!1,i=!1,c=!1,u=!0,C=!1;if("heightmap-1.0"===e.format)C=!0,d(l._heightmapStructure)||(l._heightmapStructure={heightScale:.2,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),i=!0,l._requestWaterMask=!0;else if(0!==e.format.indexOf("quantized-mesh-1."))return t='The tile format "'+e.format+'" is invalid or not supported.',void(s=T.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,w));var b,S=e.tiles,A=e.maxzoom;if(_=Math.max(_,A),e.projection&&"EPSG:4326"!==e.projection){if("EPSG:3857"!==e.projection)return t='The projection "'+e.projection+'" is invalid or not supported.',void(s=T.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,w));l._tilingScheme=new f({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid})}else l._tilingScheme=new m({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:l._ellipsoid});if(l._levelZeroMaximumGeometricError=x.getEstimatedLevelZeroGeometricErrorForAHeightmap(l._tilingScheme.ellipsoid,l._heightmapWidth,l._tilingScheme.getNumberOfXTilesAtLevel(0)),e.scheme&&"tms"!==e.scheme&&"slippyMap"!==e.scheme)return t='The scheme "'+e.scheme+'" is invalid or not supported.',void(s=T.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,w));l._scheme=e.scheme,d(e.extensions)&&-1!==e.extensions.indexOf("octvertexnormals")?r=!0:d(e.extensions)&&-1!==e.extensions.indexOf("vertexnormals")&&(r=!0,u=!1),d(e.extensions)&&-1!==e.extensions.indexOf("watermask")&&(i=!0),d(e.extensions)&&-1!==e.extensions.indexOf("metadata")&&(c=!0);var L,M=e.metadataAvailability,R=e.available;if(d(R)&&!d(M)){L=new E(l._tilingScheme,R.length);for(var D=0;D<R.length;++D){var N=R[D],O=l._tilingScheme.getNumberOfYTilesAtLevel(D);d(p[D])||(p[D]=[]);for(var I=0;I<N.length;++I){var F=N[I],k=O-F.endY-1,U=O-F.startY-1;p[D].push([F.startX,k,F.endX,U]),L.addAvailableTileRange(D,F.startX,k,F.endX,U)}}}else d(M)&&(b=new E(l._tilingScheme,A),L=new E(l._tilingScheme,A),p[0]=[[0,0,1,0]],L.addAvailableTileRange(0,0,0,1,0));l._hasWaterMask=l._hasWaterMask||i,l._hasVertexNormals=l._hasVertexNormals||r,l._hasMetadata=l._hasMetadata||c,d(e.attribution)&&(g.length>0&&(g+=" "),g+=e.attribution),h.push(new P({resource:n,version:e.version,isHeightmap:C,tileUrlTemplates:S,availability:L,hasVertexNormals:r,hasWaterMask:i,hasMetadata:c,availabilityLevels:M,availabilityTilesLoaded:b,littleEndianExtensionSize:u}));var z=e.parentUrl;if(d(z)){if(!d(L))return console.log("A layer.json can't have a parentUrl if it does't have an available array."),o.resolve();(n=n.getDerivedResource({url:z})).appendForwardSlash();var G=(a=n.getDerivedResource({url:"layer.json"})).fetchJson();return o(G,v,y)}return o.resolve()}function y(e){var t="An error occurred while accessing "+a.url+".";s=T.handleError(s,l,l._errorEvent,t,void 0,void 0,void 0,w)}function C(e){v(e).then((function(){if(!d(s)){var e=p.length;if(e>0)for(var t=l._availability=new E(l._tilingScheme,_),r=0;r<e;++r)for(var i=p[r],n=0;n<i.length;++n){var o=i[n];t.addAvailableTileRange(r,o[0],o[1],o[2],o[3])}if(g.length>0){var a=new c(g);d(l._tileCredits)?l._tileCredits.push(a):l._tileCredits=[a]}l._ready=!0,l._readyPromise.resolve(!0)}}))}function b(e){d(e)&&404===e.statusCode?C({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]}):y()}function w(){o(a.fetchJson()).then(C).otherwise(b)}o(e.url).then((function(e){var t=S.createIfNeeded(e);t.appendForwardSlash(),a=(n=t).getDerivedResource({url:"layer.json"}),l._tileCredits=t.credits,w()})).otherwise((function(e){r.reject(e)}))}var L=1,M=2,R=4;function D(e){return d(e)&&0!==e.length?{Accept:"application/vnd.quantized-mesh;extensions="+e.join("-")+",application/octet-stream;q=0.9,*/*;q=0.01"}:{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"}}function N(e,t,r,i,c,u){if(!d(c))return o.reject(new w("Terrain tile doesn't exist"));var h=c.tileUrlTemplates;if(0!==h.length){var m;if(e._scheme&&"tms"!==e._scheme)m=r;else m=e._tilingScheme.getNumberOfYTilesAtLevel(i)-r-1;var f,C,b=[];e._requestVertexNormals&&c.hasVertexNormals&&b.push(c.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),e._requestWaterMask&&c.hasWaterMask&&b.push("watermask"),e._requestMetadata&&c.hasMetadata&&b.push("metadata");var S=h[(t+m+i)%h.length],x=c.resource;d(x._ionEndpoint)&&!d(x._ionEndpoint.externalType)?(0!==b.length&&(C={extensions:b.join("-")}),f=D(void 0)):f=D(b);var E=x.getDerivedResource({url:S,templateValues:{version:c.version,z:i,x:t,y:m},queryParameters:C,headers:f,request:u});if(E.request.state!==n.ISSUED&&E.request.state!==n.ACTIVE){var T=E.fetchArrayBuffer();if(d(T))return T.then((function(n){return d(e._heightmapStructure)?function(e,t,r,i,n){var o=new Uint16Array(t,0,e._heightmapWidth*e._heightmapWidth);return new p({buffer:o,childTileMask:new Uint8Array(t,o.byteLength,1)[0],waterMask:new Uint8Array(t,o.byteLength+1,t.byteLength-o.byteLength-1),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure,credits:e._tileCredits})}(e,n):function(e,t,r,i,n,o){var c=o.littleEndianExtensionSize,u=0,h=3*Float64Array.BYTES_PER_ELEMENT,m=4*Float64Array.BYTES_PER_ELEMENT,f=3*Uint16Array.BYTES_PER_ELEMENT,p=Uint16Array.BYTES_PER_ELEMENT,C=3*p,b=new DataView(t),S=new l(b.getFloat64(u,!0),b.getFloat64(u+8,!0),b.getFloat64(u+16,!0));u+=h;var w=b.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var x=b.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;var E=new s(new l(b.getFloat64(u,!0),b.getFloat64(u+8,!0),b.getFloat64(u+16,!0)),b.getFloat64(u+h,!0));u+=m;var T=new l(b.getFloat64(u,!0),b.getFloat64(u+8,!0),b.getFloat64(u+16,!0));u+=h;var P=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var A=new Uint16Array(t,u,3*P);u+=P*f,P>65536&&(C=3*(p=Uint32Array.BYTES_PER_ELEMENT));var D=A.subarray(0,P),N=A.subarray(P,2*P),O=A.subarray(2*P,3*P);a.zigZagDeltaDecode(D,N,O),u%p!=0&&(u+=p-u%p);var I=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var F=_.createTypedArrayFromArrayBuffer(P,t,u,3*I);u+=I*C;for(var k=0,U=F.length,z=0;z<U;++z){var G=F[z];F[z]=k-G,0===G&&++k}var B=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var H=_.createTypedArrayFromArrayBuffer(P,t,u,B);u+=B*p;var W=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var j=_.createTypedArrayFromArrayBuffer(P,t,u,W);u+=W*p;var V=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var q=_.createTypedArrayFromArrayBuffer(P,t,u,V);u+=V*p;var Y=b.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var X,J,Z=_.createTypedArrayFromArrayBuffer(P,t,u,Y);for(u+=Y*p;u<b.byteLength;){var $=b.getUint8(u,!0);u+=Uint8Array.BYTES_PER_ELEMENT;var Q=b.getUint32(u,c);if(u+=Uint32Array.BYTES_PER_ELEMENT,$===L&&e._requestVertexNormals)X=new Uint8Array(t,u,2*P);else if($===M&&e._requestWaterMask)J=new Uint8Array(t,u,Q);else if($===R&&e._requestMetadata){var K=b.getUint32(u,!0);if(K>0){var ee=g(new Uint8Array(t),u+Uint32Array.BYTES_PER_ELEMENT,K).available;if(d(ee))for(var te=0;te<ee.length;++te)for(var re=r+te+1,ie=ee[te],ne=e._tilingScheme.getNumberOfYTilesAtLevel(re),oe=0;oe<ie.length;++oe){var ae=ie[oe],se=ne-ae.endY-1,le=ne-ae.startY-1;e.availability.addAvailableTileRange(re,ae.startX,se,ae.endX,le),o.availability.addAvailableTileRange(re,ae.startX,se,ae.endX,le)}}o.availabilityTilesLoaded.addAvailableTileRange(r,i,n,i,n)}u+=Q}var ce=5*e.getLevelMaximumGeometricError(r),ue=e._tilingScheme.tileXYToRectangle(i,n,r),de=v.fromRectangle(ue,w,x,e._tilingScheme.ellipsoid);return new y({center:S,minimumHeight:w,maximumHeight:x,boundingSphere:E,orientedBoundingBox:de,horizonOcclusionPoint:T,quantizedVertices:A,encodedNormals:X,indices:F,westIndices:H,southIndices:j,eastIndices:q,northIndices:Z,westSkirtHeight:ce,southSkirtHeight:ce,eastSkirtHeight:ce,northSkirtHeight:ce,childTileMask:e.availability.computeChildMaskForTile(r,i,n),waterMask:J,credits:e._tileCredits})}(e,n,i,t,r,c)}))}}}function O(e,t,r,i){if(0!==i){var n=e.availabilityLevels,o=i%n==0?i-n:(i/n|0)*n,a=1<<i-o;return{level:o,x:t/a|0,y:r/a|0}}}function I(e,t,r,i,n,o){if(!d(n.availabilityLevels))return{result:!1};for(var a,s=function(){delete n.availabilityPromiseCache[a]},l=n.availabilityTilesLoaded,c=n.availability,u=O(n,t,r,i);d(u);){if(c.isTileAvailable(u.level,u.x,u.y)&&!l.isTileAvailable(u.level,u.x,u.y)){var h;if(!o&&(a=u.level+"-"+u.x+"-"+u.y,h=n.availabilityPromiseCache[a],!d(h))){var m=new C({throttle:!1,throttleByServer:!1,type:b.TERRAIN});h=N(e,u.x,u.y,u.level,n,m),d(h)&&(n.availabilityPromiseCache[a]=h,h.then(s))}return{result:!0,promise:h}}u=O(n,u.x,u.y,u.level)}return{result:!1}}function F(e,t){return null!=e?e:t}function k(e){return null!=e}A.prototype.requestTileGeometry=function(e,t,r,i){var n,o=this._layers,a=o.length;if(1===a)n=o[0];else for(var s=0;s<a;++s){var l=o[s];if(!d(l.availability)||l.availability.isTileAvailable(r,e,t)){n=l;break}}return N(this,e,t,r,n,i)},Object.defineProperties(A.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){return this._availability}}}),A.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},A.prototype.getTileDataAvailable=function(e,t,r){if(d(this._availability)){if(r>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(r,e,t))return!0;if(!this._hasMetadata)return!1;for(var i=this._layers,n=i.length,o=0;o<n;++o){if(I(this,e,t,r,i[o],0===o).result)return}return!1}},A.prototype.loadTileDataAvailability=function(e,t,r){if(!(!d(this._availability)||r>this._availability._maximumLevel||this._availability.isTileAvailable(r,e,t))&&this._hasMetadata)for(var i=this._layers,n=i.length,o=0;o<n;++o){var a=I(this,e,t,r,i[o],0===o);if(d(a.promise))return a.promise}},A._getAvailabilityTile=O;const U=/((?:.*\/)|^)CesiumPro\.js(?:\?|#|$)/;let z,G,B;function H(e){return"undefined"==typeof document?e:(k(z)||(z=document.createElement("a")),z.href=e,z.href=z.href,z.href)}function W(e){return H(`../${e}`)}function j(){if(k(G))return G;let e;if(e="undefined"!=typeof CESIUMPRO_BASE_URL?CESIUMPRO_BASE_URL:"object"==typeof window.define&&k(window.define.amd)&&!window.define.amd.toUrlUndefined?Cesium.getAbsoluteUri("..","core/Url.js"):function(){const e=document.getElementsByTagName("script");for(let t=0,r=e.length;t<r;++t){const r=e[t].getAttribute("src"),i=U.exec(r);if(null!==i)return i[1]}}(),!k(e))throw new t("Unable to determine CesiumPro base URL automatically, try defining a global variable called CESIUMPRO_BASE_URL.");return k(e)||(e=""),G=new Cesium.Resource({url:H(e)}),G.appendForwardSlash(),G}function V(e){return j().getDerivedResource({url:e}).url}function q(e){k(B)||(B="object"==typeof window.define&&k(window.define.amd)&&!window.define.amd.toUrlUndefined?W:V);return B(e)}const Y={join:function(...e){const t=[];for(let r of e)r.startsWith("/")&&(r=r.substring(1)),r.endsWith("/")&&(r=r.substring(0,r.length-1)),t.push(r);return t.join("/")},buildModuleUrl:function(e){return q(e)}};Y.getCesiumProBaseUrl=j;const{FeatureDetection:X,isCrossOriginUrl:J}=Cesium;let Z;function $(){return k(Z)||(Z=function(e){let t=Cesium.buildModuleUrl(e);if(J(t)){const e='importScripts("'+t+'");';let r;try{r=new Blob([e],{type:"application/javascript"})}catch(t){let i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(e),r=i.getBlob("application/javascript")}t=(window.URL||window.webkitURL).createObjectURL(r)}return t}("Workers/cesiumWorkerBootstrapper.js")),Z}function Q(e){const t=new Worker($());t.postMessage=F(t.webkitPostMessage,t.postMessage);const r={loaderConfig:{paths:{Workers:q("workers")},baseUrl:j().url},workerModule:e._workerPath};return t.postMessage(r),t.onmessage=function(t){!function(e,t){console.log(e,t,"------complete-----")}(e,t.data)},t.postMessage(e._options),t}const{kdbush:K,Cartesian3:ee,Cartographic:te,PointPrimitive:re,BoundingRectangle:ie,SceneMode:ne,EllipsoidalOccluder:oe}=Cesium;function ae(e){return e.__pixel.x}function se(e){return e.__pixel.y}function le(e,t){const r=new ie;return re.getScreenSpaceBoundingBox(e,t,r),function(e,t){e.x-=t,e.y-=t,e.width+=2*t,e.height+=2*t}(r,this.pixelRange),r}let ce;function ue(e){if(!e.scene.globe)return;const t=Cesium.getTimestamp(),r=e.scene;if(k(ce)&&t-ce<250)return;ce=t;const i=r.canvas.clientWidth,n=r.canvas.clientHeight,o=r.camera.getPickRay(new Cesium.Cartesian2(i/2,n/2)),a=r.camera.getPickRay(new Cesium.Cartesian2(i/2+1,n/2)),s=r.globe.pick(o,r),l=r.globe.pick(a,r);if(!k(s)||!k(l))return;return new Cesium.EllipsoidGeodesic(r.globe.ellipsoid.cartesianToCartographic(s),r.globe.ellipsoid.cartesianToCartographic(l)).surfaceDistance}class de{constructor(e,r,i){if(!k(e))throw new t("longitude is required.");if(!k(r))throw new t("latitude is required.");this.lon=e,this.lat=r,this.alt=F(i,0)}toPixel(e){return de.toPixel(this,e)}toCartesian(){return de.toCartesian(this)}toCartographic(){return de.toCartographic(this)}getRadias(){return{lon:Cesium.Math.toRadians(this.lon),lat:Cesium.Math.toRadians(this.lat),alt:alt}}isVisible(e){return de.isVisible(this,e)}toString(){return`{lon: ${this.lon}, lat: ${this.lat}, alt: ${this.alt}}`}toJson(){return{lon:this.lon,lat:this.lat,alt:this.alt}}static isVisible(e,r){if(r instanceof Cesium.Viewer)throw new t("viewer不是一个有效的Cesium.Viewer对象");if(!k(e))throw new t("point is not defined.");const i=de.toCartesian(e);if(r.scene.mode===Cesium.SceneMode.SCENE3D){if(!new Cesium.EllipsoidalOccluder(Cesium.Ellipsoid.WGS84,r.camera.position).isPointVisible(i))return!1;const t=de.toPixel(e,r.scene);if(!k(t))return!1;const n=r.canvas.width||r.canvas.clientWidth,o=r.canvas.height||r.canvas.clientHeight;return t.x>0&&t.x<n&&t.y>0&&t.y<o}if(r.scene.mode===Cesium.SceneMode.SCENE2D){const e=r.scene.camera.frustum,{positionWC:t,directionWC:n,upWC:o}=r.scene.camera,a=e.computeCullingVolume(t,n,o),s=Cesium.BoundingSphere.projectTo2D(new BoundingSphere(i,1)),l=a.computeVisibility(s);return l===Cesium.Intersect.INSIDE||l===Cesium.Intersect.INERSECTING}}static toPixel(e,r){if(!k(r))throw new t("scene未定义。");if(!k(e))throw new t("point is not defined.");const i=de.toCartesian(e);if(k(i))return Cesium.SceneTransforms.wgs84ToWindowCoordinates(r,i)}static toCartographic(e){if(!k(e))throw new t("point is not defined.");return Cesium.Cartographic.fromDegrees(e.lon,e.lat,e.alt)}static toCartesian(e,r){if(!k(e))throw new t("point is not defined.");if(e instanceof Cesium.Cartesian3)return e;if(e instanceof Cesium.Cartographic)return Cesium.Cartographic.toCartesian(e);if(e instanceof de)return Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt);if(e instanceof Cesium.Cartesian2){if(!r)return;const e=r.scene.camera.getPickRay(pixel);return r.scene.globe.pick(e,r.scene)}}static fromCartesian(e){if(!k(e))throw new t("cartesian is not defined.");const r=Cesium.Cartographic.fromCartesian(e);if(k(r))return de.fromCartographic(r)}static fromCartographic(e){if(!k(e))throw new t("cartographic is not defined.");return new de(Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height)}static fromPixel(e,r){if(!r.scene.globe)return;if(!k(e))throw new t("pixel is not defined.");if(r instanceof Cesium.Viewer==!1)throw new t("viewer不是一个有效的Cesium.Viewer对象");const i=r.scene.camera.getPickRay(e),n=r.scene.globe.pick(i,r.scene);return k(n)?de.fromCartesian(n):void 0}static fromDegrees(e,t,r){return new de(e,t,r)}static fromRadians(e,t,r){return new de(Cesium.Math.toDegrees(e),Cesium.Math.toDegrees(t),r)}static inChina(...e){if(1!==e.length){const t=+e[0],r=+e[1];return t>73.66&&t<135.05&&r>3.86&&r<53.55}{const t=e[0];if(e[0]instanceof de)return de.inChina(t.lon,t.lat)}}static fromLonlat(e){return new de(...e)}}function he(e){const t=e.canvas.getBoundingClientRect(),r=new Cesium.Cartesian2(t.width/2,t.height/2);return de.fromPixel(r,e)}function me(e){if(!e.scene.globe)return{};if(e.scene.mode===Cesium.SceneMode.SCENE3D){const t=e.camera.computeViewRectangle();if(!k(t))return;return{west:Cesium.Math.toDegrees(t.west),south:Cesium.Math.toDegrees(t.south),east:Cesium.Math.toDegrees(t.east),north:Cesium.Math.toDegrees(t.north)}}const t=e.canvas.getBoundingClientRect(),r=de.fromPixel(new Cesium.Cartesian2(0,t.height/2),e)||{lon:-180},i=de.fromPixel(new Cesium.Cartesian2(t.width,t.height/2),e)||{lon:180},n=de.fromPixel(new Cesium.Cartesian2(t.width/2,0),e)||{lat:90},o=de.fromPixel(new Cesium.Cartesian2(t.width/2,t.height),e)||{lat:-90};return{west:r.lon,south:o.lat,east:i.lon,north:n.lat}}function fe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function ge(e,t){let r;const i={"y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()},n=Object.keys(i);for(const t of n)r=new RegExp(`(${t})`).exec(e),r&&(e=e.replace(r[1],1===r[1].length?i[t]:i[t].padStart(r[1].length,"0")));return e}window.Date.prototype.format=function(e){ge(e,this)};const pe="uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  ",_e="attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",{defaultValue:ve,destroyObject:ye,Matrix4:Ce,DrawCommand:be,BoxGeometry:Se,Cartesian3:we,defined:xe,GeometryPipeline:Ee,Transforms:Te,VertexFormat:Pe,BufferUsage:Ae,CubeMap:Le,loadCubeMap:Me,RenderState:Re,VertexArray:De,BlendingState:Ne,SceneMode:Oe,ShaderProgram:Ie,ShaderSource:Fe,Matrix3:ke}=Cesium;const Ue=Object.freeze({LEFT:-1,RIGHT:1,NONE:0,TOP:-10,BOTTOM:10}),{Cartesian2:ze,Rectangle:Ge,GeographicProjection:Be,Ellipsoid:He}=Cesium,We=Cesium.Math;function je(e){e=F(e,F.EMPTY_OBJECT),this._ellipsoid=F(e.ellipsoid,He.WGS84),this._rectangle=F(e.rectangle,Ge.MAX_VALUE),this._projection=new Be(this._ellipsoid),this._numberOfLevelZeroTilesX=36,this._numberOfLevelZeroTilesY=18,this._intervalOfZeorLevel=F(e.intervalOfZeorLevel,16)}Object.defineProperties(je.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),je.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},je.prototype.modifyLevel=function(e){return e<3?0:e<6?1:void 0},je.prototype.getDelatXY=function(e){const t=this._intervalOfZeorLevel;return{dx:t/2**e,dy:t/2**e}},je.prototype.getLonLatValuee=function(e,t,r){const i=this.getDelatXY(e);return{lon:i.dx*t-180,lat:90-i.dy*r}},je.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},je.prototype.rectangleToNativeRectangle=function(e,t){const r=We.toDegrees(e.west),i=We.toDegrees(e.south),n=We.toDegrees(e.east),o=We.toDegrees(e.north);return k(t)?(t.west=r,t.south=i,t.east=n,t.north=o,t):new Ge(r,i,n,o)},je.prototype.tileXYToNativeRectangle=function(e,t,r,i){const n=this.tileXYToRectangle(e,t,r,i);return n.west=We.toDegrees(n.west),n.south=We.toDegrees(n.south),n.east=We.toDegrees(n.east),n.north=We.toDegrees(n.north),n},je.prototype.tileXYToRectangle=function(e,t,r,i){var n=this._rectangle,o=this.getNumberOfXTilesAtLevel(r),a=this.getNumberOfYTilesAtLevel(r),s=n.width/o,l=e*s+n.west,c=(e+1)*s+n.west,u=n.height/a,d=n.north-t*u,h=n.north-(t+1)*u;return k(i)||(i=new Ge(l,h,c,d)),i.west=l,i.south=h,i.east=c,i.north=d,i},je.prototype.positionToTileXY=function(e,t,r){var i=this._rectangle;if(Ge.contains(i,e)){var n=this.getNumberOfXTilesAtLevel(t),o=this.getNumberOfYTilesAtLevel(t),a=i.width/n,s=i.height/o,l=e.longitude;i.east<i.west&&(l+=We.TWO_PI);var c=(l-i.west)/a|0;c>=n&&(c=n-1);var u=(i.north-e.latitude)/s|0;return u>=o&&(u=o-1),k(r)?(r.x=c,r.y=u,r):new ze(c,u)}};const{CesiumTerrainProvider:Ve,when:qe,TerrainProvider:Ye,Resource:Xe,CustomDataSource:Je,Cartesian3:Ze,Entity:$e,Color:Qe,Rectangle:Ke}=Cesium;function et(e){let t=[];const r=[e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north];return"EPSG:4326"===e.projection.toUpperCase()&&(t=[r[0],r[1],r[0],r[3],r[2],r[3],r[2],r[1],r[0],r[1]]),new $e({polyline:{positions:Ze.fromRadiansArray(t),material:Qe.fromRandom({alpha:1}),width:3,clampToGround:!0}})}function tt(e,t){const r=Xe.createIfNeeded(t);r.appendForwardSlash();const i=r.getDerivedResource({url:"layer.json"});return new Promise(((t,r)=>{qe(i.fetchJson()).then((r=>{e.projection=r.projection,e.bounds=Ke.fromDegrees(...r.valid_bounds),t(!0)}))}))}const rt=52.35987755982988,it=3.141592653589793,nt=6378245,ot=.006693421622965943;function at(e,t){let r=this.transformLng(e-105,t-35),i=this.transformLat(e-105,t-35);const n=t/180*it;let o=Math.sin(n);o=1-ot*o*o;const a=Math.sqrt(o);return r=180*r/(nt/a*Math.cos(n)*it),i=180*i/(nt*(1-ot)/(o*a)*it),[r,i]}const st={get:function(e="EPSG:3857",r){const i=e.toUpperCase();if("EPSG:3857"===i)return new Cesium.WebMercatorTilingScheme(r);if("EPSG:4326"===i)return new Cesium.GeographicTilingScheme(r);throw new t("未知的坐标系.")},BD09ToGCJ02:function(e,t){const r=+e-.0065,i=+t-.006,n=Math.sqrt(r*r+i*i)-2e-5*Math.sin(i*rt),o=Math.atan2(i,r)-3e-6*Math.cos(r*rt);return[n*Math.cos(o),n*Math.sin(o)]},GCJ02ToBD09:function(e,t){t=+t,e=+e;const r=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*rt),i=Math.atan2(t,e)+3e-6*Math.cos(e*rt);return[r*Math.cos(i)+.0065,r*Math.sin(i)+.006]},WGS84ToGCJ02:function(e,t){if(t=+t,e=+e,de.inChina(e,t)){const r=at(e,t);return[e+r[0],t+r[1]]}return[e,t]},GCJ02ToWGS84:function(e,t){if(t=+t,e=+e,de.inChina(e,t)){const r=at(e,t);return[2*e-(e+r[0]),2*t-(t+r[1])]}return[e,t]}},{Color:lt}=Cesium;class ct{constructor(){}static pointColor=lt.AQUA;static fillColor=lt.AQUA;static strokeColor=lt.AQUA}class ut extends Cesium.UrlTemplateImageryProvider{constructor(e){"string"==typeof e&&(e={url:e}),e.getFeatureInfoFormats=F(e.getFeatureInfoFormats,ut.defaultFeatureInfoFormats),super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get rectangle(){return super.rectangle}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}function dt(){return new ut({url:Y.buildModuleUrl("assets/tiles/{z}/{x}/{y}.png"),maximumLevel:4})}ut.defaultFeatureInfoFormats=Object.freeze([Object.freeze(new Cesium.GetFeatureInfoFormat("json","application/json")),Object.freeze(new Cesium.GetFeatureInfoFormat("xml","text/xml")),Object.freeze(new Cesium.GetFeatureInfoFormat("text","text/html"))]);const{defined:ht,defaultValue:mt,ColorMaterialProperty:ft,ConstantPositionProperty:gt,ConstantProperty:pt,DataSource:_t,PolygonGraphics:vt,PolylineGraphics:yt,EntityCluster:Ct,PinBuilder:bt,createGuid:St,Cartesian3:wt,PointGraphics:xt,ArcType:Et,PolygonHierarchy:Tt,Color:Pt,EntityCollection:At,HeightReference:Lt,when:Mt,Resource:Rt,describe:Dt,Event:Nt}=Cesium,Ot={small:24,medium:48,large:64},It={},Ft={},kt={"urn:ogc:def:crs:OGC:1.3:CRS84":ir,"EPSG:4326":ir,"urn:ogc:def:crs:EPSG::4326":ir},Ut=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"],zt={Feature:Wt,FeatureCollection:function(e,t,r,i,n){for(var o=t.features,a=0,s=o.length;a<s;a++)Wt(e,o[a],void 0,i,n)},GeometryCollection:jt,LineString:Zt,MultiLineString:$t,MultiPoint:Yt,MultiPolygon:er,Point:qt,Polygon:Kt,Topology:tr},Gt={GeometryCollection:jt,LineString:Zt,MultiLineString:$t,MultiPoint:Yt,MultiPolygon:er,Point:qt,Polygon:Kt,Topology:tr};function Bt(e,t){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function Ht(e,t,r){var i=e.id;if(ht(i)&&"Feature"===e.type){for(var n=2,o=i;ht(t.getById(o));)o=i+"_"+n,n++;i=o}else i=St();var a=t.getOrCreateEntity(i),s=e.properties;if(ht(s)){var l;a.properties=s;var c=s.title;if(ht(c))a.name=c,l="title";else{var u=Number.MAX_VALUE;for(var d in s)if(s.hasOwnProperty(d)&&s[d]){var h=d.toLowerCase();if(u>1&&"title"===h){u=1,l=d;break}u>2&&"name"===h?(u=2,l=d):u>3&&/title/i.test(d)?(u=3,l=d):u>4&&/name/i.test(d)&&(u=4,l=d)}ht(l)&&(a.name=s[l])}var m=s.description;null!==m&&(a.description=ht(m)?new pt(m):r(s,l))}return a}function Wt(e,r,i,n,o){if(null!==r.geometry){if(!ht(r.geometry))throw new t("feature.geometry is required.");var a=r.geometry.type,s=Gt[a];if(!ht(s))throw new t("Unknown geometry type: "+a);s(e,r,r.geometry,n,o)}else Ht(r,e._entityCollection,o.describe)}function jt(e,r,i,n,o){for(var a=i.geometries,s=0,l=a.length;s<l;s++){var c=a[s],u=c.type,d=Gt[u];if(!ht(d))throw new t("Unknown geometry type: "+u);d(e,r,c,n,o)}}function Vt(e,t,r,i,n){let o=n.pointSize,a=n.pointColor;const s=t.properties;if(ht(s)){const e=s["point-color"];ht(e)&&(a=Pt.fromCssColorString(e)),o=mt(Ot[s["point-size"]],o)}const l=new xt;2===i.length&&n.clampToGround&&(l.heightReference=Lt.CLAMP_TO_GROUND);const c=Ht(t,e._entityCollection,n.describe);c.point=l,c.point.color=a,c.point.pixelSize=o,c.position=new gt(r(i))}function qt(e,t,r,i,n){Vt(e,t,i,r.coordinates,n)}function Yt(e,t,r,i,n){for(var o=r.coordinates,a=0;a<o.length;a++)Vt(e,t,i,o[a],n)}function Xt(e,t,r,i,n){const o=n.lineColor,a=n.lineWidth,s=t.properties;if(ht(s)){const e=s["stroke-width"];let t;ht(e)&&(a=new pt(e));let r=s.stroke;ht(r)&&(t=Pt.fromCssColorString(r));let i=s["stroke-opacity"];ht(i)&&1!==i&&(ht(t)||(t=o.color.clone()),t.alpha=i),ht(t)&&(o=new ft(t))}const l=Ht(t,e._entityCollection,n.describe),c=new yt;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=a,c.positions=new pt(Bt(i,r)),c.arcType=Et.RHUMB}function Jt(e,t){var r="";for(var i in e)if(e.hasOwnProperty(i)){if(i===t||-1!==Ut.indexOf(i))continue;var n=e[i];ht(n)&&(r+="object"==typeof n?"<tr><th>"+i+"</th><td>"+Jt(n)+"</td></tr>":"<tr><th>"+i+"</th><td>"+n+"</td></tr>")}return r.length>0&&(r='<table class="cesium-infoBox-defaultTable"><tbody>'+r+"</tbody></table>"),r}function Zt(e,t,r,i,n){Xt(e,t,i,r.coordinates,n)}function $t(e,t,r,i,n){for(var o=r.coordinates,a=0;a<o.length;a++)Xt(e,t,i,o[a],n)}function Qt(e,t,r,i,n){if(0===i.length||0===i[0].length)return;let o=n.outlineColor.color,a=n.fill,s=n.outlineWidth;const l=t.properties;if(ht(l)){const e=l["stroke-width"];let t;ht(e)&&(s=new pt(e));const r=l.stroke;ht(r)&&(t=Pt.fromCssColorString(r));let i,c=l["stroke-opacity"];ht(c)&&1!==c&&(ht(t)||(t=n.outlineColor.color.clone()),t.alpha=c),ht(t)&&(o=new pt(t));const u=l.fill;ht(u)&&(i=Pt.fromCssColorString(u),i.alpha=a.color.alpha),c=l["fill-opacity"],ht(c)&&c!==a.color.alpha&&(ht(i)||(i=a.color.clone()),i.alpha=c),ht(i)&&(a=new ft(i))}const c=new vt;c.outline=new pt(n.outline),c.outlineColor=o,c.outlineWidth=s,c.material=a,c.arcType=Et.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let r of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(r);ht(e)&&ht(e[1])&&(t=t.replace(r,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const d=[];for(var h=1,m=i.length;h<m;h++)d.push(new Tt(Bt(i[h],r)));const f=i[0];c.hierarchy=new pt(new Tt(Bt(f,r),d)),f[0].length>2?c.perPositionHeight=new pt(!0):n.clampToGround||(c.height=0);Ht(t,e._entityCollection,n.describe).polygon=c}function Kt(e,t,r,i,n){Qt(e,t,i,r.coordinates,n)}function er(e,t,r,i,n){for(var o=r.coordinates,a=0;a<o.length;a++)Qt(e,t,i,o[a],n)}function tr(e,t,r,i,n){for(var o in r.objects)if(r.objects.hasOwnProperty(o)){var a=topojson.feature(r,r.objects[o]);(0,zt[a.type])(e,a,a,i,n)}}function rr(e,t){return new Cesium.CallbackProperty(function(e,t,r){var i;return function(n,o){return ht(i)||(i=e(t,r)),i}}(Jt,e,t),!0)}function ir(e){return wt.fromDegrees(e[0],e[1],e[2])}class nr{constructor(e){this._name=e,this._changed=new Nt,this._error=new Nt,this._isLoading=!1,this._loading=new Nt,this._entityCollection=new At(this),this._promises=[],this._pinBuilder=new bt,this._entityCluster=new Ct,this._credit=void 0,this._resourceCredits=[]}static pointSize=5;static pointColor=Pt.ROYALBLUE;static lineColor=Pt.YELLOW;static fill=Pt.fromBytes(255,255,0,100);static outline=!0;static outlineColor=Pt.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return kt}static crsLinkHrefs(){return It}static crsLinkTypes(){return Ft}get entities(){return this._entityCollection}get name(){return this._name}set name(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}get clock(){}get isLoading(){return this._isLoading}get changedEvent(){return this._changed}get errorEvent(){return this._error}get loadingEvent(){return this._loading}get show(){return this._entityCollection.show}set show(e){this._entityCollection.show=e}get clustering(){return this._entityCluster}set clustering(e){this._entityCluster=e}get credit(){return this._credit}load(e,r){_t.setLoading(this,!0);let i=(r=mt(r,{})).credit;"string"==typeof i&&(i=new Credit(i)),this._credit=i;let n=e,o=r.sourceUri;if("string"==typeof e||e instanceof Rt){n=(e=Rt.createIfNeeded(e)).fetchJson(),o=mt(o,e.getUrlComponent());const t=this._resourceCredits,r=e.credits;if(ht(r)){const e=r.length;for(const i=0;i<e;i++)t.push(r[i])}}r={describe:mt(r.describe,rr),pointSize:mt(r.pointSize,nr.pointSize),pointColor:mt(r.pointColor,nr.pointColor),lineWidth:new pt(mt(r.lineWidth,nr.lineWidth)),outlineColor:new ft(mt(r.outlineColor,nr.outlineColor)),lineColor:new ft(mt(r.lineColor,nr.lineColor)),outlineWidth:mt(r.outlineWidth,nr.outlineWidth),fill:new ft(mt(r.fill,nr.fill)),outline:mt(r.outline,nr.outline),clampToGround:mt(r.clampToGround,nr.clampToGround),extrudedHeight:r.extrudedHeight};const a=this;return Mt(n,(function(e){return function(e,r,i,n){let o;ht(n)&&(o=Cesium.getFilenameFromUri(n)),ht(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const a=zt[r.type];if(!ht(a))throw new t("Unsupported GeoJSON object type: "+r.type);const s=r.crs;let l=null!==s?ir:null;if(ht(s)){if(!ht(s.properties))throw new t("crs.properties is undefined.");const e=s.properties;if("name"===s.type){if(l=kt[e.name],!ht(l))throw new t("Unknown crs name: "+e.name)}else if("link"===s.type){var c=It[e.href];if(ht(c)||(c=Ft[e.type]),!ht(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==s.type)throw new t("Unknown crs type: "+s.type);if(l=kt["EPSG:"+e.code],!ht(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&a(e,r,r,t,i),Cesium.when.all(e._promises,(function(){return e._promises.length=0,_t.setLoading(e,!1),e}))}))}(a,e,r,o)})).otherwise((function(e){return _t.setLoading(a,!1),a._error.raiseEvent(a,e),console.log(e),Mt.reject(e)}))}update(){return!0}}nr.load=function(e,t){return(new nr).load(e,t)};const or={};function ar(e){return new sr(e instanceof Uint8Array?e:new Uint8Array(e))}function sr(e){this._array=e}sr.prototype.read=function(){var e=this._array;return this._array=null,Promise.resolve(e?{done:!1,value:e}:{done:!0,value:void 0})},sr.prototype.cancel=function(){return this._array=null,Promise.resolve()};var lr=function(e){return fetch(e).then((function(e){return e.body&&e.body.getReader?e.body.getReader():e.arrayBuffer().then(ar)}))},cr=function(e){return new Promise((function(t,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onload=function(){t(ar(i.response))},i.onerror=r,i.ontimeout=r,i.open("GET",e,!0),i.send()}))};function ur(e){return("function"==typeof fetch?lr:cr)(e)}function dr(e){return"function"==typeof e.read?e:e.getReader()}var hr=new Uint8Array(0);function mr(e,t){if(!e.length)return t;if(!t.length)return e;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function fr(e){return"function"==typeof e.slice?e:new gr("function"==typeof e.read?e:e.getReader())}function gr(e){this._source=e,this._array=hr,this._index=0}gr.prototype.read=function(){var e=this,t=e._array.subarray(e._index);return e._source.read().then((function(r){return e._array=hr,e._index=0,r.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:mr(t,r.value)}}))},gr.prototype.slice=function(e){if((e|=0)<0)throw new Error("invalid length");var t=this,r=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var i=new Uint8Array(e);return i.set(this._array.subarray(this._index)),function n(){return t._source.read().then((function(o){return o.done?(t._array=hr,t._index=0,r>0?i.subarray(0,r):null):r+o.value.length>=e?(t._array=o.value,t._index=e-r,i.set(o.value.subarray(0,e-r),r),i):(i.set(o.value,r),r+=o.value.length,n())}))}()},gr.prototype.cancel=function(){return this._source.cancel()};var pr=function(e){return!(e=e.trim())||isNaN(e=+e)?null:e},_r={B:pr,C:function(e){return e.trim()||null},D:function(e){return new Date(+e.substring(0,4),e.substring(4,6)-1,+e.substring(6,8))},F:pr,L:function(e){return!/^[nf]$/i.test(e)&&(!!/^[yt]$/i.test(e)||null)},M:pr,N:pr},vr=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},yr=function(e,t){return(e=fr(e)).slice(32).then((function(r){var i=vr(r);return e.slice(i.getUint16(8,!0)-32).then((function(r){return new Cr(e,t,i,vr(r))}))}))};function Cr(e,t,r,i){this._source=e,this._decode=t.decode.bind(t),this._recordLength=r.getUint16(10,!0),this._fields=[];for(var n=0;13!==i.getUint8(n);n+=32){for(var o=0;o<11&&0!==i.getUint8(n+o);++o);this._fields.push({name:this._decode(new Uint8Array(i.buffer,i.byteOffset+n,o)),type:String.fromCharCode(i.getUint8(n+11)),length:i.getUint8(n+16)})}}var br=Cr.prototype;br.read=function(){var e=this,t=1;return e._source.slice(e._recordLength).then((function(r){return r&&26!==r[0]?{done:!1,value:e._fields.reduce((function(i,n){return i[n.name]=_r[n.type](e._decode(r.subarray(t,t+=n.length))),i}),{})}:{done:!0,value:void 0}}))},br.cancel=function(){return this._source.cancel()};var Sr=function(e){var t,r=40,i=e.getInt32(36,!0),n=new Array(i);for(t=0;t<i;++t,r+=16)n[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return{type:"MultiPoint",coordinates:n}},wr=function(e){return{type:"Point",coordinates:[e.getFloat64(4,!0),e.getFloat64(12,!0)]}},xr=function(e){var t,r=44,i=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(i),a=new Array(n),s=[],l=[];for(t=0;t<i;++t,r+=4)o[t]=e.getInt32(r,!0);for(t=0;t<n;++t,r+=16)a[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return o.forEach((function(e,t){var r=a.slice(e,o[t+1]);!function(e){if((t=e.length)<4)return!1;var t,r=0,i=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];for(;++r<t;)i+=e[r-1][1]*e[r][0]-e[r-1][0]*e[r][1];return i>=0}(r)?l.push(r):s.push([r])})),l.forEach((function(e){s.some((function(t){if(function(e,t){var r,i=-1,n=t.length;for(;++i<n;)if(r=Er(e,t[i]))return r>0;return!1}(t[0],e))return t.push(e),!0}))||s.push([e])})),1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}};function Er(e,t){for(var r=t[0],i=t[1],n=-1,o=0,a=e.length,s=a-1;o<a;s=o++){var l=e[o],c=l[0],u=l[1],d=e[s],h=d[0],m=d[1];if(Tr(l,d,t))return 0;u>i!=m>i&&r<(h-c)*(i-u)/(m-u)+c&&(n=-n)}return n}function Tr(e,t,r){var i=r[0]-e[0],n=r[1]-e[1];if(0===i&&0===n)return!0;var o=t[0]-e[0],a=t[1]-e[1];if(0===o&&0===a)return!1;var s=(i*o+n*a)/(o*o+a*a);return!(s<0||s>1)&&(0===s||1===s||s*o===i&&s*a===n)}var Pr=function(e){var t,r=44,i=e.getInt32(36,!0),n=e.getInt32(40,!0),o=new Array(i),a=new Array(n);for(t=0;t<i;++t,r+=4)o[t]=e.getInt32(r,!0);for(t=0;t<n;++t,r+=16)a[t]=[e.getFloat64(r,!0),e.getFloat64(r+8,!0)];return 1===i?{type:"LineString",coordinates:a}:{type:"MultiLineString",coordinates:o.map((function(e,t){return a.slice(e,o[t+1])}))}},Ar=function(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},Lr={0:function(){return null},1:wr,3:Pr,5:xr,8:Sr,11:wr,13:Pr,15:xr,18:Sr,21:wr,23:Pr,25:xr,28:Sr},Mr=function(e){return(e=fr(e)).slice(100).then((function(t){return new Rr(e,vr(t))}))};function Rr(e,t){var r=t.getInt32(32,!0);if(!(r in Lr))throw new Error("unsupported shape type: "+r);this._source=e,this._type=r,this._index=0,this._parse=Lr[r],this.bbox=[t.getFloat64(36,!0),t.getFloat64(44,!0),t.getFloat64(52,!0),t.getFloat64(60,!0)]}var Dr=Rr.prototype;function Nr(){}Dr.read=function(){var e=this;return++e._index,e._source.slice(12).then((function(t){if(null==t)return{done:!0,value:void 0};var r=vr(t);function i(){return e._source.slice(4).then((function(o){return null==o?{done:!0,value:void 0}:(r=vr(t=Ar(t.slice(4),o))).getInt32(0,!1)!==e._index?i():n()}))}function n(){var n=2*r.getInt32(4,!1)-4,o=r.getInt32(8,!0);return n<0||o&&o!==e._type?i():e._source.slice(n).then((function(r){return{done:!1,value:o?e._parse(vr(Ar(t.slice(8),r))):null}}))}return n()}))},Dr.cancel=function(){return this._source.cancel()};function Or(e,t){this._shp=e,this._dbf=t,this.bbox=e.bbox}var Ir=Or.prototype;function Fr(e,t,r){return"string"==typeof t?(/\.dbf$/.test(t)||(t+=".dbf"),t=ur(t)):t instanceof ArrayBuffer||t instanceof Uint8Array?t=ar(t):null!=t&&(t=dr(t)),"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),void 0===t&&(t=ur(e.substring(0,e.length-4)+".dbf").catch((function(){}))),e=ur(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?ar(e):dr(e),Promise.all([e,t]).then((function(e){var t,i,n,o=e[0],a=e[1],s="windows-1252";return r&&null!=r.encoding&&(s=r.encoding),t=o,i=a,n=a&&new TextDecoder(s),Promise.all([Mr(t),i&&yr(i,n)]).then((function(e){return new Or(e[0],e[1])}))}))}Ir.read=function(){var e=this;return Promise.all([e._dbf?e._dbf.read():{value:{}},e._shp.read()]).then((function(e){var t=e[0],r=e[1];return r.done?r:{done:!1,value:{type:"Feature",properties:t.value,geometry:r.value}}}))},Ir.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(Nr)},or.open=Fr,or.openShp=function(e,t){return"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),e=ur(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?ar(e):dr(e),Promise.resolve(e).then(Mr)},or.openDbf=function(e,t){var r="windows-1252";return t&&null!=t.encoding&&(r=t.encoding),r=new TextDecoder(r),"string"==typeof e?(/\.dbf$/.test(e)||(e+=".dbf"),e=ur(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?ar(e):dr(e),Promise.resolve(e).then((function(e){return yr(e,r)}))},or.read=function(e,t,r){return Fr(e,t,r).then((function(e){var t=[],r={type:"FeatureCollection",features:t,bbox:e.bbox};return e.read().then((function i(n){return n.done?r:(t.push(n.value),e.read().then(i))}))}))},Object.defineProperty(or,"__esModule",{value:!0});const{defined:kr,defaultValue:Ur,ColorMaterialProperty:zr,ConstantPositionProperty:Gr,ConstantProperty:Br,DataSource:Hr,PolygonGraphics:Wr,PolylineGraphics:jr,createGuid:Vr,Cartesian3:qr,PointGraphics:Yr,ArcType:Xr,PolygonHierarchy:Jr,Color:Zr,HeightReference:$r,Resource:Qr}=Cesium,Kr={small:24,medium:48,large:64},ei={},ti={},ri={"urn:ogc:def:crs:OGC:1.3:CRS84":Si,"EPSG:4326":Si,"urn:ogc:def:crs:EPSG::4326":Si},ii={Feature:si,FeatureCollection:function(e,t,r,i,n){for(var o=t.features,a=0,s=o.length;a<s;a++)si(e,o[a],void 0,i,n)},GeometryCollection:li,LineString:mi,MultiLineString:fi,MultiPoint:di,MultiPolygon:_i,Point:ui,Polygon:pi,Topology:vi},ni={GeometryCollection:li,LineString:mi,MultiLineString:fi,MultiPoint:di,MultiPolygon:_i,Point:ui,Polygon:pi,Topology:vi};function oi(e,t){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function ai(e,t,r){var i=e.id;if(kr(i)&&"Feature"===e.type){for(var n=2,o=i;kr(t.getById(o));)o=i+"_"+n,n++;i=o}else i=Vr();var a=t.getOrCreateEntity(i),s=e.properties;if(kr(s)){var l;a.properties=s;var c=s.title;if(kr(c))a.name=c,l="title";else{var u=Number.MAX_VALUE;for(var d in s)if(s.hasOwnProperty(d)&&s[d]){var h=d.toLowerCase();if(u>1&&"title"===h){u=1,l=d;break}u>2&&"name"===h?(u=2,l=d):u>3&&/title/i.test(d)?(u=3,l=d):u>4&&/name/i.test(d)&&(u=4,l=d)}kr(l)&&(a.name=s[l])}var m=s.description;null!==m&&(a.description=kr(m)?new Br(m):r(s,l))}return a}function si(e,r,i,n,o){if(null!==r.geometry){if(!kr(r.geometry))throw new t("feature.geometry is required.");var a=r.geometry.type,s=ni[a];if(!kr(s))throw new t("Unknown geometry type: "+a);s(e,r,r.geometry,n,o)}else ai(r,e._entityCollection,o.describe)}function li(e,r,i,n,o){for(var a=i.geometries,s=0,l=a.length;s<l;s++){var c=a[s],u=c.type,d=ni[u];if(!kr(d))throw new t("Unknown geometry type: "+u);d(e,r,c,n,o)}}function ci(e,t,r,i,n){let o=n.pointSize,a=n.pointColor;const s=t.properties;if(kr(s)){const e=s["point-color"];kr(e)&&(a=Zr.fromCssColorString(e)),o=Ur(Kr[s["point-size"]],o)}const l=new Yr;2===i.length&&n.clampToGround&&(l.heightReference=$r.CLAMP_TO_GROUND);const c=ai(t,e._entityCollection,n.describe);c.point=l,c.point.color=a,c.point.pixelSize=o,c.position=new Gr(r(i))}function ui(e,t,r,i,n){ci(e,t,i,r.coordinates,n)}function di(e,t,r,i,n){for(var o=r.coordinates,a=0;a<o.length;a++)ci(e,t,i,o[a],n)}function hi(e,t,r,i,n){const o=n.lineColor,a=n.lineWidth,s=t.properties;if(kr(s)){const e=s["stroke-width"];let t;kr(e)&&(a=new Br(e));let r=s.stroke;kr(r)&&(t=Zr.fromCssColorString(r));let i=s["stroke-opacity"];kr(i)&&1!==i&&(kr(t)||(t=o.color.clone()),t.alpha=i),kr(t)&&(o=new zr(t))}const l=ai(t,e._entityCollection,n.describe),c=new jr;l.polyline=c,c.clampToGround=n.clampToGround,c.material=o,c.width=a,c.positions=new Br(oi(i,r)),c.arcType=Xr.RHUMB}function mi(e,t,r,i,n){hi(e,t,i,r.coordinates,n)}function fi(e,t,r,i,n){for(var o=r.coordinates,a=0;a<o.length;a++)hi(e,t,i,o[a],n)}function gi(e,t,r,i,n){if(0===i.length||0===i[0].length)return;let o=n.outlineColor.color,a=n.fill,s=n.outlineWidth;const l=t.properties;if(kr(l)){const e=l["stroke-width"];let t;kr(e)&&(s=new Br(e));const r=l.stroke;kr(r)&&(t=Zr.fromCssColorString(r));let i,c=l["stroke-opacity"];kr(c)&&1!==c&&(kr(t)||(t=n.outlineColor.color.clone()),t.alpha=c),kr(t)&&(o=new Br(t));const u=l.fill;kr(u)&&(i=Zr.fromCssColorString(u),i.alpha=a.color.alpha),c=l["fill-opacity"],kr(c)&&c!==a.color.alpha&&(kr(i)||(i=a.color.clone()),i.alpha=c),kr(i)&&(a=new zr(i))}const c=new Wr;c.outline=new Br(n.outline),c.outlineColor=o,c.outlineWidth=s,c.material=a,c.arcType=Xr.RHUMB;const u=n.extrudedHeight;if(u)if("number"==typeof u)c.extrudedHeight=u;else if("string"==typeof u){const e=u.match(/\$\{\s*.*?\s*\}/gi);if(e){let t=u;for(let r of e){const e=/\$\{\s*(.*?)\s*\}/gi.exec(r);kr(e)&&kr(e[1])&&(t=t.replace(r,l[e[1]]))}try{const e=window.eval(t);"number"==typeof e&&(c.extrudedHeight=e)}catch(e){}}}const d=[];for(var h=1,m=i.length;h<m;h++)d.push(new Jr(oi(i[h],r)));const f=i[0];c.hierarchy=new Br(new Jr(oi(f,r),d)),f[0].length>2?c.perPositionHeight=new Br(!0):n.clampToGround||(c.height=0);ai(t,e._entityCollection,n.describe).polygon=c}function pi(e,t,r,i,n){gi(e,t,i,r.coordinates,n)}function _i(e,t,r,i,n){for(var o=r.coordinates,a=0;a<o.length;a++)gi(e,t,i,o[a],n)}function vi(e,t,r,i,n){for(var o in r.objects)if(r.objects.hasOwnProperty(o)){var a=topojson.feature(r,r.objects[o]);(0,ii[a.type])(e,a,a,i,n)}}function yi(e,t){var r="";for(var i in e)if(e.hasOwnProperty(i)){if(i===t||-1!==Ci.indexOf(i))continue;var n=e[i];kr(n)&&(r+="object"==typeof n?"<tr><th>"+i+"</th><td>"+yi(n)+"</td></tr>":"<tr><th>"+i+"</th><td>"+n+"</td></tr>")}return r.length>0&&(r='<table class="cesium-infoBox-defaultTable"><tbody>'+r+"</tbody></table>"),r}const Ci=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"];function bi(e,t){return new Cesium.CallbackProperty(function(e,t,r){var i;return function(n,o){return kr(i)||(i=e(t,r)),i}}(yi,e,t),!0)}function Si(e){return qr.fromDegrees(e[0],e[1],e[2])}class wi extends nr{constructor(e){super(e),this._geoJson=void 0}get geoJson(){return this._geoJson}set geoJson(e){this._geoJson?this._geoJson.features.push(e):this._geoJson={type:"FeatureCollection",features:[e]}}static pointSize=5;static pointColor=Zr.ROYALBLUE;static lineColor=Zr.YELLOW;static fill=Zr.fromBytes(255,255,0,100);static outline=!0;static outlineColor=Zr.YELLOW;static lineWidth=2;static clampToGround=!1;static outlineWidth=1;static crsNames(){return ri}static crsLinkHrefs(){return ei}static crsLinkTypes(){return ti}load(e,r={encoding:"utf-8"}){if(!kr(e))throw new t("data is required.");Cesium.DataSource.setLoading(this,!0);const i=r.credit;"string"==typeof i&&(i=new Cesium.Credit(i)),this._credit=i;const n=this;let o=e,a=r.sourceUri;if("string"==typeof e||e instanceof Qr){o=new Promise(((t,i)=>{or.open(e,void 0,{encoding:r.encoding}).then((e=>e.read().then((function r(i){if(!i.done)return n.geoJson=i.value,e.read().then(r);t(n.geoJson)})))).catch((e=>i(e.stack)))})),a=Ur(a,"");var s=this._resourceCredits,l=e.credits;if(kr(l))for(var c=l.length,u=0;u<c;u++)s.push(l[u])}return r={describe:Ur(r.describe,bi),pointSize:Ur(r.pointSize,wi.pointSize),pointColor:Ur(r.pointColor,wi.pointColor),lineWidth:new Br(Ur(r.lineWidth,wi.lineWidth)),outlineColor:new zr(Ur(r.outlineColor,wi.outlineColor)),lineColor:new zr(Ur(r.lineColor,wi.lineColor)),outlineWidth:Ur(r.outlineWidth,wi.outlineWidth),fill:new zr(Ur(r.fill,wi.fill)),outline:Ur(r.outline,wi.outline),clampToGround:Ur(r.clampToGround,wi.clampToGround),extrudedHeight:r.extrudedHeight},Cesium.when(o,(function(e){return function(e,r,i,n){let o;kr(n)&&(o=Cesium.getFilenameFromUri(n)),kr(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const a=ii[r.type];if(!kr(a))throw new t("Unsupported GeoJSON object type: "+r.type);const s=r.crs;let l=null!==s?Si:null;if(kr(s)){if(!kr(s.properties))throw new t("crs.properties is undefined.");const e=s.properties;if("name"===s.type){if(l=ri[e.name],!kr(l))throw new t("Unknown crs name: "+e.name)}else if("link"===s.type){var c=ei[e.href];if(kr(c)||(c=ti[e.type]),!kr(c))throw new t("Unable to resolve crs link: "+JSON.stringify(e));l=c(e)}else{if("EPSG"!==s.type)throw new t("Unknown crs type: "+s.type);if(l=ri["EPSG:"+e.code],!kr(l))throw new t("Unknown crs EPSG code: "+e.code)}}return Cesium.when(l,(function(t){return e._entityCollection.removeAll(),null!==t&&a(e,r,r,t,i),Cesium.when.all(e._promises,(function(){return e._promises.length=0,Hr.setLoading(e,!1),e}))}))}(n,e,r,a)})).otherwise((function(e){return Cesium.DataSource.setLoading(n,!1),n._error.raiseEvent(n,e),console.log(e),Cesium.when.reject(e)}))}}wi.load=function(e,t){return(new wi).load(e,t)};const{buildModuleUrl:xi,Color:Ei,defined:Ti,destroyObject:Pi,knockout:Ai,getElement:Li,subscribeAndEvaluate:Mi,InfoBoxViewModel:Ri}=Cesium;class Di{constructor(e){e=Li(e);var t=document.createElement("div");t.className="cesium-infoBox",t.setAttribute("data-bind",'      css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }'),e.appendChild(t);var r=document.createElement("div");r.className="cesium-infoBox-title",r.setAttribute("data-bind","text: titleText"),t.appendChild(r);var i=document.createElement("button");i.type="button",i.className="cesium-infoBox-close",i.setAttribute("data-bind","      click: function () { closeClicked.raiseEvent(this); }"),i.innerHTML="&times;",t.appendChild(i);var n=document.createElement("iframe");n.className="cesium-infoBox-iframe",n.setAttribute("sandbox","allow-same-origin allow-popups allow-forms"),n.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }"),n.setAttribute("allowfullscreen",!0),t.appendChild(n);var o=new Ri;Ai.applyBindings(o,t),this._container=e,this._element=t,this._frame=n,this._viewModel=o,this._descriptionSubscription=void 0;var a=this;n.addEventListener("load",(function(){var e=n.contentDocument,r=e.createElement("link");r.href=xi("Widgets/InfoBox/InfoBoxDescription.css"),r.rel="stylesheet",r.type="text/css";var i=e.createElement("div");i.className="cesium-infoBox-description",e.head.appendChild(r),e.body.appendChild(i),a._descriptionSubscription=Mi(o,"description",(function(e){n.style.height="5px",i.innerHTML=e;var r=null,o=i.firstElementChild;if(null!==o&&1===i.childNodes.length){var a=window.getComputedStyle(o);if(null!==a){var s=a["background-color"],l=Ei.fromCssColorString(s);Ti(l)&&0!==l.alpha&&(r=a["background-color"])}}t.style["background-color"]=r;var c=i.getBoundingClientRect().height;n.style.height=c+"px"}))})),n.setAttribute("src","about:blank")}get container(){return this._container}get viewModel(){return this._viewModel}get frame(){return this._frame}isDestroyed(){return!1}destroy(){var e=this._container;return Ai.cleanNode(this._element),e.removeChild(this._element),Ti(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),Pi(this)}}const{Transforms:Ni,Cartesian3:Oi}=Cesium;class Ii{constructor(e={}){if(!k(e.modelMatrix)&&k(e.position)){let t;e.position instanceof Oi?t=e.position:e.position instanceof de&&(t=e.position.toCartesian()),t&&(e.modelMatrix=Ni.eastNorthUpToFixedFrame(t))}if(k(e.gltf))this.delegate=new Cesium.Model(e);else{if(!k(e.url))throw new t("one of parameters url or gltf must be provided.");this.delegate=Cesium.Model.fromGltf(e)}this._readyPromise=this.delegate._readyPromise,this._ready=this.delegate._ready}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get activeAnimations(){return this.delegate.activeAnimations}set activeAnimations(e){this.delegate.activeAnimations=e}get allowPicking(){return this.delegate.allowPicking}get asynchronous(){return this.delegate.asynchronous}get backFaceCulling(){return this.delegate.backFaceCulling}get basePath(){return this.delegate.basePath}get boundingSphere(){return this.delegate.boundingSphere}get clippingPlanes(){return this.delegate.clippingPlanes}set clippingPlanes(e){this.delegate.clippingPlanes=e}get color(){return this.delegate.color}set color(e){this.delegate.color=e}get colorBlendMode(){return this.delegate.colorBlendMode}set colorBlendMode(e){this.delegate.colorBlendMode=e}get colorBlendAmount(){return this.delegate.colorBlendAmount}set colorBlendAmount(e){this.delegate.colorBlendAmount=e}get credit(){return this.delegate.credit}set credit(e){this.delegate.credit=e}get debugShowBoundingVolume(){return this.delegate.debugShowBoundingVolume}set debugShowBoundingVolume(e){this.delegate.debugShowBoundingVolume=e}get debugWireframe(){return this.delegate.debugWireframe}set debugWireframe(e){this.delegate.debugWireframe=e}get distanceDisplayCondition(){return this.delegate.distanceDisplayCondition}set distanceDisplayCondition(e){this.delegate.distanceDisplayCondition=e}get gltf(){return this.delegate.gltf}get id(){return this.delegate.id}set id(e){this.delegate.id=e}get maximumScale(){return this.delegate.maximumScale}set maximumScale(e){this.delegate.maximumScale=e}get minimumPixelSize(){return this.delegate.minimumPixelSize}set minimumPixelSize(e){this.delegate.minimumPixelSize=e}get modelMatrix(){return this.delegate.modelMatrix}set modelMatrix(e){this.delegate.modelMatrix=e}get scale(){return this.delegate.scale}set scale(e){this.delegate.scale=e}get shadows(){return this.delegate.shadows}set shadows(e){this.delegate.shadows=e}get show(){return this.delegate.show}set show(e){this.delegate.show=e}get showOutline(){return this.delegate.showOutline}get silhouetteColor(){return this.delegate.silhouetteColor}set silhouetteColor(e){this.delegate.silhouetteColor=e}get silhouetteSize(){return this.delegate.silhouetteSize}set silhouetteSize(e){this.delegate.silhouetteSize=e}static silhouetteSupported(e){return Cesium.Model.silhouetteSupported(e.scene)}destroy(){this.delegate.destroy()}isDestroyed(){this.delegate.isDestroyed()}getMaterial(e){return this.delegate.getMaterial(e)}getMesh(e){return this.delegate.getMesh(e)}getNode(e){return this.delegate.getNode(e)}get rootNodes(){return this.delegate._runtime.rootNodes}get nodes(){return this.delegate._runtime.nodesByName}get materials(){return this.delegate._runtime.materialsByName}get meshs(){return this.delegate._runtime.meshesByName}}class Fi{constructor(e={}){this._id=F(e.id,fe()),this._maxClusterLevel=F(e.maxClusterLevel,12),this._minLoadLevel=F(e.minLoadLevel,12),this._objects=void 0}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects}set objects(e){this._objects=e}updateCluster(e){t.throwInstantiationError()}beginUpdate(e){t.throwInstantiationError()}endUpdate(e){t.throwInstantiationError()}initialize(e,r){t.throwInstantiationError()}createGeometry(e,r,i){t.throwInstantiationError()}removeGeometry(e,t){}removeAll(){t.throwInstantiationError()}isDestroyed(){return!1}destroy(){t.throwInstantiationError()}}const{AssociativeArray:ki}=Cesium;class Ui{constructor(){this._layers=new ki}get layer(){return this._layers}get length(){return this._layers.length}get values(){return this._layers.values}get(e){return this._layers.get(e)}add(e){e instanceof Fi&&this._layers.set(e.id,e)}has(e){return e instanceof Fi?this._layers.contains(e):"string"==typeof e&&this._layers.contains(this.get(e))}remove(e){if(e instanceof Fi)return e.destroy(),this._layers.remove(e.id);if("string"==typeof e){const t=this._layers.get(e);return t&&t.destroy(),this._layers.remove(e)}return!1}removeAll(){return this._layers.removeAll()}}const{GeographicTilingScheme:zi,GlobeSurfaceTileProvider:Gi,when:Bi,Event:Hi,GlobeSurfaceTile:Wi,TerrainState:ji,RequestType:Vi,Request:qi,Rectangle:Yi,QuadtreeTileLoadState:Xi,Visibility:Ji,AssociativeArray:Zi,Cartesian3:$i,Cartographic:Qi,getTimestamp:Ki}=Cesium;const en={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function tn(e,t,r,i,n){const o=e.data;o.terrainState===ji.UNLOADED&&function(e,t,r){let i=e.data;function n(e){i.terrainData=e,i.terrainState=ji.RECEIVED,i.request=void 0}function o(e){if(i.request.state===RequestState.CANCELLED)return i.terrainData=void 0,i.terrainState=ji.UNLOADED,void(i.request=void 0);i.terrainState=ji.FAILED,i.request=void 0}!function(){const t=new qi({throttle:!1,throttleByServer:!0,type:Vi.TERRAIN});i.request=t;const a=r.requestTileGeometry(e.x,e.y,e.level,t);k(a)?(i.terrainState=ji.RECEIVING,Bi(a,n,o)):(i.terrainState=ji.UNLOADED,i.request=void 0)}()}(e,0,r),o.terrainState===ji.RECEIVED&&function(e,t,r,i,n,o){const a=r.tilingScheme,s=en;s.tilingScheme=a,s.x=i,s.y=n,s.level=o,s.exaggeration=t.terrainExaggeration,s.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,s.throttle=!0;const l=e.terrainData.createMesh(s);k(l)&&(e.terrainState=ji.TRANSFORMING,Bi(l,(function(t){e.mesh=t,e.terrainState=ji.TRANSFORMED}),(function(){e.terrainState=ji.FAILED})))}(o,t,r,e.x,e.y,e.level),o.terrainState===ji.TRANSFORMED&&(e.renderable=!0)}function rn(e,t){const r=[];for(let i of e)k(i)&&(k(i.id)||(i.id=fe()),k(i)&&k(i.position)&&(i.position instanceof $i?i.cartesian=i.position:i.position instanceof Qi?(i.cartesian=Qi.toCartesian(i.position),i.catographic=i.position):i.position instanceof de?(i.cartesian=i.position.toCartesian(),i.cartographic=i.position.toCartoGraphic()):i.cartesian=i.position,i.cartographic||(i.cartographic=Qi.fromCartesian(i.cartesian)),Yi.contains(t.rectangle,i.cartographic)&&r.push(i)));return r}class nn{constructor(){this.boundingVolumeSourceTile=void 0,this.terrainState=Cesium.TerrainState.UNLOADED,this.mesh=void 0,this.terrainData=void 0,this.objects=void 0,this._geometryOfTile=new Zi,this._objectsOfTile=new Zi,this._needRenderObjects=new Zi}static processStateMachine(e,t,r,i,n){nn.initialize(e,r),e.state===Xi.LOADING&&tn(e,t,r)}static initialize(e,t){let r=e.data;k(r)||(r=e.data=new nn),e.state===Xi.START&&(e.state=Xi.LOADING)}}function on(e,t,r,i,n){let o=r.data._geometryOfTile.get(t.id),a=e._hasRenderCached.get(t.id);a||(a={},e._hasRenderCached.set(t.id,a)),o||(o=[]);for(let e of n){if(a[e.id])return;const n=t.createGeometry(r,i,e);n&&(a[e.id]=!0,o.push({id:e.id,geometry:n}))}r.data._geometryOfTile.set(t.id,o)}function an(e,t,r,i,n){const o=e._hasRenderCached.get(t.id);for(let e of n){const{id:r,geometry:n}=e;t.removeGeometry(i,n),delete o[r]}r.data._geometryOfTile.remove(t.id)}class sn{constructor(e={}){this._ready=!0,this._scene=e.scene,this._tilingSceheme=new zi,this._readyPromise=Bi.defer(),this._readyPromise.resolve(!0),this._errorEvent=new Hi,this._terrainProvider=e.terrainProvider,this._show=!0,this.cartographicLimitRectangle=Yi.clone(Yi.MAX_VALUE),this.tree=void 0,this._layers=new Ui,this._lastTilesToRender=[],this._hasRenderCached=new Zi,this._tilesCahced=[]}get terrainProvider(){return this._terrainProvider}get show(){return this._show}set show(e){this._show=e}get ready(){return this._ready}get tilingScheme(){return this._tilingSceheme}get readyPromise(){return this._readyPromise}get quadtree(){return this._quadtree}set quadtree(e){k(e)&&(this._quadtree=e)}initialize(e){for(let t of this._layers.values)t.initialize(e,this._scene)}beginUpdate(e){const t=this._layers.values;for(let r of t)r.beginUpdate(e);this._frameNumber++}showTileThisFrame(e,t){const r=e.data;if(!k(r))return;this._tilesCahced.includes(e)||this._tilesCahced.push(e);const i=this._layers.values;Ki();for(let n of i){if(!k(n.objects)||!Array.isArray(n.objects))continue;const i=n.id;if(r._geometryOfTile.get(i)&&!n._needReclass)return;let o=r._objectsOfTile.get(i);k(o)&&!n._needReclass||(o=rn(n.objects,e),r._objectsOfTile.set(i,o)),on(this,n,e,t,o)}}endUpdate(e){const t=this._quadtree;if(!t)return;const r=this._lastTilesToRender,i=t._tilesToRender,n=this._layers.values;for(let t of r)if(!i.includes(t))for(let r of n){const i=t.data._geometryOfTile.get(r.id)||[];an(this,r,t,e,i)}for(let t of n){t.endUpdate(e)&&i.forEach((r=>{const i=r.data._geometryOfTile.get(t.id)||[];an(this,t,r,e,i)}))}this._lastTilesToRender=[...i]}loadTile(e,t){let r,i=!0;t.data&&(r=t.data.terrainState,i=t.data.boundingVolumeSourceTile!==t),nn.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree);const n=t.data;i&&r!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==Ji.NONE&&n.boundingVolumeSourceTile===t&&nn.processStateMachine(t,e,this.terrainProvider,this._layers,this.quadtree)}getLevelMaximumGeometricError(e){return this._terrainProvider.getLevelMaximumGeometricError(e)}canRefine(e){return Gi.prototype.canRefine.call(this,e)}computeTileVisibility(e,t,r){return k(e.data)||(e.data=new nn),Gi.prototype.computeTileVisibility.call(this,e,t,r)}computeDistanceToTile(e,t){return e.data||(e.data=new nn),Gi.prototype.computeDistanceToTile.call(this,e,t)}clearTile(e){const t=this._tilesCahced;for(let r of t)r.data._geometryOfTile.remove(e),r.data._objectsOfTile.remove(e);this._hasRenderCached.remove(e)}isDestroyed(){return!1}destroy(){this._removeEventListener();const e=this._layers.values;for(let t of e)t.destroy()}computeTileLoadPriority(e,t){return Gi.prototype.computeTileLoadPriority(e,t)}_onLayerAdded(e,t){}_onLayerRemoved(e,t){}_onLayerShownOrHidden(e,t,r){r?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)}}var ln="uniform vec4 u_initialColor;\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_DAY_NIGHT_ALPHA\nuniform float u_dayTextureNightAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureDayAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SPLIT\nuniform float czm_p_imagerySplitPosition;\nuniform float czm_p_drawingBufferHeight;\nuniform float czm_p_drawingBufferWidth;\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\n\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\nuniform highp sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n\n#ifdef TRANSLUCENT\nuniform vec4 u_frontFaceAlphaByDistance;\nuniform vec4 u_backFaceAlphaByDistance;\nuniform vec4 u_translucencyRectangle;\n#endif\n\n#ifdef UNDERGROUND_COLOR\nuniform vec4 u_undergroundColor;\nuniform vec4 u_undergroundColorAlphaByDistance;\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nfloat interpolateByDistance(vec4 nearFarScalar, float distance)\n{\n    float startDistance = nearFarScalar.x;\n    float startValue = nearFarScalar.y;\n    float endDistance = nearFarScalar.z;\n    float endValue = nearFarScalar.w;\n    float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);\n    return mix(startValue, endValue, t);\n}\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT) || defined(APPLY_MATERIAL)\nvec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)\n{\n    return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);\n}\n#endif\n\n#ifdef TRANSLUCENT\nbool inTranslucencyRectangle()\n{\n    return\n        v_textureCoordinates.x > u_translucencyRectangle.x &&\n        v_textureCoordinates.x < u_translucencyRectangle.z &&\n        v_textureCoordinates.y > u_translucencyRectangle.y &&\n        v_textureCoordinates.y < u_translucencyRectangle.w;\n}\n#endif\n\nvec4 sampleAndBlend(\n    vec4 previousColor,\n    sampler2D textureToSample,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateRectangle,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureNightAlpha,\n    float textureDayAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureHue,\n    float textureSaturation,\n    float textureOneOverGamma,\n    float split,\n    vec4 colorToAlpha,\n    float nightBlend)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\n    // In other words, the alpha is zero if the fragment is outside the rectangle\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    textureAlpha *= mix(textureDayAlpha, textureNightAlpha, nightBlend);\n#endif\n\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 value = texture2D(textureToSample, textureCoordinates);\n    vec3 color = value.rgb;\n    float alpha = value.a;\n\n#ifdef APPLY_COLOR_TO_ALPHA\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n\n#if !defined(APPLY_GAMMA)\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\n    color = tempColor.rgb;\n    alpha = tempColor.a;\n#else\n    color = pow(color, vec3(textureOneOverGamma));\n#endif\n\n#ifdef APPLY_SPLIT\n    float splitPosition = czm_p_imagerySplitPosition * czm_p_drawingBufferWidth;\n    // 垂直分割 \n    if(split < -2.0 || split > 2.0) {\n        splitPosition = (1.0 - czm_p_imagerySplitPosition) * czm_p_drawingBufferHeight;\n    }\n    if(split < -2.0 && gl_FragCoord.y < splitPosition) {\n        alpha = 0.0;\n    }\n    else if (split > 2.0 && gl_FragCoord.y > splitPosition) {\n        alpha = 0.0;\n    }\n    // Split to the left\n    else if (split > -2.0 && split < 0.0 && gl_FragCoord.x > splitPosition) {\n       alpha = 0.0;\n    }\n    // Split to the right\n    else if (split < 2.0 && split > 0.0 && gl_FragCoord.x < splitPosition) {\n       alpha = 0.0;\n    }\n#endif\n\n#ifdef APPLY_BRIGHTNESS\n    color = mix(vec3(0.0), color, textureBrightness);\n#endif\n\n#ifdef APPLY_CONTRAST\n    color = mix(vec3(0.5), color, textureContrast);\n#endif\n\n#ifdef APPLY_HUE\n    color = czm_hue(color, textureHue);\n#endif\n\n#ifdef APPLY_SATURATION\n    color = czm_saturation(color, textureSaturation);\n#endif\n\n    float sourceAlpha = alpha * textureAlpha;\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n    outAlpha += sign(outAlpha) - 1.0;\n\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n\n    // When rendering imagery for a tile in multiple passes,\n    // some GPU/WebGL implementation combinations will not blend fragments in\n    // additional passes correctly if their computation includes an unmasked\n    // divide-by-zero operation,\n    // even if it's not in the output or if the output has alpha zero.\n    //\n    // For example, without sanitization for outAlpha,\n    // this renders without artifacts:\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\n    //\n    // but using czm_branchFreeTernary will cause portions of the tile that are\n    // alpha-zero in the additional pass to render as black instead of blending\n    // with the previous pass:\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\n    //\n    // So instead, sanitize against divide-by-zero,\n    // store this state on the sign of outAlpha, and correct on return.\n\n    return vec4(outColor, max(outAlpha, 0.0));\n}\n\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n}\n\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist);\n#endif\n\nconst float fExposure = 2.0;\n\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n        {\n            discard;\n        }\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\n#endif\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    float nightBlend = 1.0 - clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0, 0.0, 1.0);\n#else\n    float nightBlend = 0.0;\n#endif\n\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0), nightBlend);\n\n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\n    float cameraDist;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n    }\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\n    {\n        cameraDist = -czm_view[3].z;\n    }\n    else\n    {\n        cameraDist = length(czm_view[3]);\n    }\n    float fadeOutDist = u_lightingFadeDistance.x;\n    float fadeInDist = u_lightingFadeDistance.y;\n    if (czm_sceneMode != czm_sceneMode3D) {\n        vec3 radii = czm_ellipsoidRadii;\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\n        fadeOutDist -= maxRadii;\n        fadeInDist -= maxRadii;\n    }\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\n    float fade = 0.0;\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\n\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\n\n    if (mask > 0.0)\n    {\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\n\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\n\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n    }\n#endif\n\n#ifdef APPLY_MATERIAL\n    czm_materialInput materialInput;\n    materialInput.st = v_textureCoordinates.st;\n    materialInput.normalEC = normalize(v_normalEC);\n    materialInput.positionToEyeEC = -v_positionEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalize(v_normalEC));     \n    materialInput.slope = v_slope;\n    materialInput.height = v_height;\n    materialInput.aspect = v_aspect;\n    czm_material material = czm_getMaterial(materialInput);\n    vec4 materialColor = vec4(material.diffuse, material.alpha);\n    color = alphaBlend(materialColor, color);\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\n    vec4 finalColor = color;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\n\n    if (clipDistance < clippingPlanesEdgeWidth)\n    {\n        finalColor = clippingPlanesEdgeColor;\n    }\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n\n#ifdef FOG\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\n    fogColor *= darken;\n#endif\n\n#ifdef HDR\n    const float modifier = 0.15;\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n\n#ifdef GROUND_ATMOSPHERE\n    if (!czm_backFacing())\n    {\n        vec3 groundAtmosphereColor = computeGroundAtmosphereColor(fogColor, finalColor, atmosphereLightDirection, cameraDist);\n        finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n    }\n#endif\n\n#ifdef UNDERGROUND_COLOR\n    if (czm_backFacing())\n    {\n        float distanceFromEllipsoid = max(czm_eyeHeight, 0.0);\n        float distance = max(v_distance - distanceFromEllipsoid, 0.0);\n        float blendAmount = interpolateByDistance(u_undergroundColorAlphaByDistance, distance);\n        vec4 undergroundColor = vec4(u_undergroundColor.rgb, u_undergroundColor.a * blendAmount);\n        finalColor = alphaBlend(undergroundColor, finalColor);\n    }\n#endif\n\n#ifdef TRANSLUCENT\n    if (inTranslucencyRectangle())\n    {\n      vec4 alphaByDistance = gl_FrontFacing ? u_frontFaceAlphaByDistance : u_backFaceAlphaByDistance;\n      finalColor.a *= interpolateByDistance(alphaByDistance, v_distance);\n    }\n#endif\n\n    gl_FragColor = finalColor;\n}\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist)\n{\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n    xy *= czm_viewport.zw * mpp * 0.5;\n\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\n\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\n\n    float fadeInDist = u_nightFadeDistance.x;\n    float fadeOutDist = u_nightFadeDistance.y;\n\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\n\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\n    vec3 groundAtmosphereColor = fogColor;\n#endif\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\n#endif\n\n    return groundAtmosphereColor;\n}\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n\nfloat waveFade(float edge0, float edge1, float x)\n{\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return pow(1.0 - y, 5.0);\n}\n\nfloat linearFade(float edge0, float edge1, float x)\n{\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\n// Based on water rendering by Jonas Wagner:\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\n// low altitude wave settings\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\n\n// high altitude wave settings\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\n\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\n    vec3 positionToEyeEC = -positionEyeCoordinates;\n    float positionToEyeECLength = length(positionToEyeEC);\n\n    // The double normalize below works around a bug in Firefox on Android devices.\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\n\n    // Fade out the waves as the camera moves far from the surface.\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n\n#ifdef SHOW_OCEAN_WAVES\n    // high altitude waves\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\n\n    // low altitude waves\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\n\n    // blend the 2 wave layers based on distance to surface\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\n    vec3 normalTangentSpace =\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // fade out the normal perturbation as we move farther from the water surface\n    normalTangentSpace.xy *= waveIntensity;\n    normalTangentSpace = normalize(normalTangentSpace);\n#else\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 normalEC = enuToEye * normalTangentSpace;\n\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\n\n    // Use diffuse light to highlight the waves\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n\n#ifdef SHOW_OCEAN_WAVES\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\n    // the wave bumpiness and no particular light direction.\n    float tsPerturbationRatio = normalTangentSpace.z;\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\n    vec3 nonDiffuseHighlight = vec3(0.0);\n#endif\n\n    // Add specular highlights in 3D, and in all modes when zoomed in.\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\n    float specular = specularIntensity * surfaceReflectance;\n\n#ifdef HDR\n    specular *= 1.4;\n\n    float e = 0.2;\n    float d = 3.3;\n    float c = 1.7;\n\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\n\n    return vec4(color, imageryColor.a);\n}\n\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n";const{BoundingSphere:cn,buildModuleUrl:un,Cartesian3:dn,Cartographic:hn,Color:mn,defaultValue:fn,defined:gn,destroyObject:pn,DeveloperError:_n,Ellipsoid:vn,EllipsoidTerrainProvider:yn,Event:Cn,IntersectionTests:bn,NearFarScalar:Sn,Ray:wn,Rectangle:xn,Resource:En,ShaderSource:Tn,Texture:Pn,when:An,GlobeSurfaceShaderSet:Ln,GlobeSurfaceTileProvider:Mn,GlobeTranslucency:Rn,ImageryLayerCollection:Dn,QuadtreePrimitive:Nn,SceneMode:On,ShadowMode:In}=Cesium,Fn=Cesium._shadersGlobeVS,kn=Cesium._shadersGroundAtmosphere;function Un(e){e=fn(e,vn.WGS84);var t=new yn({ellipsoid:e}),r=new Dn;this._ellipsoid=e,this._from="cesiumpro-globe",this._imageryLayerCollection=r,this._surfaceShaderSet=new Ln,this._material=void 0,this._surface=new Nn({tileProvider:new Mn({terrainProvider:t,imageryLayers:r,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new Cn,this._undergroundColor=mn.clone(mn.BLACK),this._undergroundColorAlphaByDistance=new Sn(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new Rn,zn(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new En({url:un("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=In.RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function zn(e){var t=[],r=gn(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),i=[kn];!gn(e._material)||r&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.materialUniformMap=void 0:(i.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms),i.push(ln),e._surfaceShaderSet.baseVertexShaderSource=new Tn({sources:[kn,Fn],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new Tn({sources:i,defines:t}),e._surfaceShaderSet.material=e._material}Object.defineProperties(Un.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!gn(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){gn(e)||(e=xn.clone(xn.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),gn(this._material)&&zn(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,zn(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=mn.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=Sn.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});var Gn=[],Bn={start:0,stop:0};Un.prototype.pickWorldCoordinates=function(e,t,r,i){r=fn(r,!0);var n=t.mode,o=t.mapProjection,a=Gn;a.length=0;var s,l,c,u,d=this._surface._tilesToRender,h=d.length;for(l=0;l<h;++l){var m=(s=d[l]).data;if(gn(m)){var f=m.pickBoundingSphere;if(n!==On.SCENE3D)m.pickBoundingSphere=f=cn.fromRectangleWithHeights2D(s.rectangle,o,m.tileBoundingRegion.minimumHeight,m.tileBoundingRegion.maximumHeight,f),dn.fromElements(f.center.z,f.center.x,f.center.y,f.center);else{if(!gn(m.renderedMesh))continue;cn.clone(m.tileBoundingRegion.boundingSphere,f)}var g=bn.raySphere(e,f,Bn);gn(g)&&a.push(m)}}for(a.sort((c=e.origin,function(e,t){return cn.distanceSquaredTo(e.pickBoundingSphere,c)-cn.distanceSquaredTo(t.pickBoundingSphere,c)})),h=a.length,l=0;l<h&&(u=a[l].pick(e,t.mode,t.mapProjection,r,i),!gn(u));++l);return u};var Hn=new hn;Un.prototype.pick=function(e,t,r){if(r=this.pickWorldCoordinates(e,t,!0,r),gn(r)&&t.mode!==On.SCENE3D){r=dn.fromElements(r.y,r.z,r.x,r);var i=t.mapProjection.unproject(r,Hn);r=t.globe.ellipsoid.cartographicToCartesian(i,r)}return r};var Wn=new dn,jn=new dn,Vn=new hn,qn=new wn;function Yn(e,t){return gn(e)&&xn.contains(e.rectangle,t)?e:void 0}Un.prototype.getHeight=function(e){var t=this._surface._levelZeroTiles;if(gn(t)){var r,i,n=t.length;for(i=0;i<n&&(r=t[i],!xn.contains(r.rectangle,e));++i);if(!(i>=n)){for(var o=r;gn(r);)r=Yn(r._southwestChild,e)||Yn(r._southeastChild,e)||Yn(r._northwestChild,e)||r._northeastChild,gn(r)&&gn(r.data)&&gn(r.data.renderedMesh)&&(o=r);if(gn(r=o)&&gn(r.data)&&gn(r.data.renderedMesh)){var a=this._surface._tileProvider.tilingScheme.projection,s=this._surface._tileProvider.tilingScheme.ellipsoid,l=dn.fromRadians(e.longitude,e.latitude,0,s,Wn),c=qn,u=s.geodeticSurfaceNormal(l,c.direction),d=s.getSurfaceNormalIntersectionWithZAxis(l,11500,c.origin);if(!gn(d)){var h;gn(r.data.tileBoundingRegion)&&(h=r.data.tileBoundingRegion.minimumHeight);var m=Math.min(fn(h,0),-11500),f=dn.multiplyByScalar(u,Math.abs(m)+1,jn);dn.subtract(l,f,c.origin)}var g=r.data.pick(c,void 0,a,!1,jn);if(gn(g))return s.cartesianToCartographic(g,Vn).height}}}},Un.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},Un.prototype.beginFrame=function(e){var t=this._surface,r=t.tileProvider,i=this.terrainProvider,n=this.showWaterEffect&&i.ready&&i.hasWaterMask;if(n&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;var o=this._oceanNormalMapResource,a=o.url;if(gn(a)){var s=this;An(o.fetchImage(),(function(t){a===s._oceanNormalMapResource.url&&(s._oceanNormalMap=s._oceanNormalMap&&s._oceanNormalMap.destroy(),s._oceanNormalMap=new Pn({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}var l=e.passes,c=e.mode;l.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,r.terrainProvider=this.terrainProvider,r.lightingFadeOutDistance=this.lightingFadeOutDistance,r.lightingFadeInDistance=this.lightingFadeInDistance,r.nightFadeOutDistance=this.nightFadeOutDistance,r.nightFadeInDistance=this.nightFadeInDistance,r.zoomedOutOceanSpecularIntensity=c===On.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,r.hasWaterMask=n,r.oceanNormalMap=this._oceanNormalMap,r.enableLighting=this.enableLighting,r.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,r.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,r.showGroundAtmosphere=this.showGroundAtmosphere,r.shadows=this.shadows,r.hueShift=this.atmosphereHueShift,r.saturationShift=this.atmosphereSaturationShift,r.brightnessShift=this.atmosphereBrightnessShift,r.fillHighlightColor=this.fillHighlightColor,r.showSkirts=this.showSkirts,r.backFaceCulling=this.backFaceCulling,r.undergroundColor=this._undergroundColor,r.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,t.beginFrame(e))},Un.prototype.render=function(e){this.show&&(gn(this._material)&&this._material.update(e.context),this._surface.render(e))},Un.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},Un.prototype.isDestroyed=function(){return!1},Un.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),pn(this)};const{ShaderProgram:Xn,RuntimeError:Jn,createUniform:Zn,defined:$n,createUniformArray:Qn,WebGLConstants:Kn}=Cesium;function eo(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}const to=Cesium.AutomaticUniforms,ro="[Cesium WebGL] ",io={...to,czm_p_drawingBufferWidth:new eo({size:1,datatype:Kn.FLOAT,getValue:function(e){return e._frameState.context.drawingBufferWidth}}),czm_p_drawingBufferHeight:new eo({size:1,datatype:Kn.FLOAT,getValue:function(e){return e._frameState.context.drawingBufferHeight}}),czm_p_imagerySplitPosition:new eo({size:1,datatype:Kn.FLOAT,getValue:function(e){return e._frameState.imagerySplitPosition}})};function no(e){$n(e._program)||oo(e)}function oo(e){var t=e._program,r=e._gl,i=function(e,t){var r=t._vertexShaderText,i=t._fragmentShaderText,n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,r),e.compileShader(n);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,i),e.compileShader(o);var a=e.createProgram();e.attachShader(a,n),e.attachShader(a,o),e.deleteShader(n),e.deleteShader(o);var s,l=t._attributeLocations;if($n(l))for(var c in l)l.hasOwnProperty(c)&&e.bindAttribLocation(a,l[c],c);if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var u=t._debugShaders;if(!e.getShaderParameter(o,e.COMPILE_STATUS)){if(s=e.getShaderInfoLog(o),console.error(ro+"Fragment shader compile log: "+s),$n(u)){var d=u.getTranslatedShaderSource(o);""!==d?console.error(ro+"Translated fragment shader source:\n"+d):console.error(ro+"Fragment shader translation failed.")}throw e.deleteProgram(a),new Jn("Fragment shader failed to compile.  Compile log: "+s)}if(!e.getShaderParameter(n,e.COMPILE_STATUS)){if(s=e.getShaderInfoLog(n),console.error(ro+"Vertex shader compile log: "+s),$n(u)){var h=u.getTranslatedShaderSource(n);""!==h?console.error(ro+"Translated vertex shader source:\n"+h):console.error(ro+"Vertex shader translation failed.")}throw e.deleteProgram(a),new Jn("Vertex shader failed to compile.  Compile log: "+s)}throw s=e.getProgramInfoLog(a),console.error(ro+"Shader program link log: "+s),$n(u)&&(console.error(ro+"Translated vertex shader source:\n"+u.getTranslatedShaderSource(n)),console.error(ro+"Translated fragment shader source:\n"+u.getTranslatedShaderSource(o))),e.deleteProgram(a),new Jn("Program failed to link.  Link log: "+s)}var m=t._logShaderCompilation;return m&&(s=e.getShaderInfoLog(n),$n(s)&&s.length>0&&console.log(ro+"Vertex shader compile log: "+s)),m&&(s=e.getShaderInfoLog(o),$n(s)&&s.length>0&&console.log(ro+"Fragment shader compile log: "+s)),m&&(s=e.getProgramInfoLog(a),$n(s)&&s.length>0&&console.log(ro+"Shader program link log: "+s)),a}(r,e,e._debugShaders),n=r.getProgramParameter(i,r.ACTIVE_ATTRIBUTES),o=function(e,t){for(var r={},i=[],n=[],o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<o;++a){var s=e.getActiveUniform(t,a),l=-1!==s.name.indexOf("[0]",s.name.length-"[0]".length)?s.name.slice(0,s.name.length-3):s.name;if(0!==l.indexOf("gl_"))if(s.name.indexOf("[")<0){var c=e.getUniformLocation(t,l);if(null!==c){var u=Zn(e,s,l,c);r[l]=u,i.push(u),u._setSampler&&n.push(u)}}else{var d,h,m,f,g=l.indexOf("[");if(g>=0){if(d=r[l.slice(0,g)],!$n(d))continue;(h=d._locations).length<=1&&(m=d.value,null!==(f=e.getUniformLocation(t,l))&&(h.push(f),m.push(e.getUniform(t,f))))}else{h=[];for(var p=0;p<s.size;++p)null!==(f=e.getUniformLocation(t,l+"["+p+"]"))&&h.push(f);d=Qn(e,s,l,h),r[l]=d,i.push(d),d._setSampler&&n.push(d)}}}return{uniformsByName:r,uniforms:i,samplerUniforms:n}}(r,i),a=function(e,t){var r=[],i=[];for(var n in t)if(t.hasOwnProperty(n)){var o=t[n],a=n,s=e._duplicateUniformNames[a];$n(s)&&(o.name=s,a=s);var l=io[a];$n(l)?r.push({uniform:o,automaticUniform:l}):i.push(o)}return{automaticUniforms:r,manualUniforms:i}}(e,o.uniformsByName);e._program=i,e._numberOfVertexAttributes=n,e._vertexAttributes=function(e,t,r){for(var i={},n=0;n<r;++n){var o=e.getActiveAttrib(t,n),a=e.getAttribLocation(t,o.name);i[o.name]={name:o.name,type:o.type,index:a}}return i}(r,i,n),e._uniformsByName=o.uniformsByName,e._uniforms=o.uniforms,e._automaticUniforms=a.automaticUniforms,e._manualUniforms=a.manualUniforms,e.maximumTextureUnitIndex=function(e,t,r){e.useProgram(t);for(var i=0,n=r.length,o=0;o<n;++o)i=r[o]._setSampler(i);return e.useProgram(null),i}(r,i,o.samplerUniforms),t&&e._gl.deleteProgram(t),"undefined"!=typeof spector&&(e._program.__SPECTOR_rebuildProgram=function(t,r,i,n){var o=e._vertexShaderText,a=e._fragmentShaderText,s=/ ! = /g;e._vertexShaderText=t.replace(s," != "),e._fragmentShaderText=r.replace(s," != ");try{oo(e),i(e._program)}catch(t){e._vertexShaderText=o,e._fragmentShaderText=a;var l=/(?:Compile|Link) error: ([^]*)/.exec(t.message);n(l?l[1]:t.message)}})}function ao(){const e=Xn.prototype;Xn.prototype={},Xn.prototype._bind=function(){no(this),this._gl.useProgram(this._program)},Xn.prototype.destroy=e.destroy,Xn.prototype._setUniforms=function(t,r,i){e._setUniforms.call(this,t,r,i)},Xn.prototype.isDestroyed=e.isDestroyed,Xn.prototype.finalDestroy=e.finalDestroy,Object.defineProperties(Xn.prototype,{vertexAttributes:{get:function(){return no(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return no(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return no(this),this._uniformsByName}},vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}}})}const so=Cesium.Scene,{JulianDate:lo,defined:co,RequestScheduler:uo,PerformanceDisplay:ho,Cesium3DTilePassState:mo,Cesium3DTilePass:fo,defaultValue:go,Color:po,BoundingRectangle:_o,Pass:vo,SunLight:yo,Cartesian3:Co}=Cesium,bo=new mo({pass:fo.PRELOAD}),So=new mo({pass:fo.PRELOAD_FLIGHT}),wo=new mo({pass:fo.REQUEST_RENDER_MODE_DEFER_CHECK});function xo(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function Eo(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),co(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function To(e){return e._picking.updateMostDetailedRayPicks(e)}function Po(e){var t=e._frameState;bo.camera=t.camera,bo.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,bo)}function Ao(e){var t=e._frameState;t.camera.canPreloadFlight()&&(So.camera=e.preloadFlightCamera,So.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,So))}const Lo=new mo({pass:fo.RENDER});function Mo(e){e.primitives.updateForPass(e._frameState,wo)}function Ro(e){var t=e._frameState;e.primitives.postPassesUpdate(t),uo.update()}function Do(e){var t=e._frameState,r=e.context,i=r.uniformState,n=e._defaultView;e._view=n,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Lo;var o=go(e.backgroundColor,po.BLACK);e._hdr&&((o=po.clone(o,scratchBackgroundColor)).red=Math.pow(o.red,e.gamma),o.green=Math.pow(o.green,e.gamma),o.blue=Math.pow(o.blue,e.gamma)),t.backgroundColor=o,e.fog.update(t),i.update(t);var a=e.shadowMap;co(a)&&a.enabled&&(!co(e.light)||e.light instanceof yo?Co.negate(i.sunDirectionWC,e._shadowMapCamera.direction):Co.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(a)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var s=n.viewport;s.x=0,s.y=0,s.width=r.drawingBufferWidth,s.height=r.drawingBufferHeight;var l=n.passState;l.framebuffer=void 0,l.blendingEnabled=void 0,l.scissorTest=void 0,l.viewport=_o.clone(s,l.viewport),co(e.globe)&&(e.globe.beginFrame(t),e._LodGraphic.beginFrame(t)),e.updateEnvironment(),e.updateAndExecuteCommands(l,o),e.globe&&e._LodGraphic.render(t),e.resolveFramebuffers(l),l.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(vo.OVERLAY);for(var r=e.context,i=e._overlayCommandList,n=i.length,o=0;o<n;++o)i[o].execute(r,t)}(e,l),co(e.globe)&&(e.globe.endFrame(t),e._LodGraphic.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),r.endFrame()}function No(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,co(e)||(e=lo.now());var r=this._view.checkForCameraUpdates(this),i=!this.requestRenderMode||this._renderRequested||r||this._logDepthBufferDirty||this._hdrDirty||this.mode===SceneMode.MORPHING;if(!i&&co(this.maximumRenderTimeChange)&&co(this._lastRenderTime)){var n=Math.abs(lo.secondsDifference(this._lastRenderTime,e));i=i||n>this.maximumRenderTimeChange}i&&(this._lastRenderTime=lo.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,function(e,t,r){var i=e._frameState;i.frameNumber=t,i.time=lo.clone(r,i.time)}(this,Cesium.Math.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);xo(this,Eo),this.primitives.show&&(xo(this,To),xo(this,Po),xo(this,Ao),i||xo(this,Mo)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),xo(this,Do)),function(e,t){if(e.debugShowFramesPerSecond){if(!co(e._performanceDisplay)){var r=document.createElement("div");r.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(r);var i=new ho({container:r});e._performanceDisplay=i,e._performanceContainer=r}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else co(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,i),xo(this,Ro),function(e){for(var t=e._frameState.afterRender,r=0,i=t.length;r<i;++r)t[r](),e.requestRender();t.length=0}(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())}function Oo(){(class{static overrideRenderFunction(){so.prototype.render=No}}).overrideRenderFunction()}function Io(){Oo(),ao()}const{Matrix4:Fo,BoundingSphere:ko}=Cesium;function Uo(e,t,r){e.camera.flyToBoundingSphere(t,{duration:r.duration,maximumHeight:r.maximumHeight,endTransform:r.endTransform,offset:r.offset,complete:function(){e._zoomPromise.resolve(!0)},cancel:function(){e._zoomPromise.resolve(!1)},offset:r.offset})}let zo,Go,Bo=0,Ho=0,Wo="N/A",jo="N/A";function Vo(e){return null!=e&&"object"==typeof e&&"function"==typeof e.then}function qo(e,t,r,i){const n=Cesium.Cartesian3.fromDegrees(t,r,i),o=e.camera,a=o.heading,s=o.pitch,l=function(e,t,r){t=Cesium.Math.clamp(t,-Cesium.Math.PI_OVER_TWO,Cesium.Math.PI_OVER_TWO),e=Cesium.Math.zeroToTwoPi(e)-Cesium.Math.PI_OVER_TWO;const i=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,-t),n=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-e),o=Cesium.Quaternion.multiply(n,i,n),a=Cesium.Matrix3.fromQuaternion(o),s=Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_X);return Cesium.Matrix3.multiplyByVector(a,s,s),Cesium.Cartesian3.negate(s,s),Cesium.Cartesian3.multiplyByScalar(s,r,s),s}(a,s,2*i),c=Cesium.Transforms.eastNorthUpToFixedFrame(n);Cesium.Matrix4.multiplyByPoint(c,l,n),o.setView({destination:n,orientation:{heading:a,pitch:s},easingFunction:Cesium.EasingFunction.QUADRATIC_OUT})}function Yo(e,t){e.infoBox&&(t._infoBox=function(e){const t=document.createElement("div");t.className="cesium-viewer-infoBoxContainer",e.container.appendChild(t);const r=new Di(t),i=r.viewModel;return e._eventHelper.add(i.cameraClicked,Jo.prototype._onInfoBoxCameraClicked,e),e._eventHelper.add(i.closeClicked,Jo.prototype._onInfoBoxClockClicked,e),e._enableInfoOrSelection=!0,r}(t))}function Xo(e,t,r){const i=e._zoomPromise=Cesium.when.defer();return t.readyPromise.then((()=>{if(t._boundingSpheres)Uo(e,ko.fromBoundingSpheres(t._boundingSpheres),r);else if(t.boundingSphere){let i=t.boundingSphere;i=ko.clone(i),t.modelMatrix&&Fo.multiplyByPoint(t.modelMatrix,i.center,i.center),Uo(e,i,r)}})),i}class Jo extends Cesium.Viewer{constructor(e,t={}){t=Object.assign({animation:!1,timeline:!1,geocoder:!1,homeButton:!1,navigationHelpButton:!1,baseLayerPicker:!1,fullscreenElement:"cesiumContainer",fullscreenButton:!1,shouldAnimate:!1,infoBox:!1,selectionIndicator:!1,sceneModePicker:!1,shadows:!1,imageryProvider:dt(),contextOptions:{webgl:{alpha:!0,depth:!1,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0},allowTextureFilterAnisotropic:!0}},t),Cesium.Camera.DEFAULT_VIEW_RECTANGLE=Cesium.Rectangle.fromDegrees(70,5,130,60),!1===t.globe&&(t.imageryProvider=void 0);const r=Object.assign({},t,{infoBox:!1});r.globe?r.globe=new Un(r.globe._ellipsoid):!1!==r.globe&&(r.globe=new Un),super(e,r);const i=document.querySelector(".cesium-credit-logoContainer");if(i&&i.parentElement.removeChild(i),Yo(t,this),this._options=t,this.scene.preRender.addEventListener(this.update,this),this._distancePerPixel=void 0,this._extent=void 0,this._center=void 0,this._autoRotation=!1,this.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.scene.globe){const e=new sn({terrainProvider:this.terrainProvider,scene:this.scene}),t=new Cesium.QuadtreePrimitive({tileProvider:e});this.scene._LodGraphic=t}this.scene.dataSources=this.dataSources}get massiveGraphicLayers(){return this.scene._LodGraphic.tileProvider._layers}get entities(){return super.entities}get primitives(){return this.scene.primitives}get enableLighting(){if(k(this.globe))return this.scene.globe.enableLighting}set enableLighting(e){k(this.globe)&&(this.scene.globe.enableLighting=e)}get autoRotation(){return this._autoRotation}set autoRotation(e){this._autoRotation=e}get fxaa(){return this.scene.postProcessStages.fxaa.enabled}set fxaa(e){this.scene.postProcessStages.fxaa.enabled=e}get distancePerPixel(){return this._distancePerPixel}get extent(){return this._extent}get center(){return this._center}get container(){return this._container}get layers(){return this.scene.imageryLayers}get dataSources(){return super.dataSources}get globe(){return this.scene.globe}get ellipsoid(){if(this.globe)return this.globe.ellipsoid}get terrain(){return this.terrainProvider}set terrain(e){k(e)&&!1!==e||(this.terrainProvider=new Cesium.EllipsoidTerrainProvider),e!==this.terrainProvider&&(this.terrainProvider=e)}get terrainChanged(){return this.scene.terrainProviderChanged}get terrainExaggeration(){if(this.globe)return this.globe.terrainExaggeration}set terrainExaggeration(e){e<0&&(e=0),this.globe&&(this.globe.terrainExaggeration=e)}get showFps(){return this.scene.debugShowFramesPerSecond}set showFps(e){this.scene.debugShowFramesPerSecond=e}get fps(){return this._fps+"FPS"}get ms(){return this._ms+"MS"}get heading(){return Cesium.Math.toDegrees(this.camera.heading)}get pitch(){return Cesium.Math.toDegrees(this.camera.pitch)}get roll(){return Cesium.Math.toDegrees(this.camera.roll)}get depthTest(){return this.scene.globe.depthTestAgainstTerrain}set depthTest(e){this.scene.globe.depthTestAgainstTerrain=e}addModel(e){this.primitives.add(e.delegate)}removeModel(e){this.primitives.remove(e.delegate)}setView(e){let t;e instanceof Cesium.Cartographic?t=de.fromCartographic(e):e instanceof Cesium.Cartesian3?t=de.fromCartesian(e):e instanceof de&&(t=e),t&&qo(this,t.lon,t.lat,t.alt)}stepFlyTo(e={}){let t;e.destination instanceof Cesium.Cartesian3?t=de.fromCartesian(e.destination):e.destination instanceof Cesium.Cartographic?t=de.fromCartographic(e.destination):e.destination instanceof de&&(t=e.destination),t&&(e.destination=t,function(e,t={}){const{camera:r}=e,i=F(t.step1Duration,3),n=F(t.step2Duration,3),o=F(t.step3Duration,3),a=t.destination,s=e.camera._positionCartographic.height,l=Cesium.Cartesian3.fromDegrees(a.lon,a.lat,s),c=t.destination.toCartesian();new Promise((e=>{r.flyTo({destination:l,duration:i,complete(){r.flyTo({destination:c,duration:n,complete(){r.flyTo({destination:c,orientation:t.orientation,duration:o,complete(){e()}})}})}})}))}(this,e))}linkView(e){if(!k(e))throw new t("viewer不是一个有效的Cesium.Viewer对象");return function(e,t){let r,i;return i=function i(n,o){return n.scene.postRender.addEventListener((()=>{const a=n.camera.positionWC,s=n.camera.heading,l=n.camera.pitch,c=n.camera.roll;r&&(r(),r=void 0),o.camera.flyTo({destination:a,orientation:{heading:s,pitch:l,roll:c},duration:0,complete:function(){r=i(t,e)},cancel:function(){r=i(t,e)}})}))}(e,t),function(){i&&i(),r&&r()}}(this,e)}flyTo(e,t={}){if(e instanceof de){const r=e.toCartesian();return this.flyTo(r,t)}if(e instanceof Cesium.Cartesian3){const r=viewer._zoomPromise=Cesium.when.defer(),i=F(t.radius,1e3);delete t.radius;return Uo(this,new Cesium.BoundingSphere(e,i),t),r}return e instanceof Cesium.Primitive||e instanceof Cesium.Model||e instanceof Ii?Xo(this,e,t):super.flyTo(e,t)}rotateAroundPoint(e,t={}){const r=this;let i;if(e instanceof Cesium.Cartesian3)i=e;else if(e instanceof Cesium.Cartographic)i=Cesium.Cartographic.toCartesian(e);else{if(!(e instanceof de))return;i=e.toCartesian()}const n=F(t.multiplier,1),o=F(t.offset,{});return this._cancelRotateAroundPoint&&(this._cancelRotateAroundPoint(),this._cancelRotateAroundPoint=void 0),this._cancelRotateAroundPoint=this.scene.postRender.addEventListener((function(){const e=Cesium.Math.toRadians(F(o.heading,r.heading)+1*n),t=Cesium.Math.toRadians(F(o.pitch,-20)),a=F(o.range,1e4);r.flyTo(i,{duration:0,offset:new Cesium.HeadingPitchRange(e,t,a)})})),this._cancelRotateAroundPoint}addLayer(e){return e instanceof Cesium.GeoJsonDataSource||e instanceof Cesium.KmlDataSource||e instanceof Cesium.CzmlDataSource||e instanceof Cesium.CustomDataSource||e instanceof nr||e instanceof wi||Vo(e)?this.dataSources.add(e):this.layers.addImageryProvider(e)}removeLayer(e){if(Vo(e))e.then((e=>{this.removeLayer(e)}));else{this.layers.remove(e)||this.dataSources.remove(e)}}pickLayer(e){const t=this.scene,r=t.camera.getPickRay(e);return this.layers.pickImageryLayerFeatures(r,t)}render(){super.render()}update(){const e=function(){k(zo)||(zo=Cesium.getTimestamp()),k(Go)||(Go=Cesium.getTimestamp()),Bo++;const e=Cesium.getTimestamp();let t=(e-zo)/1e3;return t>1&&(Wo=Bo/t||0,zo=e,Bo=0,Wo=Wo.toFixed(0)),Ho++,t=e-Go,t>100&&(jo=t/Ho,Go=e,Ho=0,jo=jo.toFixed(2)),{ms:jo,fps:Wo}}();this._fps=e.fps,this._ms=e.ms;const t=ue(viewer);t&&(this._distancePerPixel=t),this._extent=me(this),this._center=he(viewer),this._autoRotation&&function(e){if(!e||e.scene.mode!==Cesium.SceneMode.SCENE3D)return;const t=Cesium.Transforms.computeIcrfToFixedMatrix(e.clock.currentTime);if(k(t)){const r=e.camera,i=Cesium.Cartesian3.clone(r.position),n=Cesium.Matrix4.fromRotationTranslation(t);r.lookAtTransform(n,i)}}(this)}resize(){super.resize()}forceResize(){super.forceResize()}destroy(){super.destroy()}isDestroyed(){return super.isDestroyed()}}Io();const Zo=33746824,$o=33554054;const{BingMapsImageryProvider:Qo,BingMapsStyle:Ko}=Cesium;class ea extends Qo{constructor(e={}){e.url="https://dev.virtualearth.net",e.mapStyle=F(e.mapStyle,ea.mapStyle.AERIAL),e.key=F(e.key,"AqMhBWJKbBPBtoWEvtGdUii6XSkDCJ3vWFpOVWzplD-Q0J-ECUF6i8MGXpew8bkc"),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}static tileXYToQuadKey(e,t,r){return Qo.tileXYToQuadKey(e,t,r)}static quadKeyToTileXY(e){return Qo.quadKeyToTileXY(e)}static mapStyle=Ko}class ta extends ut{constructor(e){e=F(e,{});const t=F(e.layer,"img"),{scl:r,style:i}=ta.getParametersByLayer(t),n=F(e.lang,"zh_cn");e.url=`https://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=${n}&size=1&scl=${r}&style=${i}`,e.subdomains="1234",super(e)}static layers=[{layer:"img",desc:"影像地图"},{layer:"vec",desc:"矢量地图"},{layer:"vei",desc:"矢量地图（含注记）"},{layer:"roa",desc:"路网地图"},{layer:"roi",desc:"路网地图（含注记）"}];static getParametersByLayer(e){let t={scl:1,style:6};switch(e){case"img":break;case"vec":t.scl=2,t.style=7;break;case"vei":t.scl=1,t.style=7;break;case"roa":t.scl=2,t.style=8;break;case"roi":t.scl=1,t.style=8}return t}}const{WebMapTileServiceImageryProvider:ra}=Cesium;class ia extends ra{constructor(e={}){super(e)}get dimensions(){return super.dimensions}set dimensions(e){super.dimensions=e}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get rectangle(){return super.rectangle}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}const na={map:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=1&version=297",road:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={reverseY}&styleid=2&version=297",img:"https://p{s}.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{reverseY}.jpg?version=229"};const{when:oa,Rectangle:aa}=Cesium;class sa extends Cesium.TileMapServiceImageryProvider{constructor(e){super(e)}get url(){return super.url}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return super.enablePickFeatures}set enablePickFeatures(e){super.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}const{Resource:la}=Cesium;class ca extends Cesium.WebMapServiceImageryProvider{constructor(e={}){k(e.parameters)||(e.parameters=ca.DefaultParameters),k(e.GetFeatureInfoDefaultParameters),super(e)}get minimumLevel(){return super.minimumLevel}get maximumLevel(){return super.maximumLevel}get errorEvent(){return super.errorEvent}get rectangle(){return super.rectangle}get ready(){return super.ready}get readyPromise(){return super.readyPromise}get tilingScheme(){return super.tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}pickFeatures(e,t,r,i,n){return super.pickFeatures(e,t,r,i,n)}requestImage(e,t,r,i){return super.requestImage(e,t,r,i)}}ca.DefaultParameters=Object.assign({transparent:!0},Cesium.WebMapServiceImageryProvider.DefaultParameters,{format:"image/png"}),ca.GetFeatureInfoDefaultParameters=Cesium.WebMapServiceImageryProvider.GetFeatureInfoDefaultParameters;const{AssociativeArray:ua,destroyObject:da,CustomDataSource:ha,Event:ma}=Cesium,fa=function(){},ga=[31638318];for(let e=1;e<20;e++)ga.push(ga[e-1]/2);function pa(e){let t=0;for(let r of ga){if(e>r)break;t++}return t}class _a extends Fi{constructor(e={}){super(e),this._id=F(e.id,fe()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new ma,this._maxClusterLevel=F(e.maxClusterLevel,12),this._minLoadLevel=F(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={}}get id(){return this._id}get dataSource(){return this._dataSource}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=pa(e),r=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,r)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){pa(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=pa(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){this._dataSource||(this._scene=t,this._dataSource=new ha("massive-layer"+fe()),this._scene.dataSources.add(this._dataSource))}createGeometry(e,t,r){if(e.level<this._minLoadLevel)return;const i=F(this._createGeometryFunction,fa)(r),n=Object.keys(r);for(let e of n)"position"!==e&&"id"!==e&&"cartesian"!==e&&"cartographic"!==e&&"label"!==e&&"billboard"!==e&&"__pixel"!==e&&(i[e]=r[e]);return this.add(i),i}removeGeometry(e,t){if(!t)return;const r=this._dataSource.entities.remove(t);return da(t),r}add(e){this._dataSource&&e&&this._dataSource.entities.add(e)}removeAll(){this._dataSource.entities.removeAll()}isDestroyed(){return!1}destroy(){this._dataSource.removeAll(),da(this)}}const{QuadtreeTileProvider:va,GeographicTilingScheme:ya,when:Ca,Event:ba,Cartographic:Sa,Color:wa,Entity:xa}=Cesium;const{destroyObject:Ea,Event:Ta,Transforms:Pa}=Cesium,Aa=function(e,t){const r={};if(e.modelMatrix)r.modelMatrix=e.modelMatrix;else if(e.position){let t=e.position;if(e.position instanceof de&&(t=e.position.toCartesian()),!t)return;r.modelMatrix=Pa.eastNorthUpToFixedFrame(t),e.modelMatrix=r.modelMatrix}return r.minimumPixelSize=F(e.minimumPixelSize,t.minimumPixelSize),r.maximumScale=F(e.maximumScale,t.maximumScale),r.scale=F(e.scale,t.scale),r.allowPicking=F(e.allowPicking,t.allowPicking),r.shadows=F(e.shadows,t.shadows),r.id=e._id,r.url=F(e.url,t.url),Cesium.Model.fromGltf(r)},La=[31638318];for(let e=1;e<20;e++)La.push(La[e-1]/2);function Ma(e){let t=0;for(let r of La){if(e>r)break;t++}return t}const{QuadtreeTileProvider:Ra,GeographicTilingScheme:Da,when:Na,Event:Oa,Cartographic:Ia,Color:Fa,Entity:ka}=Cesium;const{ShaderSource:Ua}=Cesium;e.BaiDuLayer=class extends ut{constructor(e){(e=F(e,{})).url=F(e.url,"http://maponline{s}.bdimg.com/tile/?qt=vtile&styles=pl&scaler=1&udt=20200102"),e.customid&&(e.url=`https://api.map.baidu.com/customimage/tile?customid=${e.customid}`);const t=new Cesium.Cartesian2(-$o,-Zo),r=new Cesium.Cartesian2($o,Zo);e.tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:r}),e.subdomains="123",super(e),this._rectangle=this._tilingScheme.rectangle}requestImage(e,t,r){const i=function(e,t,r,i){let n=e.url+"&x={x}&y={y}&z={z}";const o=e._tilingScheme.getNumberOfXTilesAtLevel(i),a=e._tilingScheme.getNumberOfYTilesAtLevel(i),s=4*Math.random()|0;return n=n.replace("{s}",s).replace("{x}",t-o/2).replace("{y}",a/2-r-1).replace("{z}",i),n}(this,e,t,r);return Cesium.ImageryProvider.loadImage(this,i)}},e.BingLayer=ea,e.CesiumProError=t,e.CesiumProTerrainProvider=A,e.Cluster=class{constructor(e,t={}){this._objects=F(t.objects,[]),this._getScreenBoundingBox=F(t.getScreenBoundingBox,le),this._scene=e,this.clusterSize=3,this.pixelRange=50,this._clusterObjects=[]}get objects(){return this._objects}set objects(e){this._objects=e}_clearCluster(){this._objects.map((e=>e.cluster=!1)),this._clusterObjects=[]}update(){const e=this._objects;this._clearCluster();const t=function(e,t){const r=[],i=new oe(t.globe.ellipsoid,t.camera.positionWC);for(let n of e)n.position&&(t.mode!==ne.SCENE3D||i.isPointVisible(n.position))&&(n.__pixel=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,n.position),n.__pixel&&r.push(n));return r}(e,this._scene),r=new K(t,ae,se,64,Int32Array);for(let e of t){if(e.cluster)continue;const i=this._getScreenBoundingBox(e,e.__pixel),n=ie.clone(i,new ie);e.cluster=!0;const o=r.range(i.x,i.y,i.x+i.width,i.y+i.height),a=o.length,s=ee.clone(e.position);let l,c=1;const u=[];for(let e=0;e<a;e++){const r=t[o[e]];if(r.cluster)continue;u.push(r.id),r.cluster=!0;const i=this._getScreenBoundingBox(r,r.__pixel);ee.add(r.position,s,s),ie.union(n,i,n),c++,l=r}c>=this.clusterSize?(ee.multiplyByScalar(s,1/c,s),this._clusterObjects.push({position:new ee(s.x,s.y,s.z),number:c,ids:u,id:l.id+c})):this._clusterObjects.push(e)}}},e.Event=i,e.GaoDeLayer=ta,e.GeoJsonDataSource=nr,e.GeoPoint=de,e.Globe=Un,e.GroundSkyBox=class{constructor(e={}){this.sources=ve(e.sources,{positiveX:Y.buildModuleUrl("./assets/skybox/px.png"),negativeX:Y.buildModuleUrl("./assets/skybox/nx.png"),positiveY:Y.buildModuleUrl("./assets/skybox/py.png"),negativeY:Y.buildModuleUrl("./assets/skybox/ny.png"),positiveZ:Y.buildModuleUrl("./assets/skybox/pz.png"),negativeZ:Y.buildModuleUrl("./assets/skybox/nz.png")}),this._sources=void 0,this.show=ve(e.show,!0),this._command=new be({modelMatrix:Ce.clone(Ce.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0,this._isDestroyed=!1}update(e,r){const i=new ke,n=this;if(!this.show)return;if(e.mode!==Oe.SCENE3D&&e.mode!==Oe.MORPHING)return;if(!e.passes.render)return;const{context:o}=e;if(this._sources!==this.sources){this._sources=this.sources;const{sources:e}=this;if(!(xe(e.positiveX)&&xe(e.negativeX)&&xe(e.positiveY)&&xe(e.negativeY)&&xe(e.positiveZ)&&xe(e.negativeZ)))throw new t("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof e.positiveX!=typeof e.negativeX||typeof e.positiveX!=typeof e.positiveY||typeof e.positiveX!=typeof e.negativeY||typeof e.positiveX!=typeof e.positiveZ||typeof e.positiveX!=typeof e.negativeZ)throw new t("this.sources properties must all be the same type.");"string"==typeof e.positiveX?Me(o,this._sources).then((e=>{n._cubeMap=n._cubeMap&&n._cubeMap.destroy(),n._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Le({context:o,source:e}))}const a=this._command;if(a.modelMatrix=Te.eastNorthUpToFixedFrame(e.camera._positionWC),!xe(a.vertexArray)){a.uniformMap={u_cubeMap:()=>n._cubeMap,u_rotateMatrix:()=>"function"==typeof Ce.getRotation?Ce.getRotation(a.modelMatrix,i):Ce.getMatrix3(a.modelMatrix,i)};const e=Se.createGeometry(Se.fromDimensions({dimensions:new we(2,2,2),vertexFormat:Pe.POSITION_ONLY})),t=this._attributeLocations=Ee.createAttributeLocations(e);a.vertexArray=De.fromGeometry({context:o,geometry:e,attributeLocations:t,bufferUsage:Ae._DRAW}),a.renderState=Re.fromCache({blending:Ne.ALPHA_BLEND})}if(!xe(a.shaderProgram)||this._useHdr!==r){const e=new Fe({defines:[r?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n  varying vec3 v_texCoord;\n  void main()\n  {\n  vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n  gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n  }\n  "]});a.shaderProgram=Ie.fromCache({context:o,vertexShaderSource:"attribute vec3 position;\n  varying vec3 v_texCoord;\n  uniform mat3 u_rotateMatrix;\n  void main()\n  {\n  vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n  gl_Position = czm_projection * vec4(p, 1.0);\n  v_texCoord = position.xyz;\n  }\n  ",fragmentShaderSource:e,attributeLocations:this._attributeLocations}),this._useHdr=r}return xe(this._cubeMap)?a:void 0}isDestroyed(){return this._isDestroyed}destroy(){const e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),ye(this)}},e.ImagerySplitDirection=Ue,e.InfoBox=Di,e.LonLatNetLayer=class{constructor(e={}){const t=new je({rectangle:Cesium.Rectangle.MAX_VALUE,intervalOfZeorLevel:e.intervalOfZeorLevel});this._hasAlphaChannel=F(e.hasAlphaChannel,!0),this._tilingScheme=t,this._image=void 0,this._texture=void 0,this._errorEvent=new i,this._ready=!0,this._readyPromise=Cesium.when.defer(),this._readyPromise.resolve(!0),this._font=F(e.font,"bold 24px sans-serif"),this._color=F(e.color,"white"),this._borderColor=F(e.borderColor,"gold"),this._borderWidth=F(e.borderWidth,2),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=256,this.canvas.height=256,this.ctx.textBaseline="middle"}get hasAlphaChannel(){return this._hasAlphaChannel}get tileHeight(){return 256}get tileWidth(){return 256}get minimumLevel(){return 0}get maximumLevel(){return 4}get rectangle(){return Cesium.Rectangle.MAX_VALUE}get errorEvent(){return this._errorEvent}get tileDiscardPolicy(){}get readyPromise(){return this._readyPromise}get ready(){return!0}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}_resetStyle(){this.ctx.font=this.font,this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.borderColor,this.ctx.lineWidth=this.borderWidth}_clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getOffset(e,t,r){const i=this.tilingScheme.getDelatXY(r),n=Math.floor(e),o=Math.floor(t);if(n===e&&o===t)return[0,0,n,o];const a=e-n,s=t-o;let l=0,c=0;return a&&(l=this.tileWidth/i.dx*a),s&&(c=this.tileHeight/i.dy*s),[l,c,n,o]}requestImage(e,t,r,i){this._clearCanvas(),this._resetStyle();const{canvas:n,ctx:o}=this,a=this.tilingScheme.getLonLatValuee(r,e,t);return this.tilingScheme.tileXYToNativeRectangle(e,t,r),this.ctx.textAlign="left",o.fillText(a.lon,10,n.height/2),this.ctx.textAlign="center",o.fillText(a.lat,n.width/2,20),o.strokeRect(0,0,n.width,n.height),n}},e.LonlatTilingScheme=je,e.MassiveBillboardLayer=class extends _a{constructor(e={}){e.objects=F(e.objects,[]),e.pixelSize=F(e.pixelSize,5),e.color=F(e.color,wa.fromRandom),e.createGeometryFunction=F(e.createGeometryFunction,function(e){return function(t){const r={id:t.id,position:t.position,point:{pixelSize:F(t.pixelSize,e.pixelSize),color:F(t.color,e.color)}};return t.label&&(r.label={text:t.label}),new xa(r)}}(e)),super(e)}},e.MassiveEntityLayer=_a,e.MassiveGraphicLayer=Fi,e.MassiveGraphicLayerCollection=Ui,e.MassiveModelLayer=class extends Fi{constructor(e={}){e.objects.forEach((e=>{e._id=e.id,delete e.id})),super(e),this._id=F(e.id,fe()),this._createGeometryFunction=e.createGeometryFunction,this._data=e.objects,this._needReclass=!0,this._changeEvent=new Ta,this._maxClusterLevel=F(e.maxClusterLevel,12),this._minLoadLevel=F(e.minLoadLevel,12),this._geometryCached={},this._objectsCached={},this._options=e}get id(){return this._id}get minLoadLevel(){return this._minLoadLevel}set minLoadLevel(e){this._minLoadLevel=e}get objects(){return this._objects||this._data}set objects(e){this._objects=e}updateCluster(e){const t=Ma(e),r=this._objects;return t>this._maxClusterLevel?(this._objects=this._data,this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._objectsCached[t]?(this._objects=this._objectsCached[t],this._needReclass=r!==this._objects,Promise.resolve(this._needReclass)):this._cluster?new Promise(((e,r)=>{this._cluster.update(),this._objects=this._cluster._clusterObjects,this._objectsCached[t]=JSON.parse(JSON.stringify(this._objects)),this._needReclass=!0,e(!0)})):void 0}beginUpdate(e){Ma(e.camera.positionCartographic.height)<this._minLoadLevel?this._objects=[]:this._objects=this._data}endUpdate(e){const t=Ma(e.camera.positionCartographic.height);return this._needReclass=!1,t<this._minLoadLevel}initialize(e,t){if(!this._collection){this._scene=t;const e=new Cesium.PrimitiveCollection;t.primitives.add(e),this._collection=e}}createGeometry(e,t,r){if(e.level<this._minLoadLevel)return;const i=F(this._createGeometryFunction,Aa)(r,this._options);return this.add(i),i}removeGeometry(e,t){if(!t)return;return this._collection.remove(t)}add(e){this._collection&&e&&this._collection.add(e)}removeAll(){this._collection.removeAll()}isDestroyed(){return!1}destroy(){this._collection.removeAll(),Ea(this)}},e.MassivePointLayer=class extends _a{constructor(e={}){e.objects=F(e.objects,[]),e.pixelSize=F(e.pixelSize,5),e.color=F(e.color,Fa.fromRandom),e.createGeometryFunction=F(e.createGeometryFunction,function(e){return function(t){const r={id:t.id,position:t.position,point:{pixelSize:F(t.pixelSize,e.pixelSize),color:F(t.color,e.color)}};return t.label&&(r.label={text:t.label}),new ka(r)}}(e)),super(e)}},e.Model=Ii,e.MultipleTerrainProvider=class{constructor(e,t={}){this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=t.ellipsoid,this._requestVertexNormals=F(t.requestVertexNormals,!1),this._requestWaterMask=F(t.requestWaterMask,!1),this._requestMetadata=F(t.requestMetadata,!0),this._errorEvent=new i,this._terrainProviders=[];const r=[];for(let i of e){i.requestVertexNormals=i.requestVertexNormals||t.requestVertexNormals,i.requestWaterMask=i.requestWaterMask||t.requestWaterMask,i.requestMetadata=i.requestMetadata||t.requestMetadata;const e=new A(i);e.zIndex=i.zIndex||-1,this._terrainProviders.push(e),r.push(tt(e,i.url))}this._ready=!1,this._readyPromise=qe.defer(),this._terrainList=e,Promise.all([...this._terrainProviders.map((e=>e.readyPromise)),...r]).then((e=>{this._ready=!0,this._readyPromise.resolve(!0),this._tilingScheme=this._terrainProviders[0]._tilingScheme,this._levelZeroMaximumGeometricError=Ye.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0))})),this._validProvider=void 0}get tilingScheme(){return this._tilingScheme}get ready(){return this._ready}get readyPromise(){return this._readyPromise}createBoundingRectangle(e){const t=new Je("multiple-terrain-provider");for(let e of this._terrainProviders)t.entities.add(et(e));return e.addLayer(t),function(){const t=e.dataSources.getByName("multiple-terrain-provider");e.dataSources.remove(t[0])}}getLevelMaximumGeometricError(e){return this._validProvider?this._validProvider.getLevelMaximumGeometricError(e):this._levelZeroMaximumGeometricError/(1<<e)}getTileDataAvailable(e,t,r){const i=this._terrainProviders.filter((i=>i.getTileDataAvailable(e,t,r))).sort(((e,t)=>t.zIndex-e.zIndex));return this._validProvider=i[0],!!this._validProvider}requestTileGeometry(e,t,r,i){for(let i of this._terrainProviders)i!==this._validProvider&&i.getTileDataAvailable(e,t,r)&&i.requestTileGeometry(e,t,r);if(this._validProvider)return this._validProvider.requestTileGeometry(e,t,r)}},e.PbfDataSource=function(){},e.QuadTreeProvider=sn,e.Scene=Oo,e.Selection=ct,e.ShaderProgram=ao,e.ShapefileDataSource=wi,e.TDTLayer=class extends ia{constructor(e){const t=(e=F(e,{})).key;t||(console.warn("未定义key，地图服务将不可用"),console.warn("请前往http://lbs.tianditu.gov.cn/server/MapService.html获取地图key"));const r=F(e.tilingScheme,new Cesium.WebMercatorTilingScheme);let i="w",n="w",o=e.tileMatrixLabels;r instanceof Cesium.GeographicTilingScheme&&(i="c",n="c",k(o)||(o=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]));const a=F(e.layer,"img"),s=`http://t{s}.tianditu.com/${a}_${i}/wmts?service=wmts&tileMatrixSet=${n}&request=GetTile&version=1.0.0&LAYER=${a}&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=${t}`;return new Cesium.WebMapTileServiceImageryProvider({url:s,layer:a,style:e.style||"default",format:e.format||"tiles",tileMatrixSetID:"GoogleMapsCompatible",credit:e.credit?new Cesium.Credit(e.credit||""):null,tilingScheme:e.tilingScheme,maximumLevel:e.maximumLevel||19,minimumLevel:e.minimumLevel||0,tileMatrixLabels:o,subdomains:"01234567"})}static layers=[{layer:"vec",desc:"矢量底图"},{layer:"cva",desc:"矢量注记"},{layer:"img",desc:"影像底图"},{layer:"cia",desc:"影像注记"},{layer:"ter",desc:"地形晕渲"},{layer:"cta",desc:"地形注记"},{layer:"ibo",desc:"全球境界"},{layer:"eva",desc:"矢量英文注记"},{layer:"eia",desc:"影像英文注记"}]},e.TMSLayer=sa,e.TaskProcessor=class{constructor(e,t={}){this._workers=[],this._workerPath="workers/"+e,this._options=t,Math.max(X.hardwareConcurrency-1,1),this._worker=Q(this)}},e.TecentLayer=class extends ut{constructor(e={}){e.layer=F(e.layer,"img"),e.subdomains="123",e.url=na[e.layer],e.customTags={sx:function(e,t,r,i){return t>>4},sy:function(e,t,r,i){return(1<<i)-r>>4}},super(e)}},e.TileDebugLayer=class{constructor(e={}){e.tileWidth=F(e.tileWidth,256),e.tileHeight=F(e.tileHeight,256),this._tilingScheme=k(e.tilingScheme)?e.tilingScheme:st.get("EPSG:4326",{ellipsoid:e.ellipsoid}),this._errorEvent=new i,this._tileWidth=F(e.tileWidth,256),this._tileHeight=F(e.tileHeight,256),this._readyPromise=Cesium.when.resolve(!0),this._font=F(e.font,"bold 24px sans-serif"),this._color=F(e.color,new Cesium.Color(1,1,1,1)),this._borderColor=F(e.borderColor,Cesium.Color.GOLD),this._borderWidth=F(e.borderWidth,2)}get ready(){return!0}get readyPromise(){return this._readyPromise}get hasAlphaChannel(){return!0}get errorEvent(){return this._errorEvent}get rectangle(){return this._tilingScheme.rectangle}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get tilingScheme(){return this._tilingScheme}get font(){return this._font}set font(e){this._font=e}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}createCanvas(){const e=document.createElement("canvas");e.width=this.tileWidth,e.height=this.tileHeight;const t=e.getContext("2d");return t.textBaseline="middle",t.textAlign="center",t.font=this.font,t.fillStyle=this.color.toCssColorString(),t.strokeStyle=this.borderColor.toCssColorString(),t.lineWidth=this.borderWidth,{canvas:e,ctx:t}}requestImage(e,t,r,i){const{canvas:n,ctx:o}=this.createCanvas(),a=function(e,t,r,i){let n=[];return n[0]="L: "+i,n[1]="X: "+t,e.reverseY?n[2]="Y: "+e.tilingScheme.getNumberOfYTilesAtLevel(i)-r-1:n[2]="Y: "+r,n}(this,e,t,r);return o.fillText(a[0],n.width/2,n.height/4*1),o.fillText(a[1],n.width/2,n.height/4*2),o.fillText(a[2],n.width/2,n.height/4*3),o.strokeRect(0,0,n.width,n.height),n}},e.TileLayer=class{constructor(e={}){this._errorEvent=new i,this._tilingScheme=st.get("EPSG:4326"),this._readyPromise=oa.defer(),this._ready=!1,this._ready=!0,this._minimumLevel=F(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._tileWidth=F(e.tileWidth,256),this._tileHeight=F(e.tileHeight,256),this._rectangle=F(e.rectangle,aa.MAX_VALUE),this._readyPromise.resolve(!0),this._errorEvent.addEventListener(((e,t,r)=>{}))}get minimumLevel(){return this._minimumLevel}get maximumLevel(){return this._maximumLevel}get errorEvent(){return this._errorEvent}get rectangle(){return this._rectangle}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get tilingScheme(){return this._tilingScheme}get enablePickFeatures(){return this._tileProvider.enablePickFeatures}set enablePickFeatures(e){this._tileProvider.enablePickFeatures=e}get tileHeight(){return this._tileHeight}get tileWidth(){return this._tileWidth}pickFeatures(e,t,r,i,n){}requestImage(e,t,r,i){return this.requestGeometry(e,t,r),Promise.reject(!1)}requestGeometry(e,t,r){}},e.Url=Y,e.VERSION="1.0.3",e.Viewer=Jo,e.WFSLayer=class{constructor(e={}){if(this._url=e.url,this._typeName=e.typeName,this._style=e.style,!k(this._url))throw new t("parameter url must be provided.");if(!k(this._typeName))throw new t("parameter typeName must be provided.");const r=new la({url:e.url,queryParameters:{service:"WFS",version:"1.0.0",request:"GetFeature",typeName:e.typeName,maxFeatures:50,outputFormat:"application/json"}});return nr.load(r,this._style)}get rectangle(){return this._rectangle||this.tilingScheme.rectangle}get tilingScheme(){return st.get("EPSG:4326")}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get ready(){return this._ready}get readyPromise(){return this._readyPromise}},e.WMSLayer=ca,e.WMTSLayer=ia,e.XYZLayer=ut,e._shaderBuildUniforms=function(e,t){Ua._czmBuiltinsAndUniforms[e]=t},e._shaderGlobeFS=ln,e._shaderGroundSkyBoxFS=pe,e._shaderGroundSkyBoxVS=_e,e._shaderLine=function(){},e.computeDistancePerPixel=ue,e.computeSceneCenterPoint=he,e.computeSceneExtent=me,e.createDefaultLayer=dt,e.createGuid=fe,e.dateFormat=ge,e.defaultValue=F,e.defined=k,e.index=Io,e.proj=st,Object.defineProperty(e,"__esModule",{value:!0})}));
